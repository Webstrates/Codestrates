(function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)})(function(t){"use strict";function n(t){var n=t.flags;return null!=n?n:(t.ignoreCase?"i":"")+(t.global?"g":"")+(t.multiline?"m":"")}function e(t){return t.global?t:new RegExp(t.source,n(t)+"g")}function i(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}function r(t,n,i){n=e(n);for(var r=i.line,o=i.ch,l=t.lastLine();r<=l;r++,o=0){n.lastIndex=o;var h=t.getLine(r),s=n.exec(h);if(s)return{from:v(r,s.index),to:v(r,s.index+s[0].length),match:s}}}function o(t,n,o){if(!i(n))return r(t,n,o);n=e(n);for(var l,h=1,s=o.line,c=t.lastLine();s<=c;){for(var f=0;f<h;f++){var u=t.getLine(s++);l=null==l?u:l+"\n"+u}h*=2,n.lastIndex=o.ch;var a=n.exec(l);if(a){var g=l.slice(0,a.index).split("\n"),m=a[0].split("\n"),d=o.line+g.length-1,p=g[g.length-1].length;return{from:v(d,p),to:v(d+m.length-1,1==m.length?p+m[0].length:m[m.length-1].length),match:a}}}}function l(t,n){for(var e,i=0;;){n.lastIndex=i;var r=n.exec(t);if(!r)return e;if(e=r,i=e.index+(e[0].length||1),i==t.length)return e}}function h(t,n,i){n=e(n);for(var r=i.line,o=i.ch,h=t.firstLine();r>=h;r--,o=-1){var s=t.getLine(r);o>-1&&(s=s.slice(0,o));var c=l(s,n);if(c)return{from:v(r,c.index),to:v(r,c.index+c[0].length),match:c}}}function s(t,n,i){n=e(n);for(var r,o=1,h=i.line,s=t.firstLine();h>=s;){for(var c=0;c<o;c++){var f=t.getLine(h--);r=null==r?f.slice(0,i.ch):f+"\n"+r}o*=2;var u=l(r,n);if(u){var a=r.slice(0,u.index).split("\n"),g=u[0].split("\n"),m=h+a.length,d=a[a.length-1].length;return{from:v(m,d),to:v(m+g.length-1,1==g.length?d+g[0].length:g[g.length-1].length),match:u}}}}function c(t,n,e,i){if(t.length==n.length)return e;for(var r=Math.min(e,t.length);;){var o=i(t.slice(0,r)).length;if(o<e)++r;else{if(!(o>e))return r;--r}}}function f(t,n,e,i){if(!n.length)return null;var r=i?g:m,o=r(n).split(/\r|\n\r?/);t:for(var l=e.line,h=e.ch,s=t.lastLine()+1-o.length;l<=s;l++,h=0){var f=t.getLine(l).slice(h),u=r(f);if(1==o.length){var a=u.indexOf(o[0]);if(a==-1)continue t;var e=c(f,u,a,r)+h;return{from:v(l,c(f,u,a,r)+h),to:v(l,c(f,u,a+o[0].length,r)+h)}}var d=u.length-o[0].length;if(u.slice(d)==o[0]){for(var p=1;p<o.length-1;p++)if(r(t.getLine(l+p))!=o[p])continue t;var L=t.getLine(l+o.length-1),x=r(L),C=o[o.length-1];if(L.slice(0,C.length)==C)return{from:v(l,c(f,u,d,r)+h),to:v(l+o.length-1,c(L,x,C.length,r))}}}}function u(t,n,e,i){if(!n.length)return null;var r=i?g:m,o=r(n).split(/\r|\n\r?/);t:for(var l=e.line,h=e.ch,s=t.firstLine()-1+o.length;l>=s;l--,h=-1){var f=t.getLine(l);h>-1&&(f=f.slice(0,h));var u=r(f);if(1==o.length){var a=u.lastIndexOf(o[0]);if(a==-1)continue t;return{from:v(l,c(f,u,a,r)),to:v(l,c(f,u,a+o[0].length,r))}}var d=o[o.length-1];if(u.slice(0,d.length)==d){for(var p=1,e=l-o.length+1;p<o.length-1;p++)if(r(t.getLine(e+p))!=o[p])continue t;var L=t.getLine(l+1-o.length),x=r(L);if(x.slice(x.length-o[0].length)==o[0])return{from:v(l+1-o.length,c(L,x,L.length-o[0].length,r)),to:v(l,c(f,u,d.length,r))}}}}function a(t,n,i,l){this.atOccurrence=!1,this.doc=t,i=i?t.clipPos(i):v(0,0),this.pos={from:i,to:i};var c;"object"==typeof l?c=l.caseFold:(c=l,l=null),"string"==typeof n?(null==c&&(c=!1),this.matches=function(e,i){return(e?u:f)(t,n,i,c)}):(n=e(n),l&&l.multiline===!1?this.matches=function(e,i){return(e?h:r)(t,n,i)}:this.matches=function(e,i){return(e?s:o)(t,n,i)})}var g,m,v=t.Pos;String.prototype.normalize?(g=function(t){return t.normalize("NFD").toLowerCase()},m=function(t){return t.normalize("NFD")}):(g=function(t){return t.toLowerCase()},m=function(t){return t}),a.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(n){for(var e=this.matches(n,this.doc.clipPos(n?this.pos.from:this.pos.to));e&&0==t.cmpPos(e.from,e.to);)n?e.from.ch?e.from=v(e.from.line,e.from.ch-1):e=e.from.line==this.doc.firstLine()?null:this.matches(n,this.doc.clipPos(v(e.from.line-1))):e.to.ch<this.doc.getLine(e.to.line).length?e.to=v(e.to.line,e.to.ch+1):e=e.to.line==this.doc.lastLine()?null:this.matches(n,v(e.to.line+1,0));if(e)return this.pos=e,this.atOccurrence=!0,this.pos.match||!0;var i=v(n?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:i,to:i},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n,e){if(this.atOccurrence){var i=t.splitLines(n);this.doc.replaceRange(i,this.pos.from,this.pos.to,e),this.pos.to=v(this.pos.from.line+i.length-1,i[i.length-1].length+(1==i.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",function(t,n,e){return new a(this.doc,t,n,e)}),t.defineDocExtension("getSearchCursor",function(t,n,e){return new a(this,t,n,e)}),t.defineExtension("selectMatches",function(n,e){for(var i=[],r=this.getSearchCursor(n,this.getCursor("from"),e);r.findNext()&&!(t.cmpPos(r.to(),this.getCursor("to"))>0);)i.push({anchor:r.from(),head:r.to()});i.length&&this.setSelections(i,0)})});
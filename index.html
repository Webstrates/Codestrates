<!doctype html>
<html __wid="8iiFCgMH" version="13" mode="edit"><head __wid="nyQjClRO"><meta __wid="VC-iR3Y0" name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-capable" content="yes" __wid="h-Ul6mwY"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" __wid="iiS6bfZA"/><script __wid="znuXkD9m" id="script-main">webstrate.on("loaded", function () { new Function(document.querySelector("#bootstrap").textContent)(); });</script><title __wid="F6LQLpsp">Codestrate Packages</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" __wid="6EZTL7cK"/>
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" __wid="uHtXDWTx"/>
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" __wid="LUQGv6Nm"/>
<link rel="apple-touch-icon" sizes="180x180" href="favicon-apple-touch-icon-180x180.png" __wid="bqAGJjKj"/>
<link rel="manifest" href="manifest.json" __wid="UmDGTqYg"/><STYLE __wid="LPGV8qVq"></STYLE><STYLE __wid="KqnvxgJL"></STYLE><STYLE __wid="7gw3AqVQ"></STYLE></head><body __wid="KajDX5Up" class style="touch-action: manipulation; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);">































<div __wid="_Y8mEnp4" id="sections"><div class="section section-hidden" name="Bootstrapping" data-id="QF65zNxe" data-type="system" data-group="basic" __wid="twRQEkaR"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="DTYb8h2d" draggable="false" __wid="ANvaNvja"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="vNDNgVL4"><h2 __wid="ZPScTucT">Codestrate Bootstrapping</h2>A codestrate is bootstrapped with a single line of code that is in a script tag in the head of the document. The script will then query for the code paragraph with the ID <code __wid="iTHLWMxi">#bootstrap</code> (see below) and execute the code in a Function object. The scope of code paragraph execution does not create a closure to their surrounding context preventing any interferences with other code executions. The #bootstrap code then executes all code that has a class .bootstrap-module before paragraphs with "run-on-load" (green running man) get executed.<div __wid="NqUgGxVw"><br __wid="fq2CeJWQ"/></div><div __wid="5K4LkWx2">The <code __wid="ammQ7xss">.bootstrap</code>-module code paragraphs add a loading screen, establish <i __wid="46ymfdxE">virtual machines</i> for JavaScript and JSON, enable "run-on-load" code paragraph execution, add functions to import libraries and require code from other code paragraphs, and add query extensions (e.g., query selectors that are based on MutationObserver). The virtual machines allow execution of JavaScript code after page load and without creating a closure to their surrounding context.<br __wid="8peAdgkc"/><h2 __wid="fa7EFdTN">Attention</h2><div __wid="K2J2h8kT">Do not change the ID of the #bootstrap code. It needs to be #bootstrap, otherwise the codestrate will not bootstrap.</div></div><h1 __wid="pvsUZee8">APIs</h1><h2 __wid="FqWC7cGi">Commands API</h2><div __wid="QMv2Fgx9">The Commands API is used to store commands, which should be available everywhere in a codestrate. A command consists of the following three parts:</div><div __wid="2aPdaZ72"><ul __wid="HBXMSz8B"><li __wid="ekbxx5MS"><code __wid="aBxi8kf5">id</code>: The identifier of a command. Use points to divide the command id from it's package or prefix (e.g. <code __wid="g8Q3qiPr">codestrates.sections.addSection</code>).</li><li __wid="CnEhiDJx"><code __wid="DkraLTBK">name</code>: A human readable name/description of the command.</li><li __wid="sRZVQXfW"><code __wid="YXRNYt3V">action</code>: A callback function, containing the action of a command.</li><li __wid="DgAP8Gii"><code __wid="2CmQA98Q">description</code>: An optional description of the command.</li></ul><div __wid="iPe7Xsj9">To manage, add or remove commands the following functions exist:</div></div><div __wid="LJmfK4Jn"><ul __wid="DPaUqLEY"><li __wid="cNhM2zgR"><code __wid="UEdpC9be">Codestrate.commands</code>: Returns the full list of commands.</li><li __wid="fyQLPwXf"><code __wid="xUSbCHth">Codestrate.getCommand(id)</code>: Returns the command with the given id.</li><li __wid="h2vTBnzA"><code __wid="bpjWrvvS">Codestrate.executeCommand(id)</code>: Executes the command with given id.</li><li __wid="fWjwgWgh"><code __wid="UHCXXjLE">Codestrate.addCommand(id, name, action, description = "")</code>: Adds a new command.</li><li __wid="v957DWFF"><code __wid="BT58yyB5">Codestrate.removeCommand(id)</code>: Removes a exisiting command.</li><li __wid="ndScNq4Y"><code __wid="X4xLHWU5">Codestrate.updateCommand(id, name, action, description = "")</code>: Removes a existing command and then adds the updated version.<br __wid="SdKJtSwG"/></li></ul><h2 __wid="8UMaRmpg">KeyBindings API</h2></div><div __wid="bdG8xYq2">The KeyBindings API works in conjunction with the Commands API. It allows to map commands to keybindings. A keybinding consists of the following three parts:</div><div __wid="DFCkJqBf"><ul __wid="ALtMk9BE"><li __wid="ZMSJTmca"><code __wid="4kjKxqBr">id</code>: The id of a command.</li><li __wid="iy3kWpeS"><code __wid="RdmasRbb">key</code>: The keyboard shortcut (see <a href="https://craig.is/killing/mice" target="_blank" __wid="fncUFupA">here</a> for a list of supported keys).</li><li __wid="UKCsFiC8"><code __wid="MpfBzV2P">preventDefault</code>: If set true, the shortcut will prevent the default shortcut action to be executed.</li></ul><div __wid="nGJ7Wkhx">To manage, add or remove keybindings the following functions exit:</div></div><div __wid="z3nm6nmc"><ul __wid="qWa92LYL"><li __wid="9B9Ay29m"><code __wid="Dkh8BB68">Codestrate.keyBindings</code>: Returns a list of all keybindings.</li><li __wid="riAuCYzF"><code __wid="t6hfYpqP">Codestrate.addKeyBinding(id, key, preventDefault = false)</code>: Adds a new keybinding.</li><li __wid="UNbfNE9E"><code __wid="e3AstCw2">Codestrate.removeKeyBinding(id, key)</code>: Removes a existing keybinding.</li></ul><div __wid="KGJcj87W"><b __wid="LfmtRr6K">Hint</b>: Instead of using <code __wid="nRUrQu6W">cmd</code> and <code __wid="fzLdeZxe">ctrl</code> one can use <code __wid="nYpjzp6s">mod</code>, which is <kbd __wid="arGUi7FS">ctrl</kbd> on Windows and <kbd __wid="wVq2mZ6J">cmd</kbd> on macOS.</div></div></div></div>
<div class="paragraph data-paragraph collapsed locked" name="Properties" data-id="UQHBUNEJ" __wid="qZDZ83Lf"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="EVaWmhDQ">{
  "version": "1.3.6",
  "description": "Bootstraps the bootstrap code and executes all other 'run-on-load' paragraphs.",
  "changelog": {
    "1.0": "Initital Release",
    "1.0.1": "Added description.",
    "1.1": "Changed Execute Code Paragraphs and expose Codestrate.executeParagraphsSync function to execute multiple paragraphs in sync order.",
    "1.2": "Added Commands and KeyBindings APIs.",
    "1.2.1": "Introduced Codestrate.addEventListener(\"loaded\", () => {}) event and a new event mechansims allowing to create custom events on the codestrate object (also allowing for immediate trigger event on addEventListener depending on an immediateTriggerEvent function parameter on the Codestrate.createEvent function).",
    "1.2.2": "Loading overlay and disconnect overlay have a close button (X) at the top right to close the overlay.",
    "1.3": "Execution and re-execution of required code paragraphs is based on the hash of the code. Changing the code paragraphs content that is required will automatically re-execute it on require.",
    "1.3.1": "Added #event-utils with debounce function",
    "1.3.2": "Added EventTarget.prototype.addDisposableEventListener.",
    "1.3.3": "Added throttle function to #event-utils.",
    "1.3.4": "Fixed bug in event handling when removeEventListener in an event listener function.",
    "1.3.5": "Introduced new theme API that checks webstrate cookie here if theme is set and sets that theme as current codestrate them. You can set new theme with Codestrate.theme = \"MyTheme\"",
    "1.3.6": "Log id when command ids are duplicated."
  }
}</pre></div><div class="paragraph code-paragraph collapsed" name="Bootstrap Code" draggable="false" last-execution-state="success" data-id="usn4MyQZ" __wid="4h89t6ux"><pre data-type="content" type="text/javascript" id="bootstrap" __wid="FkNwcz8U">window.getParameterByName = function (name, url) {
  if (!url) {
    url = window.location.href;
  }
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, " "));
};

const exec = getParameterByName("exec");

// Do not execute bootstrap code. This is also used by pull sections to minimize transclusion time
// of codestrate from which sections will be pulled.
if (exec === "no") {
  // const loadedEvent = new CustomEvent("codestrateloaded");
  // window.dispatchEvent(loadedEvent);
  return;
}

// Bluntly override Codestrate object if it exists
const Codestrate = window.Codestrate = {};

// Define properties on codestrate object and make them not writable (default)
Object.defineProperties(Codestrate, {

  version: {
    get() {
      return document.documentElement.getAttribute("version") || 0;
    },
    set(version) {
      document.documentElement.setAttribute("version", version);
    },
  },

  mode: {
    get() {
      return document.documentElement.getAttribute("mode") || "edit";
    },
    set(mode) {
      if (typeof mode === 'undefined') {
        document.documentElement.removeAttribute("mode");
      } else {
        document.documentElement.setAttribute("mode", mode);
      }
    },
  },
  OS: {
    get() {
      return {
        isMac() {
          return (navigator.userAgent.indexOf("Mac OS X") != -1);
        }
      };
    }
  }
});

/**
 * Execute bootstrap modules. All code paragraphs with bootstrap-module class will
 * be executed in the order in which they are defined. Changing the order can
 * break the Codestrate.
 */
var modules = document.querySelectorAll(".bootstrap-module");

if (!modules) return;

var len = modules.length;

for (var i = 0; i &lt; len; i++) {
  let module = modules[i];
  let paragraph = module.closest('.paragraph');

  let codeSource = paragraph.getAttribute("id") ||
    (paragraph.getAttribute("name") &&
      paragraph.getAttribute("name").replace(/\W/g, "_")) ||
    `VM${Date.now()}`;

  let code = modules[i].textContent;
  code = `${code}\n//# sourceURL=${codeSource}`;
  new Function(code)();
}</pre></div><div class="paragraph code-paragraph collapsed" data-id="88j6RXRd" name="Enable custom theme if set in user cookies" draggable="false" style __wid="BA2t2rJ3"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="67vxyBaU">const enableTheme = (theme) => {
  document.documentElement.setAttribute("transient-theme", theme);
};

Object.defineProperty(Codestrate, "theme", {
  get() {
    return document.documentElement.getAttribute("transient-theme");
  },
  set(value) {
    // enable same theme for all clients of the same user, otherwise if user is
    // not logged in the enable it locally
    if (webstrate.user && webstrate.user.cookies) {
      webstrate.user.cookies.here.set("theme", value);
    }
    else {
      enableTheme(value);
    }
  }
});

webstrate.on("cookieUpdateHere", function(key, value) {
  if (key === "theme") {
    enableTheme(value);
  }
});

if (webstrate.user && webstrate.user.cookies) {
  const theme = webstrate.user.cookies.here.get("theme");
  enableTheme(theme);
}</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Event Handling" style data-id="N3B5Vng9" __wid="VeXtq75P"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="AjHMbvRe">// available codestrate events
const events = [];

// registered event handlers
const eventHandlers = {};

const createEvent = (name, triggerImmediately = false, immediateEventObject = undefined) => {
	events.push({
		name,
		triggerImmediately,
		immediateEventObject
	});
};

const checkEvent = (name) => {
	// throw event if event wasn't created
	if (!events.some((event) => event.name === name)) {
		throw new Error(`event "${name}" does not exist`);
	}
	return true;
};

const shouldTriggerEventImmediately = (name) => {
	let eventMetadata = events.find((event) => event.name === name);
	if (eventMetadata.triggerImmediately) {
		if (typeof eventMetadata.triggerImmediately === 'function') {
			return eventMetadata.triggerImmediately();
		}
		return eventMetadata.triggerImmediately;
	}
	return false;
};

const addEventListener = (name, handler) => {
	checkEvent(name);

	if (!eventHandlers.hasOwnProperty(name)) {
		eventHandlers[name] = [];
	}
	let handlers = eventHandlers[name];
	handlers.push(handler);

	// checks if event should be triggered immediately, e.g., useful for the loaded event that should
	// trigger the event handler immediately if the codestrate has already loaded
	if (shouldTriggerEventImmediately(name)) {
		let eventMetadata = events.find((event) => event.name === name);
		let eventObject;
		if (typeof eventMetadata.immediateEventObject === 'function') {
			eventObject = eventMetadata.immediateEventObject();
		}
		else {
			eventObject = eventMetadata.immediateEventObject;
		}
		handler(eventObject);
	}
};

const removeEventListener = (name, handler = undefined) => {
	checkEvent(name);

	if (!eventHandlers.hasOwnProperty(name)) {
		return;
	}

	// Remove all handlers for this event
	if (!handler) {
		delete eventHandlers[name];
		return;
	}

	let handlers = eventHandlers[name];
	let idx = handlers.indexOf(handler);
	handlers.splice(idx, 1);
};

const dispatchEvent = (name, event) => {
	checkEvent(name);

	if (eventHandlers.hasOwnProperty(name)) {
    // copy event handlers because a handler can removeEventListener and
    // therefore change the eventHandlers array while it is iterating
		const handlers = [...eventHandlers[name]];
		for (let i = 0; i &lt; handlers.length; i++) {
			handlers[i](event);
		}
	}
};

Object.defineProperty(Codestrate, "events", {
	get() {
		return events;
	}
});

Codestrate.createEvent = createEvent;
Codestrate.addEventListener = addEventListener;
Codestrate.removeEventListener = removeEventListener;
Codestrate.dispatchEvent = dispatchEvent;</pre></div><div class="paragraph code-paragraph collapsed" data-id="YTQS3snR" name="Loaded Event Handling" __wid="aCA3gJHy"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="yQv5mCi7">// Codestrate has loaded state
let loaded = false;

// create loaded event
Codestrate.createEvent("loaded", () => {
	return loaded;
});

// Codestrate loaded property
Object.defineProperty(Codestrate, "loaded", {
  get() {
    return loaded;
  }
});

// create hook to dispatch loaded event on window object to allow transcluders of this codestrate to
// register an event handler for codestrateloaded events
Codestrate.addEventListener("loaded", (event) => {

	// flag codestrate as loaded
	loaded = true;

  const loadedEvent = new CustomEvent("codestrateloaded");
  window.dispatchEvent(loadedEvent);
});</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Get Parameter By Name Function" data-id="AfanMQdJ" style __wid="MBqSgjCN"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="5XwsC4CZ">if (!Codestrate.hasOwnProperty("params")) {

  /**
   * Creates an array of all url parameters
   */
  const params = {};
  const paramsString = window.location.search.substring(1).split('&');
  for (let i = 0; i &lt; paramsString.length; i++) {
    let paramString = paramsString[i];

    // Ignore if parameter string is empty
    if (!paramString || paramString === "") {
      continue;
    }

    let keyValue = paramsString[i].split('=');
    let key = keyValue[0];
    let value = keyValue[1] && decodeURIComponent(keyValue[1].replace(/\+/g, " "));

    // Try to parse value into a JavaScript object or primitive type (e.g., bool), ignore if it fails
    try {
      value = JSON.parse(value);
    } catch (error) {
      // Ignore
    }

    params[key] = value;
  }

  Object.defineProperty(Codestrate, 'params', {
    get: () => {
      return {
        _params: params,
        has(name) {
          return this._params.hasOwnProperty(name);
        },
        get(name, defaultValue = undefined) {
          return this.has(name) ? this._params[name] : defaultValue;
        }
      };
    }
  });
}

// @deprecated, will be removed soon
const getParameterByName = function (name, url) {
  console.warn(`window.getParameterByName is deprecated; use Codestrate.params.get(name, defaultValue)`);

  if (!url) {
    url = window.top.location.href;
  }
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, " "));
};

window.getParameterByName = getParameterByName;</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Polyfills" data-id="kBAUzKmQ" style __wid="bjXGcsCd"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="vTwNhZXF">if (window.Element && !Element.prototype.closest) {

	console.log('Adding polyfill for Element.prototype.closest');

	Element.prototype.closest =
		function (s) {
		var matches = (this.document || this.ownerDocument).querySelectorAll(s),
				i,
				el = this;
		do {
			i = matches.length;
			while (--i >= 0 && matches.item(i) !== el) {};
		} while ((i &lt; 0) && (el = el.parentElement));
		return el;
	};
}

if (!Element.prototype.matches) {

	console.log('Adding polyfill for Element.prototype.matches');

	Element.prototype.matches =
		Element.prototype.matchesSelector ||
		Element.prototype.mozMatchesSelector ||
		Element.prototype.msMatchesSelector ||
		Element.prototype.oMatchesSelector ||
		Element.prototype.webkitMatchesSelector ||
		function (s) {
		var matches = (this.document || this.ownerDocument).querySelectorAll(s),
				i = matches.length;
		while (--i >= 0 && matches.item(i) !== this) {}
		return i > -1;
	};
}

// Production steps of ECMA-262, Edition 5, 15.4.4.18
// Reference: http://es5.github.io/#x15.4.4.18
if (!Array.prototype.forEach) {

	console.log('Adding polyfill for Array.prototype.forEach');

	Array.prototype.forEach = function (callback /*, thisArg*/ ) {

		var T, k;

		if (this == null) {
			throw new TypeError('this is null or not defined');
		}

		// 1. Let O be the result of calling toObject() passing the
		// |this| value as the argument.
		var O = Object(this);

		// 2. Let lenValue be the result of calling the Get() internal
		// method of O with the argument "length".
		// 3. Let len be toUint32(lenValue).
		var len = O.length >>> 0;

		// 4. If isCallable(callback) is false, throw a TypeError exception.
		// See: http://es5.github.com/#x9.11
		if (typeof callback !== 'function') {
			throw new TypeError(callback + ' is not a function');
		}

		// 5. If thisArg was supplied, let T be thisArg; else let
		// T be undefined.
		if (arguments.length > 1) {
			T = arguments[1];
		}

		// 6. Let k be 0
		k = 0;

		// 7. Repeat, while k &lt; len
		while (k &lt; len) {

			var kValue;

			// a. Let Pk be ToString(k).
			//    This is implicit for LHS operands of the in operator
			// b. Let kPresent be the result of calling the HasProperty
			//    internal method of O with argument Pk.
			//    This step can be combined with c
			// c. If kPresent is true, then
			if (k in O) {

				// i. Let kValue be the result of calling the Get internal
				// method of O with argument Pk.
				kValue = O[k];

				// ii. Call the Call internal method of callback with T as
				// the this value and argument list containing kValue, k, and O.
				callback.call(T, kValue, k, O);
			}
			// d. Increase k by 1.
			k++;
		}
		// 8. return undefined
	};
}

if (!window.requestAnimationFrame) {

	console.log('Adding polyfill for window.requestAnimationFrame');

	// http://paulirish.com/2011/requestanimationframe-for-smart-animating/
	// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating

	// requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel

	// MIT license

	(function () {
		var lastTime = 0;
		var vendors = ['ms', 'moz', 'webkit', 'o'];
		for (var x = 0; x &lt; vendors.length && !window.requestAnimationFrame; ++x) {
			window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
			window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||
				window[vendors[x] + 'CancelRequestAnimationFrame'];
		}

		if (!window.requestAnimationFrame)
			window.requestAnimationFrame = function (callback, element) {
				var currTime = new Date().getTime();
				var timeToCall = Math.max(0, 16 - (currTime - lastTime));
				var id = window.setTimeout(function () {
					callback(currTime + timeToCall);
				},
																	 timeToCall);
				lastTime = currTime + timeToCall;
				return id;
			};

		if (!window.cancelAnimationFrame)
			window.cancelAnimationFrame = function (id) {
				clearTimeout(id);
			};
	}());
}

if (!Element.prototype || !CharacterData.prototype || !DocumentType.prototype) {

	console.log('Adding polyfill for {Element.prototype, CharacterData.prototype, DocumentType.prototype}.replaceWith');

	// from: https://github.com/jserz/js_piece/blob/master/DOM/ChildNode/replaceWith()/replaceWith().md
	(function (arr) {
		arr.forEach(function (item) {
			if (item.hasOwnProperty('replaceWith')) {
				return;
			}
			Object.defineProperty(item, 'replaceWith', {
				configurable: true,
				enumerable: true,
				writable: true,
				value: function replaceWith() {
					var argArr = Array.prototype.slice.call(arguments),
							docFrag = document.createDocumentFragment();

					argArr.forEach(function (argItem) {
						var isNode = argItem instanceof Node;
						docFrag.appendChild(isNode ? argItem : document.createTextNode(String(argItem)));
					});

					this.parentNode.replaceChild(docFrag, this);
				}
			});
		});
	})([Element.prototype, CharacterData.prototype, DocumentType.prototype]);
}</pre></div><div class="paragraph code-paragraph collapsed" data-id="AhVjMmTX" name="Bind & Unbind Function" style __wid="JtuUzEjr"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="zFQV3rid">Function.prototype.bind = (function(origBind) {
  return function() {
		let that = this.unbind();
		var fn = origBind.apply(that, arguments);
    fn.__origFn__ = that.__origFn__ || that;
    return fn;
  };
}(Function.prototype.bind));

Function.prototype.unbind = function() {
  return this.__origFn__ || this;
};</pre></div><div class="paragraph code-paragraph collapsed" name="Random String" draggable="false" data-id="HRefSutb" style __wid="wWKtdhfU"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="jnPahZSG">Codestrate.util = {
	/**
	 * Get random string of size.
	 * @param  {int}    size     Expected length of string (optional).
	 * @param  {string} alphabet List of characters to be used in string (optional).
	 * @return {string}          Generated string.
	 * @public
	 */
	randomString(size = 8,
								// Does not include 0, O, o, 1, I, l for readability.
								alphabet = "23456789abcdefghijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ") {
		const len = alphabet.length;
		let str = "";
		while (size--) {
			str += alphabet[this.random(0, len)];
		}
		return str;
	},

	/**
	 * Get random integer from interval [min, max). Unbiased and evenly distributed (or close to).
	 * @param  {int} min Minimum number, inclusive.
	 * @param  {int} max Maximum number, exclusive.
	 * @return {int}     Random number in interval [min, max);
	 * @public
	 */
	random(min, max) {
		return Math.floor(min + Math.random() * (max - min));
	}
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="6MetzGEq" name="Overlay Helper" __wid="vwPTJV6a"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="wqG2Q7AC">Codestrate.createProgressOverlay = () => {

  // Hide document while loading all external webstrates.
  const loadingContainer = document.createElement("transient");
  loadingContainer.classList.add("overlay");

  const loadingIndicator = document.createElement("div");
  loadingIndicator.classList.add("loading-indicator");

  const centerPiece = document.createElement("div");
  centerPiece.classList.add("center-piece");
  centerPiece.appendChild(loadingIndicator);
  loadingContainer.appendChild(centerPiece);

  const closeButton = document.createElement("div");
  closeButton.classList.add("close");
  closeButton.innerHTML = `&lt;i class="material-icons">close&lt;/i>`;
  loadingContainer.appendChild(closeButton);

  // remove loading container on click on close button
  closeButton.addEventListener("click", () => {
    loadingContainer.remove();
  });

  return loadingContainer;
};</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Loading Indicator" data-id="U6W7p2mW" style __wid="uP3uQiSp"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="RMHLT5Dp">let overlay = Codestrate.createProgressOverlay();
overlay.classList.add("loading");
document.body.appendChild(overlay);

const removeOverlay = () => {
  // Push to next macro task to allow CSS of codestrate to be properly applied before removing
  // the loading indicator. Otherwise it will be a bit jaggy
  setTimeout(() => {
    setTimeout(() => {
      overlay.remove();
    }, 0);
  }, 0);
};

// remove loading indicator after codestrate loaded
Codestrate.addEventListener("loaded", removeOverlay);</pre></div><div class="paragraph code-paragraph collapsed" name="Disconnect / Reconnect Code" draggable="false" style data-id="7NLAf26s" __wid="BgCX6Div"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="9qYYhpya">let overlay;

const showOfflineOverlay = () => {
  if (!overlay) {
    overlay = Codestrate.createProgressOverlay();
    overlay.classList.add("disconnected");
    document.body.appendChild(overlay);
  }
};

webstrate.on("reconnect", function () {
  if (overlay) {
    overlay.remove();
    overlay = null;
  }
});

webstrate.on("disconnect", function () {
  showOfflineOverlay();
});</pre></div><div class="paragraph code-paragraph collapsed" name="Query Extensions" draggable="false" data-id="gbYXPcgb" style __wid="VtqXxwNX"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="w7ApXRJR">// The Codestrates Query Extension do not trigger events for elements with class "template" or
// elements that have a parent with class "template". This is a temporary solution until actual
// HTML5 template elements are supported within Codestrates.

/**
 * Ignore mutations for elements with class template or for elements that have a parent element
 * with class template
 */
const isMutationAllowed = (element) => {
	return !element.closest(".template");
};

/**
 * The live query selector
 */
const liveQuerySelectorAll = function (selector, observerOptions = { subtree: true, childList: true }) {

	const elements = this.querySelectorAll(selector);

	let addResolve;
	let removeResolve;

	let observer;
	if (observerOptions) {
		observer = new MutationObserver(mutations => {

			mutations.forEach(mutation => {

				switch (mutation.type) {
					case "childList":

						if (removeResolve) {
							Array.prototype.forEach.call(mutation.removedNodes, (node) => {
								if (node.nodeType !== 1) return;

								try {
									if (node.matches(selector)) {
										removeResolve(node);
									}

									if (observerOptions.subtree) {
										const subNodes = node.querySelectorAll(selector);
										Array.prototype.forEach.call(subNodes, (subNode) => removeResolve(subNode));
									}
								} catch (error) {
									window.console.error(error, node);
								}
							});
						}

						if (addResolve) {
							Array.prototype.forEach.call(mutation.addedNodes, (node) => {
								if (node.nodeType !== 1) return;

								try {
									if (node.matches(selector)) {
										addResolve(node);
									}

									if (observerOptions.subtree) {
										const subNodes = node.querySelectorAll(selector);
										Array.prototype.forEach.call(subNodes, (subNode) => addResolve(subNode));
									}
								} catch (error) {
									window.console.error(error, node);
								}
							});
						}
						break;
				}
			});
		});
		observer.observe(this, observerOptions);
	}

	const resolver = {
		added(resolve) {

			if (typeof resolve !== "function")
				throw new Error("First parameter needs to be a function");

			// Add resolve function that also checks for allowed mutations
			addResolve = (element) => {
				if (!isMutationAllowed(element)) return;
				resolve(element);
			};

			// Immediately callback resolve function to notifiy callee about initial elements
			Array.prototype.forEach.call(elements, (element) => {
				addResolve(element);
			});

			return resolver;
		},
		removed(resolve) {
			if (typeof resolve !== "function")
				throw new Error("First parameter needs to be a function");

			// Remove resolve function that also checks for allowed mutations
			removeResolve = (element) => {
				if (!isMutationAllowed(element)) return;
				resolve(element);
			};

			return resolver;
		},
		stop() {
			if (observer) {
				observer.disconnect();
			}
		}
	};

	return resolver;
};

Document.prototype.liveQuerySelectorAll = liveQuerySelectorAll;
Element.prototype.liveQuerySelectorAll = liveQuerySelectorAll;

/******************************************************************************/

const liveAttribute = function(attributeName) {
	const element = this;

	let attributeChanged;

	const observer = new MutationObserver(mutations => {

		if (typeof attributeChanged === "function") {
			mutations.forEach(mutation => {

				if (mutation.attributeName === attributeName) {
					attributeChanged(mutation.target.getAttribute(attributeName), mutation.oldValue);
				}
			});
		}
	});
	observer.observe(element, { attributes: true, attributeOldValue: true });

	let resolver = {
		changed(resolve) {

			// Attribute changed function that also checks for allowed mutations
			attributeChanged = (value, oldValue) => {
				if (!isMutationAllowed(element)) return;
				resolve(value, oldValue);
			};

			// Immediately callback resolve function to notifiy callee about initial attribute value
			attributeChanged(element.getAttribute(attributeName), undefined);
			return resolver;
		},
		stop() {
			observer.disconnect();
		}
	};

	return resolver;
};

Element.prototype.liveAttribute = liveAttribute;</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Virtual Machine (VM)" data-id="hJYaHnaf" style __wid="JMcXMPf3"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="5CYxEZZY">const mergeContexts = (...contexts) => {
  const context = {};

  contexts.forEach(ctx => {
    Object.keys(ctx).forEach(key => {
      context[key] = ctx[key];
    });
  });

  return context;
};

const updateTypeSelectors = (names) => {
  document.liveQuerySelectorAll('.code-paragraph').added((paragraph) => {
    const ParagraphUtils = Codestrate.require('#paragraph-utils');
    let header = ParagraphUtils.getHeaderElement(paragraph);
    let content = ParagraphUtils.getContentElement(paragraph);
    // debugger;
    ParagraphUtils.addSelectElement(header, "type", content, names);
  });
};

Codestrate.VirtualMachines = {
  _vms: {},
  get(name) {
    return this._vms[name];
  },
  create(names, executeFunc) {

    if (Codestrate.loaded) {
      updateTypeSelectors(names);
    } else {
      window.addEventListener("codestrateloaded", function codestrateLoaded() {
        updateTypeSelectors(names);
        window.removeEventListener("codestrateloaded", codestrateLoaded);
      });
    }

    const vm = {
      context: {}
    };

    vm.addToGlobalContext = (context) => {
      vm.context = mergeContexts(vm.context, context);
    };

    vm.getExecutionContext = (context = {}) => {

      const tmpContext = mergeContexts(vm.context, {
        console: Codestrate.activeConsole || window.console,
        Variable: window.Variable,
        SharedMemory: Codestrate.SharedMemory
      }, context);

      return {
        execute: (code) => {
          try {
            return executeFunc(code, tmpContext);
          } catch (error) {

            // Log events only once, but still propagate them to the first paragraph
            // that initiated execution
            if (!error.handled) {
              // Set actual source of error
              error.source = tmpContext.codeSource;
              error.paragraph = tmpContext.paragraph;
              error.handled = true;
              tmpContext.console.error(error);
            }

            throw error;
          }
        }
      };
    };

    // Store vm
    if (typeof names === 'string') {
      this._vms[names] = vm;
    } else {
      names.forEach((name) => {
        this._vms[name] = vm;
      });
    }
  }
};</pre></div><div class="paragraph code-paragraph collapsed" draggable="true" name="JavaScript VM" last-execution-state="success" data-id="wpGiGayi" style __wid="CevkSYGx"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="bFTPXb5F">Codestrate.VirtualMachines.create(["text/javascript"], (code, context) => {
	code = `${code}\n//# sourceURL=${context.codeSource}`;

	let argNames = Object.keys(context);
	let args = argNames.map((key) => context[key]);

	let f = new Function(...argNames, code);

	// bind each argument function to the paragraph
	args = args.map((arg) => {
		if (typeof arg === 'function') {
			return arg.bind(context.paragraph);
		}
		return arg;
	});

	// bind function to code paragraph, so that 'this' keyword refers to paragraph instead of window
	// object
	return f.call(context.paragraph, ...args);
});</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="JSON VM" data-id="42Z4ifSq" style __wid="ZZudCRuJ"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="YTt5rAs9">Codestrate.VirtualMachines.create(["application/json"], (code) => {
	const f = new Function(`return ${code}`);
	return f();
});</pre></div><div class="paragraph code-paragraph collapsed" name="Execute Code Paragraphs" data-id="GVBwaApD" style __wid="uXk7xjMJ"><pre data-type="content" type="text/javascript" class="bootstrap-module" __wid="vxTxzbyG">// create events for execute paragraphs
Codestrate.createEvent("beforeruncode");
Codestrate.createEvent("successruncode");
Codestrate.createEvent("errorruncode");
Codestrate.createEvent("afterruncode");

Codestrate.runCode = (paragraph, exports) => {

  // Block execution of consecutive code paragraphs until this paragraph executed completely after
  // importing all libs or requiring other code paragraphs.
  let blockHandle = Codestrate.blockExecution("Codestrate.runCode");

  const codeSelector = '[data-type="content"]';
  const element = paragraph.querySelector(codeSelector);

  if (!element) {
    throw new Error(`Could not find ${codeSelector} in paragraph`);
  }

  const codeType = element.getAttribute("type");
  if (!codeType) {
    throw new Error(`Could not find type attribute on ${element}`);
  }

  var code = element.innerText;

  Codestrate.dispatchEvent("beforeruncode", {
    paragraph: paragraph,
    code: code
  });

  let codeSource = paragraph.getAttribute("id") ||
    (paragraph.getAttribute("name") && paragraph.getAttribute("name").replace(/\W/g, "_")) ||
    `VM${Codestrate.util.randomString()}`;

  try {
    const vm = Codestrate.VirtualMachines.get(codeType);

    const context = vm.getExecutionContext({
      paragraph,
      codeSource,
      exports
    });

    context.execute(code);

    Codestrate.dispatchEvent("successruncode", {
      paragraph: paragraph,
      code: code
    });
  } catch (error) {

    Codestrate.dispatchEvent("errorruncode", {
      error: error,
      paragraph: paragraph,
      code: code
    });
  }

  Codestrate.dispatchEvent("afterruncode", {
    paragraph: paragraph,
    code: code
  });

  // Release block handle
  blockHandle.continue();
};

let paragraphSelector = '.paragraph[run-on-load="true"]';


if (!Codestrate.params.has("edit") && Codestrate.mode !== "edit") {
  let groupSelector = `.section[data-group="basic"] ${paragraphSelector}`;
  paragraphSelector = `.section:not([data-group]) ${paragraphSelector},${groupSelector}`;
}
// groups as parameters are deprecated
else if (Codestrate.params.has("groups")) {
  let groups = Codestrate.params.get("groups");
  let groupSelector = groups.map((group) => {
    return `.section[data-group="${group}"] ${paragraphSelector}`;
  }).join(",");

  paragraphSelector = `.section:not([data-group]) ${paragraphSelector},${groupSelector}`;
}

// console.log('execute selector', paragraphSelector);

Codestrate.executeParagraphsSync = (executeOnLoadParagraphs) => {
  return new Promise((resolve, reject) => {

		const exports = {};
    const len = executeOnLoadParagraphs.length;

    let currentIndex = 0;
    let blockedExecutionCount = 0;

    const execute = () => {

      // Break execution loop when all paragraph have been executed.
      if (currentIndex >= len) {
        return resolve(exports);
      }

      const paragraph = executeOnLoadParagraphs[currentIndex];

      Codestrate.runCode(paragraph, exports);

      if (!blockedExecutionCount) {
        execute(++currentIndex);
      }
    };

    Codestrate.blockExecution = (message = "", timeout = 30000) => {
      ++blockedExecutionCount;
      let hasContinued = false;

      let timeoutHandle;

      const continueWithNext = () => {
        clearTimeout(timeoutHandle);
        --blockedExecutionCount;

        if (!blockedExecutionCount) {
          hasContinued = true;
          execute(++currentIndex);
        }
      };

      timeoutHandle = setTimeout(() => {
        const confirmMessage = `Loading "${message}" is taking too long. Do you want to continue?`;
        if (window.confirm(confirmMessage)) {
          continueWithNext();
        }
      }, timeout);

      return {
        continue: () => {
          if (!hasContinued) {
            continueWithNext();
          }
        }
      };
    };

    // Execute first paragraph if one exists.
    if (len) {
      execute(currentIndex);
    }
  });
};

(async() => {
  const executeOnLoadParagraphs = Array.from(document.querySelectorAll(paragraphSelector));

  let exports = await Codestrate.executeParagraphsSync(executeOnLoadParagraphs);

	// store global exports
	Codestrate.global = exports;

	// trigger codestrate loaded event
	Codestrate.dispatchEvent("loaded");
})();</pre></div><div class="paragraph code-paragraph collapsed" name="Template Code" draggable="false" run-on-load="true" data-id="BsNZH7Rd" last-execution-state="success" __wid="KLx3uu2J"><pre data-type="content" type="text/javascript" __wid="nH6ewaQt">const func = `return eval('\`' + __str__ + '\`');`;

window.template = function (str, data) {
	let context = Object.assign({}, data, {
		__str__: str
	});

	const argNames = Object.keys(context);
	const args = argNames.map((key) => context[key]);

	const f = new Function(...argNames, func);
	return f(...args);
};</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Import Function" run-on-load="true" style data-id="HpbBedd6" last-execution-state="success" __wid="KLi5LK7M"><pre data-type="content" type="text/javascript" __wid="4DxuWvHW">const relativeUrlRegex = new RegExp('^\\s*(?:[a-z0-9]+:)?//', 'i');
const isCacheEnabled = Codestrate.params.get("cache", false);
const cacheKeyPrefix = "notestrate-import:";

console.debug(`Cache enabled: ${isCacheEnabled}`);

let importsContainer = document.head.querySelector('transient#imports');

// Add imports container if it does not exist.
if (!importsContainer) {
	importsContainer = document.createElement("transient");
	importsContainer.setAttribute("id", "imports");
	document.head.insertBefore(importsContainer, document.head.firstChild);
}

/**
 * Returns true if the resource is relative path to this webstrate.
 *
 * @param {string} src Url to resource.
 * @param {boolean} Returns true if the resource is relative.
 */
const isRelativeResource = (src) => {
	return !relativeUrlRegex.test(src);
};

const getLatestAssets = () => {

	let latestAssets = {};
	let assets = webstrate.assets.call({});
	Array.prototype.forEach.call(assets, asset => {
		if (!latestAssets[asset.fileName] || latestAssets[asset.fileName].v &lt; asset.v) {
			latestAssets[asset.fileName] = asset;
		}
	});

	return latestAssets;
};

// Webstrate assets to check if cached resource needs to be updated.
const assets = []; //getLatestAssets();

/**
* Executes JavaScript code by adding it to a script element, which is then appended
* to the importsContainer transient element. The script element is returned.
*
* @param {string} code The JavaScript code.
* @return {HTMLScriptElement} The script element containing the code.
*/
const executeJavaScript = function (code) {

	// Add sourcemap functionality to script
	code = `${code}\n//# sourceURL=${Codestrate.util.randomString()}`;

	const script = document.createElement("script");
	script.setAttribute("type", "text/javascript");

	// Use text node to make large scripts work (> 65k characters)
	const textNode = document.createTextNode(code);
	script.appendChild(textNode);

	importsContainer.appendChild(script);

	return script;
};

/**
* Executes the CSS by adding it to a style element, which is then appended to the
* importsContainer transient element. The style element is returned.
*
* @param {string} css The CSS style.
* @param {HTMLStyleElement The style element containing the css.
*/
const executeCss = function (css) {

	// Create the style element
	const style = document.createElement("style");

	// Add styles
	style.innerHTML = css;

	// WebKit hack :(
	style.appendChild(document.createTextNode(""));

	// Add the style element to the page
	importsContainer.appendChild(style);

	return style;
};

const storeInCache = (src, type) => {

	// Check if cache is enabled and only cache resources are from this webstrate.
	if (!isCacheEnabled || !isRelativeResource(src)) {
		return false;
	}

	// Get asset and only cache if asset for resource exists.
	const asset = assets[src];

	if (typeof (Storage) !== "undefined" && asset) {

		// Get resource and store its content in cache.
		fetch(src, { credentials: 'include' }).then(externalResource => {
			externalResource.text().then(content => {

				const resource = {
					asset,
					type,
					content
				};

				localStorage.setItem(`${cacheKeyPrefix}${src}`, JSON.stringify(resource));
			});
		});
	}
};

/**
 * It loads the source from cache if the cache is enabled and if it exists in cache
 */
const loadFromCache = (src) => {

	if (!isCacheEnabled) {
		return false;
	}

	if (typeof (Storage) !== "undefined") {

		const value = localStorage.getItem(`${cacheKeyPrefix}${src}`);

		if (value) {
			try {
				const { asset, type, content } = JSON.parse(value);

				// If asset does not exist then it has been updated eventually
				if (assets[asset.fileName].v > asset.v) {
					localStorage.removeItem(`${cacheKeyPrefix}${src}`);
					return false;
				}

				let imported = importsContainer.querySelector(`[data-src="${src}"]`);

				// Source already imported
				if (imported) {
					return true;
				}

				// 				console.debug(`Loading ${asset.fileName}?v=${asset.v} from cache`);

				let element;
				if (type === "text/javascript") {
					element = executeJavaScript(content);
				}
				else if (type === "text/css") {
					element = executeCss(content);
				}
				else {
					throw new Error(`Type "${type}" is not supported.`);
				}
				element.setAttribute("data-cached", "true");
				element.setAttribute("data-src", src);
				return true;
			} catch (error) {
				debugger;
				console.error(`Could not load source ${src} from cache. Removing it from cache.`, error);
				localStorage.removeItem(`${cacheKeyPrefix}${src}`);
			}
		}
	}

	return false;
};

window.importLib = function (src, type = "text/javascript") {

	// Block execution of consecutive code paragraphs until all external libraries imported
	// by the current code paragraph have been executed.
	const blockHandle = Codestrate.blockExecution(src);

	const loadLibrary = (s, callback) => {

		if (loadFromCache(s)) {
			setTimeout(() => {
				callback();
			}, 0);
			return;
		}

		let script = importsContainer.querySelector(`script[src="${s}"]`);

		// Import source only once.
		if (!script) {
			script = document.createElement("script");
			script.setAttribute("type", type);
			script.setAttribute("src", s);
			script.onload = () => {
				script.__loaded = true;

				if (isCacheEnabled) {
					storeInCache(s, type);
				}

				callback();

				if (script.__callbacks) {
					script.__callbacks.forEach(cb => cb());
				}
			};
			importsContainer.appendChild(script);
		}
		// Script is imported by another code paragraph, but has not been loaded completely
		// by the first one. So, the callback is added to a list and called after the
		// has loaded.
		else if (!script.__loaded) {
			if (!script.__callbacks) {
				script.__callbacks = [];
			}
			script.__callbacks.push(callback);
		}
		// The script has been loaded and executed before. Just continue.
		else {
			callback();
		}
	};

	// Returns a promise like function, which will be executed when all imports
	// were loaded.
	return {

		then: (resolve) => {

			if (typeof src === "string") {
				loadLibrary(src, () => {
					try {
						resolve();
					} finally {
						blockHandle.continue();
					}
				});
			} else if (Array.isArray(src)) {

				const len = src.length;
				let i = 0;

				const loadNextLib = () => {
					if (i &lt; len) {
						loadLibrary(src[i], () => {
							++i;
							loadNextLib();
						});
					} else {
						try {
							resolve();
						} finally {
							blockHandle.continue();
						}
					}
				};

				loadNextLib();
			} else {
				throw new Error(`The 1 parameter must be a string or an array of strings instead of ${src}`);
			}
		}
	};
};

/**
 * Load style from source.
 *
 * @param {string|Array} src The url to the source or an array of urls to sources.
 */
const loadStyle = (src) => {

	// Load resource from cache and return on success.
	if (loadFromCache(src))	return;

	let link = importsContainer.querySelector(`link[src="${src}"]`);

	// Import resource only once.
	if (!link) {
		link = document.createElement("link");
		link.setAttribute("rel", "stylesheet");
		link.setAttribute("href", src);
		importsContainer.appendChild(link);

		if (isCacheEnabled) {
			storeInCache(src, "text/css");
		}
	}
};

// Export importStyle function to global window object.
window.importStyle = function (src) {
	if (typeof src === "string") {
		loadStyle(src);
	} else if (Array.isArray(src)) {
		src.forEach(loadStyle);
	} else {
		throw new Error(`The 1 parameter must be a string or an array of strings instead of ${src}`);
	}
};</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Require Function" run-on-load="true" data-id="47dEZgUz" __wid="GqJPgTa8"><pre data-type="content" type="text/javascript" __wid="gw5ExKZx">const vm = Codestrate.VirtualMachines.get("text/javascript");

/**
 * Hash code function to check if a required code paragraphs needs to be
 * re-executed.
 */
const hashCode = (str) => {
  var hash = 0, i, chr;
  if (str.length === 0) return hash;
  for (i = 0; i &lt; str.length; i++) {
    chr   = str.charCodeAt(i);
    hash  = ((hash &lt;&lt; 5) - hash) + chr;
    hash |= 0; // Convert to 32bit integer
  }
  return hash;
};

const requireSingle = (codeElement, data, multiple = false) => {

	let code;
	if (multiple) {
		code = codeElement.map((element) => {
			return element.innerText;
		}).join("\n\n");
		codeElement = codeElement[0];
	}
	else {
		code = codeElement.innerText;
	}

	// Replace placeholders like ${myVar} in code
	if (data) {
		code = template(code, data);
	}

	let paragraph = codeElement.closest(".paragraph");

	let codeSource = paragraph.getAttribute("id") ||
			(paragraph.getAttribute("name") &&
			 paragraph.getAttribute("name").replace(/\W/g, "_")) ||
			`VM${Codestrate.util.randomString()}`;

	const type = codeElement.getAttribute("type");

	if (type === "text/javascript") {

		// generate hash code for code string to check if it needs to be executed
		// or whether the exports object from a previous execution should be used
		let hash = hashCode(code);

		// Return exports from previous execution when resuse exports is enabled
		if (codeElement.__required && codeElement.__required.hash === hash) {
			return codeElement.__required.exports;
		}

		let exports = {};
		const context = vm.getExecutionContext({
			paragraph,
			codeSource,
			exports
		});

		context.execute(code);

		// Store exports in for later reuse
		codeElement.__required = {
			hash,
			exports
		};

		return exports;
	} else if (type === "application/json") {
		const jsonVM = Codestrate.VirtualMachines.get(type);
		const context = jsonVM.getExecutionContext();
		return context.execute(code);
	} else if (type === "text/css") {
		return code;
	} else if (type === "text/html") {
		let html = codeElement.innerHTML;

		if (data) {
			html = template(html, data);
		}

		const container = document.createElement("div");
		container.innerHTML = html;

		return Array.from(container.children).map(c => c);
	}

	return code;
};

const require = (selector, data) => {
	const codeElements = Array.from(document.querySelectorAll(`${selector}[data-type="content"]`));

	if (!codeElements.length) {
		throw new Error(`require("${selector}") does not exist`);
	}

	if (codeElements.length > 1) {
		return requireSingle(codeElements, data, true);
	}

	return requireSingle(codeElements[0], data);
};

const requireAll = (selector, data) => {
	const codeElements = Array.from(document.querySelectorAll(`${selector}[data-type="content"]`));

	let exports = Array.prototype.map.call(codeElements, (codeElement) => {
		return requireSingle(codeElement, data);
	});

	return exports;
};

// Add require to global execution context for JavaScript virtual machine
vm.addToGlobalContext({
	require,
	requireAll
});

// For debugging: export to Codestrate object
Codestrate.require = require;
Codestrate.requireAll = requireAll;</pre></div><div class="paragraph code-paragraph collapsed" name="Destroy Event Listeners On Rerun" style draggable="false" data-id="8237gBwR" last-execution-state="success" __wid="mHJQxnCC"><pre data-type="content" type="text/javascript" id="destroy-event-listeners-on-rerun" __wid="N5Hi4XdH">Codestrate.addEventListener("beforeruncode", (event) => {

	const {
		paragraph,
		code
	} = event;

	// Add codestrate object
	if (!paragraph.codestrate) {
		paragraph.codestrate = {};
	}

	if (paragraph.__listeners) {
		// console.info('removing event listeners added during a previous run of this paragraph', paragraph.__listeners);
		paragraph.__listeners.forEach((listener) => {
			listener.source.removeEventListener(...listener.parameters);
		});

		// Clear list of event listeners
		paragraph.__listeners.length = 0;
	} else {
		paragraph.__listeners = [];
	}

	if (!paragraph.codestrate.customAddEventListener) {
		paragraph.codestrate.customAddEventListener = function () {
			var parameters = Array.from(arguments);
			// window.console.log('arguments %o', parameters);

			try {
				paragraph.codestrate.oldAddEventListener.call(this, ...parameters);
				paragraph.__listeners.push({
					source: this,
					parameters: parameters
				});
			} catch (error) {
				throw error;
			}
		};
	}

	// Only register custom event listener once as another code paragraph might have already done this
	if (Node.prototype.addEventListener === paragraph.codestrate.customAddEventListener) {
		console.warn('prevent overriding addEventListener multiple times');
		return;
	}

	// Keep a reference to the previous event listener, which will be re-added after the code paragraph ran
	paragraph.codestrate.oldAddEventListener = Node.prototype.addEventListener;

	// Temporarily override addEventListener with custom implementation
	Node.prototype.addEventListener = paragraph.codestrate.customAddEventListener;
});

Codestrate.addEventListener("afterruncode", (event) => {

	const {
		paragraph
	} = event;

	// Ignore this code paragraph's after run
	if (paragraph.querySelector('#destroy-event-listeners-on-rerun')) {
		return;
	}

	// Re-add old addEventListener
	if (paragraph.codestrate.oldAddEventListener) {
		Node.prototype.addEventListener = paragraph.codestrate.oldAddEventListener;
		delete paragraph.codestrate.oldAddEventListener;
	}
});</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Destroy DOM Elements On Rerun" style data-id="qaqmECVU" __wid="Ku3TFDt7"><pre data-type="content" type="text/javascript" id="destroy-dom-elements-on-rerun" __wid="3cVrGVrd">Codestrate.addEventListener("beforeruncode", (event) => {

	const {
		paragraph,
		code
	} = event;

	// Add codestrate object
	if (!paragraph.codestrate) {
		paragraph.codestrate = {};
	}

	if (paragraph.__appendedChildren) {
		console.info("removing children appended during a previous run of this paragraph", paragraph.__appendedChildren);
		paragraph.__appendedChildren.forEach((child) => {
			child.remove();
		});

		// Clear list of event listeners
		paragraph.__appendedChildren.length = 0;
	} else {
		paragraph.__appendedChildren = [];
	}

	if (!paragraph.codestrate.customAppendChild) {
		paragraph.codestrate.customAppendChild = function (child) {
			paragraph.__appendedChildren.push(child);
			paragraph.codestrate.oldAppendChild.call(this, child);
		};
	}

	// Only register custom appendChild once as another code paragraph might have already done this
	if (Node.prototype.appendChild === paragraph.codestrate.customAppendChild) {
		console.warn("prevent overriding appendChild multiple times");
		return;
	}

	// Keep a reference to the previous appendChild function, which will be re-added after the code paragraph ran
	paragraph.codestrate.oldAppendChild = Node.prototype.appendChild;

	// Temporarily override appendChild with custom implementation
	Node.prototype.appendChild = paragraph.codestrate.customAppendChild;
});

Codestrate.addEventListener("afterruncode", (event) => {

	const {
		paragraph
	} = event;

	// Ignore this code paragraph"s after run
	if (paragraph.querySelector("#destroy-dom-elements-on-rerun")) {
		return;
	}

	// Re-add old addEventListener
	if (paragraph.codestrate.oldAddEventListener) {
		Node.prototype.appendChild = paragraph.codestrate.oldAppendChild;
		delete paragraph.codestrate.oldAppendChild;
	}
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="h8nwFkzx" name="EventTarget.prototype.addDisposableEventListener" run-on-load="true" __wid="d4u2NqrC"><pre data-type="content" type="text/javascript" __wid="y2ekdEcH">EventTarget.prototype.addDisposableEventListener = function(type, listener, capture, ...unused) {
  this.addEventListener(type, listener, capture, ...unused);
  return {
    dispose: () => {
      this.removeEventListener(type, listener, capture, ...unused);
    }
  };
};</pre></div><div class="paragraph code-paragraph collapsed" run-on-load="true" last-execution-state="success" draggable="false" name="Dialog VM Overwrite" style data-id="W54QAJP8" __wid="siA5ZcP9"><pre data-type="content" type="text/javascript" __wid="GFwjtELa">const Dialogs = require("#dialog-utils");

const vm = Codestrate.VirtualMachines.get("text/javascript");
vm.addToGlobalContext({
	alert: Dialogs.alert,
	confirm: Dialogs.confirm,
	prompt: Dialogs.prompt,
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="wrrZ5anC" name="Reload codestrate" run-on-load="true" last-execution-state="success" __wid="kXF4VZc2"><pre data-type="content" type="text/javascript" __wid="4JhS8Juq">webstrate.on("signal", (signal, senderId) => {

	// reload codestrate when reload message comes in
	if (signal.source === "codestrate" && signal.cmd === "reload") {
		// reload codestrate
		Codestrate.reload(signal.message, senderId === webstrate.clientId);
	}
});

// only reloads this codestrate
Codestrate.reload = (message, self = true) => {

	if (self) {
		alert(message, "Reloading Codestrate");
		(async() => {
			// reload when last operations were received by the server
			await webstrate.dataSaved();
			window.location.reload();
		})();
	}
	else {
		(async() => {
			let result = await confirm(`${message}&lt;br>&lt;br>Do you want to reload?`, "Reloading Codestrate");
			if (result) {
				window.location.reload();
			}
		})();
	}
};

// triggers reloading all clients connected to this codestrate
Codestrate.reloadAll = (message) => {

	(async() => {
		// reload when last operations were received by the server
		await webstrate.dataSaved();

		webstrate.signal({
			source: "codestrate",
			cmd: "reload",
			message
		});
	})();
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="dn6jQVsC" name="Commands and Key Bindings" run-on-load="true" __wid="6MwPki9R"><pre data-type="content" type="text/javascript" __wid="xDCr8yp2">const commandList = [];
const keyBindings = [];

/******************************************************************************/

const findCommand = (id) => commandList.find(el => el.id === id);
const findCommandIndex = (id) => commandList.findIndex(el => el.id === id);

const findKeyBinding = (id, key) => keyBindings.find(el => (el.id === id && el.key === key));
const findKeyBindingIndex = (id, key) => keyBindings.findIndex(el => (el.id === id && el.key === key));

/******************************************************************************/

importLib([
	"mousetrap.min.js",
	"mousetrap-global-bind.min.js"
]).then(() => {

	/**
	 * Returns the whole command map.
	 */
	const getCommandList = () => {
		return commandList.map(command => Object.assign({}, command));
	};

	/**
	 * Returns a command if found.
	 */
	const getCommand = (id) => {
		return Object.assign({}, findCommand(id));
	};

	/**
	 * Executes a command if found.
	 */
	const executeCommand = (id, event = null) => {
		const command = findCommand(id);
		if (command) {
			return command.action(event);
		} else {
			console.log(`Command "${id}" not found!`);
			return false;
		}
	};

/******************************************************************************/

	/**
	 * Adds a new command.
	 */
	const addCommand = (id, name, action, description = "") => {
		if (id === null || id === "") {
			console.error("A command needs an id!");
			return false;
		} else if (findCommand(id)) {
			console.error(`A command needs an unique id (${id})`);
			return false;
		} else if (name === null || name === "") {
			console.error("A command needs a name!");
			return false;
		} else if (action === null || typeof action !== "function") {
			console.error("A command action needs to be of type function!");
			return false;
		}

		const command = {
			id: id,
			name: name,
			action: action,
			description: description
		};

		commandList.push(command);

		var evt = document.createEvent("CustomEvent");
		evt.initCustomEvent("CommandAdded", true, true, command);
		window.dispatchEvent(evt);

		return command;
	};

	/**
	 * Removes a command if found.
	 */
	const removeCommand = (id) => {
		const command = findCommand(id);

		if (!command) {
			console.log(`Command "${id}" not found!`);
			return false;
		}

		const index = findCommandIndex(name);
		commandList.splice(index, 1);

		var evt = document.createEvent("CustomEvent");
		evt.initCustomEvent("CommandRemoved", true, true, command);
		window.dispatchEvent(evt);

		return command;
	};

	/**
	 * Updates a command by removing and adding it again.
	 */
	const updateCommand = (id, name, action, description) => {
		const oldCommand = removeCommand(id);
		const newCommand = addCommand(id, name, action, description);
		return {
			oldCommand: oldCommand,
			newCommand: newCommand
		};
	};

/******************************************************************************/

	/**
	 * Returns the keyBindings.
	 */
	const getKeyBindings = () => {
		return keyBindings.map(keyBinding => Object.assign({}, keyBinding));
	};

	/**
	 * Binds a new key mapping.
	 */
	const bindKey = (id, key, preventDefault = false) => {
		if (id === null || id === "") {
			console.error("A keybinding needs a command id!");
			return false;
		} else if (findKeyBinding(id, key)) {
			console.log("This keybinding already exits.");
			return false;
		} else if (key === null || key === "") {
			console.error("A keybinding needs keys!");
			return false;
		}

		const keyBinding = {
			id: id,
			key: key,
			preventDefault: preventDefault
		};

		keyBindings.push(keyBinding);
		Mousetrap.bindGlobal(key, (event) => {
			if (preventDefault) {
				event.preventDefault();
				executeCommand(id, event);
				return false;
			} else {
				return executeCommand(id, event);
			}
		});

		var evt = document.createEvent("CustomEvent");
		evt.initCustomEvent("KeyBindingAdded", true, true, keyBinding);
		window.dispatchEvent(evt);

		return keyBinding;
	};

	/**
	 * Removes and unbinds a key mapping.
	 */
	const unbindKey = (id, key) => {
		const keyBinding = findKeyBinding(id, key);

		if (!keyBinding) {
			console.log(`Keybinding "${id}" - "${key}" not found!`);
			return false;
		}

		const index = findKeyBindingIndex(id, key);
		keyBindings.splice(index, 1);
		Mousetrap.unbind(key);

		var evt = document.createEvent("CustomEvent");
		evt.initCustomEvent("KeyBindingRemoved", true, true, keyBinding);
		window.dispatchEvent(evt);

		return keyBinding;
	};

/******************************************************************************/

	Object.defineProperty(Codestrate, "commands", {
		get: () => getCommandList()
	});
	Object.defineProperty(Codestrate, "getCommand", {
		value: (id) => getCommand(id),
	});
	Object.defineProperty(Codestrate, "executeCommand", {
		value: (id) => executeCommand(id),
	});
	Object.defineProperty(Codestrate, "addCommand", {
		value: (id, name, action, description) => addCommand(id, name, action, description),
	});
	Object.defineProperty(Codestrate, "removeCommand", {
		value: (id) => removeCommand(id),
	});
	Object.defineProperty(Codestrate, "updateCommand", {
		value: (id, name, action, description) => updateCommand(id, name, action, description),
	});

	Object.defineProperty(Codestrate, "keyBindings", {
		get: () => getKeyBindings(),
	});
	Object.defineProperty(Codestrate, "addKeyBinding", {
		value: (id, key, preventDefault) => bindKey(id, key, preventDefault),
	});
	Object.defineProperty(Codestrate, "removeKeyBinding", {
		value: (id, key) => unbindKey(id, key),
	});
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="2Hu8vGMx" name="Event Utils" __wid="AhXvStJA"><pre data-type="content" type="text/javascript" id="event-utils" __wid="ciqXqUYy">// Returns a function, that, as long as it continues to be invoked, will not
// be triggered. The function will be called after it stops being called for
// N milliseconds. If `immediate` is passed, trigger the function on the
// leading edge, instead of the trailing.
// Original source: https://davidwalsh.name/function-debounce
// https://davidwalsh.name/javascript-debounce-function
exports.debounce = (func, wait, immediate) => {
  let timeout;
  return function () {
    const context = this;
    const args = arguments;
    const later = function () {
      timeout = null;
      if (!immediate) func.apply(context, args);
    };
    const callNow = immediate && !timeout;
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
    if (callNow) func.apply(context, args);
  };
};

// Source???
exports.throttle = (fn, limit) => {
	let timeout;
	let lastCall = 0;
	return function (...args) {
		let now = Date.now();
		let delay = lastCall + limit - now;
		if (delay &lt;= 0) {
			fn(...args);
			lastCall = now;
		} else {
			clearTimeout(timeout);
			timeout = setTimeout(function () {
				fn(...args);
				lastCall = now;
			}, delay);
		}
	};
};</pre></div></div><div name="Console" class="section section-hidden" data-type="system" data-group="basic" data-id="nyjy5imM" __wid="qx6TYbDK"><div class="paragraph body-paragraph locked collapsed" name="Documentation" draggable="false" data-id="BR9vXBE3" __wid="jLym6BsV"><div data-type="content" contenteditable="false" class="section-documentation" type="text/html" codemirror="true" __wid="RgDzw65Y"><h2 __wid="AzeKSNeT">Description</h2>The console section adds a console to each code paragraph. All console calls within a paragraph are logged to the paragraph's console before logs are redirected to the browser console. To show the console, this section adds a console button to each paragraph header. Clicking the console button toggles the console. Consoles are hidden by default and located in a transient element, which means their state is not synchronized with other clients have the same codestrate open.</div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="x22UQapi" __wid="r2PNZHpd"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="XgYKxvAV">{
	"version": "1.1",
	"description": "Adds a console to each code paragraph.",
	"changelog":
	{
		"1.1": "Styling with variables.",
		"1.0": "Initital Release"
	}
}</pre></div>
<div class="paragraph code-paragraph collapsed" name="Console Code" draggable="false" last-execution-state="success" data-id="8gS9rQm6" __wid="5eRtkiQD" run-on-load="true"><pre data-type="content" type="text/javascript" __wid="hd3GXPW7">importLib("moment.min.js").then(() => {

	class Console {

		constructor(paragraph, container) {
			this.messageBufferSize = 100;
			this.paragraph = paragraph;
			this.container = container;

			// Logs go to buffer and will be subsequently rendered in requestAnimationFrame.
			this._outputBuffer = [];

			this._addHeader();
			this._addOutput();
			this._addInput();

			this._addCloseButton();

			this.container.classList.add("close");

			// Scroll to paragraph that produced the error
			this.paragraph.addEventListener("click", (event) => {
				let target = event.target;

				const error = target.closest("[error-id]");
				if (error) {
					event.preventDefault();

					const source = error.getAttribute("source");
					const lineNumber = Number(error.getAttribute("line-number")) - 1;

					const paragraph = error.__paragraph;
					paragraph.classList.remove("collapsed");

					const section = paragraph.closest(".section");
					section.classList.remove("section-hidden");

					const content = paragraph.querySelector("[data-type='content']");

					// add class to line with error
					if (content.__editor && content.__editor.editor) {

						let cm = content.__editor.editor;
						const addError = (lineHandle) => {
							cm.addLineClass(lineHandle, "background", "line-error");
							cm.addLineClass(lineHandle, "text", "line-error-text");
							// cm.addLineClass(lineHandle, "gutter", "line-error-text");
							// cm.addLineClass(lineHandle, "wrap", "line-error-text");

							cm.focus();
							cm.setCursor(lineNumber, 0);
						};

						const removeError = (lineHandle) => {
							cm.removeLineClass(lineHandle, "background", "line-error");
							cm.removeLineClass(lineHandle, "text", "line-error-text");
							// cm.removeLineClass(lineHandle, "gutter", "line-error-text");
							// cm.removeLineClass(lineHandle, "wrap", "line-error-text");
						};

						// Remove previous error
						if (this.errorLineHandle) {
							removeError(this.errorLineHandle);
							this.errorLineHandle = null;
						}

						// Add error
						this.errorLineHandle = cm.getLineHandle(lineNumber);
						addError(this.errorLineHandle);

						// remove error on editor change
						let that = this;
						cm.on("change", function change() {
							cm.off("change", change);

							if (that.errorLineHandle) {
								removeError(that.errorLineHandle);
								that.errorLineHandle = null;
							}
						});
					}

					paragraph.scrollIntoView();
				}
			});
		}

		open() {
			this.container.classList.remove("close");
			setTimeout(() => {
				this.container.classList.add("open");
			}, 1);
		}

		close() {
			const onClosed = (event) => {
				if (event.propertyName === "height") {
					this.container.removeEventListener("transitionend", onClosed);
					this.container.classList.add("close");
				}
			};

			this.container.removeAttribute("style");
			this.container.addEventListener("transitionend", onClosed, false);
			this.container.classList.remove("open");
		}

		toggle() {
			if (this.container.classList.contains("open")) {
				this.close();
			} else {
				this.open();
			}
		}

		destroy() {
			this.close();

			this.container.addEventListener("transitionend", (event) => {
				if (event.propertyName === "height") {
					this.container.remove();
				}
			}, false);
		}

		log() {
			this._internalLog("log", ...arguments);
		}

		info() {
			this._internalLog("info", ...arguments);
		}

		error() {
			this._internalLog("error", ...arguments);
		}

		warn() {
			this._internalLog("warn", ...arguments);
		}

		debug() {
			this._internalLog("debug", ...arguments);
		}

		trace() {
			this._internalLog("trace", ...arguments);
		}

		_addHeader() {
			this.header = document.createElement("div");
			this.header.setAttribute("class", "header");
			this.container.appendChild(this.header);
		}

		_addOutput() {
			this.output = document.createElement("div");
			this.output.setAttribute("class", "output");
			this.container.appendChild(this.output);
		}

		_addInput() {
			this.input = document.createElement("div");
			this.input.setAttribute("class", "input");

			let history = [];
			let historyIndex = -1;

			const inputElement = document.createElement("input");
			inputElement.setAttribute("type", "text");
			inputElement.addEventListener("keydown", event => {

				// alert("key code" + event.key);

				if (event.keyCode === 13) {

					// Get console input
					const value = inputElement.value;

					// Ignore empty console input
					if (value.trim() === "") {
						return;
					}

					// Push console input to history
					history.push(value);
					historyIndex = history.length;

					try {
						// const f = new Function("console", `return ${value}`);
						// const result = f(this);

						this.log(value);

						const result = eval(value);

						this.log(result);
					} catch (error) {
						this.error(error);
					}
					finally {
						// Reset console input
						inputElement.value = "";
					}
				} else if (event.keyCode === 38) {
					if (historyIndex > 0) {
						inputElement.value = history[--historyIndex];
					}
				} else if (event.keyCode === 40) {
					if (historyIndex &lt; history.length - 1) {
						inputElement.value = history[++historyIndex];
					}
					else {
						historyIndex = history.length;
						inputElement.value = "";
					}
				}
			});
			this.input.appendChild(inputElement);

			this.container.appendChild(this.input);
		}

		_addCloseButton() {
			const closeConsole = document.createElement("span");
			closeConsole.setAttribute("class", "close-console");
			closeConsole.addEventListener("click", event => {
				if (typeof this.onClose === "function") {
					if (this.onClose.call(this)) {
						this.close();
					}
				} else {
					this.close();
				}
			});

			const icon = document.createElement("i");
			icon.setAttribute("class", "material-icons");
			closeConsole.appendChild(icon);

			this.header.appendChild(closeConsole);
		}

		_updateScroll() {
			this.output.scrollTop = this.output.scrollHeight;
		}

		_internalLog(type, ...args) {

			// Log to actual DevTools console including the paragraph that contains the code.
			const console = window.console;
			if (console) {
				const consoleLog = console[type];
				if (typeof consoleLog === "function") {
					const location = this.paragraph.getAttribute("name") || "No Name";
					console.group("Console %c%s", "color: orange;", location);
					consoleLog.call(window, ...args);
					console.groupCollapsed("%cLog Source", "font-weight: normal;");
					console.log(this.paragraph);
					console.groupEnd();
					console.groupEnd();
				}
			}

			this._outputBuffer.push({
				// timestamp: moment().format("YYYY-MM-DD HH:mm:ss.SSS"),
				timestamp: moment().format("HH:mm:ss.SSS"),
				type: type,
				args: args
			});

			let location = "";

			/**
       * Convert arg to output that conforms to console output.
       */
			const convertArg = (arg) => {

				let converted = arg;

				if (arg instanceof Error) {

					let error = arg;

					// let codeSource = tmpContext.codeSource;
					// if (error.source) {
					// codeSource = error.source;
					// }

					// window.console.log(error.source);

					const codeSelector = "[data-type='content']";
					const element = error.paragraph.querySelector(codeSelector);

					// window.console.error(error, error.source);
					const regex = new RegExp("^([^\n]+)\n" + // error string
																	 "[^]+?" + // whatever comes before the parenthesis
																	 "\\((?:.*?):" + // code name or trash, non-capturing
																	 "([0-9]+):([0-9]+)\\)" // parenthesis
																	);

					const matches = error.stack.match(regex);
					if (matches) {
						let [_, errorString, lineNumber, letterNumber] = matches;
						// Everything except SyntaxErrors will be in a `new Function` construct with
						// two appended lines, which we should account for.
						if (errorString.substring(0,12) !== "SyntaxError:") {
							lineNumber = lineNumber - 2;
						}

						const errorId = Codestrate.util.randomString();

						location = `&lt;span error-id="${errorId}" source="${error.source}" line-number="${lineNumber}">${error.source}:${lineNumber}&lt;/span>`;

						converted = `${errorString}&lt;br>  at (${location})`;

						setTimeout(() => {
							const spans = document.querySelectorAll(`[error-id="${errorId}"]`);
							Array.prototype.forEach.call(spans, (span) => {
								span.__paragraph = error.paragraph;
							});
						}, 0);
					} else {
						converted = error.stack;
					}
				} else if (arg instanceof HTMLElement) {
					// Convert HTML element to a string.
					// !!! The replace is required otherwise the console will render the HTML
					// instead of logging the markup.
					converted = arg.outerHTML.replace(/[\u00A0-\u9999&lt;>\&]/gim, (idx) => {
						return `&#${idx.charCodeAt(0)};`;
					});
				} else if (typeof arg === "object") {
					try {
						converted = JSON.stringify(arg, null, "  ");
					} catch (error) {
						// window.console.error(error);
						converted = arg.toString();
					}
				}

				let type = typeof arg;
				if (arg === null) {
					type = "null";
				}

				return `&lt;span class="${type}">${converted}&lt;/span>`;
			};

			const logToOutput = () => {

				// Reduce log messages to maximum of buffer size
				let limit = this.messageBufferSize - this._outputBuffer.length;
				while (this.output.childNodes.length > limit && this.output.childNodes.length > 0) {
					this.output.firstElementChild.remove();
				}

				const fragment = document.createDocumentFragment();

				this._outputBuffer.forEach((item) => {
					const entry = document.createElement("div");
					entry.classList.add("log-output");
					entry.classList.add(item.type);

					const args = item.args.map(convertArg);
					let message = args.join(" ");

					entry.innerHTML = `
&lt;div class="time">${item.timestamp}&lt;/div>
&lt;div class="message">${message}&lt;/div>
&lt;div class="location">${location}&lt;/div>
`;
					fragment.appendChild(entry);
				});

				this.output.appendChild(fragment);

				this._updateScroll();

				// Clear output buffer
				this._outputBuffer.length = 0;

				// Allow new animation frame requests
				this.requestedAnimationFrame = false;
			};

			if (!this.requestedAnimationFrame) {
				this.requestedAnimationFrame = true;
				window.requestAnimationFrame(logToOutput);
			}
		}
	}

	// Hook into Active Essay bootstrap and set console for currently executed code block
	Codestrate.addEventListener("beforeruncode", event => {
		const { paragraph } = event;

		// Set active console.
		Codestrate.activeConsole = paragraph.console;
	});

	const addConsole = (paragraph) => {

		// Add console only once
		if (paragraph.console) return;

		const consoleContainer = document.createElement("transient");
		consoleContainer.setAttribute("class", "console");

		// Attach actual console to element
		const console = new Console(paragraph, consoleContainer);
		paragraph.console = console;
		paragraph.appendChild(consoleContainer);
	};

	document.liveQuerySelectorAll(".paragraph.code-paragraph").added(addConsole);
});</pre></div><div class="paragraph style-paragraph collapsed" draggable="false" name="Console Style" data-id="Xi64tc6E" __wid="MGzRYRhb"><style data-type="content" type="text/css" class="themable" __wid="sENZiQ8g" codemirror="true">html .console {
	margin-top: 8px;
	width: 100%;
	height: 0;
	opacity: 0;
	pointer-events: none;
	z-index: 9;
	border-radius: 2px;
	display: none;
	background: var(--color-primary-shade-1);
	padding: 8px;
	/* -webkit-transition: height 500ms ease-in-out 0s, opacity 500ms ease-in-out 0s;
	-moz-transition: height 500ms ease-in-out 0s, opacity 500ms ease-in-out 0s;
	transition: height 500ms ease-in-out 0s, opacity 500ms ease-in-out 0s; */
}

html .console.open {
	display: flex;
	/* flex: 1; */
	/* flex-direction: column; */
	flex-flow: column;
	min-height: 192px;
	opacity: 1.0;
	pointer-events: all;
	overflow: hidden;
	overflow-y: hidden;
	resize: vertical;
}

html .console.close {
	border: 0;
	padding: 0;
	margin: 0;
}

html .console .header {
	padding: 4px;
	border-bottom: 1px solid var(--color-tertiary-text);
}

html .console .header:before {
	content: "Console";
}

html .console .close-console {
	position: absolute;
	top: 0;
	right: 0;
	height: 100%;
	z-index: 1;
	cursor: pointer;
	/* font-size: .6em; */
}

/******************************************************************************/

/* html .console .close-console i:after {
content: "close";
position: absolute;
top: 50%;
right: 0;
font-size: .8em;
transform: translate3d(0, -50%, 0);
} */

html .console .output,
html .console .input {
	font-family: var(--font-monospace);
	font-size: 0.8125rem;
}

html .console .output {
	flex: 1;
	/* background-color: orange; */
	overflow: hidden;
	overflow-y: auto;
	/* padding: 5px; */
	/* border-top: 1px solid rgba(255, 255, 255, .05);
	border-bottom: 1px solid rgba(255, 255, 255, .05); */
}

html .console > .output > .log-output {
	display: flex;
	flex-direction: row;
	/* word-break: break-all; */
	/* word-wrap: break-word; */
	/* float: right; */
	/* white-space: pre-wrap; */
	padding: 0 4px;
	border-top: 1px solid rgba(255, 255, 255, .05);
	border-bottom: 1px solid rgba(255, 255, 255, .05);
	/* margin-bottom: -1px; */
}

html .console > .output > .log-output > * {
	/* display: inline; */
	padding: 3px;
}

html .console > .output > .log-output > .message {
	flex: 1;
}

/* html .console > .output > div:not(:last-child) {
padding: 3px 0 3px 0;
border-bottom: 1px solid rgba(255, 255, 255, .1);
}

html .console > .output > div:last-child {
padding: 3px 0 0 0;
}

html .console > .output > div > .time {
color: rgb(135, 135, 129);
} */

/******************************************************************************/

html .console > .output > .log-output.error {
	color: var(--material-color-red);
	background-color: rgba(var(--material-color-red-rgb), 0.1);
}

html .console > .output > .log-output .time,
html .console > .output > .log-output .location {
	color: var(--color-tertiary-text);
}

html .console > .output > .log-output .location {
	text-decoration: underline;
	cursor: pointer;
}

html .console > .output > .log-output.warn {
	color: var(--material-color-yellow);
	background-color: rgba(var(--material-color-yellow-rgb), 0.1);
}

html .console > .output > .log-output.info {
	color: var(--material-color-light-blue);
	background-color: rgba(var(--material-color-light-blue-rgb), 0.1);
}

html .console > .output > .log-output.debug {
	color: var(--color-tertiary-text);
}

html .console > .output > .log-output > .message .number,
html .console > .output > .log-output > .message .boolean {
	color: #9179ff;
}

html .console > .output > .log-output > .message .object {

}

html .console > .output > .log-output > .message .null,
html .console > .output > .log-output > .message .undefined {
	color: rgb(135, 135, 129);
}

html .console > .output > .log-output > .message.info:before {
	content: "INFO: ";
	display: inline-block;
}

/******************************************************************************/

html .console .input {
	padding: 4px;
	border-top: 1px solid var(--color-tertiary-text);
}

html .console .input:before {
	content: ">";
	margin-right: 5px;
	font-weight: bold;
	width: 10px;
	display: inline-block;
}

html .console .input input[type="text"] {
	font-family: inherit;
	border: 0;
	outline: 0;
	color: var(--color-primary-text);
	width: calc(100% - 15px);
	background-color: transparent;
}

/******************************************************************************/

html .console [error-id] {
	text-decoration: underline;
	cursor: pointer;
}

html .CodeMirror .line-error {
	background-color: var(--material-color-red);
	animation-name: highlight;
	animation-duration: 1250ms;
	opacity: .15;
	margin-right: 5px;
}

/* html .CodeMirror .line-error-text {
text-decoration: underline;
text-decoration-color: red;
text-decoration-style: wavy;
} */

/* html .CodeMirror .line-error-gutter {
text-decoration: underline;
text-decoration-color: red;
text-decoration-style: wavy;
} */

/* html .CodeMirror .line-error-wrap {
text-decoration: underline;
text-decoration-color: red;
text-decoration-style: wavy;
} */

/******************************************************************************/

@keyframes highlight {
	from {
		opacity: .5;
	}
}</style></div></div><div name="Migration" class="section section-hidden" data-type="system" data-group="editing" data-id="ifppNbfJ" __wid="gbYSQzn5"><div class="paragraph body-paragraph locked collapsed" name="Documentation" draggable="false" data-id="4W22rTyt" __wid="UMsMq78X"><div data-type="content" contenteditable="false" class="section-documentation" type="text/html" codemirror="true" __wid="KEhhXpMt"><h2 __wid="8Hwc5Ecq">Description</h2><div __wid="CmqMQAeM">The migration section allows to update document structure of previous versions of a codestrate. For example, the "Put sections into div#sections" adds a div element with ID sections to the document body and then moves all sections previously in the document body to the newly created div#sections element.</div><div __wid="48iwqGiB">The migration section also allows to add or update assets that changed of have been added between two versions of a codestrate.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="rYz2ZveL" __wid="v5kiP97D"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="t34agY48">{
	"version": "1.0.1",
	"description": "Performs migration steps like updating and pulling assets.",
	"changelog":
	{
		"1.0.1": "Added migration for favicons.",
		"1.0": "Initital Release"
	}
}</pre></div>

<div class="paragraph code-paragraph collapsed" draggable="false" name="Migration Facade" data-id="BjiiG8sZ" __wid="DrCx3U5C" last-execution-state="error" run-on-load="true"><pre data-type="content" type="text/javascript" __wid="trSdYfNz">const AssetUtils = require("#asset-utils");

const Migration = (minVersion, name, perform, assets = []) => {

	if (typeof minVersion !== "number") {
		throw new Error("Migration must have a minimum version");
	}

	if (!name) {
		throw new Error("Migration must have a name");
	}

	if (typeof perform !== "function") {
		throw new Error("perform must implement migration process");
	}

	return {
		name,
		minVersion,
		migrate() {
			return new Promise((resolve, reject) => {
				(async() => {

					// Fetching assets and uploading them to this codestrate
					if (assets.length) {
						window.console.log(`fetching assets for migration ${name}`);

						for (let i = 0; i &lt; assets.length; i++) {
							let assetName = assets[i];
							let response = await fetch(assetName, { credentials: "include" });
							let blob = await response.blob();
							window.console.log(assetName, blob);
							let asset = await AssetUtils.uploadBlob(assetName, blob);
						}

						window.console.log(`all assets uploaded for migration ${name}`);
					}

					window.console.log(`running migration ${name}`);
					let task = perform();

					// Allow promises as return values for migration perform
					if (task instanceof Promise) {
						await task;
					}

					window.console.log(`migration ${name} completed`);

					resolve();
				})();
			});
		}
	}
}

// Adding migration class to JavaScript execution context. This will make the Migration class
// available in code paragraphs only and not expose it to the global window scope.
const vm = Codestrate.VirtualMachines.get("text/javascript");
vm.addToGlobalContext({
	Migration
});</pre></div><div class="paragraph code-paragraph collapsed" last-execution-state="success" name="Migration Loader" run-on-load="true" data-id="kTHY8iBv" __wid="PFTVcNDi"><pre data-type="content" type="text/javascript" __wid="J4CR3wPV">// Never perform migration on prototype!!!
if (webstrate.webstrateId !== "Codestrate") {

	// Prevent other code paragraphs from being executed, allow 60 seconds to execute before timeout
	const blockHandle = Codestrate.blockExecution("migration", 60000);

	(async() => {
		let requires = requireAll(".migration");

		// Get all migrations and filter out obselete migrations
		let migrations = Array.prototype.map.call(requires, (r) => {
			return r.migration;
		}).filter((m) => m.minVersion > Codestrate.version);

		if (migrations.length) {

			let result = await confirm("Do you want to migrate this codestrate?", "Codestrate Migration");

			if (result) {
				// Sort migrations to apply them in proper order
				migrations.sort((m1, m2) => m1.minVersion > m2.minVersion);

				// Perform all migrations

				for (let i = 0; i &lt; migrations.length; i++) {
					await migrations[i].migrate();
					Codestrate.version = migrations[i].minVersion;
				}
			}
		}

		// Continue with next code paragraph
		blockHandle.continue();

		// Reload if migrations where applied
		if (migrations.length) {

			let result = await confirm("Do you want to remove migration scripts?", "Migration Completed");

			if (result) {
				// Get all migration code paragraphs, and remove them
				let migrations = document.querySelectorAll(".migration");
				Array.prototype.forEach.call(migrations, (migration) => {
					let paragraph = migration.closest(".paragraph");
					if (paragraph) {
						paragraph.remove();
					}
				});
			}

			// Reload after timeout to make sure the codestrate works without side-effects
			setTimeout(() => {
				alert("Reloading codestrate in 5 seconds");
				window.location.reload();
			}, 5000);
		}
	})();
}</pre></div><div class="paragraph code-paragraph collapsed" name="Migration - Put sections into div#sections" data-id="ENaMHnxt" __wid="L4XaPC9w"><pre data-type="content" type="text/javascript" class="migration" __wid="GmfeBa7q">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/codemirror.css",
	"/Codestrate/codemirror-addon-simplescrollbars.css",
	"/Codestrate/codemirror-addon-dialog.css",
	"/Codestrate/codemirror-addon-show-hint.css",
	"/Codestrate/codemirror-addon-foldgutter.css",
	"/Codestrate/codemirror-addon-matchesonscrollbar.css",
	"/Codestrate/codemirror.js",
	"/Codestrate/codemirror-addon-annotatescrollbar.js",
	"/Codestrate/codemirror-addon-simplescrollbars.js",
	"/Codestrate/codemirror-addon-scrollpastend.js",
	"/Codestrate/codemirror-addon-show-hint.js",
	"/Codestrate/codemirror-addon-javascript-hint.js",
	"/Codestrate/codemirror-addon-xml-hint.js",
	"/Codestrate/codemirror-addon-html-hint.js",
	"/Codestrate/codemirror-addon-css-hint.js",
	"/Codestrate/codemirror-addon-anyword-hint.js",
	"/Codestrate/codemirror-addon-comment.js",
	"/Codestrate/codemirror-addon-continuecomment.js",
	"/Codestrate/codemirror-addon-foldcode.js",
	"/Codestrate/codemirror-addon-foldgutter.js",
	"/Codestrate/codemirror-addon-brace-fold.js",
	"/Codestrate/codemirror-addon-xml-fold.js",
	"/Codestrate/codemirror-addon-markdown-fold.js",
	"/Codestrate/codemirror-addon-comment-fold.js",
	"/Codestrate/codemirror-addon-indent-fold.js",
	"/Codestrate/codemirror-addon-matchbrackets.js",
	"/Codestrate/codemirror-addon-matchtags.js",
	"/Codestrate/codemirror-addon-closebrackets.js",
	"/Codestrate/codemirror-addon-closetag.js",
	"/Codestrate/codemirror-addon-searchcursor.js",
	"/Codestrate/codemirror-addon-match-highlighter.js",
	"/Codestrate/codemirror-addon-matchesonscrollbar.js",
	"/Codestrate/codemirror-addon-jump-to-line.js",
	"/Codestrate/codemirror-addon-search.js",
	"/Codestrate/codemirror-mode-xml.js",
	"/Codestrate/codemirror-mode-htmlmixed.js",
	"/Codestrate/codemirror-mode-javascript.js",
	"/Codestrate/codemirror-mode-css.js",
	"/Codestrate/codemirror-mode-go.js",
	"/Codestrate/quadtree.js",
];

// The perform function applies necessary changes to the DOM to update the document structure
const perform = () => {
	let container = document.createElement("div");
	container.setAttribute("id", "sections");

	const sections = document.querySelectorAll("body > div.section");
	Array.prototype.forEach.call(sections, (s) => {
		container.appendChild(s);
	});
	document.body.appendChild(container);
};

// This migration will move all sections from body to a new div.sections element
exports.migration = Migration(1, "SectionsToDiv", perform, assets);</pre></div><div class="paragraph code-paragraph collapsed" name="Migration - Pull beatify libraries
" data-id="prqCkgr6" __wid="qij87KDe"><pre data-type="content" type="text/javascript" class="migration" __wid="m47yNgsn">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/beautify.js",
	"/Codestrate/beautify-css.js",
	"/Codestrate/beautify-html.js"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(2, "PullBeautifyLibraries", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" style name="Migration - Add section-visible to sections" data-id="RZFZNFxT" __wid="na3dNUdH"><pre data-type="content" type="text/javascript" class="migration" __wid="gUxkFnk5">// This migration will add section-visible class to sections that are currently visible. The
// class is required e.g., for the tooltip to display tooltip downwards for first visible section.
// Because otherwise the tooltips will be cut off.
exports.migration = Migration(3, "AddSectionVisibleClass", () => {
	let sections = document.querySelectorAll(".section:not(.section-hidden)");
	Array.prototype.forEach.call(sections, (section) => {
		section.classList.add("section-visible");
	});
});</pre></div><div class="paragraph code-paragraph collapsed" name="Migration - Pull linter libraries" style data-id="jqsLHEwJ" __wid="bpgjwJN3"><pre data-type="content" type="text/javascript" class="migration" __wid="p7K9HBJb">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/codemirror-linter-jshint.js",
	"/Codestrate/codemirror-linter-htmlhint.js",
	"/Codestrate/codemirror-linter-csslint.js",
	"/Codestrate/codemirror-linter-jsonlint.js",

	"/Codestrate/codemirror-addon-lint.js",
	"/Codestrate/codemirror-addon-lint.css",

	"/Codestrate/codemirror-addon-javascript-lint.js",
	"/Codestrate/codemirror-addon-html-lint.js",
	"/Codestrate/codemirror-addon-css-lint.js",
	"/Codestrate/codemirror-addon-json-lint.js"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(4, "PullLinterLibraries", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" name="Migration - Pull active line addon" data-id="UQdEcpxj" __wid="fb9gYmZa"><pre data-type="content" type="text/javascript" class="migration" __wid="w4ZGwp59">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/codemirror-addon-active-line.js"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(5, "PullActiveLineAddon", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" data-id="WfAEm9Ru" name="Migration - Update sortable.js" __wid="knzH7HYw"><pre data-type="content" type="text/javascript" class="migration" __wid="C5k7QBeg">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/Sortable.js"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(6, "UpdateSortableLibrary", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" data-id="pNACvEvY" name="Migration - CodeMirror Addons" __wid="iJ4ekRin"><pre data-type="content" type="text/javascript" class="migration

" __wid="v79SFNcR">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/codemirror-addon-rulers.js",
	"/Codestrate/codemirror-addon-merge.js",
	"/Codestrate/codemirror-addon-merge.css"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(7, "PullCodeMirrorAddons", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" data-id="ApzRYKv7" name="Migration - Extended Material Icons" __wid="VPSfVkA4"><pre data-type="content" type="text/javascript" class="migration" __wid="9C9MG9Bd">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/materialdesignicons-webfont.eot",
	"/Codestrate/materialdesignicons-webfont.svg",
	"/Codestrate/materialdesignicons-webfont.ttf",
	"/Codestrate/materialdesignicons-webfont.woff",
	"/Codestrate/materialdesignicons-webfont.woff2"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(8, "PullExtendedMaterialIcons", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" data-id="bG5xHrLM" name="Migration - CodeMirror Markdown Modes" __wid="v7bLhYZn"><pre data-type="content" type="text/javascript" class="migration" __wid="aZbcwTxU">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/codemirror-mode-markdown.js",
	"/Codestrate/codemirror-mode-gfm.js"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(9, "PullCodeMirrorMarkdownModes", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" data-id="NZvcTwxk" name="Migration - Roboto Fonts" __wid="yiTBi9JG"><pre data-type="content" type="text/javascript" class="migration" __wid="f6EsNWcT">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/roboto-300.woff",
	"/Codestrate/roboto-300-italic.woff",
	"/Codestrate/roboto-400.woff",
	"/Codestrate/roboto-400-italic.woff",
	"/Codestrate/roboto-500.woff",
	"/Codestrate/roboto-500-italic.woff",
	"/Codestrate/roboto-700.woff",
	"/Codestrate/roboto-700-italic.woff",

	"/Codestrate/roboto-mono-400.woff",
	"/Codestrate/roboto-mono-400-italic.woff",
	"/Codestrate/roboto-mono-700.woff",
	"/Codestrate/roboto-mono-700-italic.woff",

	"/Codestrate/roboto-300.woff2",
	"/Codestrate/roboto-300-italic.woff2",
	"/Codestrate/roboto-400.woff2",
	"/Codestrate/roboto-400-italic.woff2",
	"/Codestrate/roboto-500.woff2",
	"/Codestrate/roboto-500-italic.woff2",
	"/Codestrate/roboto-700.woff2",
	"/Codestrate/roboto-700-italic.woff2",

	"/Codestrate/roboto-mono-400.woff2",
	"/Codestrate/roboto-mono-400-italic.woff2",
	"/Codestrate/roboto-mono-700.woff2",
	"/Codestrate/roboto-mono-700-italic.woff2"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(10, "PullRobotoFonts", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" data-id="icKECWX2" name="Migration - Missing Roboto Regular Font" __wid="TBLkxKnD"><pre data-type="content" type="text/javascript" class="migration" __wid="BbG8NSmu">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/roboto-regular.ttf",
	"/Codestrate/roboto-regular.woff",
	"/Codestrate/roboto-regular.woff2"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(11, "PullRobotoMissingFonts", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" data-id="a5ZdEh3M" name="Migration - JSZip and FileSaver libraries" __wid="U5NV5gmM"><pre data-type="content" type="text/javascript" class="migration" __wid="LBQxcFYq">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/jszip.min.js",
	"/Codestrate/FileSaver.min.js"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(12, "PullJSZipAndFileSaver", () => {}, assets);</pre></div><div class="paragraph code-paragraph collapsed" data-id="i9v2tF7u" name="Migration - Favicons" __wid="z2ypL4Wv"><pre data-type="content" type="text/javascript" class="migration" __wid="M5x9gAAy">// These are dependencies that have been added to the new version of Codestrates or need an update
const assets = [
	"/Codestrate/favicon.ico",
	"/Codestrate/favicon-16x16.png",
	"/Codestrate/favicon-32x32.png",
	"/Codestrate/favicon-apple-touch-icon-180x180.png",
	"/Codestrate/favicon-android-chrome-192x192.png",
	"/Codestrate/favicon-android-chrome-512x512.png",
	"/Codestrate/notification-icon.png",
	"/Codestrate/manifest.json"
];

// This migration will copy all assets from originating codestrate
exports.migration = Migration(13, "PullFaviconsAndAddToHeader", () => {
	document.head.innerHTML += `&lt;link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
&lt;link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
&lt;link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
&lt;link rel="apple-touch-icon" sizes="180x180" href="favicon-apple-touch-icon-180x180.png">
&lt;link rel="manifest" href="manifest.json">`;
}, assets);</pre></div></div><div class="section section-hidden" name="User & Client Manager" data-type="system" data-group="basic" data-id="5anpeYib" __wid="6rdW3Lsz"><div class="paragraph body-paragraph locked collapsed" draggable="false" name="Documentation" data-id="JF57SD8B" __wid="WXEfCTHU"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="QBwucMZC"><h2 __wid="3f73G5j4">Description</h2><div __wid="FC9HPpqu">The user manager adds a users array to the Codestrate global window object. Each object in the users array will have the user id and a generated user color. For example, the color can be used in the in the Codestrate to have a consistent user color for remote pointers and remote cursors.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="yMviPwWQ" __wid="uuP3XXbr"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="Ug8MWFX6">{
	"version": "1.0",
	"description": "Manages users on a global window object.",
	"changelog":
	{
		"1.0": "Initital Release"
	}
}</pre></div>
<div class="paragraph code-paragraph collapsed" run-on-load="true" name="Client Manager Global" data-id="icqmBqmd" last-execution-state="success" __wid="kRPPnC3F"><pre data-type="content" type="text/javascript" __wid="Fnx7GCYz">const clients = [];

// Add a clients array to the global Codestrate object
Object.defineProperty(Codestrate, "clients", {
	get() {
		return clients;
	}
});

// create events
Codestrate.createEvent("clientUpdateProperty");
Codestrate.createEvent("clientAdd");
Codestrate.createEvent("clientUpdate");
Codestrate.createEvent("clientRemove");

let ignoreUpdates = false;

/**
 * Get the client object.
 *
 * @param {string} The client id.
 */
const getClient = (id = webstrate.clientId) => {
	return clients.find((c) => c.id === id);
};

/**
 * Adds a new client to the clients array and generates a random client color. Nothing will
 * happen if a client already exists.
 *
 * @param {string} id The client id.
 * @param {object} userObject The user object.
 */
const addClient = (id, userObject) => {
	let client = getClient(id);

	// Add client only if it does not exist
	if (!client) {

		let handler = {
			get: function (target, name) {
				return target[name];
			},
			set: function (target, name, value) {
				target[name] = value;

				Codestrate.dispatchEvent("clientUpdateProperty", {
					propertyName: name,
					client
				});

				if (!ignoreUpdates) {
					sendClientData(undefined, false, client.id);
				}

				// Indicate success
				return true;
			}
		};

		userObject.id = id;
		userObject.color = '#' + (Math.random() * 0xFFFFFF &lt;&lt; 0).toString(16);
		userObject.avatarUrl = webstrate.user.avatarUrl || "unknown.jpg";
		client = new Proxy(userObject, handler);

		clients.push(client);
	}
};

/**
 * Removes a client from the clients array.
 *
 * @param {string} id The client id.
 */
const removeClient = (id) => {
	const idx = clients.findIndex((c) => c.id === id);
	const client = clients.splice(idx, 1);

	Codestrate.dispatchEvent("clientRemove", client[0]);
};

/**
 * Update a clients data.
 *
 * @param {string} id The client id.
 *
 */
const updateClient = (id, data) => {

	// Add client only if it does not exist
	let client = getClient(id);
	if (client) {
		ignoreUpdates = true;

		// merge data into client
		Object.assign(client, data);

		if (client.anonymous) {
			Codestrate.dispatchEvent("clientAdd", client);
		}

		// client is not anonymous anymore
		delete client.anonymous;

		ignoreUpdates = false;

		Codestrate.dispatchEvent("clientUpdate", client);
	}
};

/**
 * Get other client ids (all connected client ids except for own client id).
 */
const otherClientIds = () => {
	return webstrate.clients.filter((c) => c !== webstrate.clientId);
};

/**
 * Send client data to other clients.
 */
const sendClientData = (receiverId = undefined, giveMeYourClientData = true, clientId = undefined) => {

	const clientData = getClient(clientId);

	if (!clientData) {
		console.warn(`could not find client data for client ${clientId}`);
		return;
	}

	const otherClients = otherClientIds();

	webstrate.signal({
		cmd: "ClientData",
		clientData,
		giveMeYourClientData
	}, receiverId ? [receiverId] : otherClients);
};

webstrate.on("signal", (message, senderId) => {

	let {
		cmd,
		clientData,
		giveMeYourClientData
	} = message;

	if (cmd === "ClientData") {

		// ignore own message
		if (webstrate.clientId === senderId) {
			return;
		}

		updateClient(clientData.id, clientData);

		if (giveMeYourClientData) {
			// Also send back own avatar to sender client.
			sendClientData(senderId, false);
		}
	}
});

/**
 * Add existing clients on connect
 */
const onConnect = () => {
	// Add all existing clients
	webstrate.clients.forEach((c) => {
		if (webstrate.clientId === c) {
			addClient(c, webstrate.user);
		} else {
			addClient(c, {
				username: "anonymous",
				anonymous: true
			});
		}
	});

	// Send this clients data
	sendClientData();
};

/**
 * Remove all clients on disconnect
 */
const onDisconnect = () => {
	clients.forEach((client) => removeClient(client.id));
};

// Add a client to the list of clients when it joins
webstrate.on("clientJoin", (clientId) => addClient(clientId, {
	username: "anonymous",
	anonymous: true
}));

// Remove a client from the list of clients when it leaves
webstrate.on("clientPart", (clientId) => removeClient(clientId));

// Add clients on reconnect
webstrate.on("reconnect", onConnect);

// Clear all clients
webstrate.on("disconnect", onDisconnect);

// reconnect is only called when disconnected before and not on initial load,
// therefore we call onConnect here
onConnect();</pre></div><div class="paragraph code-paragraph collapsed" name="Client Manager Utils" data-id="XKUmvrUu" __wid="gi7cc2d4"><pre data-type="content" type="text/javascript" __wid="9jtfcvss" id="client-manager">/**
 * Convert a hex colour to a rgb/rgba value
 * @param {string} hex
 * @param {?number} opacity
 * @returns {string}
 */
const convertHexToRGBA = (hex, opacity) => {
	hex = hex.replace("#", "");
	const r = parseInt(hex.substring(0, 2), 16);
	const g = parseInt(hex.substring(2, 4), 16);
	const b = parseInt(hex.substring(4, 6), 16);

	return `rgba(${r},${g},${b},${opacity})`;
};

const getClient = exports.getClient = (id = webstrate.clientId) => {
	return Codestrate.clients.find((c) => c.id === id);
};

const getClientColor = exports.getClientColor = (id = webstrate.clientId) => {
	const client = getClient(id);

	if (!client) {
		// return "#00ff00";
		throw new Error(`Client ${id} does not exist in ${JSON.stringify(Codestrate.clients)}`);
	}

	return client.color;
};

exports.getClientColorInRGBA = (id = webstrate.clientId, opacity = 1.0) => {
	return convertHexToRGBA(getClientColor(id), opacity);
};</pre></div><div class="paragraph code-paragraph collapsed" last-execution-state="success" name="User Manager Global" run-on-load="true" data-id="Fyk5aXMy" __wid="VAVYYpAp"><pre data-type="content" type="text/javascript" __wid="32BTqdMC">Object.defineProperty(Codestrate, "users", {
  get() {
    let users = [];

    Codestrate.clients.forEach((c) => {
      let user = users.find((u) => u.id === c.userId);
      if (!user) {
        user = {
          id: (c.userId || c.id),
          username: c.username,
          displayName: c.displayName,
          avatarUrl: c.avatarUrl,
          clients: [c]
        };
        users.push(user);
      } else {
        user.clients.push(c);
      }
    });

    return users;
  }
});</pre></div><div class="paragraph code-paragraph collapsed" name="User Manager" data-id="Bh7aPTWt" __wid="WNXGhYrS"><pre data-type="content" type="text/javascript" __wid="UwkWWdbV" id="user-manager">exports.getUser = (userId = webstrate.user.userId) => {
	return Codestrate.users.find((user) => user.id === userId);
};</pre></div></div><div class="section section-hidden" name="Idle Timer" data-type="system" data-group="basic" data-id="bZ9ftpMD" __wid="gtFGPEi9"><div class="paragraph body-paragraph locked collapsed" draggable="false" name="Documentation" data-id="CpWbeNtn" __wid="nDkrye3S"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="7CY4HByE"><h2 __wid="SyhMYFSr">Description</h2><div __wid="Nutz3Rtj">The idle timer section is a small extension to the Codestrate, which sends out awake signals when the user interacts with the Codestrate. For example, the idle timer is used for the avatar to indicate whether a user is present or absent.</div></div></div>
<div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="Mv7cqyj9" __wid="xK5r2kfJ"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="kqbXUqvt">{
	"version": "1.0",
	"description": "Sends out signals, when users interact with the Codestrate or are idle.",
	"changelog":
	{
		"1.0": "Initital Release"
	}
}</pre></div><div class="paragraph code-paragraph collapsed" run-on-load="true" name="Idle Timer Code" data-id="SJuq3Muw" last-execution-state="success" __wid="qixsEUGS" draggable="false"><pre data-type="content" type="text/javascript" __wid="vcUbgu6b">// Time until client becomes idle/inactive (in milliseconds)
const IDLE_TIMEOUT = 300 * 1000;

let isIdle = false;
let idleTimeout;
let lastAction = Date.now();

const actionHappend = () => {
	lastAction = Date.now();

	// Send awake message only if client was in idle mode
	if (isIdle) {
		isIdle = false;
		signalAwake();
	}

	if (idleTimeout) {
		clearTimeout(idleTimeout);
	}

	idleTimeout = setTimeout(() => {
		isIdle = true;
		signalIdle();
	}, IDLE_TIMEOUT);
};

/**
 * Signal awake message to all clients.
 */
const signalAwake = () => {
	webstrate.signal({ type: "IdleTimer", cmd: "awake" });
};

/**
 * Signal idle message to recipients or all clients.
 *
 * @param {Array|string} [recicipients] An array of client ids or a single client id indicating the recipients of the idle signal.
 */
const signalIdle = (recipients = webstrate.clients) => {
	webstrate.signal({
		type: "IdleTimer",
		cmd: "idle",
		idleTime: Date.now() - lastAction
	}, recipients);
};

// Send idle state to joining clients when idle = true
webstrate.on("clientJoin", (clientId) => {

	// Ignore own client join event
	if (clientId === webstrate.clientId) return;

	if (isIdle) {
		// We have to set a timeout here to cope with race condition. The signalIdle is
		// sent to the requesting client before the callback that listens for this message
		// is registered.
		setTimeout(() => signalIdle(clientId), 10000);
	}
});

// webstrate.on("reconnect", actionHappend);

document.addEventListener("mousemove", actionHappend);
document.addEventListener("keydown", actionHappend);
document.addEventListener("touchstart", actionHappend);
document.addEventListener("touchmove", actionHappend);
document.addEventListener("touchend", actionHappend);
actionHappend();</pre></div></div><div name="Dialogs" class="section section-hidden" data-type="system" data-group="basic" data-id="aUnGvNB7" __wid="e6Ab2N5f"><div class="paragraph body-paragraph locked" draggable="false" name="Documentation" data-id="AVYTegUf" __wid="6pYzagbS"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="Zr4VTvXv"><h2 __wid="9XGVMkFi">Description</h2>
<div __wid="pJymMyPc">The dialog section adds support to write custom non-modal dialogs that can be used for various purposes. For example, it is used to overwrite a browser's default dialogs with non-blocking dialogs. This section also provides a dialog to show tags and restore them.</div>
<h2 __wid="xVRQLRNR">Usage</h2>
<div __wid="AVEWzwgX">You can either use one of the basic dialog functions <code __wid="3By6FL8B">promt()</code>, <code __wid="j9QHczGE">alert()</code> and <code __wid="3aX8NHNR">confirm()</code> or create your own dialogs using the <code __wid="NTkEFr89">#dialog-template</code>.</div>
<h3 __wid="cqK8pLhS">confirm(message, [title = ""], [options= {} ])</h3>
<div __wid="P5Gmtgyx">The confirm function has three parameters <code __wid="Dd4Z8Yjb">message</code>, <code __wid="5CiysPzK">[title]</code>, and <code __wid="LkkAzNeX">[options]</code>. The options parameter can take an object literal with the properties <code __wid="KbWWcJ8q">trueLabel</code>, <code __wid="YSD3PsQr">falseLabel</code>, and <code __wid="PRpG4YkZ">className</code>. The default values for the options object are set to <code __wid="rM8LRSc3">"OK"</code> for the <code __wid="acVnkj3a">trueLabel</code>, <code __wid="iE2Tn6is">"Cancel"</code> for the <code __wid="Qig8RFd4">falseLabel</code>, and <code __wid="qXTWNxSB">""</code> (empty string) for the <code __wid="CeD5ueZV">className</code>.


</div><div __wid="cKcRA2EL"></div><pre __wid="xn2568R4">const myCustomOptionsConfirmResult = await confirm("Do you like liquorice?", "Mother of all Questions", {
    trueLabel: "Absolutely",
    falseLabel: "Hell no!"
});
if (myCustomOptionsConfirmResult) {
    console.log('Pressed "Absolutely" on confirm');
    } else {
        console.log('Pressed "Hell no!" on confirm');
    }
}</pre><div __wid="zkHQS8Dr"></div></div></div><div class="paragraph data-paragraph collapsed locked" name="Properties" data-id="Xz6yvM28" __wid="taD4cuUG"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="EisEaMDs">{
  "version": "1.2.3",
  "description": "Provides a dialog template and basic functions to use them.",
  "changelog": {
    "1.0": "Initital Release",
    "1.1": "Applied Material Design theme.",
    "1.1.1": "Expanded documentation.",
    "1.1.2": "Added some styling for inputs and selects.",
    "1.2": "Replace className parameter by an optional options object. The object can have a className property with the className set to the dialog, and strings (optional) that set the labels for the ok and cancel action buttons.",
    "1.2.1": "Removed specific select style to favor of global style.",
    "1.2.2": "Outfactored tagging code to its own system section.",
    "1.2.3": "Fixed select dropdown color."
  }
}</pre></div>

<div class="paragraph body-paragraph collapsed locked" name="Dialog Template" draggable="false" data-id="wtHuW5uq" __wid="8HLGKrBS"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" id="dialog-template" __wid="RLkPmzyu"><div class="modal" __wid="Qs3MdPqZ"></div>
<div class="dialog ${className}" __wid="xFspTBNM">
	<div class="title" __wid="2bWyZyvp">${title}</div>
	<div class="body" __wid="jh48NmwU">${message}</div>
	<div class="actions" __wid="FRNKLkU2">${actions}</div>
</div></div></div><div class="paragraph code-paragraph collapsed" draggable="false" last-execution-state="success" name="Dialog Utils" data-id="LkND9ZyA" __wid="bn3mkHQk"><pre data-type="content" type="text/javascript" id="dialog-utils" __wid="iDcKQYmb">/**
 * Shows an alert to the user.
 *
 * @param message      The message of the alert.
 * @param title        The title of the alert.
 * @param options      Options to set the trueLabel, falseLabel, and an optional
 *                     className added to the dialog. Their default settings are
 *                     trueLabel "OK", falseLabel "Cancel", and "" for the
 *                     className.
 *
 * @return Promise which resolves when the user clicks OK.
 */
exports.alert = (message, title = "", options = {}) => {
	return new Promise((resolve, reject) => {

    const mergedOptions = Object.assign({
      trueLabel: "OK",
      className: ""
    }, options);

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: title === "" ? " " : title,
			message: message,
			actions: `&lt;div class="button ok">${mergedOptions.trueLabel}&lt;/div>`,
			className: mergedOptions.className
		});

		elements.forEach(e => transient.appendChild(e));

		const okBtn = transient.querySelector(".ok");

		const ok = () => {
			transient.remove();
			resolve(true);
		};

		okBtn.addEventListener("click", ok);

		document.body.appendChild(transient);
	});
};

/******************************************************************************/

/**
 * Shows a promt to the user.
 *
 * @param message      The message of the prompt.
 * @param defaultValue The default value of the prompt input.
 * @param title        The title of the prompt.
 * @param options      Options to set the trueLabel, falseLabel, and an optional
 *                     className added to the dialog. Their default settings are
 *                     trueLabel "OK", falseLabel "Cancel", and "" for the
 *                     className.
 *
 * @return Promise which resolves either to false or the prompt input value.
 */
exports.prompt = (message, defaultValue = "", title = "", options = {}) => {
	return new Promise((resolve, reject) => {

    const mergedOptions = Object.assign({
      trueLabel: "OK",
      falseLabel: "Cancel",
      className: ""
    }, options);

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: title === "" ? " " : title,
			message: `&lt;div>${message}&lt;/div>
&lt;input class="input" type="text" value="${defaultValue}">`,
			actions: `
&lt;div class="button ok">${mergedOptions.trueLabel}&lt;/div>
&lt;div class="button cancel">${mergedOptions.falseLabel}&lt;/div>
`,
			className: mergedOptions.className
		});

		elements.forEach(e => transient.appendChild(e));

		const okBtn = transient.querySelector(".ok");
		const cancelBtn = transient.querySelector(".cancel");
		const input = transient.querySelector(".input");

		const ok = () => {
			transient.remove();
			resolve(input.value);
		};

		const cancel = () => {
			transient.remove();
			resolve(false);
		};

		okBtn.addEventListener("click", ok);
		cancelBtn.addEventListener("click", cancel);

		input.addEventListener("keydown", e => {
			e.stopPropagation();

			if (e.keyCode === 13) {
				e.preventDefault();
				ok();
			} else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
		});

		document.body.appendChild(transient);

		input.focus();
	});
};

/******************************************************************************/

/**
 * Shows a confirm dialog to the user.
 *
 * @param message      The message of the confirm dialog.
 * @param title        The title of the confirm dialog.
 * @param className    Additional classNames of the confirm dialog.
 * @param options      Options to set the trueLabel, falseLabel, and an optional
 *                     className added to the dialog. Their default settings are
 *                     trueLabel "OK", falseLabel "Cancel", and "" for the
 *                     className.
 *
 * @return Promise which resolves either to true or false.
 */
exports.confirm = (message, title = "", options = {}) => {
	return new Promise((resolve, reject) => {

    const mergedOptions = Object.assign({
      trueLabel: "OK",
      falseLabel: "Cancel",
      className: ""
    }, options);

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: title === "" ? " " : title,
			message: message,
			actions: `
&lt;div class="button ok">${mergedOptions.trueLabel}&lt;/div>
&lt;div class="button cancel">${mergedOptions.falseLabel}&lt;/div>
`,
			className: mergedOptions.className
		});

		elements.forEach(e => transient.appendChild(e));

		const okBtn = transient.querySelector(".ok");
		const cancelBtn = transient.querySelector(".cancel");

		const ok = () => {
			transient.remove();
			resolve(true);
		};

		const cancel = () => {
			transient.remove();
			resolve(false);
		};

		okBtn.addEventListener("click", ok);
		cancelBtn.addEventListener("click", cancel);

		document.body.appendChild(transient);
	});
};</pre></div><div class="paragraph style-paragraph collapsed" name="Dialog Style" draggable="false" data-id="L4rzUGdH" style __wid="tKtE9HTy"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="9GgkyAQY">@keyframes dialogAnimation {
  from {
    transform: translate(-50%, -50%) translate(0, 96px) scale(0.75);
    opacity: 0;
  }
}

@keyframes modalAnimation {
  from {
    opacity: 0;
  }
}

html .dialog {
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  min-width: 384px;
  max-width: calc(100vw - 32px);
  z-index: 400;
  box-shadow: var(--material-shadow-z24);
  border-radius: 2px;
  background: var(--color-primary-shade-1);
  animation: dialogAnimation var(--navigation-transition);
}

html .modal {
  position: fixed;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  background: var(--color-primary-text);
  opacity: 0.25;
  pointer-events: none;
  z-index: 399;
  animation: modalAnimation var(--navigation-transition);
}

/******************************************************************************/

html .dialog .title {
  color: var(--color-primary-text);
  display: flex;
  align-items: center;
  font-size: 1.425rem;
  font-weight: 500;
  letter-spacing: 0.02em;
  line-height: 2rem;
  flex: 1;
  margin: 0;
  padding: 24px 24px 0;
}

html .dialog .body {
  color: var(--color-secondary-text);
  font-size: 1rem;
  font-weight: 400;
  letter-spacing: 0.02em;
  line-height: 1.25rem;
  margin-top: 20px;
  padding: 0 24px 24px;
  max-height: 80vh;
  overflow-y: auto;
  max-width: 512px;
}

html .dialog .actions {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: flex-end;
  padding: 8px;
}

/******************************************************************************/

html .dialog .button {
  color: var(--color-primary-text);
  background: none;
  font-size: 1rem;
  font-weight: 500;
  letter-spacing: 0.04em;
  line-height: 2.25rem;
  text-decoration: none;
  text-transform: uppercase;
  display: inline-block;
  box-sizing: border-box;
  min-width: 64px;
  height: 36px;
  padding: 0 16px;
  border: none;
  outline: none;
  text-align: center;
  overflow: hidden;
  vertical-align: middle;
  border-radius: 2px;
  cursor: pointer;
  margin-right: 8px;
  user-select: none;
}

html .dialog .button:last-child {
  margin-right: 0;
}

html .dialog .button:hover {
  background-color: var(--color-primary-shade-2);
}

/******************************************************************************/

html .dialog .body input {
  font-size: 1rem;
  width: 100%;
  padding: 4px;
  outline: 0;
  color: var(--color-primary-text);
  background-color: transparent;
  border: 0;
  border-bottom: 1px solid var(--color-tertiary-text);
  margin-top: 8px;
  margin-bottom: 16px;
}

html .dialog .body input:focus {
  border-bottom-color: var(--color-secondary-text);
}

html .dialog .body input:invalid {
  border-bottom-color: var(--material-color-red);
}

html .dialog .body input::-webkit-calendar-picker-indicator {
  opacity: 1.0;
}

html .dialog .body input::-webkit-calendar-picker-indicator:hover {
  background: var(--color-primary-shade-2);
}

/******************************************************************************/

html .dialog .body select {
  font-size: 1rem;
  border: none;
  border-radius: 2px;
  outline: none;
  padding: 4px;
  margin-top: 8px;
  margin-bottom: 16px;
  width: 100%;
  background: var(--color-primary-shade-3);
  color: var(--color-primary-text);
}

html .dialog .body select-selected {
  background: var(--color-accent);
  color: var(--color-accent-text);
}</style></div>
<div class="paragraph code-paragraph collapsed" data-id="us8cGJst" name="Dialog Examples" last-execution-state="success" __wid="kNhTw5Z9"><pre data-type="content" type="text/javascript" __wid="McfwDsgL">// Dialogs return promises, so either ".then()" or "async()" needs to be used to make code wait for them.
(async() => {

	await alert("ALERT ALERT", "ALERT");
	console.log("Pressed OK on alert");

	const myConfirmResult = await confirm("Are you really sure??", "My Title");
	if (myConfirmResult){
		console.log("Pressed OK on confirm");
	} else {
		console.log("Pressed Cancel on confirm");
	}

  const myCustomOptionsConfirmResult = await confirm("Do you like liquorice?", "Mother of all Questions", {
    trueLabel: "Absolutely",
    falseLabel: "Hell no!"
  });
	if (myCustomOptionsConfirmResult){
		console.log('Pressed "Absolutely" on confirm');
	} else {
		console.log('Pressed "Hell no!" on confirm');
	}

	const myPromptResult = await prompt("What's your name?", "Alice", "Name");
	if (myPromptResult === false) {
		console.log("Pressed Cancel on prompt");
	} else if (myPromptResult === "") {
		console.log("Empty prompt value");
	} else {
		console.log(`Hello ${myPromptResult}!`);
	}

})();</pre></div></div><div name="Toasts" class="section section-hidden" data-type="system" data-id="KpPUf4hU" __wid="yQVhm35M"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="fMjDPWw3" __wid="CgmfruVV"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="beEWQNA4"><h2 __wid="hMSSCDWe">Description</h2><div __wid="pBwTKxbH">The toast section adds the functionality to display toast messages in the bottom right corner of the screen. It is possible to set the timeout time add an optional action to toasts. This section also takes care, that there is only one toast visible at a time. Others will be queued in a waitinglist.</div><h2 __wid="BVFWwkX3">Usage</h2><div __wid="4PyyG6rP">See <code __wid="skt5g3PE">.toast-utils</code> paragraph for function documentation.</div></div></div><div class="paragraph data-paragraph collapsed locked" name="Properties" data-id="NWNPBCkV" __wid="xxjrCM5y"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="a8rzxMHP">{
  "version": "1.0.2",
  "description": "Utility to display toast messages.",
  "changelog": {
    "1.0": "Initial version.",
    "1.0.1": "Added usage to documentation.",
    "1.0.2": "Fixed style of toast messages"
  }
}</pre></div><div class="paragraph body-paragraph locked collapsed" data-id="Ntg4itsi" name="Toast Template" __wid="epS2r6Kq"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" id="toast-template" __wid="Rtkdu6mc"><div class="toast ${className}" __wid="iKg4gswf">
	<div class="body" __wid="vSVszYkT">${message}</div>
	<div class="action" __wid="qzrxxNSV">${action}</div>
</div></div></div><div class="paragraph code-paragraph collapsed" data-id="mhwRpSfq" name="Toast Utils" __wid="y38riPCk"><pre data-type="content" type="text/javascript" id="toast-utils" __wid="NcdjZ2p3">const waitingList = [];

/******************************************************************************/

const hideToast = (transient) => {

  const toast = transient.querySelector(".toast");

	// toast set to be hidden before, e.g., a user double clicked on the element, which would add the
	// transitionend listener twice
	if (toast.classList.contains("hidden")) return;

  // make sure to remove transient when transition finished hiding the toast
  toast.addEventListener("transitionend", function onAnimationEnd() {
    // remove toast from waiting list because it has been shown and its timeout elapsed
    waitingList.shift();

    // remove toast from DOM
    transient.remove();
    toast.removeEventListener("transitionend", onAnimationEnd);

    if (waitingList.length > 0) {
      showToast();
    }
  });

  toast.classList.add("hidden");
};

const showToast = () => {
  let {
    toast,
    timeout
  } = waitingList[0];

  // append toast message to document
  document.body.appendChild(toast);

  // remove toast after timeout elapsed
  setTimeout(() => {
    hideToast(toast);
  }, timeout || 3000);
};

/******************************************************************************/

/**
 * Creates a toast message in the bottom right corner.
 *
 * @param message     The message of the toast.
 * @param timeout     The timout time in milliseconds.
 * @param action      The optional action function of the toast.
 * @param actionTitle The title of the action.
 * @param className   Additional classNames for the toast.
 */
exports.toast = (message, timeout = 3000, action = undefined, actionTitle = "", className = "") => {
  const transient = document.createElement("transient");

  const elements = require("#toast-template", {
    message: `&lt;div>${message}&lt;/div>`,
    action: `${(typeof action === "function") ? `&lt;div class="button custom-action">${actionTitle || "OK"}&lt;/div>` : ""}&lt;div class="button close">&lt;i class="material-icons">&lt;/i>&lt;/div>`,
    className: className
  });

  elements.forEach((e) => transient.appendChild(e));

  // check if an action function was defined for this toast
  if (action && typeof action === "function") {
    const actionBtn = transient.querySelector(".button.custom-action");
    actionBtn.addEventListener("click", () => hideToast(transient));
    actionBtn.addEventListener("click", action);
  }

  const closeBtn = transient.querySelector(".button.close");
  closeBtn.addEventListener("click", () => hideToast(transient));

  waitingList.push({
    toast: transient,
    timeout: timeout
  });

  if (waitingList.length === 1) {
    showToast();
  }
};</pre></div><div class="paragraph code-paragraph collapsed" name="Global Context" data-id="3HsuLjYL" run-on-load="true" last-execution-state="success" __wid="kJrbDKjw"><pre data-type="content" type="text/javascript" __wid="KZWyrrmG">const Toasts = require("#toast-utils");

const vm = Codestrate.VirtualMachines.get("text/javascript");
vm.addToGlobalContext({
	toast: Toasts.toast
});</pre></div><div class="paragraph style-paragraph collapsed" name="Toast Style" data-id="es3FhyeZ" __wid="dveWbsEq"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="iBgbeP9g">@keyframes toastAnimation {
	from {
		opacity: 0;
		transform: translate(0, 72px);
	}
}

html .toast {
	position: fixed;
	right: 24px;
	bottom: 24px;
	display: flex;
	align-items: center;
	justify-content: space-between;
	min-height: 48px;
	max-width: calc(100% - 48px);
	background: var(--color-primary-shade-1);
	box-shadow: var(--material-shadow-z6);
	border-radius: 2px;
	padding: 16px;
	z-index: 500;
	font-size: 0.875rem;
	word-wrap: break-word;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	animation: toastAnimation var(--navigation-transition);
	transition: opacity var(--navigation-transition),
							transform var(--navigation-transition);
}

html .toast.hidden {
	opacity: 0;
	transform: translate(0, 72px);
}

/******************************************************************************/

html .toast .action {
	display: flex;
	align-items: center;
}

html .toast .button {
	border-radius: 2px;
	cursor: pointer;
}

html .toast .button.custom-action {
	font-weight: 500;
	letter-spacing: 0.04em;
	text-transform: uppercase;
	color: var(--color-accent);
	margin-left: 48px;
}

html .toast .button.close {
	display: flex;
	margin-left: 16px;
	user-select: none;
}

html .toast .button.close i:after {
	display: flex;
	content: "close";
	font-size: 1rem;
}

/******************************************************************************/

@media only screen and (max-device-width: 480px) {
	html .toast {
		right: 0;
		bottom: 0;
		width: 100%;
		max-width: 100%;
		border-radius: 0;
	}
}</style></div><div class="paragraph code-paragraph collapsed" name="Toast Examples" data-id="hKqqJwjM" last-execution-state="success" __wid="CJVZYKyU"><pre data-type="content" type="text/javascript" __wid="kmrqvrqF">// Simple Toast
toast("My message of this toast, I have a close button:");

// Toast with custom timout
toast("I'm a very fast toast. Usually they stay for 3 seconds", 1000);

// Toast with custom action
toast("I can log messages!", 5000, () => console.log("You clicked me!"));

// Toast with custom action and title
toast("I can have every name, too", 5000, () => console.log("You clicked me, too!"), "Click Me");</pre></div></div><div class="section section-hidden" data-id="D2c4Behy" name="Context Menu" data-type="system" data-group="basic" __wid="2uq9Cact"><div class="paragraph body-paragraph collapsed locked" name="Documentation" data-id="NWiVAM6j" __wid="tBZDVJdq"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="F6BgM7Gm"><h2 __wid="i7CtynBY">Description</h2><div __wid="epvJ8YYY">This section implements context menu support for Codestrates. Run the `Context Menu Example Code` and then longpress on the `Context Menu Example` body paragraph to see it in action.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="rpEb7cyY" __wid="f4v7EGK6"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="fR3PBpT3">{
  "version": "0.2.12",
  "description": "Context menu implementation for codestrate.",
  "changelog": {
    "0.1": "Initial version.",
    "0.2": "Changed context menu to work with ContextMenuManager.register to make it easier to bind a context menu to an element/target.",
    "0.2.1": "The items property in menu metadata allows functions as well.",
    "0.2.2": "Dispose context menu when re-open another to avoid duplicates.",
    "0.2.3": "Added event options",
    "0.2.4": "Distinguish in ContextMenuManager.register between container and activationTarget.",
    "0.2.5": "Added data-group=\"basic\" attribute to section to load it in non-edit mode",
    "0.2.6": "Enable context menu using right-click.",
    "0.2.7": "Fixed longpress to open context menu.",
    "0.2.8": "Added source event as srcEvent to property to event.",
    "0.2.9": "Changed to different source event; source event that opened the context menu.",
    "0.2.10": "Added option to hide menu items through hidden: true/function property.",
    "0.2.11": "Fixed bug that didn't close open sub-menu-items when opening a sub-menu-item in a different menu item hierarchy.",
    "0.2.12": "Fixed bug that prevent context menu to open on longpress on touch devices"
  }
}</pre></div><div class="paragraph code-paragraph collapsed" data-id="UmSAKuZP" name="Context Menu Manager" __wid="QbrRkDkC"><pre data-type="content" type="text/javascript" id="context-menu-manager" contenteditable="true" __wid="dVihhRX8">importLib([
  "hammer.min.js"
]).then(() => {

  const { ContextMenu } = require('#context-menu');

  exports.register = (container, activationTarget, entriesOrFunc = [], eventOptions = undefined) => {

    // add longpress event listener to activate context menu
    const manager = new Hammer.Manager(activationTarget);

    let press = new Hammer.Press({
      event: 'longpress',
      time: 500
    });

    let tap = new Hammer.Tap({});

    manager.add(press);
    manager.add(tap);

    let contextMenu;

    // dispose a context menu
    const disposeContextMenu = () => {
      contextMenu.hide();
      contextMenu = null;
    };

    const showContextMenu = (event) => {

      // dispose a previous context menu
      if (contextMenu) {
        disposeContextMenu();
      }

      let items = entriesOrFunc;
      if (typeof entriesOrFunc === 'function') {
        items = entriesOrFunc.call(this);
      }

      let clientX = event.clientX;
      let clientY = event.clientY;
      if (event instanceof TouchEvent) {
        clientX = event.changedTouches[0].clientX;
        clientY = event.changedTouches[0].clientY;
      }

      const bounds = container.getBoundingClientRect();
      const x = clientX - bounds.x;
      const y = clientY - bounds.y;

      /* adding source event to event options */
      const newEventOptions = Object.assign({}, eventOptions, {
        srcEvent: event
      });

      contextMenu = new ContextMenu(container, newEventOptions);
      contextMenu.items = items;
      contextMenu.show(x, y);
    };

    // open context menu on long press
    manager.on("longpress", (event) => {
      showContextMenu(event.srcEvent);
    });

    // close on tap, and only if tap is outside of context menu
    manager.on("tap", (event) => {
      if (contextMenu && !event.target.closest('.context-menu')) {
        disposeContextMenu();
      }
    });

    activationTarget.addEventListener("contextmenu", (event) => {

      showContextMenu(event);

      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();

      return false;
    });

    return {
      destroy: () => {
				manager.destroy();
      }
    };
  };
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="s3drthud" name="Context Menu" __wid="RMVbm2eT"><pre data-type="content" type="text/javascript" id="context-menu" __wid="iu3FgQej">const triggerAction = (listener, contextMenu, event = undefined) => {
  const customEvent = Object.assign({}, contextMenu.eventOptions, {
    x: contextMenu.x,
    y: contextMenu.y
  });
  return listener.call(contextMenu, customEvent);
};

/**
 * Returns the value or the return value of the function.
 */
const getValueOrFuncValue = (contextMenu, valueOrFunc) => {
  if (typeof valueOrFunc === 'function') {
    return triggerAction(valueOrFunc, contextMenu);
  }
  return valueOrFunc;
};

const createMenu = (type) => {
  const menu = document.createElement("ul");
  menu.classList.add(type);
  menu.classList.add("z-depth-1");
  return menu;
};

const addItem = (contextMenu, menu, entry) => {
  const item = document.createElement("li");

  const label = getValueOrFuncValue(contextMenu, entry.label);
  item.innerHTML = `&lt;span>${label}&lt;/span>`;

  // add waves element
  if (entry.items) {
    item.classList.add("sub-menu-item");

    const waves = document.createElement("div");
    waves.classList.add("waves");
    waves.classList.add("waves-effect");
    item.appendChild(waves);
  } else {
    item.classList.add("waves-effect");
  }

  // set item invisible
  if (entry.hidden) {
    const hidden = getValueOrFuncValue(contextMenu, entry.hidden);
    if (!hidden) {
      item.classList.add("hidden");
    }
  }

  // disable item
  if (entry.disabled) {
    const disabled = getValueOrFuncValue(contextMenu, entry.disabled);
    if (disabled) {
      item.classList.add("disabled");
    }
  }

  // add sub items open icon, and sub items
  if (entry.items) {
    const items = getValueOrFuncValue(contextMenu, entry.items);

    const openIcon = document.createElement("i");
    openIcon.classList.add("material-icons");
    openIcon.classList.add("right");
    openIcon.innerText = "more_horiz";
    item.appendChild(openIcon);

    const subMenu = createMenu("sub-menu");
    addItems(contextMenu, subMenu, items);

    const toggleSubMenuItem = () => {

      // close other open sub menu items that are not parents of this item
      let openSubMenuItems = contextMenu.element.querySelectorAll('.sub-menu-item.open');
      Array.prototype.forEach.call(openSubMenuItems, (subMenuItem) => {
        if (!subMenuItem.contains(item)) {
          subMenuItem.classList.remove("open");
        }
      });

      item.classList.toggle("open");
    };

    item.addEventListener("click", toggleSubMenuItem);
    item.addEventListener("touchend", toggleSubMenuItem);

    item.appendChild(subMenu);
  }

  // append icon
  if (entry.icon) {
    const icon = document.createElement("i");
    icon.classList.add("material-icons");

    const iconValue = getValueOrFuncValue(contextMenu, entry.icon);
    icon.innerText = iconValue;
    item.appendChild(icon);
  }

  item.addEventListener("click", (event) => {
    const target = event.target;
    if (target.closest('.context-menu li:not(.sub-menu-item):not(.disabled)')) {
      target.closest('.context-menu').remove();
    }
  });

  item.addEventListener("touchend", (event) => {
    const target = event.target;
    if (target.closest('.context-menu li:not(.sub-menu-item):not(.disabled)')) {
      target.closest('.context-menu').remove();
    }
  });

  // trigger the action on click, bind it to the entry
  if (typeof entry.action === 'function') {
    const boundAction = (event) => {
      triggerAction(entry.action, contextMenu, event);
    };

    item.addEventListener("click", boundAction);
    item.addEventListener("touchend", boundAction);
  }

  menu.appendChild(item);
};

const addSeparator = (menu) => {
  const separator = document.createElement("li");
  separator.classList.add("separator");
  menu.appendChild(separator);
};

const addItems = (contextMenu, menu, entries) => {
  entries.forEach((entry) => {
    switch (entry.type) {
    case "item":
      addItem(contextMenu, menu, entry);
      break;
    case "separator":
      addSeparator(menu);
      break;
    }
  });
};

const createRootMenu = (contextMenu, entries) => {
  const menu = createMenu("menu");
  menu.classList.add("grey-text");
  menu.classList.add("text-darken-2");
  menu.classList.add("open");

  addItems(contextMenu, menu, entries);

  return menu;
};

class ContextMenu {

  constructor(target, eventOptions) {
    this.target = target;
    this.eventOptions = eventOptions;

    this.element = document.createElement("transient");
    this.element.classList.add("context-menu");
  }

  get items() {
    return this._items;
  }

  set items(value) {
    this._items = value;

    this.element.innerHTML = '';
    const menu = createRootMenu(this, value);
    this.element.appendChild(menu);
  }

  show(x, y) {
    this.x = x;
    this.y = y;

    this.target.appendChild(this.element);
    this.element.style.left = `${x}px`;
    this.element.style.top = `${y}px`;
    this.element.classList.add("open");

    // close context menu on scroll
    this._disposable = window.addDisposableEventListener("scroll", () => this.hide(), true);
  }

  hide() {
    if (this._disposable) {
      this._disposable.dispose();
    }
    this.element.classList.remove("open");
    this.element.remove();
  }
}

exports.ContextMenu = ContextMenu;</pre></div><div class="paragraph style-paragraph collapsed" data-id="XNdJDpED" name="Context Menu Style" __wid="X3aU4iPb"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="KvSZU2aG">.context-menu {
	position: absolute;
	z-index: 301;
}

.context-menu * {
	box-sizing: border-box !important;
}

.z-depth-1 {
	box-shadow: 0 2px 5px 0 rgba(0,0,0,0.16), 0 2px 10px 0 rgba(0,0,0,0.12);
}

.grey-text.text-darken-2 {
	color: #616161 !important;
}

.context-menu ul.menu {
	list-style-type: none;
}

.context-menu .menu,
.context-menu .sub-menu {
  opacity: 0;
  pointer-events: none;
  transition: opacity .5s;
  margin: 0;
  min-width: 200px;
  box-sizing: border-box;
  background: #fff;
  display: inline-block;
  padding: 8px 0;
  border-radius: 2px;
}

.context-menu .menu.open,
.context-menu .sub-menu.open {
  opacity: 1;
  pointer-events: all;
}

.context-menu li {
  cursor: pointer;
}

.context-menu .menu li:not(.separator):not(.hidden),
.context-menu .sub-menu li:not(.separator):not(.hidden) {
  position: relative;
  box-sizing: border-box;
  padding: 16px 72px;
  width: 100%;
  transition: .3s;
  text-align: left !important;
  white-space: nowrap;
  display: flex;
	align-items: center;
}

.context-menu .menu li .sub-menu,
.context-menu .sub-menu li .sub-menu {
	align-self: flex-start;
}

.context-menu .menu li:not(.separator):hover,
.context-menu .sub-menu li:not(.separator):hover {
  background: #eee;
}

.context-menu .menu li:not(.separator) .material-icons,
.context-menu .sub-menu li:not(.separator) .material-icons {
  position: absolute;
  left: 24px;
}

.context-menu .menu li:not(.separator) .right,
.context-menu .sub-menu li:not(.separator) .right {
  left: auto;
  right: 24px;
}

.context-menu .menu .hidden,
.context-menu .sub-menu .hidden {
  display: none;
}

.context-menu .menu .disabled,
.context-menu .sub-menu .disabled {
  opacity: .7;
  cursor: default;
}

.context-menu .menu .disabled:hover,
.context-menu .sub-menu .disabled:hover {
  background: transparent !important;
}

.context-menu .menu .separator,
.context-menu .sub-menu .separator {
  margin: 8px 0;
  border-bottom: 1px solid #ddd;
}

.context-menu .menu .waves,
.context-menu .sub-menu .waves {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  z-index: 10;
}

.context-menu .menu .sub-menu-item,
.context-menu .sub-menu .sub-menu-item {
  overflow: visible;
}

.context-menu .menu .sub-menu-item .sub-menu,
.context-menu .sub-menu .sub-menu-item .sub-menu {
  opacity: 0;
  pointer-events: none;
  transition: .3s;
  position: absolute;
  z-index: 11;
  width: auto;
  margin: 0;
  left: calc(100% - 4px);
}

.menu .sub-menu-item .right,
.sub-menu .sub-menu-item .right {
  transition: .5s;
}

.menu .sub-menu-item.open>.sub-menu,
.sub-menu .sub-menu-item.open>.sub-menu {
  opacity: 1;
  pointer-events: all;
}

.menu .sub-menu-item.open>.right,
.sub-menu .sub-menu-item.open>.right {
	transform: rotate(-180deg);
}</style></div><div class="paragraph body-paragraph locked" data-id="sXGqGGYX" name="Context Menu Example" __wid="FtNaTcYP"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="writing" id="context-menu-example" style="touch-action: manipulation; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);" __wid="p35TcPf2"></div></div><div class="paragraph style-paragraph collapsed" data-id="rRNh3Y5e" name="Context Menu Example Style" __wid="V9ztcFpq"><style data-type="content" type="text/css" codemirror="true" __wid="57PAWGqL">#context-menu-example {
	color: black;
	background-color: white;
	min-height: 500px;
}</style></div><div class="paragraph code-paragraph collapsed" data-id="xxYWnwkP" name="Context Menu Example Code" last-execution-state="success" __wid="PeKVeM8L"><pre data-type="content" type="text/javascript" __wid="HmBDx3fQ">const ContextMenuManager = require('#context-menu-manager');

const example = document.querySelector('#context-menu-example');
const exampleParagraph = example.closest('.paragraph');
let contextMenu;

const exampleContextMenuData = [{
  type: "item",
  label: "Normal Option",
  action: function () {
    console.log('normal option menu item clicked');
  }
}, {
  type: "item",
  label: "Disabled",
  icon: "close",
  disabled: true
}, {
  type: "separator"
}, {
  type: "item",
  label: "Delete",
  icon: "delete",
  action: function () {
    console.log(`delete menu item clicked at position x=${this.y}, y=${this.x}`);
  }
}, {
  type: "item",
  label: "Submenu",
  icon: "note_add",
  items: [{
    type: "item",
    label: "Sub item",
    icon: "person",
    action: function (event) {
      console.log('sub item clicked', event);
    }
  }, {
    type: "item",
    label: "Other delete",
    icon: "delete",
    action: function () {
      console.log('other delete menu item clicked');
    }
  }]
}];

// create context menu for example
ContextMenuManager.register(exampleParagraph, example, exampleContextMenuData, {
  foo: "bar",
  baz: 123
});</pre></div></div><div class="section section-hidden" name="Global Navigation" data-type="system" data-id="9LquKSJE" data-group="basic" __wid="LJjiVrxX"><div class="paragraph body-paragraph collapsed locked" name="Documentation" data-id="KDD29nq9" draggable="false" __wid="VmTrfmwW"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="xXUCHrSN"><h2 __wid="SLR5f56M">Description</h2><div __wid="3ZYUWXdS">The global navigation provides a basic navigation consisting of a <b __wid="CpTZmsd2">toolbar </b>at the top of the screen and a <b __wid="FhvzMQWB">menu </b>sidebar on the left. Using the two "Utils" paragraphs <code __wid="kUV2wJ3S">#global-toolbar-utils</code> and <code __wid="mbEQEvjh">#global-menu-utils</code> it is possible to add new items to either the toolbar or the menu.</div><h2 __wid="dJzh493w">Global Toolbar</h2><div __wid="XbHGd3JE">The toolbar is fixed at the top of the screen. The toolbar consists of three container: left-, center- and right-aligned. You can put items in either of these. The toolbar should be used for actions, which add content and create new things (like adding paragraphs), or important inputs and searches.</div><h3 __wid="kHatZkEa">Usage</h3><div __wid="xRupapCP">To add elements to the toolbar you can use the functions provided and documented in the <code __wid="ceFF5rRM">#global-toolbar-utils</code> paragraph below.</div><h2 __wid="xR82ekAZ">Global Menu</h2><div __wid="d62pACVs">The global menu is a drawer on the left side of the screen. It can be opened by hovering the handle to open it temporarily (as long as hovered). Pressing the "menu" button in the toolbar pins the menu to be permanently visible. The menu should be used for actions, which have many entries and can be easier described by text. For multiple entries of the same package or category submenus should be used.</div><h3 __wid="kgz2V5P6">Usage</h3><div __wid="iZ27BWCy">To add elements to the toolbar you can use the functions provided and documented in the <code __wid="zXaHhBir">#global-menu-utils</code> paragraph below.</div><h3 __wid="nRFqymAH">Pinning the Menu</h3><div __wid="aHthGxV3">The global menu uses a transient attribute added to the body element to indicate whether it is pinned or not. The respective attribute is <code __wid="4RTDc3Lc">transient-menu-pinned="true"</code>. It can also be used by other code to adjust UI elements so the menu doesn't overlay other content.</div><div __wid="gRnJtcXe"><br __wid="vEj6wYht"/></div><div __wid="pxvKeS9N">The <code __wid="CszbfnCD">#global-menu-utils</code> also provide functions to open, close or toggle the menu pinning.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="R2Gx7nZ3" style __wid="zMHZ7YWG"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="JpZc5Bwb">{
  "version": "1.2.7",
  "description": "Provides the basic navigation consisting of toolbar and menu.",
  "changelog": {
    "1.0": "Initital Release",
    "1.1": "Added submenus and create functions.",
    "1.2": "Added toolbar and changed theme to Material Design.",
    "1.2.1": "Updated documentation and added examples.",
    "1.2.2": "Updated Codestrate menu entries.",
    "1.2.3": "Adjusted placing and styles of toolbar to new structure.",
    "1.2.4": "Commands API used.",
    "1.2.5": "Made toolbar scrollable on mobile.",
    "1.2.6": "Using section utils to create new section.",
    "1.2.7": "Outfactored tagging menu items to the tagging and versioning system section."
  }
}</pre></div>

<div class="paragraph body-paragraph locked collapsed" data-id="UvFTUhZK" name="Global Toolbar Template" draggable="false" style __wid="5WteCmwv"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" __wid="qvmvcXJD"><template id="global-toolbar-template" __wid="riiJ26cS">
	<transient id="global-toolbar" __wid="Thc67aFQ">
		<div class="toolbar-row" __wid="TcagJQRp">
			<div class="toolbar-container toolbar-left" __wid="6qkGWT6E"></div>
			<div class="toolbar-container toolbar-center" __wid="VbspbT8K"></div>
			<div class="toolbar-container toolbar-right" __wid="ynsMHNa4"></div>
		</div>
	</transient>
</template></div></div><div class="paragraph body-paragraph collapsed" name="Global Menu Template" data-id="sP2y6U2W" draggable="false" style __wid="qGDyDSqy"><div data-type="content" type="text/html" codemirror="true" contenteditable="true" __wid="Sk94Tike"><template id="global-menu-template" __wid="u6cE5b9V">
	<transient id="global-menu" __wid="zyGzD9eU">
		<span class="handle material-icons" __wid="2brXyCaT"></span>
		<div class="menu-container" __wid="BFR6EMXL"></div>
	</transient>
</template></div></div><div class="paragraph code-paragraph collapsed" name="Add Global Toolbar and Menu" data-id="pa2PDQ5T" draggable="false" style run-on-load="true" last-execution-state="success" __wid="kjv6D9Eh"><pre data-type="content" type="text/javascript" __wid="mippH4YS">const globalToolbarTemplate = document.querySelector("#global-toolbar-template");
const globalToolbarFragment = document.importNode(globalToolbarTemplate.content, true);
document.body.appendChild(globalToolbarFragment);

const globalMenuTemplate = document.querySelector("#global-menu-template");
const globalMenuFragment = document.importNode(globalMenuTemplate.content, true);
document.body.appendChild(globalMenuFragment);</pre></div><div class="paragraph code-paragraph collapsed" name="Global Toolbar Utils" data-id="giNkDZSm" draggable="false" style __wid="vA5n3cRK"><pre data-type="content" type="text/javascript" id="global-toolbar-utils" __wid="pRxrDMkR">const globalToolbar = document.querySelector("#global-toolbar");
const toolbarLeft = globalToolbar.querySelector(".toolbar-left");
const toolbarCenter = globalToolbar.querySelector(".toolbar-center");
const toolbarRight = globalToolbar.querySelector(".toolbar-right");

/******************************************************************************/

exports.open = () => {
	document.body.removeAttribute("transient-toolbar-hidden");
};

exports.close = () => {
	document.body.setAttribute("transient-toolbar-hidden", "true");
};

exports.toggle = () => {
	if (document.body.hasAttribute("transient-toolbar-hidden")) {
		exports.open();
	} else {
		exports.close();
	}
};

/******************************************************************************/

/**
 * Adds a &lt;hr> divider to the toolbar.
 *
 * @param container  Toolbar container to add the divider to
 *                   (-1: left, 0: center, 1: right (default)).
 * @param classNames Additional CSS classes for the divider.
 */
exports.addDivider = (container, classNames = false) => {
	const divider = document.createElement("hr");
	if (classNames) divider.setAttribute("class", classNames);
	exports.addToolbarItem(divider, container);
};

/**
 * Adds an HTML element to a toolbar container.
 *
 * @param toolbarItem The HTML element to add to the toolbar.
 * @param container   Toolbar container to add the item to
 *                    (-1: left, 0: center, 1: right (default)).
 */
exports.addToolbarItem = (toolbarItem, container = 1) => {
	if (container === -1) {
		toolbarLeft.appendChild(toolbarItem);
	} else if (container === 0) {
		toolbarCenter.appendChild(toolbarItem);
	} else {
		toolbarRight.appendChild(toolbarItem);
	}
};

/******************************************************************************/

/**
 * Creates and adds a button to the toolbar.
 *
 * @param title      The title-attribute of the button.
 * @param icon       The icon of the button (use Material Icons string).
 * @param classNames Additional CSS classes for the button.
 * @param container  Toolbar container to add the button to
 *                   (-1: left, 0: center, 1: right (default)).
 * @param action     The function to perform on clicks.
 */
exports.addButton = (title, icon, classNames, container, action) => {
	const button = exports.createButton(title, icon, classNames, action);
	exports.addToolbarItem(button, container);
};

/**
 * Creates and adds a title to the toolbar.
 *
 * @param title      The title-attribute of the title.
 * @param classNames Additional CSS classes for the title.
 * @param content    The text of the title.
 * @param container  Toolbar container to add the title to
                     (-1: left, 0: center, 1: right (default)).
 */
exports.addTitle = (title, classNames, content, container) => {
	const titleElement = exports.createTitle(title, classNames, content);
	exports.addToolbarItem(titleElement, container);
};

/**
 * Creates and adds a input for the toolbar.
 *
 * @param title       The title-attribute of the input.
 * @param classNames  Additional CSS classes for the input.
 * @param content     The text of the input.
 * @param container   Toolbar container to add the input to
 *                    (-1: left, 0: center, 1: right (default)).
 * @param inputAction Function for the "input" eventlistener of the input.
 */
exports.addInput = (title, classNames, content, container, inputAction) => {
	const input = exports.createInput(title, classNames, content, inputAction);
	exports.addToolbarItem(input, container);
};

/**
 * Creates and adds a search for the toolbar.
 *
 * @param title        The title-attribute of the search.
 * @param classNames   Additional CSS classes for the search.
 * @param placeholder  The placeholder text of the search.
 * @param container    Toolbar container to add the search to
 *                     (-1: left, 0: center, 1: right (default)).
 * @param searchAction Function for the search.
 *
 * @return The created search.
 */
exports.addSearch = (title, classNames, placeholder, container, searchAction) => {
	const search = exports.createSearch(title, classNames, placeholder, searchAction);
	exports.addToolbarItem(search, container);
};

/******************************************************************************/

/**
 * Creates a button for the toolbar and returns it.
 *
 * @param title      The title-attribute of the button.
 * @param icon       The icon of the button (use Material Icons string).
 * @param classNames Additional CSS classes for the button.
 * @param action     The function to perform on clicks.
 *
 * @return The created button.
 */
exports.createButton = (title, icon = "", classNames = false, action = false) => {
	const button = document.createElement("span");
	button.setAttribute("title", title);

	const i = document.createElement("i");
	i.classList.add("material-icons");
	i.innerHTML = icon;

	button.appendChild(i);

	if (classNames) {
		button.setAttribute("class", classNames);
	}
	button.classList.add("toolbar-button");

	if (typeof action === "function") {
		button.addEventListener("click", action);
	}

	return button;
};

/**
 * Creates a title for the toolbar and returns it.
 *
 * @param title      The title-attribute of the title.
 * @param classNames Additional CSS classes for the title.
 * @param content    The text of the title.
 *
 * @return The created title.
 */
exports.createTitle = (title, classNames = false, content = false) => {
	const titleElement = document.createElement("span");
	titleElement.setAttribute("title", title);

	if (classNames) {
		titleElement.setAttribute("class", classNames);
	}
	titleElement.classList.add("toolbar-title");

	if (content) {
		titleElement.innerText = content;
	}

	return titleElement;
};

/**
 * Creates a input for the toolbar and returns it.
 *
 * @param title       The title-attribute of the input.
 * @param classNames  Additional CSS classes for the input.
 * @param content     The text of the input.
 * @param inputAction Function for the "input" eventlistener of the input.
 *
 * @return The created input.
 */
exports.createInput = (title, classNames = false, content = false, inputAction = false) => {
	const inputElement = exports.createTitle(title, classNames, content);
	inputElement.classList.add("toolbar-input");
	inputElement.setAttribute("contenteditable", "true");
	inputElement.addEventListener("keypress", event => {
		if (event.which === 13) {
			event.preventDefault();
		}
	});

	if (typeof inputAction === "function") {
		inputElement.addEventListener("input", () => inputAction(inputElement));
	}

	return inputElement;
};

/**
 * Creates a search for the toolbar and returns it.
 *
 * @param title        The title-attribute of the search.
 * @param classNames   Additional CSS classes for the search.
 * @param placeholder  The placeholder text of the search.
 * @param searchAction Function for the search.
 *
 * @return The created search.
 */
exports.createSearch = (title, classNames = false, placeholder = false, searchAction = false) => {
	const search = document.createElement("span");
	search.setAttribute("title", title);

	if (classNames) {
		search.setAttribute("class", classNames);
	}
	search.classList.add("toolbar-search");

	const searchInput = document.createElement("input");
	searchInput.classList.add("toolbar-search-input");
	searchInput.setAttribute("placeholder", placeholder ? placeholder : "Search");
	searchInput.addEventListener("keypress", event => {
		if (event.which === 13) {
			searchAction(searchInput);
		}
	});

	const searchButton = exports.createButton("Search", "", "toolbar-search-button-search", () => {
		searchAction(searchInput);
	});

	const clearSearchButton = exports.createButton("Clear Search", "", "toolbar-search-button-clear", () => {
		searchInput.value = "";
	});

	search.appendChild(searchButton);
	search.appendChild(searchInput);
	search.appendChild(clearSearchButton);

	return search;
};</pre></div><div class="paragraph code-paragraph collapsed" style draggable="false" name="Global Menu Utils" data-id="H9YMLbvG" __wid="cQxkXuEr"><pre data-type="content" type="text/javascript" id="global-menu-utils" __wid="Uspc8QzW">const globalMenu = document.querySelector("#global-menu");
const container = globalMenu.querySelector(".menu-container");

/******************************************************************************/

exports.open = () => {
	document.body.setAttribute("transient-menu-pinned", "true");
};

exports.close = () => {
	document.body.removeAttribute("transient-menu-pinned");
};

exports.toggle = () => {
	if (document.body.hasAttribute("transient-menu-pinned")) {
		exports.close();
	} else {
		exports.open();
	}
};

/******************************************************************************/

/**
 * Adds a &lt;hr> divider to the menu.
 *
 * @param classNames Additional CSS classes for the divider.
 */
exports.addDivider = (classNames = false) => {
	const divider = document.createElement("hr");
	if (classNames) divider.setAttribute("class", classNames);
	container.appendChild(divider);
};

/**
 * Adds an HTML element to the menu.
 *
 * @param menuItem The HTML elemen to add.
 */
exports.addMenuItem = (menuItem) => {
	container.appendChild(menuItem);
};

/******************************************************************************/

/**
 * Creates and adds a button to the menu.
 *
 * @param name       The name of the button.
 * @param classNames Additional CSS classes for the button.
 * @param action     The function to perform on clicks.
 */
exports.addButton = (name, classNames, action) => {
	const button = exports.createButton(name, classNames, action);
	container.appendChild(button);
};

/**
 * Creates and adds (if not already available) a submenu to the menu.
 *
 * @param name The name of the submenu.
 */
exports.addSubMenu = (subMenuName) => {
	let subMenu = container.querySelector(`.sub-menu[name="${subMenuName}"]`);
	if (!subMenu) {
		subMenu = exports.createSubMenu(subMenuName);
		container.appendChild(subMenu);
	}
};

/**
 * Adds an HTML element to a submenu. The submenu will be added if not available.
 *
 * @param menuItem    The HTML elemen to add.
 * @param subMenuName The name of the submenu.
 */
exports.addMenuItemToSubMenu = (menuItem, subMenuName) => {
	let subMenu = container.querySelector(`.sub-menu[name="${subMenuName}"]`);
	if (!subMenu) {
		subMenu = exports.createSubMenu(subMenuName);
		container.appendChild(subMenu);
	}
	subMenu.appendChild(menuItem);
};

/**
 * Creates and adds a button to a submenu. The submenu will be added if not available.
 *
 * @param name        The name of the button.
 * @param classNames  Additional CSS classes for the button.
 * @param action      The function to perform on clicks.
 * @param subMenuName The name of the submenu.
 */
exports.addButtonToSubMenu = (name, classNames, action, subMenuName) => {
	const button = exports.createButton(name, classNames, action);
	exports.addMenuItemToSubMenu(button, subMenuName);
};

/******************************************************************************/

/**
 * Creates a button for the menu and returns it.
 *
 * @param name       The name of the button.
 * @param classNames Additional CSS classes for the button.
 * @param action     The function to perform on clicks.
 *
 * @return The created button.
 */
exports.createButton = (name, classNames, action) => {
	const button = document.createElement("div");
	button.innerText = name;

	if (classNames) {
		button.setAttribute("class", classNames);
	}
	button.classList.add("menu-button");

	if (typeof action === "function") {
		button.addEventListener("click", action);
	}

	return button;
};

/**
 * Creates a submenu and returns it.
 *
 * @param name The name of the submenu.
 */
exports.createSubMenu = (name) => {
	const subMenu = document.createElement("div");
	subMenu.setAttribute("name", name);
	subMenu.classList.add("sub-menu", "hidden");

	const label = document.createElement("div");
	label.classList.add("label");
	label.innerHTML = `&lt;span class="expander">&lt;i class="material-icons">&lt;/i>&lt;/span>&lt;span class="title">${name}&lt;/span>`;
	label.addEventListener("click", () => {
		subMenu.classList.toggle("hidden");
	});

	subMenu.appendChild(label);

	return subMenu;
};</pre></div><div class="paragraph code-paragraph collapsed" name="Init Global Toolbar and Menu" draggable="false" style data-id="7aMu3qpU" run-on-load="true" last-execution-state="success" __wid="EwhEmgXG"><pre data-type="content" type="text/javascript" __wid="ctV8XLwG">const GlobalToolbarUtils = require("#global-toolbar-utils");
const GlobalMenuUtils = require("#global-menu-utils");
const SectionUtils = require('#section-utils');
const ParagraphUtils = require("#paragraph-utils");

/******************************************************************************/

// Add menu button
Codestrate.addCommand("codestrates.toggleMenu", "Toggle Menu", () => {
	GlobalMenuUtils.toggle();
});
GlobalToolbarUtils.addButton("Menu", "", "toolbar-button-menu", -1, () => {
	Codestrate.executeCommand("codestrates.toggleMenu");
});

// Add contenteditable for the Codestrate title
const titleInput = GlobalToolbarUtils.createInput("Codestrate Title", "toolbar-input-title", document.title, (inputElement) => {
	document.title = inputElement.innerText;
});

titleInput.__titleObserver = new MutationObserver(() => {
	const position = HTMLUtils.getCaretPosition(titleInput);
	titleInput.innerText = document.title;
	HTMLUtils.setCaretPosition(titleInput, position);
});

titleInput.__titleObserver.observe(document.querySelector("title"), { characterData: true, attributes: false, childList: true, subtree: true });
GlobalToolbarUtils.addToolbarItem(titleInput, -1);

/******************************************************************************/

Codestrate.addCommand("codestrates.sections.addSection", "Add Section", () => {
	const section = SectionUtils.createSection();

	const sections = document.querySelector('#sections');
	if (Codestrate.focussedSection) {
		sections.insertBefore(section, Codestrate.focussedSection.nextSibling);
	} else {
		sections.appendChild(section);
	}

	Codestrate.simulateClick(section);
});
GlobalToolbarUtils.addButton("Add Section", "label", false, 1, () => {
	Codestrate.executeCommand("codestrates.sections.addSection");
});

Codestrate.addCommand("codestrates.sections.addBodyParagraph", "Add Body Paragraph", () => {
	const bodyParagraph = ParagraphUtils.createBodyParagraph();
	bodyParagraph.querySelector('[data-type="content"]').classList.add("writing");
	ParagraphUtils.insertParagraphAfterFocussed(bodyParagraph);
});
GlobalToolbarUtils.addButton("Add Body Paragraph", "text_fields", "section-tools", 1, () => {
	Codestrate.executeCommand("codestrates.sections.addBodyParagraph");
});

Codestrate.addCommand("codestrates.sections.addStyleParagraph", "Add Style Paragraph", () => {
	ParagraphUtils.insertParagraphAfterFocussed(ParagraphUtils.createStyleParagraph());
});
GlobalToolbarUtils.addButton("Add Style Paragraph", "brush", "section-tools", 1, () => {
	Codestrate.executeCommand("codestrates.sections.addStyleParagraph");
});

Codestrate.addCommand("codestrates.sections.addCodeParagraph", "Add Code Paragraph", () => {
	ParagraphUtils.insertParagraphAfterFocussed(ParagraphUtils.createCodeParagraph());
});
GlobalToolbarUtils.addButton("Add Code Paragraph", "code", "section-tools", 1, () => {
	Codestrate.executeCommand("codestrates.sections.addCodeParagraph");
});

Codestrate.addCommand("codestrates.sections.addDataParagraph", "Add Data Paragraph", () => {
	ParagraphUtils.insertParagraphAfterFocussed(ParagraphUtils.createDataParagraph());
});
GlobalToolbarUtils.addButton("Add Data Paragraph", "storage", "section-tools", 1, () => {
	Codestrate.executeCommand("codestrates.sections.addDataParagraph");
});

/******************************************************************************/

const getLoadModeLabel = () => {
	return Codestrate.mode === "edit" ? 'Switch to "No Edit" Mode' : 'Switch to Edit Mode';
};

Codestrate.addCommand("codestrates.toggleLoadMode", "Toggle Load Mode", () => {
	if (Codestrate.mode === "edit") {
		Codestrate.mode = "no-edit";
		toggleLoadModeButton.innerHTML = getLoadModeLabel();
	}
	else {
		Codestrate.mode = "edit";
		toggleLoadModeButton.innerHTML = getLoadModeLabel();
	}

	toast(`Codestrate is in "${Codestrate.mode}" mode`);
});
const toggleLoadModeButton = GlobalMenuUtils.createButton(getLoadModeLabel(), false, () => {
	Codestrate.executeCommand("codestrates.toggleLoadMode");
});

Codestrate.addCommand("codestrates.createCodestrateCopy", "Create Copy of Codestrate", () => {
	window.open(`/${webstrate.webstrateId}/?copy`);
});
const createCodestrateCopyButton = GlobalMenuUtils.createButton("Create Copy of Codestrate", false, () => {
	Codestrate.executeCommand("codestrates.createCodestrateCopy");
});

/******************************************************************************/

const subMenuName = "Codestrate";

GlobalMenuUtils.addMenuItemToSubMenu(toggleLoadModeButton, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(createCodestrateCopyButton, subMenuName);</pre></div>
<div class="paragraph style-paragraph collapsed" data-id="y7Q3AHEx" draggable="false" style name="Global Toolbar Style" __wid="enuSPwMt"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="8XhgVWS2">html #global-toolbar {
	background: var(--color-primary);
	color: var(--color-primary-text);
	display: block;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 64px;
	overflow-x: scroll;
	overflow-y: hidden;
	z-index: 200;
	box-shadow: var(--material-shadow-z4);
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	transition: transform var(--navigation-transition),
							box-shadow var(--navigation-transition);
}

html #global-toolbar::-webkit-scrollbar {
	display: none;
}

html body[transient-toolbar-hidden="true"] #global-toolbar {
	box-shadow: none;
	transform: translate(0, -100%);
}

/******************************************************************************/

html #global-toolbar .toolbar-row {
	display: flex;
	justify-content: space-between;
	position: relative;
	align-items: center;
	width: 100%;
	height: 100%;
	padding: 8px;
}

html #global-toolbar .toolbar-container {
	display: flex;
	box-sizing: border-box;
	height: 48px;
	vertical-align: middle;
	z-index: 1;
}

html #global-toolbar .toolbar-left {
	flex: 1 0 auto;
	justify-content: flex-start;
	order: -1;
	padding-right: 32px;
}

html #global-toolbar .toolbar-center {
	flex: 1 1 100%;
	justify-content: center;
	order: 0;
}

html #global-toolbar .toolbar-right {
	flex: 0 0 auto;
	justify-content: flex-end;
	order: 1;
	padding-left: 32px;
}

/******************************************************************************/

html #global-toolbar .toolbar-button {
	display: flex;
	padding: 4px;
	width: 48px;
	height: 48px;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	border-radius: 50%;
	flex-shrink: 0;
	user-select: none;
}

html #global-toolbar .toolbar-title {
	font-size: 1.25rem;
	font-weight: 500;
	letter-spacing: 0.02rem;
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
	align-self: center;
	padding: 0 16px;
}

html #global-toolbar .toolbar-title+.toolbar-title {
	padding-left: 0;
}

html #global-toolbar .toolbar-input {
	cursor: text;
	outline: none;
}

html #global-toolbar .toolbar-input:empty:before {
	content: "Empty";
	opacity: 0.5;
}

html #global-toolbar .toolbar-search {
	background: var(--color-primary-shade-1);
	border-radius: 4px;
	display: flex;
	flex: 0 1 512px;
}

html #global-toolbar .toolbar-search-input {
	flex: 0 1 100%;
	outline: none;
	background: none;
	border: none;
	color: var(--color-primary-text);
	text-overflow: ellipsis;
	font-size: 1em;
	letter-spacing: 0.02rem;
}

html #global-toolbar .toolbar-search-input::placeholder {
	color: var(--color-tertiary-text);
}

html #global-toolbar .toolbar-search-button-search,
html #global-toolbar .toolbar-search-button-clear {
	width: 40px;
	height: 40px;
	margin: 4px;
}

html #global-toolbar .toolbar-search-button-search i:after {
	content: "search";
}

html #global-toolbar .toolbar-search-input:placeholder-shown ~ .toolbar-search-button-clear {
	visibility: hidden;
}

html #global-toolbar .toolbar-search-button-clear i:after {
	content: "clear";
}

/******************************************************************************/

html #global-toolbar .toolbar-input-title:empty:before {
	content: "No Title";
}

html #global-toolbar .toolbar-button-menu {
	padding-right: 24px;
	padding-left: 24px;
}

html #global-toolbar .toolbar-button-menu i:after {
	content: "menu";
}

/******************************************************************************/

html #global-toolbar hr {
	border: none;
	border-left: 1px solid var(--color-primary-text);
	margin: 8px 4px;
	opacity: 0.8;
}</style></div><div class="paragraph style-paragraph collapsed" name="Global Menu Style" draggable="false" data-id="wckGBv9N" style __wid="D9tfDnMb"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="aJpMSpRD">html #global-menu {
	background-color: var(--color-primary-shade-1);
	color: var(--color-primary-text);
	position: fixed;
	top: 0;
	left: 0;
	width: 288px;
	height: 100%;
	z-index: 100;
	padding-top: 80px;
	padding-bottom: 8px;
	box-shadow: var(--material-shadow-z16);
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	transition: transform var(--navigation-transition),
							box-shadow var(--navigation-transition),
							padding-top var(--navigation-transition);
}

html body[transient-toolbar-hidden="true"] #global-menu {
	padding-top: 16px;
}

html body:not([transient-menu-pinned="true"]) #global-menu {
	transform: translate(-100%, 0);
	box-shadow: none;
}

/******************************************************************************/

html body:not([transient-menu-pinned="true"])  #global-menu:hover {
	transform: none;
	box-shadow: var(--material-shadow-z16);
}

html #global-menu .handle {
	position: absolute;
	right: 0;
	top: 50%;
	transform: translate(100%, -50%);
	transition: opacity var(--navigation-transition);
}

html #global-menu .handle:after {
	content: "keyboard_arrow_right";
	background: var(--color-primary);
	border-top-right-radius: 50%;
	border-bottom-right-radius: 50%;
}

html #global-menu:hover .handle,
html body[transient-menu-pinned="true"] #global-menu .handle {
	opacity: 0;
}

/******************************************************************************/

html #global-menu .menu-container {
	display: flex;
	flex-direction: column;
	width: 100%;
	height: 100%;
	overflow: hidden;
	overflow-y: auto;
	flex-wrap: nowrap;
}

/******************************************************************************/

html #global-menu .menu-container hr {
	border: 0;
	border-bottom: 1px solid var(--color-primary-shade-3);
	width: 100%;
}

html #global-menu .menu-container .menu-button,
html #global-menu .menu-container .sub-menu > .label {
	height: 40px;
	font-weight: 500;
	cursor: pointer;
	font-size: 0.9rem;
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: flex-start;
	border: none;
	background: none;
	padding-left: 16px;
	padding-right: 16px;
	flex-shrink: 0;
	user-select: none;
}


html #global-menu .menu-container .sub-menu {
	display: flex;
	flex-direction: column;
	flex-wrap: nowrap;
	flex-shrink: 0;
	border: 0;
	padding-bottom: 8px;
	border-bottom: 1px solid var(--color-primary-shade-3);
	margin-bottom: 8px;
}

html #global-menu .menu-container .sub-menu > .label .expander {
	margin-right: 8px;
}

html #global-menu .menu-container .menu-button:hover,
html #global-menu .menu-container .sub-menu > .label:hover,
html #global-menu .menu-container .sub-menu:not(.hidden) > .label {
	background: var(--color-primary-shade-2);
}

html #global-menu .menu-container .sub-menu > .label i {
	font-size: 1.4rem;
	display: flex
}

html #global-menu .menu-container .sub-menu > .label i:after {
	content: "keyboard_arrow_down";
}

html #global-menu .menu-container .sub-menu.hidden > .label i:after {
	content: "keyboard_arrow_right";
}

html #global-menu .menu-container .sub-menu.hidden > *:not(.label) {
	display: none;
}</style></div><div class="paragraph code-paragraph collapsed" data-id="LihLx6rS" name="Global Navigation Examples" last-execution-state="success" style __wid="VAfhXJEd"><pre data-type="content" type="text/javascript" __wid="Y4aaAmGj">const GlobalToolbarUtils = require("#global-toolbar-utils");
const GlobalMenuUtils = require("#global-menu-utils");

/******************************************************************************/

// Add a divider to the left of the toolbar
GlobalToolbarUtils.addDivider(-1, "example-css-class");

// Add a button which logs something to the left of the toolbar
GlobalToolbarUtils.addButton("Example Button", "message", "example-css-class", -1, () => console.log("You logged something from the toolbar!"));

// Add a title to the center of the toolbar
GlobalToolbarUtils.addTitle("Example Title", "example-css-class", "You can't edit me!", 0);

// Add an input, which logs it's content, to the center of the toolbar
GlobalToolbarUtils.addInput("Example Input", "example-css-class", "Edit me!", 0, (inputElement) => console.log(inputElement.innerText));

// Add a search, which logs it's content and clears itself, to the right of the toolbar
GlobalToolbarUtils.addSearch("Example Search", "example-css-class", "Oh my I'm empty!", 1, (searchInput) => {
	if (searchInput.value === "") {
		console.log("Enter something first!");
	} else {
		console.log(searchInput.value);
		searchInput.value = "";
	}
});

// Add custom element to the center of the toolbar
const toolbarSpan = document.createElement("span");
toolbarSpan.setAttribute("style", "background: hotpink; width: 48px;");
GlobalToolbarUtils.addToolbarItem(toolbarSpan, 0);

/******************************************************************************/

// Add a button to the menu
GlobalMenuUtils.addButton("Example Button", "example-css-class", () => console.log("You logged something from the menu!"));

// Add a divider to the menu
GlobalMenuUtils.addDivider("example-css-class");

// Add a empty submenu to the menu
GlobalMenuUtils.addSubMenu("Empty SubMenu");

// Add a submenu with a button to the menu
GlobalMenuUtils.addButtonToSubMenu("SubMenu 1", "example-css-class", () => console.log("SubMenu 1"), "Example SubMenu");

// Add custom element to the menu
const menuSpan = document.createElement("span");
menuSpan.setAttribute("style", "background: hotpink; height: 48px;");
GlobalMenuUtils.addMenuItem(menuSpan);</pre></div></div><div class="section section-hidden" data-id="NELYfTiq" name="Snackbar" data-type="system" __wid="PC3rHS75"><div class="paragraph body-paragraph collapsed locked" data-id="aveXm4uW" name="Documentation" __wid="exChTgFE"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="ZhmZgguc"><h2 __wid="ih8ZD7KN">Description</h2>
<div __wid="yx2Sx6uL">The snackbar provides a toolbar to display actions to manipulate or transform currently focussed paragraphs or elements. To use basic snackbar functions like adding items one needs to use the <code __wid="ziM8fFfi">#snackbar-utils</code>. The management of when items show is done by the "Snackbar Tools", which can be accessed using the <code __wid="3tysAxKu">#snackbar-tools</code>.</div><h2 __wid="8mEujwq4">Snackbar</h2><div __wid="Z3EKDrAn">The snackbar implementation offers a second toolbar at the bottom of the screen, which can be expanded to show content like editors, consoles or any other HTML elements. The content can also be expanded to show even more of the content.</div><h3 __wid="35fsBLkj">States</h3><div __wid="jBWULZXA">The snackbar has three states, indicated by three classes, which are attached to the <code __wid="aL88dnDC">#snackbar</code> element.</div><div __wid="rbxvJZu9"><ul __wid="hgysMgnj"><li __wid="rM8pvnhx"><code __wid="TQaZNKrW">.row-open</code>: The toolbar part of the snackbar is visible.</li><li __wid="VBdezffR"><code __wid="c8YCBwJm">.content-open</code>: The content of the snackbar is visible (e.g. when editing HTML of body paragraphs).</li><li __wid="SJ4qQnQZ"><code __wid="NE9zXkLe">.content-expanded-open</code>: The content of the snackbar is expanded to the top of the screen.</li></ul><div __wid="TSFD4KSy"><b __wid="sJB6XEZ9">Note</b>: Switching between these states is usually done by the Snackbar implementation and Snackbar Tools. So calling the <code __wid="p4XVaQ92">openRow() / openContent() / openContentExpanded()</code> and respective <code __wid="AcW6Ta53">close()</code> functions usually don't need to be called manually.</div></div><h3 __wid="3nbgZzY2">Snackbar Content</h3><h4 __wid="VctVm5MX">Adding and Removing Content</h4><div __wid="69n7wuTN">It is possible to show display any HTML element in the content of the snackbar. This can be done by using the <code __wid="aUVtEUHS">setContent()</code> function. The snackbar will automatically switch to the <code __wid="8ULEnin6">.content-open</code> state upon setting content.</div><div __wid="56fgZNLK">Removing the content later on can be done by the <code __wid="VeJLJYZE">removeContent()</code> function. The function will return the content of the snackbar and additionally fire an <code __wid="ijebmF2Y">SnackbarRemoveContent</code> event with the content as <code __wid="9NzG6pkT">event.detail</code>. Upon removing the content, the snackbar will automatically switch back to the <code __wid="pKmc2rdQ">.row-open</code> state.</div><div __wid="D6np8cpB"><b __wid="63RDfutn">Note</b>: When closing the content (by pressing the close button or calling the <code __wid="jJnGXsg3">closeContent()</code> function) without removing the content in advance, the content will automatically be removed. Therefore the event of removing content should be listened to in case the content is still needed.</div><h4 __wid="mjiiFbG7">SnackbarRemoveContent Event</h4><div __wid="hhS7nJSf">When the content of the snackbar closes and the content gets removed an event will be fired containing the removed content. Functions and listen to the event and react on it, if the removed content is still needed, e.g. if it's the editor of a paragraph.</div><h4 __wid="tdUREUMG">Snackbar Content Related Paragraph</h4><div __wid="qyuJ4bkb">If the content of the snackbar is related to a paragraph (e.g. when opening the console of a code paragraph in it), the related paragraph should receive the attribute <code __wid="XahwnxvF">transient-content-paragraph="true"</code>. This makes it easier for the user to find the related paragraph at a glance. Remember to remove the attribute after the content is closed.</div><h3 __wid="aTcBWTMu">Usage</h3><div __wid="NjABxcrN">Functions to open the row, the content and the expanded content aswell as functions to add items can be found in the <code __wid="KYKCtEnu">#snackbar-utils</code>.</div><h2 __wid="JJEmNVpG">Snackbar Tools</h2><div __wid="6YutQCk9">The snackbar tools are an extension of the snackbar providing the functionality to show and hide icons according to the currently selected/clicked element/paragraph/section. Upon clicking on any element expect the global toolbar, global menu or snackbar itself, the set of active tools will be updated.</div><div __wid="rrDiSQ9v">This is done by adding <code __wid="FQziZ9zm">-tools="true"</code> attributes to the snackbar element and a <code __wid="xLMhyBRp">-tools</code> class to the items. Using a styling like this then hides all items, which are not active at the moment:</div><pre __wid="YXttLHBZ"><code __wid="ePbycz2B">html #snackbar:not([myName-tools="true"]) .myName-tools {
  display: none;
}</code></pre><div __wid="h6dL2SMH"><b __wid="CU5kH7yv">Note</b>: The styling needs to be added manually if needed.</div><h3 __wid="SWzy6L3L">Default Tools</h3><div __wid="HrtZNXnQ">The default tools, which come with this section, are the following:</div><div __wid="TSjcqRHP"><ul __wid="BAkRVDmP"><li __wid="gJv4ZZqQ"><code __wid="ZdH5jrND">.section-tools</code>: Activated, when there is a <code __wid="NETCCipi">Codestrate.focussedSection</code>.</li><li __wid="QndzaxiS"><code __wid="YMg3fUA4">.paragraph-tools</code>: Activated, when there is a<code __wid="FnvUbAYT">Codestrate.focussedParagraph</code>.</li><li __wid="mnKhyup6"><code __wid="EdFLnNLS">.body-tools</code>: Activated, when the <code __wid="CqFZZ29s">Codestrate.focussedParagraph</code> is a body paragraph.</li><li __wid="HGUYBVnr"><code __wid="UjGAv4Mq">.style-tools</code>: Activated, when the <code __wid="bhWpyuVa">Codestrate.focussedParagraph</code> is a style paragraph.</li><li __wid="m2z5Wc7V"><code __wid="2ukbbnv7">.code-tools</code>: Activated, when the <code __wid="XvJVdFiS">Codestrate.focussedParagraph</code> is a code paragraph.</li><li __wid="dzSeRwkv"><code __wid="ajHZPPTW">.data-tools</code>: Activated, when the <code __wid="hchVMUkf">Codestrate.focussedParagraph</code> is a data paragraph.</li><li __wid="hPd7iqF3"><code __wid="s8afF5YN">.content-tools</code>: Activated, when the content of the snackbar is visible. The content tools override other tools. So while the content is open, only content-tools are visible.</li></ul><h3 __wid="qXK5XQcg">Adding Tools</h3></div><div __wid="mYTPfVBK">Tools can be added using the <code __wid="nFbifSX7">addTools()</code> function of the <code __wid="gySZrRhY">#snackbar-tools</code> paragraph. The functions takes two parameters:</div><div __wid="aHCB2VLR"><ul __wid="ZekdWnxX"><li __wid="wHibfRQE"><code __wid="L9LLSR7g">checkToolsAction</code>: A callback function, which is called every time the Snackbar Tools update the tools (so when clicking on elements). The function is called with the <code __wid="pjANrNvH">event.target</code> as a parameter and needs to return either <code __wid="Tj3YYkA4">true</code> if the tools should be activated or <code __wid="uHbr87TG">false</code> if the tools should be deactivated.</li><li __wid="fdf2vmG8"><code __wid="DujUmEYs">toolsAttribute</code>: The attribute name the tools.</li></ul></div><h3 __wid="zNkrFRyg">Usage</h3><div __wid="cy7hQkNs">Functions to enable/disable the Snackbar Tools or to add new tools can be found in the <code __wid="Ly7Mbtm4">#snackbar-tools</code> paragraph.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="A6UVbUGd" style __wid="4qzJ5wzA"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="X6FmmcxB">{
	"version": "1.0.3",
	"description": "Snackbar at the bottom of the screen to show contextual actions.",
	"changelog":
	{
		"1.0.3": "Adjusted position for notification bar.",
		"1.0.2": "Adjusted height to new structure.",
		"1.0.1": "Added documentation, comments and examples.",
		"1.0": "Initial Release"
	}
}</pre></div><div class="paragraph body-paragraph collapsed locked" data-id="isazPvip" name="Snackbar Template" style __wid="NXb6PMyp"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" __wid="CkqGvJC9"><template id="snackbar-template" __wid="hNFdBRsN">
	<transient id="snackbar" __wid="2WT9Cwkm">
		<div class="snackbar-fade" __wid="efVhpsPb"></div>
		<div class="snackbar" __wid="2Hx7T4xh">
			<div class="snackbar-row" __wid="Pv9uGm9C">
				<div class="snackbar-container snackbar-left" __wid="hwhYzDdz">
					<span class="snackbar-title content-tools content-title" __wid="yp5ZKskq"></span>
				</div>
				<div class="snackbar-container snackbar-center" __wid="uXgvvqPi"></div>
				<div class="snackbar-container snackbar-right" __wid="r82He8U3">
					<span title="Expand Content" class="snackbar-button content-tools content-expand" __wid="NHpJxfLa">
						<i class="material-icons" __wid="KwGKibBb"></i>
					</span>
					<span title="Close Content" class="snackbar-button content-tools content-close" __wid="QbavLnrM">
						<i class="material-icons" __wid="rnYHH3sD"></i>
					</span>
				</div>
			</div>
			<div class="snackbar-content" __wid="KRFc9pFh"></div>
		</div>
	</transient>
</template></div></div><div class="paragraph code-paragraph collapsed" data-id="TSpdaCip" name="Add Snackbar" style __wid="h8MTXuP8" last-execution-state="success" run-on-load="true"><pre data-type="content" type="text/javascript" __wid="5tfSAFMC">const snackbarTemplate = document.querySelector("#snackbar-template");
const snackbarFragment = document.importNode(snackbarTemplate.content, true);
document.body.appendChild(snackbarFragment);

/******************************************************************************/

const SnackbarUtils = require("#snackbar-utils");
SnackbarUtils.initContentControls();</pre></div><div class="paragraph code-paragraph collapsed" data-id="uG6BBKVh" name="Snackbar Utils" draggable="false" style __wid="EVBag2wz"><pre data-type="content" type="text/javascript" __wid="4f23Emnc" id="snackbar-utils">const snackbar = document.querySelector("#snackbar");

const snackbarRow = snackbar.querySelector(".snackbar-row");
const snackbarLeft = snackbarRow.querySelector(".snackbar-left");
const snackbarCenter = snackbarRow.querySelector(".snackbar-center");
const snackbarRight = snackbarRow.querySelector(".snackbar-right");

const snackbarContent = snackbar.querySelector(".snackbar-content");
const snackbarContentTitle = snackbarRow.querySelector(".content-title");
const snackbarContentExpand = snackbarRow.querySelector(".content-expand");
const snackbarContentClose = snackbarRow.querySelector(".content-close");

/******************************************************************************/

/**
 * Creates the "Expand Content" and "Close Content" buttons in the snackbar.
 */
exports.initContentControls = () => {
	snackbarContentExpand.addEventListener("click", (event) => {
		exports.toggleContentExpanded();
	});

	snackbarContentClose.addEventListener("click", (event) => {
		exports.closeContent();
	});
};

/******************************************************************************/

/**
 * Functions for opening and closing of the snackbar. They "cascade", so for
 * example closing the "row" will also close the "content" or closing the
 * "content" will also close the "expanded content".
 */

exports.openRow = () => {
	snackbar.classList.add("row-open");
};

exports.closeRow = () => {
	exports.closeContent();
	snackbar.classList.remove("row-open");
};

exports.toggleRow = () => {
	if (snackbar.classList.contains("row-open")) {
		exports.closeRow();
	} else {
		exports.openRow();
	}
};


exports.openContent = () => {
	exports.openRow();
	snackbar.classList.add("content-open");
};

exports.closeContent = () => {
	exports.removeContent();
	exports.closeContentExpanded();
	snackbar.classList.remove("content-open");
};

exports.toggleContent = () => {
	if (snackbar.classList.contains("content-open")) {
		exports.closeContent();
	} else {
		exports.openContent();
	}
};


exports.openContentExpanded = () => {
	exports.openContent();
	snackbar.classList.add("content-expanded-open");
};

exports.closeContentExpanded = () => {
	snackbar.classList.remove("content-expanded-open");
};

exports.toggleContentExpanded = () => {
	if (snackbar.classList.contains("content-expanded-open")) {
		exports.closeContentExpanded();
	} else {
		exports.openContentExpanded();
	}
};

/******************************************************************************/

/**
 * Adds a &lt;hr> divider to the snackbar.
 *
 * @param container  Snackbar container to add the divider to
 *                   (-1: left, 0: center, 1: right (default)).
 * @param classNames Additional CSS classes for the divider.
 */
exports.addDivider = (container, classNames = false) => {
	const divider = document.createElement("hr");
	if (classNames) divider.setAttribute("class", classNames);
	exports.addSnackbarItem(divider, container);
};

/**
 * Adds an HTML element to a snackbar container.
 *
 * @param snackbarItem The HTML element to add to the snackbar.
 * @param container    Snackbar container to add the item to
 *                     (-1: left, 0: center, 1: right (default)).
 */
exports.addSnackbarItem = (snackbarItem, container = 1) => {
	if (container === -1) {
		snackbarLeft.appendChild(snackbarItem);
	} else if (container === 0) {
		snackbarCenter.appendChild(snackbarItem);
	} else {
		snackbarRight.appendChild(snackbarItem);
	}
};

/**
 * Sets the content and optionally the title of the snackbar and opens the
 * content.
 * Note: Removes previous content before setting the new one.
 *
 * @param element The HTML element which the content should be set to.
 * @param title   The title of the content.
 */
exports.setContent = (element, title = false) => {
	exports.removeContent();
	snackbarContent.appendChild(element);
	snackbarContentTitle.innerText = title ? title : "";
	exports.openContent();
};

/**
 * Returns the current content of the snackbar. Don't use this method to move
 * content out of the snackbar, use "removeContent()" instead.
 *
 * @return The current content element.
 */
exports.getContent = () => {
	return snackbarContent.firstChild;
};


/**
 * Removes the content out of the snackbar, fires the "SnackbarRemoveContent"
 * event and closes the snackbar content.
 *
 * @return The removed content element.
 */
exports.removeContent = () => {
	const content = exports.getContent();

	if (content) {
		var evt = document.createEvent("CustomEvent");
		evt.initCustomEvent("SnackbarRemoveContent", true, true, content);
		window.dispatchEvent(evt);

		while (snackbarContent.firstChild) {
			snackbarContent.removeChild(snackbarContent.firstChild);
		}

		exports.closeContent();
	}

	return content;
};

/******************************************************************************/

/**
 * Creates and adds a button to the snackbar.
 *
 * @param title      The title-attribute of the button.
 * @param icon       The icon of the button (use Material Icons string).
 * @param classNames Additional CSS classes for the button.
 * @param container  Snackbar container to add the button to
 *                   (-1: left, 0: center, 1: right (default)).
 * @param action     The function to perform on clicks.
 */
exports.addButton = (title, icon, classNames, container, action) => {
	const button = exports.createButton(title, icon, classNames, action);
	exports.addSnackbarItem(button, container);
};

/**
 * Creates and adds a title to the snackbar.
 *
 * @param title      The title-attribute of the title.
 * @param classNames Additional CSS classes for the title.
 * @param content    The text of the title.
 * @param container  Snackbar container to add the title to
                     (-1: left, 0: center, 1: right (default)).
 */
exports.addTitle = (title, classNames, content, container) => {
	const titleElement = exports.createTitle(title, classNames, content);
	exports.addSnackbarItem(titleElement, container);
};

/**
 * Creates and adds a input for the snackbar.
 *
 * @param title       The title-attribute of the input.
 * @param classNames  Additional CSS classes for the input.
 * @param content     The text of the input.
 * @param container   Snackbar container to add the input to
 *                    (-1: left, 0: center, 1: right (default)).
 * @param inputAction Function for the "input" eventlistener of the input.
 */
exports.addInput = (title, classNames, content, container, inputAction) => {
	const input = exports.createInput(title, classNames, content, inputAction);
	exports.addSnackbarItem(input, container);
};

/******************************************************************************/

/**
 * Creates a button for the snackbar and returns it.
 *
 * @param title      The title-attribute of the button.
 * @param icon       The icon of the button (use Material Icons string).
 * @param classNames Additional CSS classes for the button.
 * @param action     The function to perform on clicks.
 *
 * @return The created button.
 */
exports.createButton = (title, icon = "", classNames = false, action = false) => {
	const button = document.createElement("span");
	button.setAttribute("title", title);

	const i = document.createElement("i");
	i.classList.add("material-icons");
	i.innerHTML = icon;

	button.appendChild(i);

	if (classNames) {
		button.setAttribute("class", classNames);
	}
	button.classList.add("snackbar-button");

	if (typeof action === "function") {
		button.addEventListener("click", action);
	}

	return button;
};

/**
 * Creates a title for the snackbar and returns it.
 *
 * @param title      The title-attribute of the title.
 * @param classNames Additional CSS classes for the title.
 * @param content    The text of the title.
 *
 * @return The created title.
 */
exports.createTitle = (title, classNames = false, content = false) => {
	const titleElement = document.createElement("span");
	titleElement.setAttribute("title", title);

	if (classNames) {
		titleElement.setAttribute("class", classNames);
	}
	titleElement.classList.add("snackbar-title");

	if (content) {
		titleElement.innerText = content;
	}

	return titleElement;
};

/**
 * Creates a input for the snackbar and returns it.
 *
 * @param title       The title-attribute of the input.
 * @param classNames  Additional CSS classes for the input.
 * @param content     The text of the input.
 * @param inputAction Function for the "input" eventlistener of the input.
 *
 * @return The created input.
 */
exports.createInput = (title, classNames = false, content = false, inputAction = false) => {
	const inputElement = exports.createTitle(title, classNames, content);
	inputElement.classList.add("snackbar-input");
	inputElement.setAttribute("contenteditable", "true");
	inputElement.addEventListener("keypress", event => {
		if (event.which === 13) {
			event.preventDefault();
		}
	});

	if (typeof inputAction === "function") {
		inputElement.addEventListener("input", () => inputAction(inputElement));
	}

	return inputElement;
};</pre></div><div class="paragraph style-paragraph collapsed" data-id="D7BPWi9D" name="Snackbar Style" style __wid="bpNbAMgU"><style data-type="content" type="text/css" __wid="MDTeB86z" codemirror="true" contenteditable="true" class="themable">html #snackbar .snackbar {
	background: var(--color-primary);
	color: var(--color-primary-text);
	display: block;
	position: fixed;
	bottom: 0;
	left: 50%;
	width: 64rem;
	max-width: 100vw;
	margin-right: 16px;
	z-index: 50;
	box-shadow: none;
	opacity: 0;
	transform: translate(-50%, 100%);
	overflow-x: scroll;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	transition: transform var(--navigation-transition),
							box-shadow var(--navigation-transition),
							width var(--navigation-transition),
							opacity var(--navigation-transition),
							left var(--navigation-transition);
}

html #snackbar .snackbar::-webkit-scrollbar {
	display: none;
}

@keyframes fadeAnimation {
	from {
		opacity: 0;
	}
}

html #snackbar .snackbar-fade {
	position: fixed;
	left: 0;
	top: 0;
	width: 100vw;
	height: 100vh;
	background: var(--color-primary-text);
	opacity: 0.25;
	pointer-events: none;
	z-index: 249;
	animation: fadeAnimation var(--navigation-transition);
	display: none;
}

html #snackbar.content-expanded-open .snackbar-fade {
	display: block;
}

/******************************************************************************/

html #snackbar.row-open .snackbar {
	box-shadow: var(--material-shadow-z6);
	transform: translate(-50%, 0);
	opacity: 1;
}

html #snackbar.content-open .snackbar-content {
	height: calc(25vh - 48px);
}

html #snackbar.content-expanded-open .snackbar-content {
	height: calc(100vh - 48px);
}

html #snackbar.content-expanded-open .snackbar {
	z-index: 250;
}

html body[transient-menu-pinned="true"] #snackbar .snackbar {
	left: calc(50% + 144px);
	max-width: calc(100vw - 288px);
}

html body[transient-notification-pinned="true"] #snackbar .snackbar {
	left: calc(50% - 192px);
	max-width: calc(100vw - 384px);
}

html body[transient-menu-pinned="true"][transient-notification-pinned="true"] #snackbar .snackbar {
	left: calc(50% - 48px);
	max-width: calc(100vw - 672px);
}

/******************************************************************************/

html #snackbar .snackbar-row {
	display: flex;
	justify-content: space-between;
	position: relative;
	align-items: center;
	width: 100%;
	height: 48px;
	padding: 8px;
}

html #snackbar .snackbar-container {
	display: flex;
	box-sizing: border-box;
	height: 32px;
	vertical-align: middle;
	z-index: 1;
}

html #snackbar .snackbar-left {
	flex: 1 0 auto;
	justify-content: flex-start;
	order: -1;
	padding-right: 24px;
}

html #snackbar .snackbar-center {
	flex: 1 1 100%;
	justify-content: center;
	order: 0;
}

html #snackbar .snackbar-right {
	flex: 0 0 auto;
	justify-content: flex-end;
	order: 1;
	padding-left: 24px;
}

/******************************************************************************/

html #snackbar .snackbar-content {
	display: block;
	position: relative;
	background: var(--color-primary-shade-1);
	color: var(--color-primary-text);
	height: 0;
	overflow-y: auto;
	width: 100%;
	padding: 0 24px;
	transition: height var(--navigation-transition),
							padding var(--navigation-transition);
}

html #snackbar.content-open .snackbar-content {
	padding: 16px;
}

html #snackbar .content-title {
	order: -999;
}

html #snackbar .content-expand {
	order: 998;
}

html #snackbar .content-close {
	order: 999;
}

html #snackbar .content-expand i:after {
	content: "fullscreen";
}

html #snackbar.content-expanded-open .content-expand i:after {
	content: "fullscreen_exit";
}

html #snackbar .content-close i:after {
	content: "close";
}

/******************************************************************************/

html #snackbar .snackbar-button {
	display: flex;
	padding: 4px;
	width: 32px;
	height: 32px;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	border-radius: 50%;
	margin: 0 4px;
	user-select: none;
}

html #snackbar .snackbar-title {
	font-size: 1.25rem;
	font-weight: 500;
	letter-spacing: 0.02rem;
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
	align-self: center;
	padding: 0 8px;
}

html #snackbar .snackbar-title+.snackbar-title {
	padding-left: 0;
}

html #snackbar .snackbar-input {
	cursor: text;
	outline: none;
}

html #snackbar .snackbar-input:empty:before {
	content: "Empty";
	opacity: 0.5;
}

/******************************************************************************/

html #snackbar hr {
	border: none;
	border-left: 1px solid var(--color-primary-text);
	margin: 4px;
	opacity: 0.8;
}</style></div><div class="paragraph code-paragraph collapsed" data-id="gArzG7N6" name="Snackbar Tools" draggable="false" style __wid="BTM7JvKd" last-execution-state="success" run-on-load="true"><pre data-type="content" type="text/javascript" id="snackbar-tools" __wid="EW9kiQwV">const SnackbarUtils = require("#snackbar-utils");

/******************************************************************************/

const snackbar = document.querySelector("#snackbar");

let enabled = true;
let previousEvent = false;
let additionalTools = [];

exports.currentParagraph = false;
exports.currentSection = false;

/******************************************************************************/

/**
 * Enables the snackbar tools.
 */
exports.enable = () => {
	enabled = true;
};

/**
 * Disables the snackbar tools.
 */
exports.disable = () => {
	enabled = false;
	SnackbarUtils.closeRow();
};

/**
 * Toggles the snackbar tools.
 */
exports.toggle = () => {
	if (enabled) {
		exports.disable();
	} else {
		exports.enable();
	}
};

/******************************************************************************/

/**
 * Adds additional tools to the snackbar.
 *
 * @param checkToolsAction Function, which takes one argument (target) and
 *                         returns true if tools should be active and false if
 *                         not.
 * @param toolsAttribute   The name of the attribute for the new tools. Needs to
 *                         contain "tools" in it.
 *
 * @return True if tools were added successfully, else false.
 */
exports.addTools = (checkToolsAction, toolsAttribute) => {
	if (typeof checkToolsAction === "function" &&
			typeof toolsAttribute === "string" &&
			toolsAttribute.indexOf("tools") !== -1) {
		additionalTools.push({
			checkToolsAction: checkToolsAction,
			toolsAttribute: toolsAttribute
		});
		return true;
	} else {
		return false;
	}
};

/******************************************************************************/

// Update tools on every click
window.addEventListener("click", (event) => {

	// Only proceed if there is a target and the tools are enabled
	if (!enabled || !event.target || !event.target.closest) {
		return;
	}

	// Don't update tools upon clicking on UI
	if (event.target.closest("#global-toolbar") ||
		  event.target.closest("#global-menu") ||
		  event.target.closest("#snackbar")) {
		if (previousEvent) {
			event = previousEvent;
		}
	}

	previousEvent = event;

	// Update basic snackbar attributes for paragraphs
	if (Codestrate.focussedParagraph) {
		snackbar.setAttribute("paragraph-tools", "true");
		if (Codestrate.focussedParagraph.classList.contains("body-paragraph") &&
				!Codestrate.focussedParagraph.classList.contains("locked")) {
			snackbar.setAttribute("body-tools", "true");
		} else {
			snackbar.removeAttribute("body-tools");
		}
		if (Codestrate.focussedParagraph.classList.contains("style-paragraph")) {
			snackbar.setAttribute("style-tools", "true");
		} else {
			snackbar.removeAttribute("style-tools");
		}
		if (Codestrate.focussedParagraph.classList.contains("code-paragraph")) {
			snackbar.setAttribute("code-tools", "true");
		} else {
			snackbar.removeAttribute("code-tools");
		}
		if (Codestrate.focussedParagraph.classList.contains("data-paragraph")) {
			snackbar.setAttribute("data-tools", "true");
		} else {
			snackbar.removeAttribute("data-tools");
		}
	} else {
		snackbar.removeAttribute("body-tools");
		snackbar.removeAttribute("style-tools");
		snackbar.removeAttribute("code-tools");
		snackbar.removeAttribute("data-tools");
		snackbar.removeAttribute("paragraph-tools");
	}

	// Update basic snackbar attribute for sections
	if (Codestrate.focussedSection) {
		snackbar.setAttribute("section-tools", "true");
	} else {
		snackbar.removeAttribute("section-tools");
	}

	// Update basic snackbar attribute for content
	if (snackbar.classList.contains("content-open")) {
		snackbar.setAttribute("content-tools", "true");
	} else {
		snackbar.removeAttribute("content-tools");
	}

	// Add additional snackbar attributes
	additionalTools.forEach(additionalTool => {
		if (additionalTool.checkToolsAction(event.target)) {
			snackbar.setAttribute(additionalTool.toolsAttribute, "true");
		} else {
			snackbar.removeAttribute(additionalTool.toolsAttribute);
		}
	});

	// Open and close snackbar depending on if there are active tools
	let open = false;
	const openTools = Array.from(snackbar.attributes).filter(att => att.name.indexOf("tools") !== -1).map(att => att.name);
	if (openTools.length > 0) {
		openTools.forEach(tool => {
			if (!open && snackbar.querySelector(`.snackbar-row .${tool}`)) {
				open = true;
			}
		});
	}

	if (open) {
		SnackbarUtils.openRow();
	} else {
		SnackbarUtils.closeRow();
	}
}, false);</pre></div><div class="paragraph style-paragraph collapsed" style draggable="false" name="Snackbar Tools Style" data-id="Nj3GC2by" __wid="UXxkMfYV"><style data-type="content" type="text/css" __wid="QtFgvGNF" codemirror="true" class="themable">html #snackbar:not([section-tools="true"]) .section-tools {
	display: none;
}

html #snackbar:not([paragraph-tools="true"]) .paragraph-tools {
	display: none;
}

html #snackbar:not([body-tools="true"]) .body-tools {
	display: none;
}

html #snackbar:not([style-tools="true"]) .style-tools {
	display: none;
}

html #snackbar:not([code-tools="true"]) .code-tools {
	display: none;
}

html #snackbar:not([data-tools="true"]) .data-tools {
	display: none;
}

/******************************************************************************/

html #snackbar:not([content-tools="true"]) .content-tools {
	display: none;
}

html #snackbar .snackbar-title.content-tools+.snackbar-title {
	padding-left: 8px;
}

html #snackbar[content-tools="true"] .snackbar-button:not(.content-tools),
html #snackbar[content-tools="true"] .snackbar-title:not(.content-tools),
html #snackbar[content-tools="true"] hr:not(.content-tools) {
	display: none;
}

html .paragraph-header {
	transition: border-left var(--navigation-transition);
}

html .paragraph[transient-content-paragraph] .paragraph-header {
	border-left: 4px solid var(--color-accent);
	border-radius: 4px 2px 2px 4px;
}</style></div><div class="paragraph code-paragraph collapsed" name="Snackbar Tools HTML Editor" style data-id="7vfcpFtU" run-on-load="true" last-execution-state="success" __wid="JdwKuUSd"><pre data-type="content" type="text/javascript" __wid="hsUtmDCU">const SnackbarUtils = require("#snackbar-utils");
const SnackbarTools = require("#snackbar-tools");

/******************************************************************************/

const toolsName = "html-editor-tools";
const snackbar = document.querySelector("#snackbar");
let currentParagraph = false;

/******************************************************************************/

const editorToSnackbar = (editor) => {

	// Make editor visible
	editor.classList.remove("hidden");

	// Get title of the content
	const name = Codestrate.focussedParagraph.getAttribute("name") ? Codestrate.focussedParagraph.getAttribute("name") : "Unnamed Paragraph";

	SnackbarUtils.setContent(editor, name + " HTML");

	// Store related paragraph and set attribute
	currentParagraph = Codestrate.focussedParagraph;
	currentParagraph.setAttribute("transient-content-paragraph", "true");

	// Update and enable editor
	const htmlEditor = currentParagraph.querySelector("[data-type='content']").__editor;
	htmlEditor.enableMutationObserver();
	htmlEditor.updateEditor();

	// Activate editor tools ("Save HTML" button)
	snackbar.setAttribute(toolsName, "true");
};

const editorToParagraph = (editor) => {
	editor.classList.add("hidden");
	currentParagraph.appendChild(editor);
	const htmlEditor = currentParagraph.querySelector("[data-type='content']").__editor;
	htmlEditor.disableMutationObserver();
	currentParagraph.removeAttribute("transient-content-paragraph");
	currentParagraph = false;
	SnackbarUtils.closeContent();
	snackbar.removeAttribute(toolsName);
};

/******************************************************************************/

SnackbarUtils.addButton("Show HTML Editor", "", "body-tools html-editor-button", 1, () => {

	// Check if there is a HTML in the content
	const content = SnackbarUtils.getContent();
	if (content && content.classList.contains("html-editor")) {
		editorToParagraph(content);
	} else {
		const editor = Codestrate.focussedParagraph.querySelector(".html-editor");
		editorToSnackbar(editor);
	}
});

// Listen to the "SnackbarRemoveContent" event in case the snackbar content gets
// closed from somewhere else
window.addEventListener("SnackbarRemoveContent", (event) => {
	if (currentParagraph && event.detail && event.detail.classList.contains("html-editor")) {
		editorToParagraph(event.detail);
	}
});

SnackbarUtils.addButton("Save HTML", "", toolsName + " html-save-button", 1, () => {
	const editor = currentParagraph.querySelector("[data-type='content']").__editor;
	editor.saveHtml();
});</pre></div><div class="paragraph style-paragraph collapsed" data-id="CYYui4Xj" name="Snackbar Tools HTML Editor Style" __wid="ZN4Tjctw"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="4X5MCVh2">html #snackbar:not([html-editor-tools="true"]) .html-editor-tools {
	display: none;
}

html #snackbar[html-editor-tools="true"][content-tools="true"] .html-editor-tools {
	display: flex;
}

html #snackbar .snackbar-content .html-editor .CodeMirror,
html #snackbar .snackbar-content .html-editor .CodeMirror-gutters  {
	background: none;
}

/******************************************************************************/

html #snackbar .html-editor-button i:after {
	content: var(--xml);
	font-family: "Material Design Icons";
}

html #snackbar .html-save-button i:after {
	content: "save";
}</style></div><div class="paragraph code-paragraph collapsed" data-id="P7Cm8syW" draggable="false" style name="Snackbar Tools Code Execution" __wid="aNam5vvV" last-execution-state="success" run-on-load="true"><pre data-type="content" type="text/javascript" __wid="fuUu5T6N">const SnackbarUtils = require("#snackbar-utils");
const SnackbarTools = require("#snackbar-tools");

/******************************************************************************/

const runOnLoadAttributeName = "run-on-load";
let currentParagraph = false;

/******************************************************************************/

const consoleToSnackbar = (console) => {
	const name = Codestrate.focussedParagraph.getAttribute("name") ? Codestrate.focussedParagraph.getAttribute("name") : "Unnamed Paragraph";
	SnackbarUtils.setContent(console, name + " Console");
	currentParagraph = Codestrate.focussedParagraph;
	currentParagraph.setAttribute("transient-content-paragraph", "true");
	currentParagraph.console.open();
};

const consoleToParagraph = (console) => {
	currentParagraph.appendChild(console);
	currentParagraph.console.close();
	currentParagraph.removeAttribute("transient-content-paragraph");
	currentParagraph = false;
	SnackbarUtils.closeContent();
};

/******************************************************************************/

SnackbarUtils.addButton("Execute Code", "play_circle_outline", "code-tools", 1, () => {
	Codestrate.runCode(Codestrate.focussedParagraph);
});

SnackbarUtils.addButton("Toggle Console", "message", "code-tools", 1, () => {
	const content = SnackbarUtils.getContent();
	if (content && content.classList.contains("console")) {
		consoleToParagraph(content);
	} else {
		const console = Codestrate.focussedParagraph.querySelector(".console");
		consoleToSnackbar(console);
	}
});

window.addEventListener("SnackbarRemoveContent", (event) => {
	if (currentParagraph && event.detail && event.detail.classList.contains("console")) {
		consoleToParagraph(event.detail);
	}
});

SnackbarUtils.addButton("Run on load", "directions_run", "code-tools", 1, () => {
	if (Codestrate.focussedParagraph.hasAttribute(runOnLoadAttributeName)) {
		Codestrate.focussedParagraph.removeAttribute(runOnLoadAttributeName);
	} else {
		Codestrate.focussedParagraph.setAttribute(runOnLoadAttributeName, "true");
	}
});</pre></div><div class="paragraph style-paragraph collapsed" name="Snackbar Tools Code Execution Style" data-id="SfU3DezA" __wid="LS2LQwza"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="i5jghJyj">html #snackbar .snackbar-content .console {
	height: 100%;
	margin: 0;
}</style></div><div class="paragraph code-paragraph collapsed" data-id="VB7G4SeT" name="Snackbar Examples" last-execution-state="success" __wid="cHber965"><pre data-type="content" type="text/javascript" __wid="NVVhBY6B" class="snackbar-examples">const SnackbarUtils = require("#snackbar-utils");
const SnackbarTools = require("#snackbar-tools");

/******************************************************************************/

// Set a name for the tools of this example
const toolsName = "snackbar-example-tools";

/******************************************************************************/

// Add a new tools category, which is only visible in this paragraph
SnackbarTools.addTools((target) => {

	// Check if the user clicked on paragraph
	let paragraph = target.closest(".paragraph");
	if (!paragraph) return false;

	// Instead of using the "target" parameter it would have also been possible to
	// use the "Codestrate.focussedParagraph" variable, to get the currently
	// selected paragraph.
	paragraph = Codestrate.focussedParagraph;

	// Check if the paragraph has a content with the example class
	const content = paragraph.querySelector(".snackbar-examples[data-type='content']");
	if (!content) return false;

	// Return true and activate tools
	return true;
}, toolsName);

// Add a button to the left container of the snackbar, which class is the
// example tools class
SnackbarUtils.addButton("Example Button", "info", toolsName, -1, () => {
	console.log("Something from the button.");
});

/******************************************************************************/

// Add a title to the center conainer of the snackbar, which is always visible,
// when the snackbar is open
SnackbarUtils.addTitle("Example Title", "", "My Title", 0);

// Add another button, which toggles the background of a selected paragraph
// using the "Codestrate.focussedParagraph"
// Set the className "paragraph-tools" to make the button active on paragraphs
SnackbarUtils.addButton("Example Background Button", "brush", "paragraph-tools", -1, () => {
	const attributeName = "transient-snackbar-example";

	const paragraph = Codestrate.focussedParagraph;
	if (paragraph.getAttribute(attributeName)) {
		paragraph.removeAttribute(attributeName);
	} else {
		paragraph.setAttribute(attributeName, "true");
	}
});

/******************************************************************************/

// See the "Snackbar Tools HTML Editor" and "Snackbar Tools Code Execution"
// paragraphs for more examples on how to set content and make use of the
// "SnackbarRemoveContent" event.</pre></div><div class="paragraph style-paragraph collapsed" data-id="LqkSYjsg" name="Snackbar Examples Style" __wid="9b9diCbA"><style data-type="content" type="text/css" codemirror="true" class="snackbar-examples" __wid="c4csWcjN">/* Hide the tools when they are not activated */
html #snackbar:not([snackbar-example-tools="true"]) .snackbar-example-tools {
	display: none;
}

/* Change background of toggled paragraph */
html .paragraph[transient-snackbar-example="true"] {
	background: hotpink;
}</style></div></div><div class="section section-hidden" data-id="inDkJBan" name="Notifications" data-type="system" style draggable="false" __wid="g8gacji7"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="ELZH5zAm" style draggable="false" __wid="9AVVBPC6"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="JR8ex2fR"><h2 __wid="WzyFgcbY">Description</h2><div __wid="8Lgyne7R">The Notifications API of Codestrates allows to send notifications to other users using the Webstrates <a href="https://webstrates.github.io/userguide/api/messaging.html" target="_blank" __wid="QSpaP3j7">Messaging API</a>.</div><h3 __wid="agyew4AD">Notifications</h3><div class="warning" __wid="2U62cUje"><b __wid="X5HAMRAQ">Hint</b>: A user needs to be logged in to use notifications!</div><div __wid="pHdt5fSM">To send a new Notification use the <code __wid="BHr9juS7">Codestrate.notification(notification, recipients)</code> function. Properties of the notification are listed below. Examples can be found in the paragraph below.</div><div __wid="YMjMPvPd"><ul __wid="K64De8wa"><li __wid="Qcu8NUDm"><code __wid="wjeeSHWR">className</code>: A CSS class, which is being attached to the HTML element of the notification.</li><li __wid="mpvucFmf"><code __wid="v6dsfrZU">color</code>: The color theme of the notification. Any CSS color.</li><li __wid="c6U2DPQD"><code __wid="tgWReqBC">header</code></li><ul __wid="SR4gkwey"><li __wid="Ev8sLzPD"><code __wid="yzQCJbpQ">icon</code>: An icon-string from the <a href="https://material.io/icons/" target="_blank" __wid="6J3BHuAn">Material Icons</a>.</li><li __wid="DiPnkAL9"><code __wid="iMAEeChU">appName</code>: An app or package name of the notification.</li><li __wid="yYd4GTMU"><code __wid="Z7FJYVyD">text</code>: Some short header text of the notification (see <a href="https://material.io/guidelines/patterns/notifications.html#notifications-anatomy-of-a-notification" target="_blank" __wid="qNvLwqnD">here</a>).</li><li __wid="z7tackmg"><code __wid="Fdv5dDsA">timestamp</code>: A timestamp of the notification (needs to be a <code __wid="tz5U2MiT">Date()</code>).</li></ul><li __wid="5ThpFafN"><code __wid="F22vWJBP">content</code></li><ul __wid="gVibukzr"><li __wid="9JnuhY23"><code __wid="R2NpWhef">title</code>: The title of the notification.</li><li __wid="7AsrJwmB"><code __wid="miXdPXgb">text</code>: The body text of the notification.</li><li __wid="LP3NPb8v"><code __wid="BKpxm8y8">imagePath</code>: A URL to an image.</li></ul><li __wid="nzpyzCwf"><code __wid="z6ebQY3q">actions</code>: A list of actions.</li><ul __wid="AsVTSmuh"><li __wid="GyDwc9Y3"><code __wid="nQBTyA3A">name</code>: The name of the action.</li><li __wid="PRkHfACa"><code __wid="c2d5nXi4">className</code>: A CSS class being attached to the action.</li><li __wid="3bk9ya4U"><code __wid="QQy3M5Yt">action</code>: A serialized callback function (use <code __wid="ZwThDLN9">.toString()</code> like in the example).</li></ul></ul></div><h3 __wid="57BBGJit">Local Notifications</h3><div __wid="qWiJ4deC">To send a new notification to the user of the current codestrate use the <code __wid="LWze67bH">Codestrate.localNotification(notification)</code> function. It takes the same properties as above. The local notification also works, when the user is not logged in. If an user is not logged in the notifications are stored within the <code __wid="beJEKjrz">localStorage</code> element.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="C8QYN26E" style __wid="wUHWVXfr"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="jCrZXJCX">{
	"version": "1.1",
	"description": "Allows to show notifications to users and store them in the webstrate messages.",
	"changelog":
	{
    "1.1": "Added basic support for notifications without authentification.",
		"1.0": "Initial version."
	}
}</pre></div><div class="paragraph body-paragraph locked collapsed" data-id="yVimDLMj" name="Notification Bar Template" __wid="654r6dpT"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" __wid="NPMWFwSd"><template id="notification-bar-template" __wid="Rtb2PSYf">
	<transient id="notification-bar" __wid="z5k8Bw2z">
		<!--<span class="handle material-icons"></span>-->
		<div class="notification-clear-all" __wid="8rD4wVGe">
			<div __wid="fu3Yqie2">Clear All</div>
			<i class="material-icons" __wid="DHr5x4KS">clear_all</i>
		</div>
		<div class="notification-container" __wid="Ytwa8vzi"></div>
	</transient>
</template></div></div><div class="paragraph body-paragraph locked collapsed" data-id="wfHASYAb" name="Notification Template" __wid="g5SVirZ7"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" id="notification-template" __wid="EhxY5bki"><div class="notification ${className}" message-id="${messageId}" style="${color}" __wid="xFDq7E6Z">
	<div class="header" __wid="imBmhqTT">
		<div class="header-icon" __wid="qMLNThAf">
			<i class="material-icons" __wid="aK9qdH33">${headerIcon}</i>
		</div>
		<div class="header-app-name" __wid="jmq3HuBz">${headerAppName}</div>
		<div class="header-text" __wid="Mt3zynET">${headerText}</div>
		<div class="header-timestamp" title="${headerTimestamp}" __wid="et6YJrv5">${headerRelativeTimestamp}</div>
		<div class="header-expand-content" __wid="2TW2nvXe">
			<i class="material-icons" __wid="8kwmFqfG"></i>
		</div>
		<div class="header-delete" __wid="wQxUPULH">
			<i class="material-icons" __wid="9dsNyG5V">delete</i>
		</div>
	</div>
	<div class="content" __wid="bqBqVWUr">
		<div class="content-title" __wid="AzwaPrKq">${contentTitle}</div>
		<div class="content-text" __wid="7kJFpHAk">${contentText}</div>
		<div class="content-image" style="${contentImage}" __wid="wKqhFvkb"></div>
	</div>
	<div class="actions" __wid="kn7Ftep5">${actions}</div>
</div></div></div><div class="paragraph code-paragraph collapsed" data-id="tkMcuk6Q" draggable="false" style run-on-load="true" name="Add Notification Bar and Integration" last-execution-state="success" __wid="GEGAqERt"><pre data-type="content" type="text/javascript" __wid="UR8H3FVH">const notificationBarTemplate = document.querySelector("#notification-bar-template");
const notificationBarFragment = document.importNode(notificationBarTemplate.content, true);
document.body.appendChild(notificationBarFragment);

/******************************************************************************/

const NotificationUtils = require("#notification-utils");
const NotificationManager = require("#notification-manager");
const GlobalMenuUtils = require("#global-menu-utils");
const GlobalToolbarUtils = require("#global-toolbar-utils");

Codestrate.addCommand("codestrates.notifications.toggle", "Toggle Notifications", () => {
	NotificationUtils.toggle();
});

Codestrate.addKeyBinding("codestrates.notifications.toggle", "mod+,", true);

GlobalToolbarUtils.addDivider(1, "notifications-toolbar");
GlobalToolbarUtils.addButton("Notifications", "", "toolbar-button-notifications notifications-toolbar", 1, () => {
	Codestrate.executeCommand("codestrates.notifications.toggle");
});

/******************************************************************************/

Codestrate.addCommand("codestrates.notifications.clearAll", "Clear All Notifications", () => {
	NotificationUtils.clearAll();
});

document.querySelector("#notification-bar .notification-clear-all").addEventListener("click", () => {
	Codestrate.executeCommand("codestrates.notifications.clearAll");
});

/******************************************************************************/

/**
 * Sends a new notification to all recipients.
 */
Object.defineProperty(Codestrate, "notification", {
  value: (notification, recipients) => {
    if (!notification.header) notification.header = {};
    if (!notification.content) notification.content = {};
    if (webstrate.message) {
      NotificationManager.addNotification(notification, recipients);
    } else {
      console.warn("You need to be logged in to use notifications!");
    }
  }
});

/**
 * Sends a new notification to the current user. This also works for users,
 * who are not logged in.
 */
Object.defineProperty(Codestrate, "localNotification", {
  value: (notification) => {
    if (!notification.header) notification.header = {};
    if (!notification.content) notification.content = {};
    NotificationManager.addNotification(notification, false, Codestrate.util.randomString());
  }
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="cie399JW" name="Notifications Utils" style __wid="6TfxSByH"><pre data-type="content" type="text/javascript" id="notification-utils" contenteditable="true" __wid="35QXbQcp">const NotificationManager = require("#notification-manager");

const notificationBar = document.querySelector("#notification-bar");
const container = notificationBar.querySelector(".notification-container");

/******************************************************************************/

const localStorageKey = "notifications";

/******************************************************************************/

timeDifference = (current, previous) => {
	const msPerSecond = 1000;
	const msPerMinute = 60 * 1000;
	const msPerHour = msPerMinute * 60;
	const msPerDay = msPerHour * 24;
	const msPerMonth = msPerDay * 30;
	const msPerYear = msPerDay * 365;

	const elapsed = current - previous;

	if (elapsed &lt; msPerSecond * 5) {
		return "now";

	} else if (elapsed &lt; msPerMinute) {
		return Math.round(elapsed / 1000) + " s";

	} else if (elapsed &lt; msPerHour) {
		return Math.round(elapsed / msPerMinute) + " m";

	} else if (elapsed &lt; msPerDay ) {
		return Math.round(elapsed / msPerHour ) + " h";

	} else if (elapsed &lt; msPerMonth) {
		return Math.round(elapsed / msPerDay) + " d";

	} else if (elapsed &lt; msPerYear) {
		return Math.round(elapsed / msPerMonth) + " mo";

	} else {
		return Math.round(elapsed / msPerYear ) + " y";
	}
};

/******************************************************************************/

exports.clearAll = async() => {
  const result = await confirm("Do you really want to delete all notifications?", "Notifications");
  if (!result) return;

  NotificationManager.removeAllNotifications();
  exports.newNotificationNotAvailable();
};

/******************************************************************************/

exports.open = () => {
	exports.newNotificationNotAvailable();
	document.body.setAttribute("transient-notification-pinned", "true");
};

exports.close = () => {
	document.body.removeAttribute("transient-notification-pinned");
};

exports.toggle = () => {
	if (document.body.hasAttribute("transient-notification-pinned")) {
		exports.close();
	} else {
		exports.open();
	}
};

exports.newNotificationAvailable = () => {
	if (!document.body.hasAttribute("transient-notification-pinned")) {
		document.body.setAttribute("transient-new-notification", "true");
	}
};

exports.newNotificationNotAvailable = () => {
	document.body.removeAttribute("transient-new-notification");
};

/******************************************************************************/

exports.addNotification = (data, browserNotification = false) => {
	let a = 0;
	const elements = require("#notification-template", {
		messageId: data.messageId,
		className: `${data.className || ""}`,
		color: `${data.color ? `--notification-color: ${data.color}` : ""}`,

		headerIcon: `${data.header.icon ? data.header.icon : "message"}`,
		headerAppName: `${data.header.appName ? data.header.appName : "Notification"}`,
		headerText: `${data.header.text || ""}`,
		headerTimestamp: `${data.header.timestamp ? new Date(data.header.timestamp) : ""}`,
		headerRelativeTimestamp: `${data.header.timestamp ? timeDifference(new Date(), new Date(data.header.timestamp)) : ""}`,

		contentTitle: `${data.content.title || ""}`,
		contentText: `${data.content.text || ""}`,
		contentImage: `${data.content.imagePath ? `background-image: url('${data.content.imagePath}');` : ""}`,

		actions: `${Array.isArray(data.actions) ? data.actions.map(action => `&lt;div class="action ${action.className || ""}" action-id="${a++}">${action.name || "Action"}&lt;/div>`).join("") : ""}`
	});

	const notification = elements[0];
	const header = notification.querySelector(".header");
	const headerDelete = notification.querySelector(".header-delete");

	header.addEventListener("click", () => {
		notification.classList.toggle("expanded");
	});

	headerDelete.addEventListener("click", () => {
    NotificationManager.removeNotification(data.messageId);
	});

	if (Array.isArray(data.actions)) {
		for (let i = 0; i &lt; data.actions.length; i++) {
			const actionElement = notification.querySelector(`.action[action-id="${i}"]`);
			const actionFunction = new Function("return " + data.actions[i].action)();

			if (actionElement && typeof actionFunction  === "function") {
				actionElement.addEventListener("click", () => actionFunction());
			}
		}
	}

	container.insertBefore(notification, container.firstChild);

  // Send browser notification
  if (browserNotification) {
    exports.newNotificationAvailable();
    Notification.requestPermission().then((permission) => {
      if (permission) {
        const notification = new Notification(data.content.title, {
          body: data.content.text,
          image: data.content.imagePath,
          icon: "notification-icon.png",
          tag: data.messageId
        });
        notification.onclick = () => {
          window.focus();
          exports.open();
          notification.close();
        };
      }
    });
  }
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="Wfq2tMZV" name="Notification Manager" __wid="br2byWGG"><pre data-type="content" type="text/javascript" id="notification-manager" __wid="vW9mCQeC">const localStorageKey = "notifications";

/******************************************************************************/

exports.addNotification = (notification, recipients, messageId = false) => {
  if (webstrate.messages) {
    if (!recipients) recipients = webstrate.user.userId;
    webstrate.message({ notification: notification }, recipients);
  } else if (!recipients && messageId) {
    notification.messageId = messageId;

    let notificationsString = localStorage.getItem(localStorageKey);
    let notifications = notificationsString ? JSON.parse(notificationsString) : [];

    if (!notifications.find((notification) => notification.messageId === messageId)) {
      notifications.push(notification);
      localStorage.setItem(localStorageKey, JSON.stringify(notifications));

      window.webstrate.signal({
        type: "addNotification",
        notification: notification,
        messageId: messageId
      });
    }
  }
};

exports.removeNotification = (messageId) => {
  if (webstrate.messages) {
		webstrate.deleteMessage(messageId);
  } else {
    let notificationsString = localStorage.getItem(localStorageKey);
    let notifications = notificationsString ? JSON.parse(notificationsString) : [];

    if (notifications.find((notification) => notification.messageId === messageId)) {
      notifications = notifications.filter((notification) => notification.messageId !== messageId);
      localStorage.setItem(localStorageKey, JSON.stringify(notifications));

      window.webstrate.signal({
        type: "removeNotification",
        messageId: messageId
      });
    }
  }
};

exports.removeAllNotifications = () => {
  if (webstrate.messages) {
    if (Array.isArray(webstrate.messages)) {
      webstrate.messages.forEach((message) => {
        if (typeof message.message === "object" && message.message.notification) {
          webstrate.deleteMessage(message.messageId);
        }
      });
    }
  } else {
    let notificationsString = localStorage.getItem(localStorageKey);
    let notifications = notificationsString ? JSON.parse(notificationsString) : [];

    notifications.forEach((notification) => {
      window.webstrate.signal({
        type: "removeNotification",
        messageId: notification.messageId
      });
    });

    localStorage.setItem(localStorageKey, JSON.stringify([]));
  }
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="2qG8zvYR" name="Notification Events" style run-on-load="true" last-execution-state="success" __wid="qguVTKLt"><pre data-type="content" type="text/javascript" __wid="G3TifS4u">const NotificationUtils = require("#notification-utils");

/******************************************************************************/

const localStorageKey = "notifications";

/******************************************************************************/

const displayNotification = (message, messageId, showNotification) => {
	if (typeof message === "object") {
		if (message.notification) {
			NotificationUtils.addNotification({
				messageId: messageId,
				className: message.notification.className,
				color: message.notification.color,

				header: {
					icon: message.notification.header.icon,
					appName: message.notification.header.appName,
					text: message.notification.header.text,
					timestamp: message.notification.header.timestamp
				},

				content: {
					title: message.notification.content.title,
					text: message.notification.content.text,
					imagePath: message.notification.content.imagePath
				},

				actions: message.notification.actions
			}, showNotification);
		}
	}
};

const deleteNotification = (messageId) => {
	const messageElement = document.querySelector(`.notification[message-id="${messageId}"]`);
	if (messageElement) messageElement.remove();
};

/******************************************************************************/

if (webstrate.messages) {
  webstrate.messages.forEach((message) => {
    displayNotification(message.message, message.messageId, false);
  });
  webstrate.on("messageReceived", (message, senderId, messageId) => {
    displayNotification(message, messageId, true);
  });

  webstrate.on("messageDeleted", (messageId) => {
    deleteNotification(messageId);
  });
} else {
  const notificationsString = localStorage.getItem(localStorageKey);
  const notifications = notificationsString ? JSON.parse(notificationsString) : [];

  notifications.forEach((notification) => displayNotification({ notification: notification }, notification.messageId, false));

  window.webstrate.on("signal", (message, senderId, node) => {
    if (message.type === "addNotification") {
      displayNotification({ notification: message.notification }, message.messageId, true);
    } else if (message.type === "removeNotification") {
      deleteNotification(message.messageId);
    }
  });
}</pre></div><div class="paragraph style-paragraph collapsed" data-id="AUwFHf3i" name="Notification Bar Style" style __wid="EEtsp4xU"><style data-type="content" type="text/css" codemirror="true" __wid="DazTKJbY">html #global-toolbar .notifications-toolbar {
	order: 999;
}

html #global-toolbar .notifications-toolbar i:after {
	content: "notifications";
}

@keyframes new-notification {
	from {content: "notifications";}
	to {content: "notifications_active";}
}

html body[transient-new-notification="true"] #global-toolbar .notifications-toolbar i:after {
	animation: new-notification 1000ms linear 1000ms infinite;
}

/******************************************************************************/

html #notification-bar {
	background-color: var(--color-primary-shade-1);
	color: var(--color-primary-text);
	position: fixed;
	top: 0;
	right: 0;
	width: 384px;
	height: 100%;
	z-index: 100;
	padding-top: 80px;
	padding-bottom: 2px;
	overflow-x: hidden;
	overflow-y: auto;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	transition: transform var(--navigation-transition),
							box-shadow var(--navigation-transition),
							padding-top var(--navigation-transition);
}

html #notification-bar::-webkit-scrollbar {
	display: none;
}

html body:not([transient-notification-pinned="true"]) #notification-bar {
	transform: translate(100%, 0);
	box-shadow: none;
}

/******************************************************************************/

/*html body:not([transient-notification-pinned="true"])  #notification-bar:hover {
	transform: none;
	box-shadow: var(--material-shadow-z16);
}*/

html #notification-bar .handle {
	position: absolute;
	left: 0;
	top: 50%;
	transform: translate(-100%, -50%);
	transition: opacity var(--navigation-transition);
}

html #notification-bar .handle:after {
	content: "keyboard_arrow_right";
	background: var(--color-primary);
	border-top-left-radius: 50%;
	border-bottom-left-radius: 50%;
}

html #notification-bar:hover .handle,
html body[transient-notification-pinned="true"] #notification-bar .handle {
	opacity: 0;
}

/******************************************************************************/

html #notification-bar .notification-clear-all {
	height: 48px;
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	font-weight: 500;
	color: var(--color-secondary-text);
	padding: 16px;
	cursor: pointer;
	user-select: none;
	text-transform: uppercase;
	letter-spacing: 0.04em;
	align-items: center;
	transition: background var(--navigation-transition);
	margin: 0 8px 8px 8px;
}

html #notification-bar .notification-clear-all:hover {
	color: var(--color-primary-text);
	background: rgba(var(--material-color-black-rgb), 0.25);
}

html #notification-bar .notification-clear-all div {
	font-size: 16px;
	height: 20px;
}

html #notification-bar .notification-clear-all i {
	font-size: 28px;
	height: 28px;
}

/******************************************************************************/

html #notification-bar .notification-container {
	display: flex;
	flex-direction: column;
	width: 100%;
	overflow: hidden;
	overflow-y: auto;
	flex-wrap: nowrap;
}

/******************************************************************************/

html #notification-bar .notification-container hr {
	border: 0;
	border-bottom: 1px solid var(--color-primary-shade-1);
	width: 100%;
}</style></div><div class="paragraph style-paragraph collapsed" data-id="qiUeY6Fk" name="Notification Style" style __wid="dAF2xkpe"><style data-type="content" type="text/css" codemirror="true" __wid="zVDHsiLq">html .notification {
	background: var(--material-color-white);
	color: var(--material-color-black);
	box-shadow: var(--material-shadow-z2);
	margin: 6px 8px;
}

html .notification .header-icon,
html .notification .header-app-name,
html .notification .header-expand-content,
html .notification .actions {
	color: var(--notification-color);
}

/******************************************************************************/

html .notification .header {
	padding: 16px;
	display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	align-items: center;
	height: 48px;
	width: 100%;
	font-size: 12px;
	overflow: hidden;
	cursor: pointer;
	user-select: none;
}

html .notification .header-app-name {
	margin-left: 6px;
}
html .notification .header-expand-content {
	margin-left: 4px;
	flex: 1 0 auto;
}

html .notification .header-text:not(:empty):before,
html .notification .header-timestamp:not(:empty):before {
	content: "\00a0•\00a0";
	color: var(--material-color-grey-600);
}

html .notification .header-icon i,
html .notification .header-expand-content i,
html .notification .header-delete i {
	font-size: 16px;
	user-select: none;
}

html .notification .header-app-name {
}

html .notification .header-text {
	color: var(--material-color-grey-600);
}

html .notification .header-timestamp {
	color: var(--material-color-grey-600);
}

html .notification .header-expand-content i {
}

html .notification .header-expand-content i:after {
	content: "keyboard_arrow_down"
}

html .notification.expanded .header-expand-content i:after {
	content: "keyboard_arrow_up"
}

html .notification .header-delete i {
	color: var(--material-color-grey-400);
	cursor: pointer;
}

html .notification:not(:hover) .header-delete {
	display: none;
}

html .notification .header-delete i:hover {
	color: var(--material-color-red);
}

/******************************************************************************/

html .notification .content {
	padding: 16px;
	padding-top: 0;
	display: flex;
	flex-direction: column;
	font-size: 15px;
	line-height: 20px;
	overflow: hidden;
	cursor: default;
	min-height: 64px;
}

html .notification .content-title {
	margin-bottom: 8px;
}

html .notification .content-text {
	color: var(--material-color-grey-600);
	overflow: hidden;
	text-overflow: ellipsis;
	margin-right: 56px;
}

html .notification:not(.expanded) .content-text {
	max-height: 20px;
	white-space: nowrap;
}

html .notification .content-image {
	position: absolute;
	transform: translate(288px, 0);
	width: 48px;
	height: 48px;
	border-radius: 50%;
	background-size: cover;
}

html .notification .content-image img {
	border-radius: 50%;
	width: 100%;
	height: 100%;
}

/******************************************************************************/

html .notification .actions {
	display: flex;
	background: var(--material-color-grey-200);
	flex-direction: row;
	align-items: center;
}

html .notification:not(.expanded) .actions {
	display: none;
}

html .notification .action {
	cursor: pointer;
	text-transform: uppercase;
	font-weight: 500;
	font-size: 14px;
	height: 40px;
	margin: 4px;
	padding: 12px;
	user-select: none;
	transition: background var(--navigation-transition);
	letter-spacing: 0.04em;
	border-radius: 2px;
}

html .notification .action:hover {
	background: rgba(var(--material-color-black-rgb), 0.1);
}</style></div><div class="paragraph code-paragraph collapsed" data-id="xVYAwhEi" name="Notification Examples" last-execution-state="success" draggable="false" style __wid="XumRTPWZ"><pre data-type="content" type="text/javascript" __wid="ysX2PqRD">const actionYes = () => {
	alert("Yes pressed.", "Notification Example");
};
const actionNo = () => {
	alert("No pressed.", "Notification Example");
};
const actionVisit = () => {
	window.open("http://codestrates.org");
};


Codestrate.notification({
	className: "notification-example",
	color: "var(--material-color-deep-orange)",

	header: {
		icon: "pets",
		appName: "App Name",
		text: "Header Text",
		timestamp: new Date()
	},

	content: {
		title: "Large",
		text: "Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.",
		imagePath: "unknown.jpg"
	},

	actions: [
		{
			"name": "Yes",
			"className": "action-yes",
			"action": actionYes.toString()
		},
		{
			"name": "No",
			"className": "action-no",
			"action": actionNo.toString()
		}
	]
}, webstrate.user.userId);

Codestrate.notification({
	color: "var(--material-color-deep-orange)",

	header: {
		icon: "message",
		appName: "Invite",
		text: "maski89",
		timestamp: new Date()
	},

	content: {
		title: "Visit Codestrates.org",
		text: "Click on VISIT to go to codestrates.org. Expand to see the action."
	},

	actions: [
		{
			"name": "Visit",
			"action": actionVisit.toString()
		}
	]
}, webstrate.user.userId);

Codestrate.notification({
	className: "short",

	header: {
		icon: "pets",
		appName: "Short",
		text: "",
		timestamp: new Date()
	},

	content: {
		title: "Short",
		text: "Short.",
		imagePath: ""
	},

	actions: []
}, webstrate.user.userId);

Codestrate.notification({
	content: {
		title: "Minimal",
		text: "Minimal."
	}
}, webstrate.user.userId);</pre></div></div><div class="section section-hidden" name="Palettes" data-type="system" data-id="FMzikLfC" __wid="A6u9ffSQ"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="6bepHddM" __wid="zfbLsFtL"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="sEwvm6AA"><h2 __wid="AHb5R5km">Description</h2><div __wid="YdxGCN3B">Adds the palette API.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="GQAsPcsz" style __wid="QUkVzJuJ"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="LFXbr6V9">{
	"version": "1.0.1",
	"description": "Adds the palette API.",
	"changelog":
	{
    "1.0.1": "Made style themable.",
		"1.0": "Initial version."
	}
}</pre></div><div class="paragraph body-paragraph locked collapsed" data-id="tiLdGVnN" name="Palette Template" style draggable="false" __wid="77i58H9t"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" __wid="Y5TQQZQA"><template id="palette-template" __wid="GckxgbDb">
	<transient id="palette" class="palette" __wid="MMUmsByE">
		<div class="palette-modal" __wid="uNVCm7uU"></div>
		<span class="palette-search" __wid="zWb7SSWJ">
			<span class="palette-icon palette-button" __wid="c7gPyT5n">
				<i class="material-icons" __wid="LYttVqiv">keyboard_arrow_right</i>
			</span>
			<input class="palette-input" placeholder="Placeholder" __wid="chiaWHYj"/>
			<span title="Close" class="palette-button-close palette-button material-ripple-primary-text" __wid="BihAHVSm">
				<i class="material-icons" __wid="hnKk3rhd">close</i>
			</span>
		</span>
	</transient>
</template></div></div><div class="paragraph code-paragraph collapsed locked" data-id="xdVKdgmM" name="Awesomplete" __wid="VBikUp64"><pre data-type="content" type="text/javascript" id="awesomplete" contenteditable="false" __wid="7c6UbYBN">/**
 * Simple, lightweight, usable local autocomplete library for modern browsers
 * Because there werenâ€™t enough autocomplete scripts in the world? Because Iâ€™m completely insane and have NIH syndrome? Probably both. :P
 * @author Lea Verou http://leaverou.github.io/awesomplete
 * MIT license
 */

(function () {

var _ = function (input, o) {
	var me = this;

    // Keep track of number of instances for unique IDs
    Awesomplete.count = (Awesomplete.count || 0) + 1;
    this.count = Awesomplete.count;

	// Setup

	this.isOpened = false;

	this.input = $(input);
	this.input.setAttribute("autocomplete", "off");
	this.input.setAttribute("aria-owns", "awesomplete_list_" + this.count);
	this.input.setAttribute("role", "combobox");

	o = o || {};

	configure(this, {
		minChars: 2,
		maxItems: 10,
		autoFirst: false,
		data: _.DATA,
		filter: _.FILTER_CONTAINS,
		sort: o.sort === false ? false : _.SORT_BYLENGTH,
		item: _.ITEM,
		replace: _.REPLACE
	}, o);

	this.index = -1;

	// Create necessary elements

	this.container = $.create("div", {
		className: "awesomplete",
		around: input
	});

	this.ul = $.create("ul", {
		hidden: "hidden",
        role: "listbox",
        id: "awesomplete_list_" + this.count,
		inside: this.container
	});

	this.status = $.create("span", {
		className: "visually-hidden",
		role: "status",
		"aria-live": "assertive",
        "aria-atomic": true,
        inside: this.container,
        textContent: this.minChars != 0 ? ("Type " + this.minChars + " or more characters for results.") : "Begin typing for results."
	});

	// Bind events

	this._events = {
		input: {
			"input": this.evaluate.bind(this),
			"blur": this.close.bind(this, { reason: "blur" }),
			"keydown": function(evt) {
				var c = evt.keyCode;

				// If the dropdown `ul` is in view, then act on keydown for the following keys:
				// Enter / Esc / Up / Down
				if(me.opened) {
					if (c === 13 && me.selected) { // Enter
						evt.preventDefault();
						me.select();
					}
					else if (c === 27) { // Esc
						me.close({ reason: "esc" });
					}
					else if (c === 38 || c === 40) { // Down/Up arrow
						evt.preventDefault();
						me[c === 38? "previous" : "next"]();
					}
				}
			}
		},
		form: {
			"submit": this.close.bind(this, { reason: "submit" })
		},
		ul: {
			"mousedown": function(evt) {
				var li = evt.target;

				if (li !== this) {

					while (li && !/li/i.test(li.nodeName)) {
						li = li.parentNode;
					}

					if (li && evt.button === 0) {  // Only select on left click
						evt.preventDefault();
						me.select(li, evt.target);
					}
				}
			}
		}
	};

	$.bind(this.input, this._events.input);
	$.bind(this.input.form, this._events.form);
	$.bind(this.ul, this._events.ul);

	if (this.input.hasAttribute("list")) {
		this.list = "#" + this.input.getAttribute("list");
		this.input.removeAttribute("list");
	}
	else {
		this.list = this.input.getAttribute("data-list") || o.list || [];
	}

	_.all.push(this);
};

_.prototype = {
	set list(list) {
		if (Array.isArray(list)) {
			this._list = list;
		}
		else if (typeof list === "string" && list.indexOf(",") > -1) {
				this._list = list.split(/\s*,\s*/);
		}
		else { // Element or CSS selector
			list = $(list);

			if (list && list.children) {
				var items = [];
				slice.apply(list.children).forEach(function (el) {
					if (!el.disabled) {
						var text = el.textContent.trim();
						var value = el.value || text;
						var label = el.label || text;
						if (value !== "") {
							items.push({ label: label, value: value });
						}
					}
				});
				this._list = items;
			}
		}

		if (document.activeElement === this.input) {
			this.evaluate();
		}
	},

	get selected() {
		return this.index > -1;
	},

	get opened() {
		return this.isOpened;
	},

	close: function (o) {
		if (!this.opened) {
			return;
		}

		this.ul.setAttribute("hidden", "");
		this.isOpened = false;
		this.index = -1;

		$.fire(this.input, "awesomplete-close", o || {});
	},

	open: function () {
		this.ul.removeAttribute("hidden");
		this.isOpened = true;

		if (this.autoFirst && this.index === -1) {
			this.goto(0);
		}

		$.fire(this.input, "awesomplete-open");
	},

	destroy: function() {
		//remove events from the input and its form
		$.unbind(this.input, this._events.input);
		$.unbind(this.input.form, this._events.form);

		//move the input out of the awesomplete container and remove the container and its children
		var parentNode = this.container.parentNode;

		parentNode.insertBefore(this.input, this.container);
		parentNode.removeChild(this.container);

		//remove autocomplete and aria-autocomplete attributes
		this.input.removeAttribute("autocomplete");
		this.input.removeAttribute("aria-autocomplete");

		//remove this awesomeplete instance from the global array of instances
		var indexOfAwesomplete = _.all.indexOf(this);

		if (indexOfAwesomplete !== -1) {
			_.all.splice(indexOfAwesomplete, 1);
		}
	},

	next: function () {
		var count = this.ul.children.length;
		this.goto(this.index &lt; count - 1 ? this.index + 1 : (count ? 0 : -1) );
	},

	previous: function () {
		var count = this.ul.children.length;
		var pos = this.index - 1;

		this.goto(this.selected && pos !== -1 ? pos : count - 1);
	},

	// Should not be used, highlights specific item without any checks!
	goto: function (i) {
		var lis = this.ul.children;

		if (this.selected) {
			lis[this.index].setAttribute("aria-selected", "false");
		}

		this.index = i;

		if (i > -1 && lis.length > 0) {
			lis[i].setAttribute("aria-selected", "true");

			this.status.textContent = lis[i].textContent + ", list item " + (i + 1) + " of " + lis.length;

            this.input.setAttribute("aria-activedescendant", this.ul.id + "_item_" + this.index);

			// scroll to highlighted element in case parent's height is fixed
			this.ul.scrollTop = lis[i].offsetTop - this.ul.clientHeight + lis[i].clientHeight;

			$.fire(this.input, "awesomplete-highlight", {
				text: this.suggestions[this.index]
			});
		}
	},

	select: function (selected, origin) {
		if (selected) {
			this.index = $.siblingIndex(selected);
		} else {
			selected = this.ul.children[this.index];
		}

		if (selected) {
			var suggestion = this.suggestions[this.index];

			var allowed = $.fire(this.input, "awesomplete-select", {
				text: suggestion,
				origin: origin || selected
			});

			if (allowed) {
				this.replace(suggestion);
				this.close({ reason: "select" });
				$.fire(this.input, "awesomplete-selectcomplete", {
					text: suggestion
				});
			}
		}
	},

	evaluate: function() {
		var me = this;
		var value = this.input.value;

		if (value.length >= this.minChars && this._list.length > 0) {
			this.index = -1;
			// Populate list with options that match
			this.ul.innerHTML = "";

			this.suggestions = this._list
				.map(function(item) {
					return new Suggestion(me.data(item, value));
				})
				.filter(function(item) {
					return me.filter(item, value);
				});

			if (this.sort !== false) {
				this.suggestions = this.suggestions.sort(this.sort);
			}

			this.suggestions = this.suggestions.slice(0, this.maxItems);

			this.suggestions.forEach(function(text, index) {
					me.ul.appendChild(me.item(text, value, index));
				});

			if (this.ul.children.length === 0) {

                this.status.textContent = "No results found";

				this.close({ reason: "nomatches" });

			} else {
				this.open();

                this.status.textContent = this.ul.children.length + " results found";
			}
		}
		else {
			this.close({ reason: "nomatches" });

                this.status.textContent = "No results found";
		}
	}
};

// Static methods/properties

_.all = [];

_.FILTER_CONTAINS = function (text, input) {
	return RegExp($.regExpEscape(input.trim()), "i").test(text);
};

_.FILTER_STARTSWITH = function (text, input) {
	return RegExp("^" + $.regExpEscape(input.trim()), "i").test(text);
};

_.SORT_BYLENGTH = function (a, b) {
	if (a.length !== b.length) {
		return a.length - b.length;
	}

	return a &lt; b? -1 : 1;
};

_.ITEM = function (text, input, item_id) {
	var html = input.trim() === "" ? text : text.replace(RegExp($.regExpEscape(input.trim()), "gi"), "&lt;mark>$&&lt;/mark>");
	return $.create("li", {
		innerHTML: html,
		"aria-selected": "false",
        "id": "awesomplete_list_" + this.count + "_item_" + item_id
	});
};

_.REPLACE = function (text) {
	this.input.value = text.value;
};

_.DATA = function (item/*, input*/) { return item; };

// Private functions

function Suggestion(data) {
	var o = Array.isArray(data)
	  ? { label: data[0], value: data[1] }
	  : typeof data === "object" && "label" in data && "value" in data ? data : { label: data, value: data };

	this.label = o.label || o.value;
	this.value = o.value;
}
Object.defineProperty(Suggestion.prototype = Object.create(String.prototype), "length", {
	get: function() { return this.label.length; }
});
Suggestion.prototype.toString = Suggestion.prototype.valueOf = function () {
	return "" + this.label;
};

function configure(instance, properties, o) {
	for (var i in properties) {
		var initial = properties[i],
		    attrValue = instance.input.getAttribute("data-" + i.toLowerCase());

		if (typeof initial === "number") {
			instance[i] = parseInt(attrValue);
		}
		else if (initial === false) { // Boolean options must be false by default anyway
			instance[i] = attrValue !== null;
		}
		else if (initial instanceof Function) {
			instance[i] = null;
		}
		else {
			instance[i] = attrValue;
		}

		if (!instance[i] && instance[i] !== 0) {
			instance[i] = (i in o)? o[i] : initial;
		}
	}
}

// Helpers

var slice = Array.prototype.slice;

function $(expr, con) {
	return typeof expr === "string"? (con || document).querySelector(expr) : expr || null;
}

function $$(expr, con) {
	return slice.call((con || document).querySelectorAll(expr));
}

$.create = function(tag, o) {
	var element = document.createElement(tag);

	for (var i in o) {
		var val = o[i];

		if (i === "inside") {
			$(val).appendChild(element);
		}
		else if (i === "around") {
			var ref = $(val);
			ref.parentNode.insertBefore(element, ref);
			element.appendChild(ref);
		}
		else if (i in element) {
			element[i] = val;
		}
		else {
			element.setAttribute(i, val);
		}
	}

	return element;
};

$.bind = function(element, o) {
	if (element) {
		for (var event in o) {
			var callback = o[event];

			event.split(/\s+/).forEach(function (event) {
				element.addEventListener(event, callback);
			});
		}
	}
};

$.unbind = function(element, o) {
	if (element) {
		for (var event in o) {
			var callback = o[event];

			event.split(/\s+/).forEach(function(event) {
				element.removeEventListener(event, callback);
			});
		}
	}
};

$.fire = function(target, type, properties) {
	var evt = document.createEvent("HTMLEvents");

	evt.initEvent(type, true, true );

	for (var j in properties) {
		evt[j] = properties[j];
	}

	return target.dispatchEvent(evt);
};

$.regExpEscape = function (s) {
	return s.replace(/[-\\^$*+?.()|[\]{}]/g, "\\$&");
};

$.siblingIndex = function (el) {
	/* eslint-disable no-cond-assign */
	for (var i = 0; el = el.previousElementSibling; i++);
	return i;
};

// Initialization

function init() {
	$$("input.awesomplete").forEach(function (input) {
		new _(input);
	});
}

// Are we in a browser? Check for Document constructor
if (typeof Document !== "undefined") {
	// DOM already loaded?
	if (document.readyState !== "loading") {
		init();
	}
	else {
		// Wait for it
		document.addEventListener("DOMContentLoaded", init);
	}
}

_.$ = $;
_.$$ = $$;

// Make sure to export Awesomplete on self when in a browser
if (typeof self !== "undefined") {
	self.Awesomplete = _;
}

// Expose Awesomplete as a CJS module
if (typeof module === "object" && module.exports) {
	module.exports = _;
}

return _;

}());</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" style name="Palette Utils" data-id="m9ZfAY6G" last-execution-state="error" __wid="s4YwJ5VP"><pre data-type="content" type="text/javascript" id="palette-utils" __wid="hAbexDzm">exports.addPalette = (id, icon, placeholder,
											action, initialList,
											commandId, commandName, commandDescription = "",
											keyBinding = "", preventKeyDefault = false) => {
	const paletteTemplate = document.querySelector("#palette-template");
	const paletteFragment = document.importNode(paletteTemplate.content, true);
	document.body.appendChild(paletteFragment);

	/******************************************************************************/

	const palette = document.querySelector("#palette");
	const paletteModal = palette.querySelector(".palette-modal");
	const paletteIcon = palette.querySelector(".palette-icon > i");
	const paletteInput = palette.querySelector(".palette-input");
	const paletteButtonClose = palette.querySelector(".palette-button-close");

	/******************************************************************************/

	palette.id = id;
	paletteIcon.innerHTML = icon;
	paletteInput.setAttribute("placeholder", placeholder);

	/******************************************************************************/

	const showPalette = () => {
		paletteInput.value = "";
		palette.classList.add("visible");
		paletteInput.focus();
	};

	const hidePalette = () => {
		palette.classList.remove("visible");
		paletteInput.blur();
	};

	const togglePalette = () => {
		if (palette.classList.contains("visible")) {
			hidePalette();
		} else {
			showPalette();
		}
	};

	const runCommand = (value) => {
		paletteInput.value = "";
		hidePalette();

		action(value);
	};

	/******************************************************************************/

	Codestrate.addCommand(commandId, commandName, () => togglePalette(), commandDescription);
	if (keyBinding)	Codestrate.addKeyBinding(commandId, keyBinding, preventKeyDefault);

	/******************************************************************************/

	paletteModal.addEventListener("click", () => hidePalette());
	paletteButtonClose.addEventListener("click", () => hidePalette());

	paletteInput.addEventListener("keydown", (e) => {
		if (e.keyCode === 13) {
			e.preventDefault();
			myAwesomplete.select();
			runCommand(paletteInput.value);
		} else if (e.keyCode === 27) {
			e.preventDefault();
			hidePalette();
		}
	});

	/******************************************************************************/

	require("#awesomplete");
	const myAwesomplete = new Awesomplete(paletteInput, {
		autoFirst: true,
		maxItems: 100,
		minChars: 0
	});

	const list = initialList;
	myAwesomplete.list = list;

	palette.__getList = () => {
		return list;
	};

	palette.__addListElement = (listElement) => {
		list.push(listElement);
		myAwesomplete.list = list;
	};

	palette.__removeListElement = (listElement) => {
		const index = list.findIndex(el => (el.label === listElement.label && el.value === listElement.value));
		if (index > -1) {
			list.splice(index, 1);
			myAwesomplete.list = list;
		}
	};


	/******************************************************************************/

	return palette;
};</pre></div><div class="paragraph style-paragraph collapsed" style name="Palette Style" data-id="NWmXiMi9" draggable="false" __wid="jTWYjzWP"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="vZDYVHHR">html .palette .palette-modal {
	position: fixed;
	left: 0;
	top: 0;
	width: 100vw;
	height: 100vh;
	background: var(--color-primary-text);
	opacity: 0.25;
	z-index: 397;
	transition: opacity var(--navigation-transition);
	opacity: 0;
	pointer-events: none;
}

html .palette.visible .palette-modal {
	opacity: 0.35;
	pointer-events: all;
}

html .palette .palette-search {
	display: flex;
	flex-direction: row;
	position: fixed;
	top: 160px;
	left: 50%;
	min-width: 400px;
	z-index: 398;
	box-shadow: var(--material-shadow-z24);
	border-radius: 2px;
	background: var(--color-primary-shade-1);
	transition: opacity var(--navigation-transition),
							transform var(--navigation-transition);
	opacity: 0;
	transform: translate(-50%, -50%) translate(0, 96px) scale(0.75);
	pointer-events: none;
}

html .palette.visible .palette-search {
	opacity: 1;
	transform: translate(-50%, -50%);
	pointer-events: all;
}

/******************************************************************************/

html .palette .palette-button {
	display: flex;
	padding: 4px;
	width: 48px;
	height: 48px;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	border-radius: 50%;
	flex-shrink: 0;
	user-select: none;
}

html .palette .palette-search {
	background: var(--color-primary-shade-1);
	border-radius: 4px;
	display: flex;
	flex: 0 1 512px;
}

html .palette .palette-input {
	flex: 0 1 100%;
	outline: none;
	background: none;
	border: none;
	color: var(--color-primary-text);
	text-overflow: ellipsis;
	font-size: 1em;
	letter-spacing: 0.02rem;
}

html .palette .palette-input::placeholder {
	color: var(--color-tertiary-text);
}

html .palette .palette-button-search,
html .palette .palette-button-close {
	width: 40px;
	height: 40px;
	margin: 4px;
}

html .palette .palette-icon {
	cursor: default;
}

/******************************************************************************/

html .palette .awesomplete [hidden] {
	display: none;
}

html .palette .awesomplete .visually-hidden {
	position: absolute;
	clip: rect(0, 0, 0, 0);
}

html .palette .awesomplete {
	display: inline-block;
	position: relative;
	display: flex;
	flex: 0 1 100%;
}

html .palette .awesomplete > input {
	display: block;
}

html .palette .awesomplete > ul {
	position: absolute;
	left: 0;
	top: 48px;
	color: var(--color-primary-text);
	z-index: 398;
	min-width: 100%;
	box-sizing: border-box;
	list-style: none;
	padding: 0;
	margin: 0;
	max-height: 320px;
	overflow-y: auto;
	border-radius: 0 0 4px 4px;
	background: var(--color-primary-shade-1);
	box-shadow: var(--material-shadow-z24);
	transition: 0.3s cubic-bezier(0.4, 0.2, 0.5, 1.4);
	transform-origin: 1.43em -.43em;
}

html .palette .awesomplete > ul::-webkit-scrollbar-thumb {
	border-radius: 0px;
	background-color: var(--color-primary-shade-3);
}

html .palette .awesomplete > ul:empty {
	display: none;
}

html .palette .awesomplete > ul[hidden],
html .palette .awesomplete > ul:empty {
	opacity: 0;
	transform: scale(0);
	display: block;
	transition-timing-function: ease;
}

html .palette .awesomplete > ul > li {
	position: relative;
	padding: 8px;
	cursor: pointer;
}

html .palette .awesomplete > ul > li:hover {
	background: rgba(var(--color-primary-shade-3-rgb), 0.25);
	color: var(--color-primary-text);
}

html .palette .awesomplete mark {
	background: rgba(var(--color-primary-shade-3-rgb), 0.5);
	color: var(--color-primary-text);
}

html .palette .awesomplete > ul > li[aria-selected="true"] {
	background: rgba(var(--color-primary-shade-3-rgb), 0.5);
	color: var(--color-primary-text);
}

html .palette .awesomplete li[aria-selected="true"] mark {
	background: rgba(var(--color-primary-shade-3-rgb), 1);
	color: var(--color-primary-text);
	border-radius: 1px;
}</style></div></div><div class="section section-hidden" data-id="RWxfFGXB" data-type="system" name="The Codestrate Code" data-group="editing" __wid="NprgAdRQ">

    <div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="5du9n32b" draggable="false" __wid="iHitMFaK"><div data-type="content" type="text/html" class="section-documentation" contenteditable="false" codemirror="true" __wid="ibkmrxbp"><h2 __wid="qCB2ZsRe">Description</h2><div __wid="bnfLWyR4">This section is the nucleus of how the Codestrate started. It organically grew with new features being introduced over the course of time. We have started to dissect the section and move paragraphs to their own sections. Yet, the development and use of Codestrates is very organic and we haven't entirely refactored the Codestrates prototype. But, this section will possibly fade away over time.</div><div __wid="yJ4KZvjD">At the moment, it still contains paragraphs that create the transient user interface for paragraphs such as paragraph headers and paragraph actions (e.g., lock, delete, collapse, and move paragraph).</div></div></div><div class="paragraph data-paragraph locked collapsed" data-id="9Tcd2zNW" name="Properties" __wid="fwgNVvHQ"><pre data-type="content" type="application/json" contenteditable="false" class="section-properties" __wid="49AUP7kH">{
	"version": "1.2.4",
	"description": "The nucleus of the Codestrate.",
	"changelog":
	{
		"1.0": "Initital Release",
		"1.1": "Focussed Paragraph and Section changes.",
		"1.2": "Added 'Variables' code paragraph.",
		"1.2.1": "Modified action utils to set title attribute.",
		"1.2.2": "Added draggable to sections (works only downwards at the moment because the drop event listener interferes with the paragraph drag and drop).",
		"1.2.3": "Added section utils with createSection function",
		"1.2.4": "Insert paragraph as first child of section when only section is selected"
	}
}</pre></div>

<div class="paragraph code-paragraph collapsed" data-id="TwAVFiuS" name="DOM Utils" draggable="false" style run-on-load="true" last-execution-state="success" __wid="rAsMqQYm"><pre data-type="content" type="text/javascript" id="dom-utils" __wid="qjiw5ECs">const HTMLUtils = window.HTMLUtils = (function () {

	this.getCaretPosition = function (editableDiv) {
		var caretPos = 0, sel, range;
		if (window.getSelection) {
			sel = window.getSelection();
			if (sel.rangeCount) {
				range = sel.getRangeAt(0);
				if (range.commonAncestorContainer.parentNode == editableDiv) {
					caretPos = range.endOffset;
				}
			}
		} else if (document.selection && document.selection.createRange) {
			range = document.selection.createRange();
			if (range.parentElement() == editableDiv) {
				var tempEl = document.createElement("span");
				editableDiv.insertBefore(tempEl, editableDiv.firstChild);
				var tempRange = range.duplicate();
				tempRange.moveToElementText(tempEl);
				tempRange.setEndPoint("EndToEnd", range);
				caretPos = tempRange.text.length;
			}
		}
		return caretPos;
	};

	this.setCaretPosition = function(editableDiv, position) {

		// Only set new caret position if position > 0
		if (position &lt;= 0) return;

		var textNode = editableDiv.firstChild;
		var range = document.createRange();
		range.setStart(textNode, position);
		range.setEnd(textNode, position);
		var sel = window.getSelection();
		sel.removeAllRanges();
		sel.addRange(range);
	};

	this.pasteHtmlAtCaret = function (html) {
		var sel, range;
		if (window.getSelection) {
			// IE9 and non-IE
			sel = window.getSelection();
			if (sel.getRangeAt && sel.rangeCount) {
				range = sel.getRangeAt(0);
				range.deleteContents();

				// Range.createContextualFragment() would be useful here but is
				// non-standard and not supported in all browsers (IE9, for one)
				var el = document.createElement("div");
				el.innerHTML = html;
				var frag = document.createDocumentFragment(), node, lastNode;
				while ((node = el.firstChild)) {
					lastNode = frag.appendChild(node);
				}
				range.insertNode(frag);

				// Preserve the selection
				if (lastNode) {
					range = range.cloneRange();
					range.setStartAfter(lastNode);
					range.collapse(true);
					sel.removeAllRanges();
					sel.addRange(range);
				}
			}
		} else if (document.selection && document.selection.type != "Control") {
			// IE &lt; 9
			document.selection.createRange().pasteHTML(html);
		}
	};

	this.appendChildAtCaret = function (child, beforeInsert) {
		if (window.getSelection) {

			// IE9 and non-IE
			const selection = window.getSelection();

			let range;
			if (selection.focusNode && selection.getRangeAt && selection.rangeCount) {
				range = selection.getRangeAt(0);
			}
			else {
				range = HTMLUtils.lastRange;
			}

			if (range) {

				// Check if child should be inserted at range.
				if (typeof beforeInsert === 'function') {
					if (!beforeInsert(range)) {
						return false;
					}
				}

				range.deleteContents();
				range.insertNode(child);

				// Preserve the selection
				if (child) {
					range = range.cloneRange();
					range.setStartAfter(child);
					range.collapse(true);
					selection.removeAllRanges();
					selection.addRange(range);
				}

				return true;
			}
		} else {
			throw new Error(`Append child at caret is not supported.`);
		}

		return false;
	};

	return this;
}).call({});

/******************************************************************************/

/**
 * This is a hack for iOS devices where the selection on contenteditable
 * changes when clicking a button.
 */
document.addEventListener("selectionchange", event => {
	if (window.getSelection) {
		const selection = window.getSelection();

		let node = selection.focusNode;
		if (node) {

			const range = selection.getRangeAt(0);
			HTMLUtils.lastRange = range.cloneRange();

			if (node.nodeType === 3) {
				node = node.parentElement;
			}

			const bodyParagraphContent = node.closest(".paragraph.body-paragraph [data-type='content'][contenteditable]");

			if (bodyParagraphContent) {
				bodyParagraphContent._selectionRange = range.cloneRange();
			}
		}
	}
});

/******************************************************************************/

Element.prototype.appendChildAtCaret = function(child) {
	if (!this.isContentEditable) return;

	let range = this._selectionRange;

	if (range) {
		// range.deleteContents();
		range.insertNode(child);

		if (window.getSelection) {
			const selection = window.getSelection();

			// Preserve the selection
			if (child) {
				range = range.cloneRange();
				range.setStartAfter(child);
				range.collapse(true);
				selection.removeAllRanges();
				selection.addRange(range);
			}
		}
		return true;
	}
	return false;
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="8GcNuGZD" name="Action Utils" draggable="false" __wid="SCjNsSd5"><pre data-type="content" type="text/javascript" id="action-utils" __wid="RJRmFf4U">exports.create = (action, options = {}) => {

	options = Object.assign({
		classNames: null,
		text: null
	}, options);

	const button = document.createElement("div");
	button.setAttribute("class", "action" + (options.classNames ? " " + options.classNames : ""));
	button.addEventListener("click", action);

	if (options.text) {
		const text = document.createElement("span");
		text.setAttribute("class", "action-label");
		text.innerText = options.text;
		button.appendChild(text);
	}

	if (options.tooltip) {
		button.setAttribute("tooltip", options.tooltip);
	}

	if (options.title) {
		button.setAttribute("title", options.title);
	}

	const icon = document.createElement("i");
	icon.setAttribute("class", "material-icons");
	button.appendChild(icon);

	return button;
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="jmTSXBNe" name="Section Utils" __wid="FgfU6L3d"><pre data-type="content" type="text/javascript" id="section-utils" __wid="NFjYYDiZ">exports.createSection = (name = undefined, type = undefined, group = undefined) => {
  const section = document.createElement("div");
  section.classList.add("section");
  section.classList.add("section-visible");

	if (name) {
		section.setAttribute("name", name);
	}

  if (type) {
    section.dataset.type = type;
  }

  if (group) {
    section.dataset.group = group;
  }

	return section;
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="WPJxSYWH" name="Section Code" draggable="false" style run-on-load="true" last-execution-state="success" __wid="nYgVhsC2"><pre data-type="content" type="text/javascript" __wid="iVi3MBPg">const ActionUtils = require("#action-utils");
const ParagraphUtils = require("#paragraph-utils");

/******************************************************************************/

/**
 * Add a transient header to the section. This transient element will
 * contain all section specific actions, like collapse, and sortable.
 */
const addArticleHeader = (section) => {

	// Add section header only once.
	if (section.querySelector(".section-header")) return;

	const header = document.createElement("transient");
	header.setAttribute("class", "section-header");

	addEditableElement(section, header, "name");
	addEditableElement(section, header, "id");

	addToggleCollapse(section, header);
	addDragHandle(section, header);
	addToggleVisibility(section, header);
	addHideCollapsedParagraphsAction(section, header);

	addDeleteAction(section, header);
	addToggleSystemSectionAction(section, header);
	addTogglePackageSectionAction(section, header);

	addDataIdElement(section, header);

	section.insertBefore(header, section.firstChild);
};

/******************************************************************************/

const addEditableElement = (section, header, attributeName) => {

	// Add title name element to header.
	const nameElement = document.createElement("span");
	nameElement.setAttribute("class", `${attributeName}-input`);
	nameElement.setAttribute("contenteditable", "true");

	section.liveAttribute(attributeName).changed(value => {
		// This fixes a bug introduced in Chrome 57 and Safari resulting in reverse text input.
		let position = HTMLUtils.getCaretPosition(nameElement);
		nameElement.innerHTML = value || "";
		HTMLUtils.setCaretPosition(nameElement, position);
	});

	nameElement.addEventListener("input", function () {
		const name = nameElement.innerText;
		const hasName = !!name.trim().length;

		if (!hasName) {
			section.removeAttribute(attributeName);
		} else {
			section.setAttribute(attributeName, name);
		}
	});
	header.appendChild(nameElement);
};

const addDataIdElement = (section, header) => {
	const idElement = document.createElement("span");
	idElement.classList.add("data-id-label");
	let id = section.getAttribute("data-id");
	if (!id) {
		id = Codestrate.util.randomString();
		section.setAttribute("data-id", id);
	}
	idElement.innerText = id;
	idElement.setAttribute("tooltip", "true");

	header.appendChild(idElement);
};

/******************************************************************************/

const removeSection = (section) => {
	const sections = document.getElementById("sections");
	const nextSection = section.nextSibling;
	section.remove();
	toast(`Section "${section.getAttribute("name") || "No Name"}" deleted`, 5000, () => sections.insertBefore(section, nextSection), "Undo");
};

const addDeleteAction = (section, header) => {
	const action = ActionUtils.create(() => {

		const name = section.getAttribute("name");

		let message = "Do you really want to delete this section?";
		if (name && name !== "") {
			message = "Do you really want to delete section " + name + " ?";
		}

		const result = confirm(message, "Delete Section");

		if (result instanceof Promise) {
			result.then(r => {
				if (r) {
					removeSection(section);
				}
			});
		} else if (result) {
			removeSection(section);
		}
	}, {
		classNames: "delete-section",
		tooltip: true,
		title: "Delete Section"
	});

	header.appendChild(action);
};

/******************************************************************************/

const addTemplates = (section, propertiesTemplateId) => {
	const firstParagraph = section.querySelector(".paragraph");

	const documentationTemplate = document.querySelector("#section-documentation-template");
	let documentationParagraph;

	if (documentationTemplate) {
		documentationParagraph = ParagraphUtils.createBodyParagraph();
		documentationParagraph.setAttribute("name", "Documentation");

		const content = documentationParagraph.querySelector("[data-type='content']");
		content.classList.add("section-documentation");
		content.innerHTML = documentationTemplate.innerHTML;

		section.insertBefore(documentationParagraph, firstParagraph);
	}

	const propertiesTemplate = document.querySelector(`#${propertiesTemplateId}`);
	let propertiesParagraph;

	if (propertiesTemplate) {
		propertiesParagraph = ParagraphUtils.createDataParagraph();
		propertiesParagraph.setAttribute("name", "Properties");

		const content = propertiesParagraph.querySelector("[data-type='content']");
		content.classList.add("section-properties");
		content.innerHTML = propertiesTemplate.innerHTML;

		section.insertBefore(propertiesParagraph, firstParagraph);
	}

	toast("Section documentation and properties added", false, () => {
		section.removeChild(documentationParagraph);
		section.removeChild(propertiesParagraph);
	}, "Undo");
};

const addTogglePackageSectionAction = (section, header) => {
	const action = ActionUtils.create(() => {

		if (section.hasAttribute("data-type") && (section.getAttribute("data-type") === "package")) {
			section.removeAttribute("data-type");
		} else {
			section.setAttribute("data-type", "package");
			if (!section.querySelector(".section-documentation") && !section.querySelector(".section-properties")) {
				confirm("Every package section should have a section documentation and properties. Do you want to copy the templates into this section?", "Missing Properties").then((result) => {
					if (result) {
						addTemplates(section, "package-section-properties-template");
					}
				});
			}
		}
	}, {
		classNames: "toggle-package-section",
		tooltip: true,
		title: "Toggle Package Section"
	});

	header.appendChild(action);
};

const addToggleSystemSectionAction = (section, header) => {
	const action = ActionUtils.create(() => {

		if (section.hasAttribute("data-type") && (section.getAttribute("data-type") === "system")) {
			section.removeAttribute("data-type");
		} else {
			section.setAttribute("data-type", "system");
			if (!section.querySelector(".section-documentation") && !section.querySelector(".section-properties")) {
				confirm("Every system section should have a section documentation and properties. Do you want to copy the templates into this section?", "Missing Properties").then((result) => {
					if (result) {
						addTemplates(section, "system-section-properties-template");
					}
				});
			}
		}
	}, {
		classNames: "toggle-system-section",
		tooltip: true,
		title: "Toggle System Section"
	});

	header.appendChild(action);
};

/******************************************************************************/

const addDragHandle = (section, header) => {
	const action = ActionUtils.create(() => {
		// empty
	}, {
		classNames: "drag-handle-section",
		tooltip: true,
		title: "Drag Handle"
	});

	header.appendChild(action);
};

const addHideCollapsedParagraphsAction = (section, header) => {
	const action = ActionUtils.create(() => {
		section.classList.toggle("hide-collapsed-paragraphs");
	}, {
		classNames: "hide-collapsed-paragraphs2",
		tooltip: true,
		title: "Hide Collapsed Paragraphs"
	});

	header.appendChild(action);
};

const addToggleVisibility = (section, header) => {
	const action = ActionUtils.create(() => {

		if (section.classList.contains("section-hidden")) {
			section.classList.remove("section-hidden");
			section.classList.add("section-visible");
		} else {
			section.classList.remove("section-visible");
			section.classList.add("section-hidden");
			toast(`Section "${section.getAttribute("name") || "No Name"}" hidden`, false, () => {
				section.classList.remove("section-hidden");
				section.classList.add("section-visible");
			}, "Undo");
		}
	}, {
		classNames: "toggle-visibility-section",
		tooltip: true,
		title: "Hide Section"
	});

	header.appendChild(action);
};

const addToggleCollapse = (section, header) => {
	const action = ActionUtils.create(() => {

		if (section.classList.contains("collapsed")) {
			section.classList.remove("collapsed");
		} else {
			section.classList.add("collapsed");
		}
	}, {
		classNames: "toggle-collapse",
		tooltip: true,
		title: "Collapse/Expand Section"
	});

	header.appendChild(action);
};

/******************************************************************************/

// Live query the body for existing sections on load and new sections added later
const sectionQuery = document.liveQuerySelectorAll(".section").added(addArticleHeader);</pre></div><div class="paragraph code-paragraph collapsed" data-id="6EkaHArw" last-execution-state="success" run-on-load="true" draggable="false" style name="Section Sortable Action Code" __wid="Su6z4Vg2"><pre data-type="content" type="text/javascript" __wid="3VGj5rTD">importLib("Sortable.js").then(() => {

  /******************************************************************************/

  const enableParagraphDragAndDrop = (sectionsContainer, enable) => {
    const sections = document.querySelectorAll('.section');
    Array.prototype.forEach.call(sections, (section) => {
      if (section.sortable) {
        section.sortable.option("disabled", !enable); // set
      }
    });
  };

  const initSortable = function (sections) {

    sections.sortable = Sortable.create(sections, {
      group: {
        name: "section",
        put: ["section"]
      },
      animation: 50,
      sort: true, // sorting inside list
      draggable: ".section",
      handle: ".drag-handle-section",
      ghostClass: "dragging-section", // Class name for the drop placeholder
      chosenClass: "dragging-section", // Class name for the chosen item
      dragClass: "dragging-section", // Class name for the dragging item

      scrollSensitivity: 30, // px, how near the mouse must be to an edge to start scrolling.
      scrollSpeed: 30, // px

      // Element dragging started
      onStart: function ( /**Event*/ evt) {

        // disable drag and drop of paragraphs
        enableParagraphDragAndDrop(sections, false);

        const codes = document.querySelectorAll("pre[type],*[codemirror]");
        Array.prototype.forEach.call(codes, (code) => {
          if (code.__editor) {
            code.__editor.editor.setOption("dragDrop", false);
          }
        });
      },

      // Element dragging ended
      onEnd: function ( /**Event*/ evt) {
        const codes = document.querySelectorAll("pre[type],*[codemirror]");
        Array.prototype.forEach.call(codes, (code) => {
          if (code.__editor) {
            code.__editor.editor.setOption("dragDrop", true);
          }
        });

        // enable drag and drop of paragraphs
        enableParagraphDragAndDrop(sections, true);
      }
    });
  };

  /******************************************************************************/

  const sections = document.querySelector("#sections");
  initSortable(sections);
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="8SKMAbq9" name="Paragraph Utils Code" style draggable="false" __wid="dqNQu4mp"><pre data-type="content" type="text/javascript" id="paragraph-utils" __wid="aUPd4RXu">const paragraphHeaderClass = "paragraph-header";

/******************************************************************************/

const createParagraph = (type) => {
  const paragraph = document.createElement("div");
  paragraph.classList.add("paragraph");
  paragraph.classList.add(`${type}-paragraph`);
  return paragraph;
};

/******************************************************************************/

exports.createBodyParagraph = (content = "") => {
  const paragraph = createParagraph("body");

  const contentContainer = document.createElement("div");
  contentContainer.setAttribute("data-type", "content");
  contentContainer.setAttribute("type", "text/html");
  contentContainer.setAttribute("codemirror", "true");
  contentContainer.contentEditable = true;
  contentContainer.innerHTML = content;

  paragraph.appendChild(contentContainer);

  return paragraph;
};

exports.createStyleParagraph = (style = "/* CSS here */", containerElement = "style") => {
  const paragraph = createParagraph("style");

  const styleContainer = document.createElement(containerElement);
  styleContainer.setAttribute("data-type", "content");
  styleContainer.setAttribute("type", "text/css");
  styleContainer.setAttribute("codemirror", "true");

  const textNode = document.createTextNode(style);
  styleContainer.appendChild(textNode);

  paragraph.appendChild(styleContainer);

  return paragraph;
};

exports.createCodeParagraph = (code = "// JavaScript code here") => {
  const paragraph = createParagraph("code");

  const codeContainer = document.createElement("pre");
  codeContainer.setAttribute("data-type", "content");
  codeContainer.setAttribute("type", "text/javascript");

  const textNode = document.createTextNode(code);
  codeContainer.appendChild(textNode);

  paragraph.appendChild(codeContainer);

  return paragraph;
};

exports.createDataParagraph = (data = "/* JSON here */") => {
  const paragraph = createParagraph("data");

  const dataContainer = document.createElement("pre");
  dataContainer.setAttribute("data-type", "content");
  dataContainer.setAttribute("type", "application/json");

  const textNode = document.createTextNode(data);
  dataContainer.appendChild(textNode);

  paragraph.appendChild(dataContainer);

  return paragraph;
};

exports.insertParagraphAfterFocussed = (paragraph) => {
  if (Codestrate.focussedParagraph) {
		// insert paragraph after focussed paragraph
    Codestrate.focussedSection.insertBefore(paragraph, Codestrate.focussedParagraph.nextSibling);
    Codestrate.simulateClick(paragraph);
  } else if (Codestrate.focussedSection) {
		// insert paragraph as new first child of section
		let firstParagraph = Codestrate.focussedSection.querySelector(':scope .paragraph:first-of-type');
		Codestrate.focussedSection.insertBefore(paragraph, firstParagraph);
    Codestrate.simulateClick(paragraph);
  } else {
    alert("Select a section first!", "Cannot Add Paragraph");
  }
};

/******************************************************************************/

/**
 * Get paragraph header or create a new transient header if it does not exist.
 */
const getHeader = (paragraph) => {

  let header = paragraph.querySelector(`.${paragraphHeaderClass}`);
  if (!header) {
    header = document.createElement("transient");
    header.setAttribute("class", paragraphHeaderClass);
    paragraph.insertBefore(header, paragraph.firstChild);
  }
  return header;
};

/**
 * Get content element.
 */
const getContentElement = (paragraph) => {
  return paragraph.querySelector('[data-type="content"]');
};

exports.getHeaderElement = getHeader;
exports.getContentElement = getContentElement;

/******************************************************************************/

exports.addHeaderAction = (paragraph, className, action, options) => {

  let header = getHeader(paragraph);

  // Only add header action once.
  if (header.querySelector(`.${className}`)) return;

  const actionElement = document.createElement("div");
  actionElement.setAttribute("class", `action ${className}`);

  // Add action if defined.
  if (action) {
    actionElement.addEventListener("click", action);
  }

  // Add tooltip when provided as optional setting
  if (options && options.tooltip) {
    actionElement.setAttribute("tooltip", options.tooltip);
  }

  const icon = document.createElement("i");
  icon.setAttribute("class", "material-icons");
  actionElement.appendChild(icon);

  header.appendChild(actionElement);

  return actionElement;
};

exports.addEditableElement = (target, attributeName, proxyElement) => {

  // Only add editable element once.
  if (target.querySelector(`span.${attributeName}-input`)) return;

  // Add title name element to header.
  const nameElement = document.createElement("span");
  nameElement.setAttribute("class", `input ${attributeName}-input`);
  nameElement.setAttribute("contenteditable", "true");

  // Update when changing to the attribute happen (also remote updates).
  proxyElement.liveAttribute(attributeName).changed((value) => {
    // This fixes a bug introduced in Chrome 57 and Safari resulting in reverse text input.
    let position = HTMLUtils.getCaretPosition(nameElement);
    nameElement.innerHTML = value || "";
    HTMLUtils.setCaretPosition(nameElement, position);
  });

  nameElement.addEventListener("input", function () {
    const name = nameElement.innerText;
    const hasName = !!name.trim().length;

    if (!hasName) {
      proxyElement.removeAttribute(attributeName);
    } else {
      proxyElement.setAttribute(attributeName, name);
    }
  });
  target.appendChild(nameElement);
};

exports.addSelectElement = (target, attributeName, proxyElement, options) => {

  // Only add editable element once.
  let selectList = target.querySelector(`select.${attributeName}-input`);
  if (!selectList) {
    //Create and append select list
    selectList = document.createElement("select");
    selectList.classList.add("input");
    selectList.classList.add(`${attributeName}-input`);
    selectList.addEventListener("change", (event) => {
      let selectedValue = selectList.value;
      proxyElement.setAttribute(attributeName, selectedValue);

      // remove invalid options if a valid option was selected
      if (!selectList.selectedOptions[0].hasAttribute("invalid")) {
        let invalidOptions = selectList.querySelectorAll('option[valid="false"]');
        Array.prototype.forEach.call(invalidOptions, (o) => o.remove());
      }
    });
  }

  const addOption = (value, valid = true) => {

    let option = selectList.querySelector(`option[value="${value}"]`);
    if (!option) {
      option = document.createElement("option");
			selectList.appendChild(option);
    }

		option.setAttribute("valid", valid);
    option.value = value;
    option.text = valid ? value : `${value} (invalid)`;
  };

  const initOptions = () => {
//     setTimeout(() => {
      //Create and append the options
      for (let i = 0; i &lt; options.length; i++) {
        addOption(options[i]);
      }

      proxyElement.liveAttribute(attributeName).changed((value) => {
        if (!selectList.querySelector(`option[value="${value}"]`)) {
          addOption(value, false);
        }

        selectList.value = value;
      });
//     }, 0);
  };

  // wait until all possible options initialized
  if (Codestrate.loaded) {
    initOptions();
  } else {
    window.addEventListener("codestrateloaded", function codestrateLoaded() {
      initOptions();
      window.removeEventListener("codestrateloaded", codestrateLoaded);
    });
  }

  target.appendChild(selectList);
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="G87Cp7CG" name="Add data-ids to Sections and Paragraphs" run-on-load="true" style draggable="false" last-execution-state="success" __wid="AJmQc544"><pre data-type="content" type="text/javascript" __wid="pLamwsnh">const ids = [];

// Adds a random data-id attribute to all sections and paragraphs, which are missing one,
// and checks for duplicate ids.
document.liveQuerySelectorAll(".section, .paragraph").added(element => {
	let id = element.getAttribute("data-id");
	if (!id) {
		id = Codestrate.util.randomString();
		element.setAttribute("data-id", id);
		ids.push(id);
	} else if (ids.includes(id)) {
		// console.error(`There are duplicate data-ids: "${id}"!`); // FIXME: Gets triggered when dragging and dropping paragraphs
	} else {
		ids.push(id);
	}
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="drVmLP3i" name="Focussed Paragraph and Section" draggable="false" style run-on-load="true" last-execution-state="success" __wid="D4bTjE3P"><pre data-type="content" type="text/javascript" __wid="jffYbcdv">const focussedAttribute = "transient-focussed";

/******************************************************************************/

const updateFocus = (event) => {
	if (!event.target || !event.target.closest) return;

	// No update on toolbar, menu or snackbar
	if (event.target.closest("#global-toolbar") ||
			event.target.closest("#global-menu") ||
			event.target.closest("#snackbar")) {
		return;
	}

	// Update paragraph
	const paragraph = event.target.closest(".paragraph");

	if (paragraph !== window.Codestrate.focussedParagraph) {
		if (window.Codestrate.focussedParagraph) {
			window.Codestrate.focussedParagraph.removeAttribute(focussedAttribute);
			window.Codestrate.focussedParagraph = null;
		}

		if (paragraph) {
			window.Codestrate.focussedParagraph = paragraph;
			window.Codestrate.focussedParagraph.setAttribute(focussedAttribute, "true");
		}
	}

	// Update section
	const section = event.target.closest(".section");

	if (section !== window.Codestrate.focussedSection) {
		if (window.Codestrate.focussedSection) {
			window.Codestrate.focussedSection.removeAttribute(focussedAttribute);
			window.Codestrate.focussedSection = null;
		}

		if (section) {
			window.Codestrate.focussedSection = section;
			window.Codestrate.focussedSection.setAttribute(focussedAttribute, "true");
		}
	}
};

/******************************************************************************/

window.addEventListener("click", function (event) {
	updateFocus(event);
}, true);

/*window.addEventListener("focus", function (event) {
	updateFocus(event);
}, true);*/

/******************************************************************************/

Codestrate.simulateClick = (element) => {
	const evObj = document.createEvent('Events');
	evObj.initEvent("click", true, false);
	element.dispatchEvent(evObj);
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="mdyivJjZ" name="Paragraph Title Code" run-on-load="true" draggable="false" style last-execution-state="success" __wid="p5FysNRn"><pre data-type="content" type="text/javascript" __wid="EpW6T6T9">const ParagraphUtils = require("#paragraph-utils");

/******************************************************************************/

document.liveQuerySelectorAll(".paragraph").added(paragraph => {
	const header = ParagraphUtils.getHeaderElement(paragraph);
	const content = ParagraphUtils.getContentElement(paragraph);

	ParagraphUtils.addEditableElement(header, "name", paragraph);
	ParagraphUtils.addEditableElement(header, "id", content);
	ParagraphUtils.addEditableElement(header, "class", content);
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="TTfmS2at" name="Paragraph Collapse Action Code" draggable="false" run-on-load="true" style last-execution-state="success" __wid="s6QfX6GF"><pre data-type="content" type="text/javascript" __wid="F9XJkjyv">const SectionUtils = require("#paragraph-utils");

/******************************************************************************/

const addCollapsibleAction = function(paragraph) {
	SectionUtils.addHeaderAction(paragraph, "collapse-expand", () => {
		paragraph.classList.toggle("collapsed");
	}, {
		tooltip: true
	});

	// CodeMirror requires a refresh on the editor if any of the parent or
	// container styles changed.
	const updateEditor = () => {
		const content = paragraph.querySelector("[data-type='content']");

		if (content && content.__editor && content.__editor.editor) {
			content.__editor.editor.refresh();
		}
	};

	paragraph.liveAttribute("class").changed(updateEditor);
};

/******************************************************************************/

document.liveQuerySelectorAll(".paragraph").added(addCollapsibleAction);</pre></div><div class="paragraph code-paragraph collapsed" data-id="Wn58bYws" name="Paragraph Sortable Action Code" draggable="false" last-execution-state="success" style run-on-load="true" __wid="MNeik2BT"><pre data-type="content" type="text/javascript" __wid="vnTbT7a6">importLib("Sortable.js").then(() => {

  const ParagraphUtils = require("#paragraph-utils");

  const addSortableAction = function (paragraph) {
    ParagraphUtils.addHeaderAction(paragraph, "drag-handle");

    // 		paragraph.addEventListener("dragstart", event => {
    // 			let clonedNode = paragraph.cloneNode(true);
    // 			clonedNode.classList.remove("dragging");
    // 			clonedNode.removeAttribute("style");

    // 			let transients = clonedNode.querySelectorAll("transient");
    // 			Array.prototype.forEach.call(transients, transient => {
    // 				transient.remove();
    // 			});

    // 			let html = clonedNode.outerHTML;

    // 			let data = {
    // 				webstrateId: webstrate.webstrateId,
    // 				type: "paragraph",
    // 				html: html
    // 			};

    // 			event.dataTransfer.setData("application/x-codestrate", JSON.stringify(data));

    // 		}, false);
  };

  /******************************************************************************/

  const initSortable = function (section) {

    // 		// Events fired on the drop targets
    // 		section.addEventListener("dragover", event => {
    // 			event.preventDefault();
    // 		}, false);

    // 		section.addEventListener("drop", event => {
    // 			let plainData = event.dataTransfer.getData("application/x-codestrate");
    // 			if (!plainData) return;

    // 			let data = JSON.parse(plainData);

    // 			// Drag and drop occured in the same codestrate, thus ignore it
    // 			if (data.webstrateId === webstrate.webstrateId) {
    // 				return;
    // 			}

    // 			let container = document.createElement("div");
    // 			container.innerHTML = data.html;
    // 			section.appendChild(container.children[0]);
    // 		}, false);

    section.sortable = Sortable.create(section, {
      group: {
        name: "paragraph",
        put: ["paragraph"]
      },
      animation: 50,
      // sort: false,
      draggable: ".paragraph",
      handle: ".drag-handle",
      ghostClass: "dragging", // Class name for the drop placeholder
      chosenClass: "dragging", // Class name for the chosen item
      dragClass: "dragging", // Class name for the dragging item

      scrollSensitivity: 30, // px, how near the mouse must be to an edge to start scrolling.
      scrollSpeed: 30, // px

      // 			onChoose: function (/**Event*/evt) {

      // 				if (window.Codestrate.focussedParagraph) {
      // 					// removeConsole(window.Codestrate.focussedParagraph);
      // 					// window.Codestrate.focussedParagraph = null;
      // 				}
      // 			},

      // Element dragging started
      onStart: function ( /**Event*/ evt) {
        const codes = document.querySelectorAll("pre[type],*[codemirror]");
        Array.prototype.forEach.call(codes, (code) => {
          if (code.__editor) {
            code.__editor.editor.setOption("dragDrop", false);
          }
        });
      },

      // Element dragging ended
      onEnd: function ( /**Event*/ evt) {
        const codes = document.querySelectorAll("pre[type],*[codemirror]");
        Array.prototype.forEach.call(codes, (code) => {
          if (code.__editor) {
            code.__editor.editor.setOption("dragDrop", true);
          }
        });
      },
    });
  };

  /******************************************************************************/

  document.liveQuerySelectorAll(".section").added(initSortable);
  document.liveQuerySelectorAll(".paragraph").added(addSortableAction);
});</pre></div><div class="paragraph code-paragraph collapsed" name="Paragraph Delete Action Code" draggable="false" run-on-load="true" style data-id="js38GiLb" last-execution-state="success" __wid="GGvm8EUZ"><pre data-type="content" type="text/javascript" __wid="mBYh58Gk">const ParagraphUtils = require("#paragraph-utils");

/******************************************************************************/

const removeParagraph = (paragraph) => {
	const section = paragraph.closest(".section");
	const nextParagraph = paragraph.nextSibling;
	paragraph.remove();
	toast(`Paragraph "${paragraph.getAttribute("name") || "No Name"}" deleted`, 5000, () => section.insertBefore(paragraph, nextParagraph), "Undo");
};

const addDeleteAction = (paragraph) => {
	ParagraphUtils.addHeaderAction(paragraph, "delete-paragraph", () => {

		const name = paragraph.getAttribute("name");

		let message = "Do you really want to delete this paragraph?";
		if (name && name !== "") {
			message = "Do you really want to delete paragraph " + name + " ?";
		}

		const result = confirm(message, "Delete Paragraph");

		if (result instanceof Promise) {
			result.then(r => {
				if (r) {
					removeParagraph(paragraph);
				}
			});
		} else if (result) {
			removeParagraph(paragraph);
		}
	}, {
		tooltip: true
	});
};

/******************************************************************************/

document.liveQuerySelectorAll(".paragraph").added(addDeleteAction);</pre></div><div class="paragraph code-paragraph collapsed" name="Lock Paragraph Code" run-on-load="true" draggable="false" style data-id="iqecX7XG" last-execution-state="success" __wid="v6t4U2jR"><pre data-type="content" type="text/javascript" contenteditable="true" __wid="RAiFHxh3">const SectionUtils = require("#paragraph-utils");

/******************************************************************************/

const addLockAction = (paragraph) => {
	const lockElement = SectionUtils.addHeaderAction(paragraph, "lock-content", () => {

		const content = paragraph.querySelector("[data-type='content']");
		if (content) {
			if (!content.hasAttribute("contenteditable") || content.getAttribute("contenteditable") === "true") {
				content.setAttribute("contenteditable", "false");
			} else {
				content.setAttribute("contenteditable", "true");
			}
		}
	}, {
		tooltip: true
	});

	const content = paragraph.querySelector("[data-type='content']");

	if (content) {
		content.liveAttribute("contenteditable").changed((value, oldValue) => {
			const readOnly = value && value === "false" ? true : false;
			if (readOnly) {
				paragraph.classList.add("locked");
			} else {
				paragraph.classList.remove("locked");
			}
		});
	}
};

/******************************************************************************/

document.liveQuerySelectorAll(".paragraph").added(addLockAction);</pre></div><div class="paragraph code-paragraph collapsed" name="Hash Scroll Code" run-on-load="true" style data-id="4rUSqsbU" draggable="false" last-execution-state="success" __wid="QPUCmMhv"><pre data-type="content" type="text/javascript" __wid="QsTk4wQ4">const element = document.getElementById(window.location.hash.substr(1));

if (element) {
	const scrollToElement = element.parentElement;

	window.addEventListener("codestrateloaded", () => {
		if (scrollToElement) {
			window.scrollTo(0, scrollToElement.getBoundingClientRect().top);
		}
	});
}</pre></div><div class="paragraph code-paragraph collapsed" name="Variable Code" data-id="LkEsdkdw" draggable="false" run-on-load="true" style last-execution-state="success" __wid="9tmzsyCY"><pre data-type="content" type="text/javascript" __wid="y7X8ZEfm">window.Variable = function (name) {
	const variables = Array.from(document.querySelectorAll(`div.variable[data-name="${name}"]`));

	this.set = function (value) {
		variables.forEach(variable => {
			variable.innerHTML = value;
		});
	};

	this.setTransient = function (value) {
		variables.forEach(variable => {
			variable.innerHTML = `&lt;transient>${value}&lt;/transient>`;
		});
	};

	this.appendChild = function(child) {
		if (variables.length === 0) {
			console.warn(`Variable ${name} does not exist`);
		}

		if (variables.length > 1) {
			console.warn(`Variable.appendChild only applied to first variable`);
		}

		if (variables.length > 0) {
			variables[0].appendChild(child);
		}
	};

	return this;
}.bind({});</pre></div></div><div class="section section-hidden" data-id="PJGnfYsy" data-type="system" name="The Codestrate Style" data-group="basic" __wid="Q4U2eGhJ"><div class="paragraph body-paragraph locked collapsed" data-id="5B8NDkAt" name="Documentation" style draggable="false" __wid="2sQ8n2sq"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="8xxHht5R"><h2 __wid="TQDRKyxw">Description</h2><div __wid="JTQViagJ">This section provides the basic styling of the user interface of Codestrates. This includes variables, Material Design styles and paragraph and section styles. Other than this styles should always be inside their respective section/package.</div><h2 __wid="K6kqMqyB">Theme Variables</h2><div __wid="UXtaLx8A">Codestrate uses CSS variables for the basic color theme and fonts. The variables can be found in the "Theme Variables" paragraph. They are available in the whole document and should be used wherever one creates user interfaces for Codestrates, as they ensure legibility and consistent use of colors throughout Codestrates. They also make it possible to easily create new themes for Codestrates.</div><h3 __wid="ZGxYiqmi">Fonts</h3><div __wid="haCVkQix">For the fonts of Codestrates there are three variables:</div><div __wid="GdRzeB3u"><ul __wid="N2RhqfSx"><li __wid="9XDaZwAj"><code __wid="hMNMmTnT">var(--font-primary)</code>: The main font for user interfaces of a Codestrate. This should be a sans-serif font most of the time.</li><li __wid="Y2GftzrR"><code __wid="vtMWxcnu">var(--font-secondary)</code>: The font for body text in body-paragraphs and alike. This can be both a serif or sans-serif font, depending on the theme.</li><li __wid="KbJd5hKX"><code __wid="tFRQUvLL">var(--font-monospace)</code>: The font for editors and other usecases, where a monospace font is needed.</li></ul></div><h3 __wid="cqcGsm55">Colors</h3><div __wid="VFBbiupe">The color variables of a Codestrate can be divided in three categories:</div><div __wid="guEJY3d3"><div __wid="ZB4yGHsw"><b __wid="wQiZMPfY">Primary Color</b></div><div __wid="EvAu55wK"><ul __wid="t6JUYtDp"><li __wid="dKNnCZWA"><code __wid="s2iVDeQc">var(--color-primary)</code>: The primary color of the Codestrate.</li><li __wid="47M4EbvD"><code __wid="PNb76tDh">var(--color-primary-shade-1)</code>: A darker or brighter shade of the primary color.</li><li __wid="SWbPzsvB"><code __wid="hei7ZVJj">var(--color-primary-shade-2)</code>: A more darker or brighter shade of the primary color.</li><li __wid="craBwJaP"><code __wid="pRSHpLtj">var(--color-primary-shade-3)</code>: A even more darker or brighter shade of the primary color.</li></ul></div><div __wid="cmHpaWmw"><div __wid="NgMiihUA"><b __wid="F9XkTdYz">Text Color</b></div><div __wid="jGYk4UEc"><ul __wid="YE6zRDCg"><li __wid="NRPJLNr2"><code __wid="sBiXqrX9">var(--color-primary-text)</code>: The primary text color. This should have a high contrast to the primary color. Used for main user interfaces and headlines.</li><li __wid="ffnNJiWB"><code __wid="XrAsZPNG">var(--color-secondary-text)</code>: A darker or brighter shade of the primary text color, which has less contrast to the primary color. Used for less important text and general body text.</li><li __wid="KKtwWJXz"><code __wid="s8VGDUss">var(--color-tertiary-text)</code>: A even darker or brighter shade of the primary text color, which has even less contrast to the primary color. Used for disabled or unimportant text.</li></ul></div><div __wid="B2pRMXTP"><div __wid="R5yTe3nK"><b __wid="fcjwsj6a">Accent Color</b></div></div><div __wid="BFPJARJL"><ul __wid="e49trRi8"><li __wid="xZb4Ep4L"><code __wid="9Zmnex4S">var(--color-accent)</code>: An accent color for highlights or important user interfaces, which also adds a bit of color to the general theme.</li><li __wid="h9kHndRZ"><code __wid="SjTUb7pV">var(--color-accent-text)</code>: A text font, which is legible on the accent color.</li></ul><h4 __wid="9qGtmpmj">RGB-Values</h4></div><div __wid="vkDdHyi3">The variables described above need to have a value, so they can be directly used (e.g. <code __wid="BQpDBHL9">#FFFFFF</code> or <code __wid="5UvgDkXH">rgb(255, 255, 255)</code>). In addition to these variables one also needs to provide the raw RGB values of the colors (e.g. <code __wid="i56958z5">255, 255, 255</code>). These are stored in variables with the same name and the suffix <code __wid="du8Ay8Qf">-rgb</code>. This is needed to use colors with an alpha value. The code snippet below shows an example:</div><pre __wid="PVF98uQB"><code __wid="fnPCsFZb">/* Has accent color and opacity of 50 % in background */
.myClass {
  background: rgba(var(--color-accent-rgb), 0.5);
}</code></pre><h2 __wid="Y7EyqcHw">The <code __wid="VkgYSb2w">themable</code> Class</h2><div __wid="brPQNdcZ">The class <code __wid="yAf3XNZc">themable</code>, which can be found on many of the style paragraphs in this section, is used by the package "Theme Creator". The class indicates the Theme Creator, that the style can be modified when creating new themes. It should be added to style paragraphs containing font, colors or other "styleable" user interfaces. Style paragraphs only containing CSS "logic", like setting the z-index or the display and position types, don't need to (but can of course) themable.</div><h3 __wid="uCW95X9X">Selector Start</h3><div __wid="DT5z4bBq">When creating themable style paragraphs, every selector should begin with <code __wid="M2xYMEzC">html</code>. This is needed for the theme creator to later override it with the respective selector of the theme (see the "Theme Creator" documentation for more information).</div><pre __wid="U5SbrTBQ"><code __wid="WmAh6Aev">/* Bad */
.myClass {
  color: hotpink;
}

/* Good */
html .myClass {
  color: hotpink;
}</code></pre><h2 __wid="p9nhq5ug">Material Design</h2><div __wid="NfwiBpff">The user interface of Codestrates uses many design guidelines of Google's Material Design (<a href="https://material.io/guidelines/" target="_blank" __wid="jkZbXyCs">link</a>). When creating new user interface elements of Codestrates these should (don't have to of course) be considered.</div><h3 __wid="dscp8JWr">Icons</h3><div __wid="BYPzZrG4">Codestrates uses the Material Icons (<a href="https://material.io/icons/" target="_blank" __wid="vGU5Mbmh">link</a>) font to display icons. The icons usually reside inside an element with the <code __wid="fZ8FbjwV">material-icons</code> class. The font uses ligatures, so setting the content of the element to <code __wid="eu4CeknX">info_outline</code> for example is enough to display icons.</div><h4 __wid="iKs2maNk">Extended Icons set</h4><div __wid="8aDUutgV">As the icons font of Google lacks some icons, Codestrates also incorporates the open "Material Design Icons" (<a href="https://materialdesignicons.com/" target="_blank" __wid="54ZZ4rZP">link</a>)) webfont. Whereas the font from Google uses ligatures, this font uses unicode symbols like <code __wid="7px6KyA2">\f2fd</code> to display icons. To overcome this inconvenience there are CSS variables for all icons. So instead of using the unicode symbol one can use the variable. To use the new font the element also needs to use the <code __wid="g8zyjGgK">Material Design Icons</code> font. The example below illustrates how to set the icon of an elment using the <code __wid="7C2ge5wz">:after</code> selector:</div><pre __wid="NSnAATh8"><code __wid="34sSc2Lb">/* Note: The element still needs the "material-icons" class */

/* Google Material Icons */
.myClass.material-icons:after {
  content: "info_outline";
}

/* Open Material Design Icons */
.myClass.material-icons:after {
  content: var(--information-outline); /* resolves to "\f2fd" */
  font-family: "Material Design Icons";
}</code></pre><h3 __wid="LwJWrvC5">Fonts</h3><div __wid="BTHa8gZc">Codestrates includes the "Roboto" font for user interfaces, body text and code editors. The following fonts are included in every Codestrate and provided using <code __wid="q2u6T8Ew">@font-face</code>:</div><div __wid="yknMv6ui"><ul __wid="2pfEkTGa"><li __wid="HZgVZ2pn"><b __wid="9FF2iKjQ">Roboto:</b> 300, 300italic, 400, 400italic, 500, 500italic, 700, 700italic</li><li __wid="AFMLgWF6"><b __wid="wqD3ThjN">Roboto Mono:</b> 400, 400italic, 700, 700italic</li></ul><div __wid="dS5FsMcG"><b __wid="fF9BdCGJ">Note</b>: 400 is regular or normal weight and 700 is bold.</div></div><h3 __wid="LJ47xpqN">Variables</h3><div __wid="QJ2H38jW">Codestrates provides basic variables for some Material Design styles like colors (<a href="https://material.io/guidelines/style/color.html#color-color-palette" target="_blank" __wid="8bCvqRpq">link</a>) and shadows (<a href="https://material.io/guidelines/material-design/elevation-shadows.html#elevation-shadows-elevation-android" target="_blank" __wid="bWE3vbgP">link</a>).</div> These can be used anywhere to get a consistent color scheme and shadows for correct elevations. A list of all variables can be found in the "Material Variables" style paragraph.<h2 __wid="MFGS44cz">z-Indexes</h2><div __wid="mBvHNDZx">In the list below is an overview over the used z-indexes in the user interface of Codestrates:</div><ul __wid="NLKYkhBb"><li __wid="NjQ85Pym">500: Toast Message</li><li __wid="5uHvQQBS">450: Help Dialog</li><li __wid="VRCiRANC">400: Dialog</li><li __wid="7svLafzT">395: Loading Screen</li><li __wid="KYAnpE9u">375: Snackbar Fullscreen</li><li __wid="gu4HiTuJ">350: Transient Fullscreen</li><li __wid="PQ7YaU3j">300: Fullscreen</li><li __wid="7H7EU5EJ">250: Snackbar Expanded</li><li __wid="tXbxJTqm">200: Global Toolbar</li><li __wid="Zvm3pEsB">100: Global Menu<br __wid="mY82iQRC"/></li><li __wid="CJzB3qxw">50: Snackbar</li></ul></div></div></div></div><div class="paragraph data-paragraph locked collapsed" data-id="Cdg8V6VB" name="Properties" style __wid="uWQFDLib"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="xUksKXMg">{
  "version": "1.3.16",
  "description": "Provides the basic styling of the user interface of Codestrates.",
  "changelog": {
    "1.0": "Initital Release",
    "1.1": "Variables, Roboto and Ripple effects added. Some style adjustments for Material Design.",
    "1.2": "Basic body paragraph content styling.",
    "1.2.1": "Added documentation.",
    "1.2.2": "Material Ripple generic class.",
    "1.3": "New div structure so scrollbar is only under toolbar.",
    "1.3.1": "Adjusted width for pinned notification bar.",
    "1.3.2": "Added info, warning, danger and success boxes to writing class.",
    "1.3.3": "Updated loading and disconnect styles",
    "1.3.4": "Added momentum scrolling to #sections ✌",
    "1.3.5": "Updated section and paragraph headers to use flex (tooltips disabled).",
    "1.3.6": "Added section draggable style",
    "1.3.7": "Fixed blinking outline in header inputs.",
    "1.3.8": "Added paragraph with example of styles.",
    "1.3.9": "Fixed display style that broke default material icons style",
    "1.3.10": "Fixed style for close button",
    "1.3.11": "Using the theme's colors to style the loading and disconnected overlay.",
    "1.3.12": "Removed unnecessary select option style.",
    "1.3.13": "Fixed select style in default template.",
    "1.3.14": "Adjusted theme to match new Codestrates theme API.",
    "1.3.15": "Adjustes orange spinner to teritiary text color.",
    "1.3.16": "Fixed issue with contenteditable not selectable on iOS."
  }
}</pre></div>

<div class="paragraph style-paragraph collapsed" data-id="2KAEh4pu" draggable="false" style name="Material Font Icons" __wid="MymLcHER"><style data-type="content" type="text/css" codemirror="true" __wid="rjnKZ3xH">@font-face {
	font-family: 'Material Icons';
	font-style: normal;
	font-weight: 400;
	src: url(MaterialIcons-Regular.eot); /* For IE6-8 */
	src: local('Material Icons'),
		local('MaterialIcons-Regular'),
		url(MaterialIcons-Regular.woff2) format('woff2'),
		url(MaterialIcons-Regular.woff) format('woff'),
		url(MaterialIcons-Regular.ttf) format('truetype');
}

.material-icons {
	font-family: 'Material Icons';
	font-weight: normal;
	font-style: normal;
	font-size: 24px;  /* Preferred icon size */
	display: inline-block;
	line-height: 1;
	text-transform: none;
	letter-spacing: normal;
	word-wrap: normal;
	white-space: nowrap;
	direction: ltr;

	/* Support for all WebKit browsers. */
	-webkit-font-smoothing: antialiased;
	/* Support for Safari and Chrome. */
	text-rendering: optimizeLegibility;

	/* Support for Firefox. */
	-moz-osx-font-smoothing: grayscale;

	/* Support for IE. */
	font-feature-settings: 'liga';
}</style></div><div class="paragraph style-paragraph collapsed" data-id="ULK9sq3b" name="Material Font Icons Extended" __wid="VTPSRrBB"><style data-type="content" type="text/css" codemirror="true" __wid="d97Cf646">/* See icons: https://cdn.materialdesignicons.com/2.0.46/ */
@font-face {
	font-family: 'Material Design Icons';
	font-style: normal;
	font-weight: 400;
	src: url(materialdesignicons-webfont.eot); /* For IE6-8 */
	src: local('Material Icons'),
		local('MaterialIcons-Regular'),
		url(materialdesignicons-webfont.woff2) format('woff2'),
		url(materialdesignicons-webfont.woff) format('woff'),
		url(materialdesignicons-webfont.ttf) format('truetype');
}</style></div><div class="paragraph style-paragraph collapsed" data-id="FdbhNSLi" name="Material Font Icons Extended Variables (do not expand paragraph)" __wid="LFRkShG5"><style data-type="content" type="text/css" codemirror="true" __wid="zPWaPLVE">.material-icons {
	--access-point: "\f002";
	--access-point-network: "\f003";
	--account: "\f004";
	--account-alert: "\f005";
	--account-box: "\f006";
	--account-box-outline: "\f007";
	--account-card-details: "\f5d2";
	--account-check: "\f008";
	--account-circle: "\f009";
	--account-convert: "\f00a";
	--account-edit: "\f6bb";
	--account-key: "\f00b";
	--account-location: "\f00c";
	--account-minus: "\f00d";
	--account-multiple: "\f00e";
	--account-multiple-minus: "\f5d3";
	--account-multiple-outline: "\f00f";
	--account-multiple-plus: "\f010";
	--account-network: "\f011";
	--account-off: "\f012";
	--account-outline: "\f013";
	--account-plus: "\f014";
	--account-remove: "\f015";
	--account-search: "\f016";
	--account-settings: "\f630";
	--account-settings-variant: "\f631";
	--account-star: "\f017";
	--account-switch: "\f019";
	--adjust: "\f01a";
	--air-conditioner: "\f01b";
	--airballoon: "\f01c";
	--airplane: "\f01d";
	--airplane-landing: "\f5d4";
	--airplane-off: "\f01e";
	--airplane-takeoff: "\f5d5";
	--airplay: "\f01f";
	--alarm: "\f020";
	--alarm-bell: "\f78d";
	--alarm-check: "\f021";
	--alarm-light: "\f78e";
	--alarm-multiple: "\f022";
	--alarm-off: "\f023";
	--alarm-plus: "\f024";
	--alarm-snooze: "\f68d";
	--album: "\f025";
	--alert: "\f026";
	--alert-box: "\f027";
	--alert-circle: "\f028";
	--alert-circle-outline: "\f5d6";
	--alert-decagram: "\f6bc";
	--alert-octagon: "\f029";
	--alert-octagram: "\f766";
	--alert-outline: "\f02a";
	--all-inclusive: "\f6bd";
	--alpha: "\f02b";
	--alphabetical: "\f02c";
	--altimeter: "\f5d7";
	--amazon: "\f02d";
	--amazon-clouddrive: "\f02e";
	--ambulance: "\f02f";
	--amplifier: "\f030";
	--anchor: "\f031";
	--android: "\f032";
	--android-debug-bridge: "\f033";
	--android-head: "\f78f";
	--android-studio: "\f034";
	--angular: "\f6b1";
	--angularjs: "\f6be";
	--animation: "\f5d8";
	--apple: "\f035";
	--apple-finder: "\f036";
	--apple-ios: "\f037";
	--apple-keyboard-caps: "\f632";
	--apple-keyboard-command: "\f633";
	--apple-keyboard-control: "\f634";
	--apple-keyboard-option: "\f635";
	--apple-keyboard-shift: "\f636";
	--apple-mobileme: "\f038";
	--apple-safari: "\f039";
	--application: "\f614";
	--approval: "\f790";
	--apps: "\f03b";
	--archive: "\f03c";
	--arrange-bring-forward: "\f03d";
	--arrange-bring-to-front: "\f03e";
	--arrange-send-backward: "\f03f";
	--arrange-send-to-back: "\f040";
	--arrow-all: "\f041";
	--arrow-bottom-left: "\f042";
	--arrow-bottom-right: "\f043";
	--arrow-collapse: "\f615";
	--arrow-collapse-all: "\f044";
	--arrow-collapse-down: "\f791";
	--arrow-collapse-left: "\f792";
	--arrow-collapse-right: "\f793";
	--arrow-collapse-up: "\f794";
	--arrow-down: "\f045";
	--arrow-down-bold: "\f72d";
	--arrow-down-bold-box: "\f72e";
	--arrow-down-bold-box-outline: "\f72f";
	--arrow-down-bold-circle: "\f047";
	--arrow-down-bold-circle-outline: "\f048";
	--arrow-down-bold-hexagon-outline: "\f049";
	--arrow-down-box: "\f6bf";
	--arrow-down-drop-circle: "\f04a";
	--arrow-down-drop-circle-outline: "\f04b";
	--arrow-down-thick: "\f046";
	--arrow-expand: "\f616";
	--arrow-expand-all: "\f04c";
	--arrow-expand-down: "\f795";
	--arrow-expand-left: "\f796";
	--arrow-expand-right: "\f797";
	--arrow-expand-up: "\f798";
	--arrow-left: "\f04d";
	--arrow-left-bold: "\f730";
	--arrow-left-bold-box: "\f731";
	--arrow-left-bold-box-outline: "\f732";
	--arrow-left-bold-circle: "\f04f";
	--arrow-left-bold-circle-outline: "\f050";
	--arrow-left-bold-hexagon-outline: "\f051";
	--arrow-left-box: "\f6c0";
	--arrow-left-drop-circle: "\f052";
	--arrow-left-drop-circle-outline: "\f053";
	--arrow-left-thick: "\f04e";
	--arrow-right: "\f054";
	--arrow-right-bold: "\f733";
	--arrow-right-bold-box: "\f734";
	--arrow-right-bold-box-outline: "\f735";
	--arrow-right-bold-circle: "\f056";
	--arrow-right-bold-circle-outline: "\f057";
	--arrow-right-bold-hexagon-outline: "\f058";
	--arrow-right-box: "\f6c1";
	--arrow-right-drop-circle: "\f059";
	--arrow-right-drop-circle-outline: "\f05a";
	--arrow-right-thick: "\f055";
	--arrow-top-left: "\f05b";
	--arrow-top-right: "\f05c";
	--arrow-up: "\f05d";
	--arrow-up-bold: "\f736";
	--arrow-up-bold-box: "\f737";
	--arrow-up-bold-box-outline: "\f738";
	--arrow-up-bold-circle: "\f05f";
	--arrow-up-bold-circle-outline: "\f060";
	--arrow-up-bold-hexagon-outline: "\f061";
	--arrow-up-box: "\f6c2";
	--arrow-up-drop-circle: "\f062";
	--arrow-up-drop-circle-outline: "\f063";
	--arrow-up-thick: "\f05e";
	--assistant: "\f064";
	--asterisk: "\f6c3";
	--at: "\f065";
	--atom: "\f767";
	--attachment: "\f066";
	--audiobook: "\f067";
	--auto-fix: "\f068";
	--auto-upload: "\f069";
	--autorenew: "\f06a";
	--av-timer: "\f06b";
	--baby: "\f06c";
	--baby-buggy: "\f68e";
	--backburger: "\f06d";
	--backspace: "\f06e";
	--backup-restore: "\f06f";
	--bandcamp: "\f674";
	--bank: "\f070";
	--barcode: "\f071";
	--barcode-scan: "\f072";
	--barley: "\f073";
	--barrel: "\f074";
	--basecamp: "\f075";
	--basket: "\f076";
	--basket-fill: "\f077";
	--basket-unfill: "\f078";
	--battery: "\f079";
	--battery-10: "\f07a";
	--battery-20: "\f07b";
	--battery-30: "\f07c";
	--battery-40: "\f07d";
	--battery-50: "\f07e";
	--battery-60: "\f07f";
	--battery-70: "\f080";
	--battery-80: "\f081";
	--battery-90: "\f082";
	--battery-alert: "\f083";
	--battery-charging: "\f084";
	--battery-charging-100: "\f085";
	--battery-charging-20: "\f086";
	--battery-charging-30: "\f087";
	--battery-charging-40: "\f088";
	--battery-charging-60: "\f089";
	--battery-charging-80: "\f08a";
	--battery-charging-90: "\f08b";
	--battery-minus: "\f08c";
	--battery-negative: "\f08d";
	--battery-outline: "\f08e";
	--battery-plus: "\f08f";
	--battery-positive: "\f090";
	--battery-unknown: "\f091";
	--beach: "\f092";
	--beaker: "\f68f";
	--beats: "\f097";
	--beer: "\f098";
	--behance: "\f099";
	--bell: "\f09a";
	--bell-off: "\f09b";
	--bell-outline: "\f09c";
	--bell-plus: "\f09d";
	--bell-ring: "\f09e";
	--bell-ring-outline: "\f09f";
	--bell-sleep: "\f0a0";
	--beta: "\f0a1";
	--bible: "\f0a2";
	--bike: "\f0a3";
	--bing: "\f0a4";
	--binoculars: "\f0a5";
	--bio: "\f0a6";
	--biohazard: "\f0a7";
	--bitbucket: "\f0a8";
	--black-mesa: "\f0a9";
	--blackberry: "\f0aa";
	--blender: "\f0ab";
	--blinds: "\f0ac";
	--block-helper: "\f0ad";
	--blogger: "\f0ae";
	--bluetooth: "\f0af";
	--bluetooth-audio: "\f0b0";
	--bluetooth-connect: "\f0b1";
	--bluetooth-off: "\f0b2";
	--bluetooth-settings: "\f0b3";
	--bluetooth-transfer: "\f0b4";
	--blur: "\f0b5";
	--blur-linear: "\f0b6";
	--blur-off: "\f0b7";
	--blur-radial: "\f0b8";
	--bomb: "\f690";
	--bomb-off: "\f6c4";
	--bone: "\f0b9";
	--book: "\f0ba";
	--book-minus: "\f5d9";
	--book-multiple: "\f0bb";
	--book-multiple-variant: "\f0bc";
	--book-open: "\f0bd";
	--book-open-page-variant: "\f5da";
	--book-open-variant: "\f0be";
	--book-plus: "\f5db";
	--book-secure: "\f799";
	--book-unsecure: "\f79a";
	--book-variant: "\f0bf";
	--bookmark: "\f0c0";
	--bookmark-check: "\f0c1";
	--bookmark-music: "\f0c2";
	--bookmark-outline: "\f0c3";
	--bookmark-plus: "\f0c5";
	--bookmark-plus-outline: "\f0c4";
	--bookmark-remove: "\f0c6";
	--boombox: "\f5dc";
	--bootstrap: "\f6c5";
	--border-all: "\f0c7";
	--border-bottom: "\f0c8";
	--border-color: "\f0c9";
	--border-horizontal: "\f0ca";
	--border-inside: "\f0cb";
	--border-left: "\f0cc";
	--border-none: "\f0cd";
	--border-outside: "\f0ce";
	--border-right: "\f0cf";
	--border-style: "\f0d0";
	--border-top: "\f0d1";
	--border-vertical: "\f0d2";
	--bow-tie: "\f677";
	--bowl: "\f617";
	--bowling: "\f0d3";
	--box: "\f0d4";
	--box-cutter: "\f0d5";
	--box-shadow: "\f637";
	--bridge: "\f618";
	--briefcase: "\f0d6";
	--briefcase-check: "\f0d7";
	--briefcase-download: "\f0d8";
	--briefcase-upload: "\f0d9";
	--brightness-1: "\f0da";
	--brightness-2: "\f0db";
	--brightness-3: "\f0dc";
	--brightness-4: "\f0dd";
	--brightness-5: "\f0de";
	--brightness-6: "\f0df";
	--brightness-7: "\f0e0";
	--brightness-auto: "\f0e1";
	--broom: "\f0e2";
	--brush: "\f0e3";
	--buffer: "\f619";
	--bug: "\f0e4";
	--bulletin-board: "\f0e5";
	--bullhorn: "\f0e6";
	--bullseye: "\f5dd";
	--burst-mode: "\f5de";
	--bus: "\f0e7";
	--bus-articulated-end: "\f79b";
	--bus-articulated-front: "\f79c";
	--bus-double-decker: "\f79d";
	--bus-school: "\f79e";
	--bus-side: "\f79f";
	--cached: "\f0e8";
	--cake: "\f0e9";
	--cake-layered: "\f0ea";
	--cake-variant: "\f0eb";
	--calculator: "\f0ec";
	--calendar: "\f0ed";
	--calendar-blank: "\f0ee";
	--calendar-check: "\f0ef";
	--calendar-clock: "\f0f0";
	--calendar-multiple: "\f0f1";
	--calendar-multiple-check: "\f0f2";
	--calendar-plus: "\f0f3";
	--calendar-question: "\f691";
	--calendar-range: "\f678";
	--calendar-remove: "\f0f4";
	--calendar-text: "\f0f5";
	--calendar-today: "\f0f6";
	--call-made: "\f0f7";
	--call-merge: "\f0f8";
	--call-missed: "\f0f9";
	--call-received: "\f0fa";
	--call-split: "\f0fb";
	--camcorder: "\f0fc";
	--camcorder-box: "\f0fd";
	--camcorder-box-off: "\f0fe";
	--camcorder-off: "\f0ff";
	--camera: "\f100";
	--camera-burst: "\f692";
	--camera-enhance: "\f101";
	--camera-front: "\f102";
	--camera-front-variant: "\f103";
	--camera-gopro: "\f7a0";
	--camera-iris: "\f104";
	--camera-metering-center: "\f7a1";
	--camera-metering-matrix: "\f7a2";
	--camera-metering-partial: "\f7a3";
	--camera-metering-spot: "\f7a4";
	--camera-off: "\f5df";
	--camera-party-mode: "\f105";
	--camera-rear: "\f106";
	--camera-rear-variant: "\f107";
	--camera-switch: "\f108";
	--camera-timer: "\f109";
	--cancel: "\f739";
	--candle: "\f5e2";
	--candycane: "\f10a";
	--cannabis: "\f7a5";
	--car: "\f10b";
	--car-battery: "\f10c";
	--car-connected: "\f10d";
	--car-convertable: "\f7a6";
	--car-estate: "\f7a7";
	--car-hatchback: "\f7a8";
	--car-pickup: "\f7a9";
	--car-side: "\f7aa";
	--car-sports: "\f7ab";
	--car-wash: "\f10e";
	--caravan: "\f7ac";
	--cards: "\f638";
	--cards-outline: "\f639";
	--cards-playing-outline: "\f63a";
	--cards-variant: "\f6c6";
	--carrot: "\f10f";
	--cart: "\f110";
	--cart-off: "\f66b";
	--cart-outline: "\f111";
	--cart-plus: "\f112";
	--case-sensitive-alt: "\f113";
	--cash: "\f114";
	--cash-100: "\f115";
	--cash-multiple: "\f116";
	--cash-usd: "\f117";
	--cast: "\f118";
	--cast-connected: "\f119";
	--cast-off: "\f789";
	--castle: "\f11a";
	--cat: "\f11b";
	--cctv: "\f7ad";
	--ceiling-light: "\f768";
	--cellphone: "\f11c";
	--cellphone-android: "\f11d";
	--cellphone-basic: "\f11e";
	--cellphone-dock: "\f11f";
	--cellphone-iphone: "\f120";
	--cellphone-link: "\f121";
	--cellphone-link-off: "\f122";
	--cellphone-settings: "\f123";
	--certificate: "\f124";
	--chair-school: "\f125";
	--chart-arc: "\f126";
	--chart-areaspline: "\f127";
	--chart-bar: "\f128";
	--chart-bar-stacked: "\f769";
	--chart-bubble: "\f5e3";
	--chart-donut: "\f7ae";
	--chart-donut-variant: "\f7af";
	--chart-gantt: "\f66c";
	--chart-histogram: "\f129";
	--chart-line: "\f12a";
	--chart-line-stacked: "\f76a";
	--chart-line-variant: "\f7b0";
	--chart-pie: "\f12b";
	--chart-scatterplot-hexbin: "\f66d";
	--chart-timeline: "\f66e";
	--check: "\f12c";
	--check-all: "\f12d";
	--check-circle: "\f5e0";
	--check-circle-outline: "\f5e1";
	--checkbox-blank: "\f12e";
	--checkbox-blank-circle: "\f12f";
	--checkbox-blank-circle-outline: "\f130";
	--checkbox-blank-outline: "\f131";
	--checkbox-marked: "\f132";
	--checkbox-marked-circle: "\f133";
	--checkbox-marked-circle-outline: "\f134";
	--checkbox-marked-outline: "\f135";
	--checkbox-multiple-blank: "\f136";
	--checkbox-multiple-blank-circle: "\f63b";
	--checkbox-multiple-blank-circle-outline: "\f63c";
	--checkbox-multiple-blank-outline: "\f137";
	--checkbox-multiple-marked: "\f138";
	--checkbox-multiple-marked-circle: "\f63d";
	--checkbox-multiple-marked-circle-outline: "\f63e";
	--checkbox-multiple-marked-outline: "\f139";
	--checkerboard: "\f13a";
	--chemical-weapon: "\f13b";
	--chevron-double-down: "\f13c";
	--chevron-double-left: "\f13d";
	--chevron-double-right: "\f13e";
	--chevron-double-up: "\f13f";
	--chevron-down: "\f140";
	--chevron-left: "\f141";
	--chevron-right: "\f142";
	--chevron-up: "\f143";
	--chili-hot: "\f7b1";
	--chili-medium: "\f7b2";
	--chili-mild: "\f7b3";
	--chip: "\f61a";
	--church: "\f144";
	--circle: "\f764";
	--circle-outline: "\f765";
	--cisco-webex: "\f145";
	--city: "\f146";
	--clipboard: "\f147";
	--clipboard-account: "\f148";
	--clipboard-alert: "\f149";
	--clipboard-arrow-down: "\f14a";
	--clipboard-arrow-left: "\f14b";
	--clipboard-check: "\f14c";
	--clipboard-flow: "\f6c7";
	--clipboard-outline: "\f14d";
	--clipboard-plus: "\f750";
	--clipboard-text: "\f14e";
	--clippy: "\f14f";
	--clock: "\f150";
	--clock-alert: "\f5ce";
	--clock-end: "\f151";
	--clock-fast: "\f152";
	--clock-in: "\f153";
	--clock-out: "\f154";
	--clock-start: "\f155";
	--close: "\f156";
	--close-box: "\f157";
	--close-box-outline: "\f158";
	--close-circle: "\f159";
	--close-circle-outline: "\f15a";
	--close-network: "\f15b";
	--close-octagon: "\f15c";
	--close-octagon-outline: "\f15d";
	--close-outline: "\f6c8";
	--closed-caption: "\f15e";
	--cloud: "\f15f";
	--cloud-braces: "\f7b4";
	--cloud-check: "\f160";
	--cloud-circle: "\f161";
	--cloud-download: "\f162";
	--cloud-off-outline: "\f164";
	--cloud-outline: "\f163";
	--cloud-print: "\f165";
	--cloud-print-outline: "\f166";
	--cloud-sync: "\f63f";
	--cloud-tags: "\f7b5";
	--cloud-upload: "\f167";
	--code-array: "\f168";
	--code-braces: "\f169";
	--code-brackets: "\f16a";
	--code-equal: "\f16b";
	--code-greater-than: "\f16c";
	--code-greater-than-or-equal: "\f16d";
	--code-less-than: "\f16e";
	--code-less-than-or-equal: "\f16f";
	--code-not-equal: "\f170";
	--code-not-equal-variant: "\f171";
	--code-parentheses: "\f172";
	--code-string: "\f173";
	--code-tags: "\f174";
	--code-tags-check: "\f693";
	--codepen: "\f175";
	--coffee: "\f176";
	--coffee-outline: "\f6c9";
	--coffee-to-go: "\f177";
	--coin: "\f178";
	--coins: "\f694";
	--collage: "\f640";
	--color-helper: "\f179";
	--comment: "\f17a";
	--comment-account: "\f17b";
	--comment-account-outline: "\f17c";
	--comment-alert: "\f17d";
	--comment-alert-outline: "\f17e";
	--comment-check: "\f17f";
	--comment-check-outline: "\f180";
	--comment-multiple-outline: "\f181";
	--comment-outline: "\f182";
	--comment-plus-outline: "\f183";
	--comment-processing: "\f184";
	--comment-processing-outline: "\f185";
	--comment-question-outline: "\f186";
	--comment-remove-outline: "\f187";
	--comment-text: "\f188";
	--comment-text-outline: "\f189";
	--compare: "\f18a";
	--compass: "\f18b";
	--compass-outline: "\f18c";
	--console: "\f18d";
	--console-line: "\f7b6";
	--contact-mail: "\f18e";
	--contacts: "\f6ca";
	--content-copy: "\f18f";
	--content-cut: "\f190";
	--content-duplicate: "\f191";
	--content-paste: "\f192";
	--content-save: "\f193";
	--content-save-all: "\f194";
	--content-save-settings: "\f61b";
	--contrast: "\f195";
	--contrast-box: "\f196";
	--contrast-circle: "\f197";
	--cookie: "\f198";
	--copyright: "\f5e6";
	--corn: "\f7b7";
	--counter: "\f199";
	--cow: "\f19a";
	--creation: "\f1c9";
	--credit-card: "\f19b";
	--credit-card-multiple: "\f19c";
	--credit-card-off: "\f5e4";
	--credit-card-plus: "\f675";
	--credit-card-scan: "\f19d";
	--crop: "\f19e";
	--crop-free: "\f19f";
	--crop-landscape: "\f1a0";
	--crop-portrait: "\f1a1";
	--crop-rotate: "\f695";
	--crop-square: "\f1a2";
	--crosshairs: "\f1a3";
	--crosshairs-gps: "\f1a4";
	--crown: "\f1a5";
	--cube: "\f1a6";
	--cube-outline: "\f1a7";
	--cube-send: "\f1a8";
	--cube-unfolded: "\f1a9";
	--cup: "\f1aa";
	--cup-off: "\f5e5";
	--cup-water: "\f1ab";
	--currency-btc: "\f1ac";
	--currency-chf: "\f7b8";
	--currency-cny: "\f7b9";
	--currency-eth: "\f7ba";
	--currency-eur: "\f1ad";
	--currency-gbp: "\f1ae";
	--currency-inr: "\f1af";
	--currency-jpy: "\f7bb";
	--currency-krw: "\f7bc";
	--currency-ngn: "\f1b0";
	--currency-rub: "\f1b1";
	--currency-sign: "\f7bd";
	--currency-try: "\f1b2";
	--currency-twd: "\f7be";
	--currency-usd: "\f1b3";
	--currency-usd-off: "\f679";
	--cursor-default: "\f1b4";
	--cursor-default-outline: "\f1b5";
	--cursor-move: "\f1b6";
	--cursor-pointer: "\f1b7";
	--cursor-text: "\f5e7";
	--database: "\f1b8";
	--database-minus: "\f1b9";
	--database-plus: "\f1ba";
	--debug-step-into: "\f1bb";
	--debug-step-out: "\f1bc";
	--debug-step-over: "\f1bd";
	--decagram: "\f76b";
	--decagram-outline: "\f76c";
	--decimal-decrease: "\f1be";
	--decimal-increase: "\f1bf";
	--delete: "\f1c0";
	--delete-circle: "\f682";
	--delete-empty: "\f6cb";
	--delete-forever: "\f5e8";
	--delete-sweep: "\f5e9";
	--delete-variant: "\f1c1";
	--delta: "\f1c2";
	--deskphone: "\f1c3";
	--desktop-classic: "\f7bf";
	--desktop-mac: "\f1c4";
	--desktop-tower: "\f1c5";
	--details: "\f1c6";
	--developer-board: "\f696";
	--deviantart: "\f1c7";
	--dialpad: "\f61c";
	--diamond: "\f1c8";
	--dice-1: "\f1ca";
	--dice-2: "\f1cb";
	--dice-3: "\f1cc";
	--dice-4: "\f1cd";
	--dice-5: "\f1ce";
	--dice-6: "\f1cf";
	--dice-d10: "\f76e";
	--dice-d20: "\f5ea";
	--dice-d4: "\f5eb";
	--dice-d6: "\f5ec";
	--dice-d8: "\f5ed";
	--dice-multiple: "\f76d";
	--dictionary: "\f61d";
	--dip-switch: "\f7c0";
	--directions: "\f1d0";
	--directions-fork: "\f641";
	--discord: "\f66f";
	--disk: "\f5ee";
	--disk-alert: "\f1d1";
	--disqus: "\f1d2";
	--disqus-outline: "\f1d3";
	--division: "\f1d4";
	--division-box: "\f1d5";
	--dna: "\f683";
	--dns: "\f1d6";
	--do-not-disturb: "\f697";
	--do-not-disturb-off: "\f698";
	--dolby: "\f6b2";
	--domain: "\f1d7";
	--donkey: "\f7c1";
	--dots-horizontal: "\f1d8";
	--dots-horizontal-circle: "\f7c2";
	--dots-vertical: "\f1d9";
	--dots-vertical-circle: "\f7c3";
	--douban: "\f699";
	--download: "\f1da";
	--download-network: "\f6f3";
	--drag: "\f1db";
	--drag-horizontal: "\f1dc";
	--drag-vertical: "\f1dd";
	--drawing: "\f1de";
	--drawing-box: "\f1df";
	--dribbble: "\f1e0";
	--dribbble-box: "\f1e1";
	--drone: "\f1e2";
	--dropbox: "\f1e3";
	--drupal: "\f1e4";
	--duck: "\f1e5";
	--dumbbell: "\f1e6";
	--ear-hearing: "\f7c4";
	--earth: "\f1e7";
	--earth-box: "\f6cc";
	--earth-box-off: "\f6cd";
	--earth-off: "\f1e8";
	--edge: "\f1e9";
	--eject: "\f1ea";
	--elephant: "\f7c5";
	--elevation-decline: "\f1eb";
	--elevation-rise: "\f1ec";
	--elevator: "\f1ed";
	--email: "\f1ee";
	--email-alert: "\f6ce";
	--email-open: "\f1ef";
	--email-open-outline: "\f5ef";
	--email-outline: "\f1f0";
	--email-secure: "\f1f1";
	--email-variant: "\f5f0";
	--emby: "\f6b3";
	--emoticon: "\f1f2";
	--emoticon-cool: "\f1f3";
	--emoticon-dead: "\f69a";
	--emoticon-devil: "\f1f4";
	--emoticon-excited: "\f69b";
	--emoticon-happy: "\f1f5";
	--emoticon-neutral: "\f1f6";
	--emoticon-poop: "\f1f7";
	--emoticon-sad: "\f1f8";
	--emoticon-tongue: "\f1f9";
	--engine: "\f1fa";
	--engine-outline: "\f1fb";
	--equal: "\f1fc";
	--equal-box: "\f1fd";
	--eraser: "\f1fe";
	--eraser-variant: "\f642";
	--escalator: "\f1ff";
	--ethernet: "\f200";
	--ethernet-cable: "\f201";
	--ethernet-cable-off: "\f202";
	--etsy: "\f203";
	--ev-station: "\f5f1";
	--eventbrite: "\f7c6";
	--evernote: "\f204";
	--exclamation: "\f205";
	--exit-to-app: "\f206";
	--export: "\f207";
	--eye: "\f208";
	--eye-off: "\f209";
	--eye-off-outline: "\f6d0";
	--eye-outline: "\f6cf";
	--eyedropper: "\f20a";
	--eyedropper-variant: "\f20b";
	--face: "\f643";
	--face-profile: "\f644";
	--facebook: "\f20c";
	--facebook-box: "\f20d";
	--facebook-messenger: "\f20e";
	--factory: "\f20f";
	--fan: "\f210";
	--fast-forward: "\f211";
	--fast-forward-outline: "\f6d1";
	--fax: "\f212";
	--feather: "\f6d2";
	--ferry: "\f213";
	--file: "\f214";
	--file-account: "\f73a";
	--file-chart: "\f215";
	--file-check: "\f216";
	--file-cloud: "\f217";
	--file-delimited: "\f218";
	--file-document: "\f219";
	--file-document-box: "\f21a";
	--file-excel: "\f21b";
	--file-excel-box: "\f21c";
	--file-export: "\f21d";
	--file-find: "\f21e";
	--file-hidden: "\f613";
	--file-image: "\f21f";
	--file-import: "\f220";
	--file-lock: "\f221";
	--file-multiple: "\f222";
	--file-music: "\f223";
	--file-outline: "\f224";
	--file-pdf: "\f225";
	--file-pdf-box: "\f226";
	--file-plus: "\f751";
	--file-powerpoint: "\f227";
	--file-powerpoint-box: "\f228";
	--file-presentation-box: "\f229";
	--file-restore: "\f670";
	--file-send: "\f22a";
	--file-tree: "\f645";
	--file-video: "\f22b";
	--file-word: "\f22c";
	--file-word-box: "\f22d";
	--file-xml: "\f22e";
	--film: "\f22f";
	--filmstrip: "\f230";
	--filmstrip-off: "\f231";
	--filter: "\f232";
	--filter-outline: "\f233";
	--filter-remove: "\f234";
	--filter-remove-outline: "\f235";
	--filter-variant: "\f236";
	--find-replace: "\f6d3";
	--fingerprint: "\f237";
	--fire: "\f238";
	--firefox: "\f239";
	--fish: "\f23a";
	--flag: "\f23b";
	--flag-checkered: "\f23c";
	--flag-outline: "\f23d";
	--flag-outline-variant: "\f23e";
	--flag-triangle: "\f23f";
	--flag-variant: "\f240";
	--flash: "\f241";
	--flash-auto: "\f242";
	--flash-off: "\f243";
	--flash-outline: "\f6d4";
	--flash-red-eye: "\f67a";
	--flashlight: "\f244";
	--flashlight-off: "\f245";
	--flask: "\f093";
	--flask-empty: "\f094";
	--flask-empty-outline: "\f095";
	--flask-outline: "\f096";
	--flattr: "\f246";
	--flip-to-back: "\f247";
	--flip-to-front: "\f248";
	--floppy: "\f249";
	--flower: "\f24a";
	--folder: "\f24b";
	--folder-account: "\f24c";
	--folder-download: "\f24d";
	--folder-google-drive: "\f24e";
	--folder-image: "\f24f";
	--folder-lock: "\f250";
	--folder-lock-open: "\f251";
	--folder-move: "\f252";
	--folder-multiple: "\f253";
	--folder-multiple-image: "\f254";
	--folder-multiple-outline: "\f255";
	--folder-open: "\f76f";
	--folder-outline: "\f256";
	--folder-plus: "\f257";
	--folder-remove: "\f258";
	--folder-star: "\f69c";
	--folder-upload: "\f259";
	--font-awesome: "\f03a";
	--food: "\f25a";
	--food-apple: "\f25b";
	--food-croissant: "\f7c7";
	--food-fork-drink: "\f5f2";
	--food-off: "\f5f3";
	--food-variant: "\f25c";
	--football: "\f25d";
	--football-australian: "\f25e";
	--football-helmet: "\f25f";
	--forklift: "\f7c8";
	--format-align-bottom: "\f752";
	--format-align-center: "\f260";
	--format-align-justify: "\f261";
	--format-align-left: "\f262";
	--format-align-middle: "\f753";
	--format-align-right: "\f263";
	--format-align-top: "\f754";
	--format-annotation-plus: "\f646";
	--format-bold: "\f264";
	--format-clear: "\f265";
	--format-color-fill: "\f266";
	--format-color-text: "\f69d";
	--format-float-center: "\f267";
	--format-float-left: "\f268";
	--format-float-none: "\f269";
	--format-float-right: "\f26a";
	--format-font: "\f6d5";
	--format-header-1: "\f26b";
	--format-header-2: "\f26c";
	--format-header-3: "\f26d";
	--format-header-4: "\f26e";
	--format-header-5: "\f26f";
	--format-header-6: "\f270";
	--format-header-decrease: "\f271";
	--format-header-equal: "\f272";
	--format-header-increase: "\f273";
	--format-header-pound: "\f274";
	--format-horizontal-align-center: "\f61e";
	--format-horizontal-align-left: "\f61f";
	--format-horizontal-align-right: "\f620";
	--format-indent-decrease: "\f275";
	--format-indent-increase: "\f276";
	--format-italic: "\f277";
	--format-line-spacing: "\f278";
	--format-line-style: "\f5c8";
	--format-line-weight: "\f5c9";
	--format-list-bulleted: "\f279";
	--format-list-bulleted-type: "\f27a";
	--format-list-checks: "\f755";
	--format-list-numbers: "\f27b";
	--format-page-break: "\f6d6";
	--format-paint: "\f27c";
	--format-paragraph: "\f27d";
	--format-pilcrow: "\f6d7";
	--format-quote-close: "\f27e";
	--format-quote-open: "\f756";
	--format-rotate-90: "\f6a9";
	--format-section: "\f69e";
	--format-size: "\f27f";
	--format-strikethrough: "\f280";
	--format-strikethrough-variant: "\f281";
	--format-subscript: "\f282";
	--format-superscript: "\f283";
	--format-text: "\f284";
	--format-textdirection-l-to-r: "\f285";
	--format-textdirection-r-to-l: "\f286";
	--format-title: "\f5f4";
	--format-underline: "\f287";
	--format-vertical-align-bottom: "\f621";
	--format-vertical-align-center: "\f622";
	--format-vertical-align-top: "\f623";
	--format-wrap-inline: "\f288";
	--format-wrap-square: "\f289";
	--format-wrap-tight: "\f28a";
	--format-wrap-top-bottom: "\f28b";
	--forum: "\f28c";
	--forward: "\f28d";
	--foursquare: "\f28e";
	--fridge: "\f28f";
	--fridge-filled: "\f290";
	--fridge-filled-bottom: "\f291";
	--fridge-filled-top: "\f292";
	--fuel: "\f7c9";
	--fullscreen: "\f293";
	--fullscreen-exit: "\f294";
	--function: "\f295";
	--gamepad: "\f296";
	--gamepad-variant: "\f297";
	--garage: "\f6d8";
	--garage-open: "\f6d9";
	--gas-cylinder: "\f647";
	--gas-station: "\f298";
	--gate: "\f299";
	--gauge: "\f29a";
	--gavel: "\f29b";
	--gender-female: "\f29c";
	--gender-male: "\f29d";
	--gender-male-female: "\f29e";
	--gender-transgender: "\f29f";
	--gesture: "\f7ca";
	--gesture-double-tap: "\f73b";
	--gesture-swipe-down: "\f73c";
	--gesture-swipe-left: "\f73d";
	--gesture-swipe-right: "\f73e";
	--gesture-swipe-up: "\f73f";
	--gesture-tap: "\f740";
	--gesture-two-double-tap: "\f741";
	--gesture-two-tap: "\f742";
	--ghost: "\f2a0";
	--gift: "\f2a1";
	--git: "\f2a2";
	--github-box: "\f2a3";
	--github-circle: "\f2a4";
	--github-face: "\f6da";
	--glass-flute: "\f2a5";
	--glass-mug: "\f2a6";
	--glass-stange: "\f2a7";
	--glass-tulip: "\f2a8";
	--glassdoor: "\f2a9";
	--glasses: "\f2aa";
	--gmail: "\f2ab";
	--gnome: "\f2ac";
	--gondola: "\f685";
	--google: "\f2ad";
	--google-analytics: "\f7cb";
	--google-assistant: "\f7cc";
	--google-cardboard: "\f2ae";
	--google-chrome: "\f2af";
	--google-circles: "\f2b0";
	--google-circles-communities: "\f2b1";
	--google-circles-extended: "\f2b2";
	--google-circles-group: "\f2b3";
	--google-controller: "\f2b4";
	--google-controller-off: "\f2b5";
	--google-drive: "\f2b6";
	--google-earth: "\f2b7";
	--google-glass: "\f2b8";
	--google-keep: "\f6db";
	--google-maps: "\f5f5";
	--google-nearby: "\f2b9";
	--google-pages: "\f2ba";
	--google-photos: "\f6dc";
	--google-physical-web: "\f2bb";
	--google-play: "\f2bc";
	--google-plus: "\f2bd";
	--google-plus-box: "\f2be";
	--google-translate: "\f2bf";
	--google-wallet: "\f2c0";
	--gradient: "\f69f";
	--grease-pencil: "\f648";
	--grid: "\f2c1";
	--grid-large: "\f757";
	--grid-off: "\f2c2";
	--group: "\f2c3";
	--guitar-acoustic: "\f770";
	--guitar-electric: "\f2c4";
	--guitar-pick: "\f2c5";
	--guitar-pick-outline: "\f2c6";
	--hackernews: "\f624";
	--hamburger: "\f684";
	--hand-pointing-right: "\f2c7";
	--hanger: "\f2c8";
	--hangouts: "\f2c9";
	--harddisk: "\f2ca";
	--headphones: "\f2cb";
	--headphones-box: "\f2cc";
	--headphones-off: "\f7cd";
	--headphones-settings: "\f2cd";
	--headset: "\f2ce";
	--headset-dock: "\f2cf";
	--headset-off: "\f2d0";
	--heart: "\f2d1";
	--heart-box: "\f2d2";
	--heart-box-outline: "\f2d3";
	--heart-broken: "\f2d4";
	--heart-half: "\f6de";
	--heart-half-full: "\f6dd";
	--heart-half-outline: "\f6df";
	--heart-off: "\f758";
	--heart-outline: "\f2d5";
	--heart-pulse: "\f5f6";
	--help: "\f2d6";
	--help-box: "\f78a";
	--help-circle: "\f2d7";
	--help-circle-outline: "\f625";
	--help-network: "\f6f4";
	--hexagon: "\f2d8";
	--hexagon-multiple: "\f6e0";
	--hexagon-outline: "\f2d9";
	--high-definition: "\f7ce";
	--highway: "\f5f7";
	--history: "\f2da";
	--hololens: "\f2db";
	--home: "\f2dc";
	--home-assistant: "\f7cf";
	--home-automation: "\f7d0";
	--home-circle: "\f7d1";
	--home-map-marker: "\f5f8";
	--home-modern: "\f2dd";
	--home-outline: "\f6a0";
	--home-variant: "\f2de";
	--hook: "\f6e1";
	--hook-off: "\f6e2";
	--hops: "\f2df";
	--hospital: "\f2e0";
	--hospital-building: "\f2e1";
	--hospital-marker: "\f2e2";
	--hotel: "\f2e3";
	--houzz: "\f2e4";
	--houzz-box: "\f2e5";
	--human: "\f2e6";
	--human-child: "\f2e7";
	--human-female: "\f649";
	--human-greeting: "\f64a";
	--human-handsdown: "\f64b";
	--human-handsup: "\f64c";
	--human-male: "\f64d";
	--human-male-female: "\f2e8";
	--human-pregnant: "\f5cf";
	--humble-bundle: "\f743";
	--image: "\f2e9";
	--image-album: "\f2ea";
	--image-area: "\f2eb";
	--image-area-close: "\f2ec";
	--image-broken: "\f2ed";
	--image-broken-variant: "\f2ee";
	--image-filter: "\f2ef";
	--image-filter-black-white: "\f2f0";
	--image-filter-center-focus: "\f2f1";
	--image-filter-center-focus-weak: "\f2f2";
	--image-filter-drama: "\f2f3";
	--image-filter-frames: "\f2f4";
	--image-filter-hdr: "\f2f5";
	--image-filter-none: "\f2f6";
	--image-filter-tilt-shift: "\f2f7";
	--image-filter-vintage: "\f2f8";
	--image-multiple: "\f2f9";
	--import: "\f2fa";
	--inbox: "\f686";
	--inbox-arrow-down: "\f2fb";
	--inbox-arrow-up: "\f3d1";
	--incognito: "\f5f9";
	--infinity: "\f6e3";
	--information: "\f2fc";
	--information-outline: "\f2fd";
	--information-variant: "\f64e";
	--instagram: "\f2fe";
	--instapaper: "\f2ff";
	--internet-explorer: "\f300";
	--invert-colors: "\f301";
	--itunes: "\f676";
	--jeepney: "\f302";
	--jira: "\f303";
	--jsfiddle: "\f304";
	--json: "\f626";
	--keg: "\f305";
	--kettle: "\f5fa";
	--key: "\f306";
	--key-change: "\f307";
	--key-minus: "\f308";
	--key-plus: "\f309";
	--key-remove: "\f30a";
	--key-variant: "\f30b";
	--keyboard: "\f30c";
	--keyboard-backspace: "\f30d";
	--keyboard-caps: "\f30e";
	--keyboard-close: "\f30f";
	--keyboard-off: "\f310";
	--keyboard-return: "\f311";
	--keyboard-tab: "\f312";
	--keyboard-variant: "\f313";
	--kickstarter: "\f744";
	--kodi: "\f314";
	--label: "\f315";
	--label-outline: "\f316";
	--lambda: "\f627";
	--lamp: "\f6b4";
	--lan: "\f317";
	--lan-connect: "\f318";
	--lan-disconnect: "\f319";
	--lan-pending: "\f31a";
	--language-c: "\f671";
	--language-cpp: "\f672";
	--language-csharp: "\f31b";
	--language-css3: "\f31c";
	--language-go: "\f7d2";
	--language-html5: "\f31d";
	--language-javascript: "\f31e";
	--language-php: "\f31f";
	--language-python: "\f320";
	--language-python-text: "\f321";
	--language-r: "\f7d3";
	--language-swift: "\f6e4";
	--language-typescript: "\f6e5";
	--laptop: "\f322";
	--laptop-chromebook: "\f323";
	--laptop-mac: "\f324";
	--laptop-off: "\f6e6";
	--laptop-windows: "\f325";
	--lastfm: "\f326";
	--launch: "\f327";
	--lava-lamp: "\f7d4";
	--layers: "\f328";
	--layers-off: "\f329";
	--lead-pencil: "\f64f";
	--leaf: "\f32a";
	--led-off: "\f32b";
	--led-on: "\f32c";
	--led-outline: "\f32d";
	--led-strip: "\f7d5";
	--led-variant-off: "\f32e";
	--led-variant-on: "\f32f";
	--led-variant-outline: "\f330";
	--library: "\f331";
	--library-books: "\f332";
	--library-music: "\f333";
	--library-plus: "\f334";
	--lightbulb: "\f335";
	--lightbulb-on: "\f6e7";
	--lightbulb-on-outline: "\f6e8";
	--lightbulb-outline: "\f336";
	--link: "\f337";
	--link-off: "\f338";
	--link-variant: "\f339";
	--link-variant-off: "\f33a";
	--linkedin: "\f33b";
	--linkedin-box: "\f33c";
	--linux: "\f33d";
	--loading: "\f771";
	--lock: "\f33e";
	--lock-open: "\f33f";
	--lock-open-outline: "\f340";
	--lock-outline: "\f341";
	--lock-pattern: "\f6e9";
	--lock-plus: "\f5fb";
	--lock-reset: "\f772";
	--locker: "\f7d6";
	--locker-multiple: "\f7d7";
	--login: "\f342";
	--login-variant: "\f5fc";
	--logout: "\f343";
	--logout-variant: "\f5fd";
	--looks: "\f344";
	--loop: "\f6ea";
	--loupe: "\f345";
	--lumx: "\f346";
	--magnet: "\f347";
	--magnet-on: "\f348";
	--magnify: "\f349";
	--magnify-minus: "\f34a";
	--magnify-minus-outline: "\f6eb";
	--magnify-plus: "\f34b";
	--magnify-plus-outline: "\f6ec";
	--mail-ru: "\f34c";
	--mailbox: "\f6ed";
	--map: "\f34d";
	--map-marker: "\f34e";
	--map-marker-circle: "\f34f";
	--map-marker-minus: "\f650";
	--map-marker-multiple: "\f350";
	--map-marker-off: "\f351";
	--map-marker-outline: "\f7d8";
	--map-marker-plus: "\f651";
	--map-marker-radius: "\f352";
	--margin: "\f353";
	--markdown: "\f354";
	--marker: "\f652";
	--marker-check: "\f355";
	--martini: "\f356";
	--material-ui: "\f357";
	--math-compass: "\f358";
	--matrix: "\f628";
	--maxcdn: "\f359";
	--medical-bag: "\f6ee";
	--medium: "\f35a";
	--memory: "\f35b";
	--menu: "\f35c";
	--menu-down: "\f35d";
	--menu-down-outline: "\f6b5";
	--menu-left: "\f35e";
	--menu-right: "\f35f";
	--menu-up: "\f360";
	--menu-up-outline: "\f6b6";
	--message: "\f361";
	--message-alert: "\f362";
	--message-bulleted: "\f6a1";
	--message-bulleted-off: "\f6a2";
	--message-draw: "\f363";
	--message-image: "\f364";
	--message-outline: "\f365";
	--message-plus: "\f653";
	--message-processing: "\f366";
	--message-reply: "\f367";
	--message-reply-text: "\f368";
	--message-settings: "\f6ef";
	--message-settings-variant: "\f6f0";
	--message-text: "\f369";
	--message-text-outline: "\f36a";
	--message-video: "\f36b";
	--meteor: "\f629";
	--metronome: "\f7d9";
	--metronome-tick: "\f7da";
	--micro-sd: "\f7db";
	--microphone: "\f36c";
	--microphone-off: "\f36d";
	--microphone-outline: "\f36e";
	--microphone-settings: "\f36f";
	--microphone-variant: "\f370";
	--microphone-variant-off: "\f371";
	--microscope: "\f654";
	--microsoft: "\f372";
	--minecraft: "\f373";
	--minus: "\f374";
	--minus-box: "\f375";
	--minus-box-outline: "\f6f1";
	--minus-circle: "\f376";
	--minus-circle-outline: "\f377";
	--minus-network: "\f378";
	--mixcloud: "\f62a";
	--mixer: "\f7dc";
	--monitor: "\f379";
	--monitor-multiple: "\f37a";
	--more: "\f37b";
	--motorbike: "\f37c";
	--mouse: "\f37d";
	--mouse-off: "\f37e";
	--mouse-variant: "\f37f";
	--mouse-variant-off: "\f380";
	--move-resize: "\f655";
	--move-resize-variant: "\f656";
	--movie: "\f381";
	--movie-roll: "\f7dd";
	--multiplication: "\f382";
	--multiplication-box: "\f383";
	--mushroom: "\f7de";
	--mushroom-outline: "\f7df";
	--music: "\f759";
	--music-box: "\f384";
	--music-box-outline: "\f385";
	--music-circle: "\f386";
	--music-note: "\f387";
	--music-note-bluetooth: "\f5fe";
	--music-note-bluetooth-off: "\f5ff";
	--music-note-eighth: "\f388";
	--music-note-half: "\f389";
	--music-note-off: "\f38a";
	--music-note-quarter: "\f38b";
	--music-note-sixteenth: "\f38c";
	--music-note-whole: "\f38d";
	--music-off: "\f75a";
	--nature: "\f38e";
	--nature-people: "\f38f";
	--navigation: "\f390";
	--near-me: "\f5cd";
	--needle: "\f391";
	--nest-protect: "\f392";
	--nest-thermostat: "\f393";
	--netflix: "\f745";
	--network: "\f6f2";
	--new-box: "\f394";
	--newspaper: "\f395";
	--nfc: "\f396";
	--nfc-tap: "\f397";
	--nfc-variant: "\f398";
	--ninja: "\f773";
	--nintendo-switch: "\f7e0";
	--nodejs: "\f399";
	--note: "\f39a";
	--note-multiple: "\f6b7";
	--note-multiple-outline: "\f6b8";
	--note-outline: "\f39b";
	--note-plus: "\f39c";
	--note-plus-outline: "\f39d";
	--note-text: "\f39e";
	--notification-clear-all: "\f39f";
	--npm: "\f6f6";
	--nuke: "\f6a3";
	--null: "\f7e1";
	--numeric: "\f3a0";
	--numeric-0-box: "\f3a1";
	--numeric-0-box-multiple-outline: "\f3a2";
	--numeric-0-box-outline: "\f3a3";
	--numeric-1-box: "\f3a4";
	--numeric-1-box-multiple-outline: "\f3a5";
	--numeric-1-box-outline: "\f3a6";
	--numeric-2-box: "\f3a7";
	--numeric-2-box-multiple-outline: "\f3a8";
	--numeric-2-box-outline: "\f3a9";
	--numeric-3-box: "\f3aa";
	--numeric-3-box-multiple-outline: "\f3ab";
	--numeric-3-box-outline: "\f3ac";
	--numeric-4-box: "\f3ad";
	--numeric-4-box-multiple-outline: "\f3ae";
	--numeric-4-box-outline: "\f3af";
	--numeric-5-box: "\f3b0";
	--numeric-5-box-multiple-outline: "\f3b1";
	--numeric-5-box-outline: "\f3b2";
	--numeric-6-box: "\f3b3";
	--numeric-6-box-multiple-outline: "\f3b4";
	--numeric-6-box-outline: "\f3b5";
	--numeric-7-box: "\f3b6";
	--numeric-7-box-multiple-outline: "\f3b7";
	--numeric-7-box-outline: "\f3b8";
	--numeric-8-box: "\f3b9";
	--numeric-8-box-multiple-outline: "\f3ba";
	--numeric-8-box-outline: "\f3bb";
	--numeric-9-box: "\f3bc";
	--numeric-9-box-multiple-outline: "\f3bd";
	--numeric-9-box-outline: "\f3be";
	--numeric-9-plus-box: "\f3bf";
	--numeric-9-plus-box-multiple-outline: "\f3c0";
	--numeric-9-plus-box-outline: "\f3c1";
	--nut: "\f6f7";
	--nutrition: "\f3c2";
	--oar: "\f67b";
	--octagon: "\f3c3";
	--octagon-outline: "\f3c4";
	--octagram: "\f6f8";
	--octagram-outline: "\f774";
	--odnoklassniki: "\f3c5";
	--office: "\f3c6";
	--oil: "\f3c7";
	--oil-temperature: "\f3c8";
	--omega: "\f3c9";
	--onedrive: "\f3ca";
	--onenote: "\f746";
	--opacity: "\f5cc";
	--open-in-app: "\f3cb";
	--open-in-new: "\f3cc";
	--openid: "\f3cd";
	--opera: "\f3ce";
	--orbit: "\f018";
	--ornament: "\f3cf";
	--ornament-variant: "\f3d0";
	--owl: "\f3d2";
	--package: "\f3d3";
	--package-down: "\f3d4";
	--package-up: "\f3d5";
	--package-variant: "\f3d6";
	--package-variant-closed: "\f3d7";
	--page-first: "\f600";
	--page-last: "\f601";
	--page-layout-body: "\f6f9";
	--page-layout-footer: "\f6fa";
	--page-layout-header: "\f6fb";
	--page-layout-sidebar-left: "\f6fc";
	--page-layout-sidebar-right: "\f6fd";
	--palette: "\f3d8";
	--palette-advanced: "\f3d9";
	--panda: "\f3da";
	--pandora: "\f3db";
	--panorama: "\f3dc";
	--panorama-fisheye: "\f3dd";
	--panorama-horizontal: "\f3de";
	--panorama-vertical: "\f3df";
	--panorama-wide-angle: "\f3e0";
	--paper-cut-vertical: "\f3e1";
	--paperclip: "\f3e2";
	--parking: "\f3e3";
	--passport: "\f7e2";
	--pause: "\f3e4";
	--pause-circle: "\f3e5";
	--pause-circle-outline: "\f3e6";
	--pause-octagon: "\f3e7";
	--pause-octagon-outline: "\f3e8";
	--paw: "\f3e9";
	--paw-off: "\f657";
	--pen: "\f3ea";
	--pencil: "\f3eb";
	--pencil-box: "\f3ec";
	--pencil-box-outline: "\f3ed";
	--pencil-circle: "\f6fe";
	--pencil-circle-outline: "\f775";
	--pencil-lock: "\f3ee";
	--pencil-off: "\f3ef";
	--pentagon: "\f6ff";
	--pentagon-outline: "\f700";
	--percent: "\f3f0";
	--periodic-table-co2: "\f7e3";
	--periscope: "\f747";
	--pharmacy: "\f3f1";
	--phone: "\f3f2";
	--phone-bluetooth: "\f3f3";
	--phone-classic: "\f602";
	--phone-forward: "\f3f4";
	--phone-hangup: "\f3f5";
	--phone-in-talk: "\f3f6";
	--phone-incoming: "\f3f7";
	--phone-locked: "\f3f8";
	--phone-log: "\f3f9";
	--phone-minus: "\f658";
	--phone-missed: "\f3fa";
	--phone-outgoing: "\f3fb";
	--phone-paused: "\f3fc";
	--phone-plus: "\f659";
	--phone-settings: "\f3fd";
	--phone-voip: "\f3fe";
	--pi: "\f3ff";
	--pi-box: "\f400";
	--piano: "\f67c";
	--pig: "\f401";
	--pill: "\f402";
	--pillar: "\f701";
	--pin: "\f403";
	--pin-off: "\f404";
	--pine-tree: "\f405";
	--pine-tree-box: "\f406";
	--pinterest: "\f407";
	--pinterest-box: "\f408";
	--pipe: "\f7e4";
	--pipe-disconnected: "\f7e5";
	--pistol: "\f702";
	--pizza: "\f409";
	--plane-shield: "\f6ba";
	--play: "\f40a";
	--play-box-outline: "\f40b";
	--play-circle: "\f40c";
	--play-circle-outline: "\f40d";
	--play-pause: "\f40e";
	--play-protected-content: "\f40f";
	--playlist-check: "\f5c7";
	--playlist-minus: "\f410";
	--playlist-play: "\f411";
	--playlist-plus: "\f412";
	--playlist-remove: "\f413";
	--playstation: "\f414";
	--plex: "\f6b9";
	--plus: "\f415";
	--plus-box: "\f416";
	--plus-box-outline: "\f703";
	--plus-circle: "\f417";
	--plus-circle-multiple-outline: "\f418";
	--plus-circle-outline: "\f419";
	--plus-network: "\f41a";
	--plus-one: "\f41b";
	--plus-outline: "\f704";
	--pocket: "\f41c";
	--pokeball: "\f41d";
	--polaroid: "\f41e";
	--poll: "\f41f";
	--poll-box: "\f420";
	--polymer: "\f421";
	--pool: "\f606";
	--popcorn: "\f422";
	--pot: "\f65a";
	--pot-mix: "\f65b";
	--pound: "\f423";
	--pound-box: "\f424";
	--power: "\f425";
	--power-plug: "\f6a4";
	--power-plug-off: "\f6a5";
	--power-settings: "\f426";
	--power-socket: "\f427";
	--power-socket-eu: "\f7e6";
	--power-socket-uk: "\f7e7";
	--power-socket-us: "\f7e8";
	--prescription: "\f705";
	--presentation: "\f428";
	--presentation-play: "\f429";
	--printer: "\f42a";
	--printer-3d: "\f42b";
	--printer-alert: "\f42c";
	--printer-settings: "\f706";
	--priority-high: "\f603";
	--priority-low: "\f604";
	--professional-hexagon: "\f42d";
	--projector: "\f42e";
	--projector-screen: "\f42f";
	--publish: "\f6a6";
	--pulse: "\f430";
	--puzzle: "\f431";
	--qqchat: "\f605";
	--qrcode: "\f432";
	--qrcode-scan: "\f433";
	--quadcopter: "\f434";
	--quality-high: "\f435";
	--quicktime: "\f436";
	--radar: "\f437";
	--radiator: "\f438";
	--radio: "\f439";
	--radio-handheld: "\f43a";
	--radio-tower: "\f43b";
	--radioactive: "\f43c";
	--radiobox-blank: "\f43d";
	--radiobox-marked: "\f43e";
	--raspberrypi: "\f43f";
	--ray-end: "\f440";
	--ray-end-arrow: "\f441";
	--ray-start: "\f442";
	--ray-start-arrow: "\f443";
	--ray-start-end: "\f444";
	--ray-vertex: "\f445";
	--rdio: "\f446";
	--react: "\f707";
	--read: "\f447";
	--readability: "\f448";
	--receipt: "\f449";
	--record: "\f44a";
	--record-rec: "\f44b";
	--recycle: "\f44c";
	--reddit: "\f44d";
	--redo: "\f44e";
	--redo-variant: "\f44f";
	--refresh: "\f450";
	--regex: "\f451";
	--relative-scale: "\f452";
	--reload: "\f453";
	--remote: "\f454";
	--rename-box: "\f455";
	--reorder-horizontal: "\f687";
	--reorder-vertical: "\f688";
	--repeat: "\f456";
	--repeat-off: "\f457";
	--repeat-once: "\f458";
	--replay: "\f459";
	--reply: "\f45a";
	--reply-all: "\f45b";
	--reproduction: "\f45c";
	--resize-bottom-right: "\f45d";
	--responsive: "\f45e";
	--restart: "\f708";
	--restore: "\f6a7";
	--rewind: "\f45f";
	--rewind-outline: "\f709";
	--rhombus: "\f70a";
	--rhombus-outline: "\f70b";
	--ribbon: "\f460";
	--rice: "\f7e9";
	--ring: "\f7ea";
	--road: "\f461";
	--road-variant: "\f462";
	--robot: "\f6a8";
	--rocket: "\f463";
	--roomba: "\f70c";
	--rotate-3d: "\f464";
	--rotate-left: "\f465";
	--rotate-left-variant: "\f466";
	--rotate-right: "\f467";
	--rotate-right-variant: "\f468";
	--rounded-corner: "\f607";
	--router-wireless: "\f469";
	--routes: "\f46a";
	--rowing: "\f608";
	--rss: "\f46b";
	--rss-box: "\f46c";
	--ruler: "\f46d";
	--run: "\f70d";
	--run-fast: "\f46e";
	--sale: "\f46f";
	--sass: "\f7eb";
	--satellite: "\f470";
	--satellite-variant: "\f471";
	--saxophone: "\f609";
	--scale: "\f472";
	--scale-balance: "\f5d1";
	--scale-bathroom: "\f473";
	--scanner: "\f6aa";
	--school: "\f474";
	--screen-rotation: "\f475";
	--screen-rotation-lock: "\f476";
	--screwdriver: "\f477";
	--script: "\f478";
	--sd: "\f479";
	--seal: "\f47a";
	--search-web: "\f70e";
	--seat-flat: "\f47b";
	--seat-flat-angled: "\f47c";
	--seat-individual-suite: "\f47d";
	--seat-legroom-extra: "\f47e";
	--seat-legroom-normal: "\f47f";
	--seat-legroom-reduced: "\f480";
	--seat-recline-extra: "\f481";
	--seat-recline-normal: "\f482";
	--security: "\f483";
	--security-home: "\f689";
	--security-network: "\f484";
	--select: "\f485";
	--select-all: "\f486";
	--select-inverse: "\f487";
	--select-off: "\f488";
	--selection: "\f489";
	--selection-off: "\f776";
	--send: "\f48a";
	--send-secure: "\f7ec";
	--serial-port: "\f65c";
	--server: "\f48b";
	--server-minus: "\f48c";
	--server-network: "\f48d";
	--server-network-off: "\f48e";
	--server-off: "\f48f";
	--server-plus: "\f490";
	--server-remove: "\f491";
	--server-security: "\f492";
	--set-all: "\f777";
	--set-center: "\f778";
	--set-center-right: "\f779";
	--set-left: "\f77a";
	--set-left-center: "\f77b";
	--set-left-right: "\f77c";
	--set-none: "\f77d";
	--set-right: "\f77e";
	--settings: "\f493";
	--settings-box: "\f494";
	--shape-circle-plus: "\f65d";
	--shape-plus: "\f495";
	--shape-polygon-plus: "\f65e";
	--shape-rectangle-plus: "\f65f";
	--shape-square-plus: "\f660";
	--share: "\f496";
	--share-variant: "\f497";
	--shield: "\f498";
	--shield-half-full: "\f77f";
	--shield-outline: "\f499";
	--shopping: "\f49a";
	--shopping-music: "\f49b";
	--shovel: "\f70f";
	--shovel-off: "\f710";
	--shredder: "\f49c";
	--shuffle: "\f49d";
	--shuffle-disabled: "\f49e";
	--shuffle-variant: "\f49f";
	--sigma: "\f4a0";
	--sigma-lower: "\f62b";
	--sign-caution: "\f4a1";
	--sign-direction: "\f780";
	--sign-text: "\f781";
	--signal: "\f4a2";
	--signal-2g: "\f711";
	--signal-3g: "\f712";
	--signal-4g: "\f713";
	--signal-hspa: "\f714";
	--signal-hspa-plus: "\f715";
	--signal-off: "\f782";
	--signal-variant: "\f60a";
	--silverware: "\f4a3";
	--silverware-fork: "\f4a4";
	--silverware-spoon: "\f4a5";
	--silverware-variant: "\f4a6";
	--sim: "\f4a7";
	--sim-alert: "\f4a8";
	--sim-off: "\f4a9";
	--sitemap: "\f4aa";
	--skip-backward: "\f4ab";
	--skip-forward: "\f4ac";
	--skip-next: "\f4ad";
	--skip-next-circle: "\f661";
	--skip-next-circle-outline: "\f662";
	--skip-previous: "\f4ae";
	--skip-previous-circle: "\f663";
	--skip-previous-circle-outline: "\f664";
	--skull: "\f68b";
	--skype: "\f4af";
	--skype-business: "\f4b0";
	--slack: "\f4b1";
	--sleep: "\f4b2";
	--sleep-off: "\f4b3";
	--smoking: "\f4b4";
	--smoking-off: "\f4b5";
	--snapchat: "\f4b6";
	--snowflake: "\f716";
	--snowman: "\f4b7";
	--soccer: "\f4b8";
	--sofa: "\f4b9";
	--solid: "\f68c";
	--sort: "\f4ba";
	--sort-alphabetical: "\f4bb";
	--sort-ascending: "\f4bc";
	--sort-descending: "\f4bd";
	--sort-numeric: "\f4be";
	--sort-variant: "\f4bf";
	--soundcloud: "\f4c0";
	--source-branch: "\f62c";
	--source-commit: "\f717";
	--source-commit-end: "\f718";
	--source-commit-end-local: "\f719";
	--source-commit-local: "\f71a";
	--source-commit-next-local: "\f71b";
	--source-commit-start: "\f71c";
	--source-commit-start-next-local: "\f71d";
	--source-fork: "\f4c1";
	--source-merge: "\f62d";
	--source-pull: "\f4c2";
	--soy-sauce: "\f7ed";
	--speaker: "\f4c3";
	--speaker-off: "\f4c4";
	--speaker-wireless: "\f71e";
	--speedometer: "\f4c5";
	--spellcheck: "\f4c6";
	--spotify: "\f4c7";
	--spotlight: "\f4c8";
	--spotlight-beam: "\f4c9";
	--spray: "\f665";
	--square: "\f763";
	--square-inc: "\f4ca";
	--square-inc-cash: "\f4cb";
	--square-outline: "\f762";
	--square-root: "\f783";
	--stackexchange: "\f60b";
	--stackoverflow: "\f4cc";
	--stadium: "\f71f";
	--stairs: "\f4cd";
	--standard-definition: "\f7ee";
	--star: "\f4ce";
	--star-circle: "\f4cf";
	--star-half: "\f4d0";
	--star-off: "\f4d1";
	--star-outline: "\f4d2";
	--steam: "\f4d3";
	--steering: "\f4d4";
	--step-backward: "\f4d5";
	--step-backward-2: "\f4d6";
	--step-forward: "\f4d7";
	--step-forward-2: "\f4d8";
	--stethoscope: "\f4d9";
	--sticker: "\f5d0";
	--sticker-emoji: "\f784";
	--stocking: "\f4da";
	--stop: "\f4db";
	--stop-circle: "\f666";
	--stop-circle-outline: "\f667";
	--store: "\f4dc";
	--store-24-hour: "\f4dd";
	--stove: "\f4de";
	--subdirectory-arrow-left: "\f60c";
	--subdirectory-arrow-right: "\f60d";
	--subway: "\f6ab";
	--subway-variant: "\f4df";
	--summit: "\f785";
	--sunglasses: "\f4e0";
	--surround-sound: "\f5c5";
	--surround-sound-2-0: "\f7ef";
	--surround-sound-3-1: "\f7f0";
	--surround-sound-5-1: "\f7f1";
	--surround-sound-7-1: "\f7f2";
	--svg: "\f720";
	--swap-horizontal: "\f4e1";
	--swap-vertical: "\f4e2";
	--swim: "\f4e3";
	--switch: "\f4e4";
	--sword: "\f4e5";
	--sword-cross: "\f786";
	--sync: "\f4e6";
	--sync-alert: "\f4e7";
	--sync-off: "\f4e8";
	--tab: "\f4e9";
	--tab-plus: "\f75b";
	--tab-unselected: "\f4ea";
	--table: "\f4eb";
	--table-column-plus-after: "\f4ec";
	--table-column-plus-before: "\f4ed";
	--table-column-remove: "\f4ee";
	--table-column-width: "\f4ef";
	--table-edit: "\f4f0";
	--table-large: "\f4f1";
	--table-row-height: "\f4f2";
	--table-row-plus-after: "\f4f3";
	--table-row-plus-before: "\f4f4";
	--table-row-remove: "\f4f5";
	--tablet: "\f4f6";
	--tablet-android: "\f4f7";
	--tablet-ipad: "\f4f8";
	--taco: "\f761";
	--tag: "\f4f9";
	--tag-faces: "\f4fa";
	--tag-heart: "\f68a";
	--tag-multiple: "\f4fb";
	--tag-outline: "\f4fc";
	--tag-plus: "\f721";
	--tag-remove: "\f722";
	--tag-text-outline: "\f4fd";
	--target: "\f4fe";
	--taxi: "\f4ff";
	--teamviewer: "\f500";
	--telegram: "\f501";
	--television: "\f502";
	--television-classic: "\f7f3";
	--television-guide: "\f503";
	--temperature-celsius: "\f504";
	--temperature-fahrenheit: "\f505";
	--temperature-kelvin: "\f506";
	--tennis: "\f507";
	--tent: "\f508";
	--terrain: "\f509";
	--test-tube: "\f668";
	--text-shadow: "\f669";
	--text-to-speech: "\f50a";
	--text-to-speech-off: "\f50b";
	--textbox: "\f60e";
	--textbox-password: "\f7f4";
	--texture: "\f50c";
	--theater: "\f50d";
	--theme-light-dark: "\f50e";
	--thermometer: "\f50f";
	--thermometer-lines: "\f510";
	--thought-bubble: "\f7f5";
	--thought-bubble-outline: "\f7f6";
	--thumb-down: "\f511";
	--thumb-down-outline: "\f512";
	--thumb-up: "\f513";
	--thumb-up-outline: "\f514";
	--thumbs-up-down: "\f515";
	--ticket: "\f516";
	--ticket-account: "\f517";
	--ticket-confirmation: "\f518";
	--ticket-percent: "\f723";
	--tie: "\f519";
	--tilde: "\f724";
	--timelapse: "\f51a";
	--timer: "\f51b";
	--timer-10: "\f51c";
	--timer-3: "\f51d";
	--timer-off: "\f51e";
	--timer-sand: "\f51f";
	--timer-sand-empty: "\f6ac";
	--timer-sand-full: "\f78b";
	--timetable: "\f520";
	--toggle-switch: "\f521";
	--toggle-switch-off: "\f522";
	--tooltip: "\f523";
	--tooltip-edit: "\f524";
	--tooltip-image: "\f525";
	--tooltip-outline: "\f526";
	--tooltip-outline-plus: "\f527";
	--tooltip-text: "\f528";
	--tooth: "\f529";
	--tor: "\f52a";
	--tower-beach: "\f680";
	--tower-fire: "\f681";
	--trackpad: "\f7f7";
	--traffic-light: "\f52b";
	--train: "\f52c";
	--tram: "\f52d";
	--transcribe: "\f52e";
	--transcribe-close: "\f52f";
	--transfer: "\f530";
	--transit-transfer: "\f6ad";
	--translate: "\f5ca";
	--treasure-chest: "\f725";
	--tree: "\f531";
	--trello: "\f532";
	--trending-down: "\f533";
	--trending-neutral: "\f534";
	--trending-up: "\f535";
	--triangle: "\f536";
	--triangle-outline: "\f537";
	--trophy: "\f538";
	--trophy-award: "\f539";
	--trophy-outline: "\f53a";
	--trophy-variant: "\f53b";
	--trophy-variant-outline: "\f53c";
	--truck: "\f53d";
	--truck-delivery: "\f53e";
	--truck-fast: "\f787";
	--truck-trailer: "\f726";
	--tshirt-crew: "\f53f";
	--tshirt-v: "\f540";
	--tumblr: "\f541";
	--tumblr-reblog: "\f542";
	--tune: "\f62e";
	--tune-vertical: "\f66a";
	--twitch: "\f543";
	--twitter: "\f544";
	--twitter-box: "\f545";
	--twitter-circle: "\f546";
	--twitter-retweet: "\f547";
	--uber: "\f748";
	--ubuntu: "\f548";
	--ultra-high-definition: "\f7f8";
	--umbraco: "\f549";
	--umbrella: "\f54a";
	--umbrella-outline: "\f54b";
	--undo: "\f54c";
	--undo-variant: "\f54d";
	--unfold-less-horizontal: "\f54e";
	--unfold-less-vertical: "\f75f";
	--unfold-more-horizontal: "\f54f";
	--unfold-more-vertical: "\f760";
	--ungroup: "\f550";
	--unity: "\f6ae";
	--untappd: "\f551";
	--update: "\f6af";
	--upload: "\f552";
	--upload-network: "\f6f5";
	--usb: "\f553";
	--van-passenger: "\f7f9";
	--van-utility: "\f7fa";
	--vanish: "\f7fb";
	--vector-arrange-above: "\f554";
	--vector-arrange-below: "\f555";
	--vector-circle: "\f556";
	--vector-circle-variant: "\f557";
	--vector-combine: "\f558";
	--vector-curve: "\f559";
	--vector-difference: "\f55a";
	--vector-difference-ab: "\f55b";
	--vector-difference-ba: "\f55c";
	--vector-intersection: "\f55d";
	--vector-line: "\f55e";
	--vector-point: "\f55f";
	--vector-polygon: "\f560";
	--vector-polyline: "\f561";
	--vector-radius: "\f749";
	--vector-rectangle: "\f5c6";
	--vector-selection: "\f562";
	--vector-square: "\f001";
	--vector-triangle: "\f563";
	--vector-union: "\f564";
	--verified: "\f565";
	--vibrate: "\f566";
	--video: "\f567";
	--video-3d: "\f7fc";
	--video-off: "\f568";
	--video-switch: "\f569";
	--view-agenda: "\f56a";
	--view-array: "\f56b";
	--view-carousel: "\f56c";
	--view-column: "\f56d";
	--view-dashboard: "\f56e";
	--view-day: "\f56f";
	--view-grid: "\f570";
	--view-headline: "\f571";
	--view-list: "\f572";
	--view-module: "\f573";
	--view-parallel: "\f727";
	--view-quilt: "\f574";
	--view-sequential: "\f728";
	--view-stream: "\f575";
	--view-week: "\f576";
	--vimeo: "\f577";
	--vine: "\f578";
	--violin: "\f60f";
	--visualstudio: "\f610";
	--vk: "\f579";
	--vk-box: "\f57a";
	--vk-circle: "\f57b";
	--vlc: "\f57c";
	--voice: "\f5cb";
	--voicemail: "\f57d";
	--volume-high: "\f57e";
	--volume-low: "\f57f";
	--volume-medium: "\f580";
	--volume-minus: "\f75d";
	--volume-mute: "\f75e";
	--volume-off: "\f581";
	--volume-plus: "\f75c";
	--vpn: "\f582";
	--walk: "\f583";
	--wall: "\f7fd";
	--wallet: "\f584";
	--wallet-giftcard: "\f585";
	--wallet-membership: "\f586";
	--wallet-travel: "\f587";
	--wan: "\f588";
	--washing-machine: "\f729";
	--watch: "\f589";
	--watch-export: "\f58a";
	--watch-import: "\f58b";
	--watch-vibrate: "\f6b0";
	--water: "\f58c";
	--water-off: "\f58d";
	--water-percent: "\f58e";
	--water-pump: "\f58f";
	--watermark: "\f612";
	--waves: "\f78c";
	--weather-cloudy: "\f590";
	--weather-fog: "\f591";
	--weather-hail: "\f592";
	--weather-lightning: "\f593";
	--weather-lightning-rainy: "\f67d";
	--weather-night: "\f594";
	--weather-partlycloudy: "\f595";
	--weather-pouring: "\f596";
	--weather-rainy: "\f597";
	--weather-snowy: "\f598";
	--weather-snowy-rainy: "\f67e";
	--weather-sunny: "\f599";
	--weather-sunset: "\f59a";
	--weather-sunset-down: "\f59b";
	--weather-sunset-up: "\f59c";
	--weather-windy: "\f59d";
	--weather-windy-variant: "\f59e";
	--web: "\f59f";
	--webcam: "\f5a0";
	--webhook: "\f62f";
	--webpack: "\f72a";
	--wechat: "\f611";
	--weight: "\f5a1";
	--weight-kilogram: "\f5a2";
	--whatsapp: "\f5a3";
	--wheelchair-accessibility: "\f5a4";
	--white-balance-auto: "\f5a5";
	--white-balance-incandescent: "\f5a6";
	--white-balance-iridescent: "\f5a7";
	--white-balance-sunny: "\f5a8";
	--widgets: "\f72b";
	--wifi: "\f5a9";
	--wifi-off: "\f5aa";
	--wii: "\f5ab";
	--wiiu: "\f72c";
	--wikipedia: "\f5ac";
	--window-close: "\f5ad";
	--window-closed: "\f5ae";
	--window-maximize: "\f5af";
	--window-minimize: "\f5b0";
	--window-open: "\f5b1";
	--window-restore: "\f5b2";
	--windows: "\f5b3";
	--wordpress: "\f5b4";
	--worker: "\f5b5";
	--wrap: "\f5b6";
	--wrench: "\f5b7";
	--wunderlist: "\f5b8";
	--xaml: "\f673";
	--xbox: "\f5b9";
	--xbox-controller: "\f5ba";
	--xbox-controller-battery-alert: "\f74a";
	--xbox-controller-battery-empty: "\f74b";
	--xbox-controller-battery-full: "\f74c";
	--xbox-controller-battery-low: "\f74d";
	--xbox-controller-battery-medium: "\f74e";
	--xbox-controller-battery-unknown: "\f74f";
	--xbox-controller-off: "\f5bb";
	--xda: "\f5bc";
	--xing: "\f5bd";
	--xing-box: "\f5be";
	--xing-circle: "\f5bf";
	--xml: "\f5c0";
	--xmpp: "\f7fe";
	--yammer: "\f788";
	--yeast: "\f5c1";
	--yelp: "\f5c2";
	--yin-yang: "\f67f";
	--youtube-play: "\f5c3";
	--zip-box: "\f5c4";
	--blank: "\f68c";
}</style></div><div class="paragraph style-paragraph collapsed" data-id="8cVA4B8t" name="Material Font Roboto" draggable="false" style __wid="qg8cfH6s"><style data-type="content" type="text/css" codemirror="true" __wid="Ca6KJBFk">@font-face {
	font-family: "Roboto";
	font-style: normal;
	font-weight: 300;
	src: local("Roboto Light"), local("Roboto-Light"),
		url("roboto-300.woff2") format("woff2"),
		url("roboto-300.woff") format("woff");
}

@font-face {
	font-family: "Roboto";
	font-style: italic;
	font-weight: 300;
	src: local("Roboto Light Italic"), local("Roboto-LightItalic"),
		url("roboto-300-italic.woff2") format("woff2"),
		url("roboto-300-italic.woff") format("woff");
}

@font-face {
	font-family: "Roboto";
	font-style: normal;
	font-weight: 400;
	src: local("Roboto"), local("Roboto-Regular"),
		url("roboto-400.woff2") format("woff2"),
		url("roboto-400.woff") format("woff");
}

@font-face {
	font-family: "Roboto";
	font-style: italic;
	font-weight: 400;
	src: local("Roboto Italic"), local("Roboto-Italic"),
		url("roboto-400-italic.woff2") format("woff2"),
		url("roboto-400-italic.woff") format("woff");
}

@font-face {
	font-family: "Roboto";
	font-style: normal;
	font-weight: 500;
	src: local("Roboto Medium"), local("Roboto-Medium"),
		url("roboto-500.woff2") format("woff2"),
		url("roboto-500.woff") format("woff");
}

@font-face {
	font-family: "Roboto";
	font-style: italic;
	font-weight: 500;
	src: local("Roboto Medium Italic"), local("Roboto-MediumItalic"),
		url("roboto-500-italic.woff2") format("woff2"),
		url("roboto-500-italic.woff") format("woff");
}

@font-face {
	font-family: "Roboto";
	font-style: normal;
	font-weight: 700;
	src: local("Roboto Bold"), local("Roboto-Bold"),
		url("roboto-700.woff2") format("woff2"),
		url("roboto-700.woff") format("woff");
}

@font-face {
	font-family: "Roboto";
	font-style: italic;
	font-weight: 700;
	src: local("Roboto Bold Italic"), local("Roboto-BoldItalic"),
		url("roboto-700-italic.woff2") format("woff2"),
		url("roboto-700-italic.woff") format("woff");
}</style></div><div class="paragraph style-paragraph collapsed" data-id="wqQCqxEH" name="Material Font Roboto Mono" __wid="nfB9cf5k"><style data-type="content" type="text/css" codemirror="true" __wid="Ugq2W8MG">@font-face {
	font-family: "Roboto Mono";
	font-style: normal;
	font-weight: 400;
	src: local("Roboto Mono"), local("RobotoMono"),
		url("roboto-mono-400.woff2") format("woff2"),
		url("roboto-mono-400.woff") format("woff");
}

@font-face {
	font-family: "Roboto Mono";
	font-style: italic;
	font-weight: 400;
	src: local("Roboto Mono Italic"), local("RobotoMono-Italic"),
		url("roboto-mono-400-italic.woff2") format("woff2"),
		url("roboto-mono-400-italic.woff") format("woff");
}

@font-face {
	font-family: "Roboto Mono";
	font-style: normal;
	font-weight: 700;
	src: local("Roboto Mono Bold"), local("RobotoMono-Bold"),
		url("roboto-mono-700.woff2") format("woff2"),
		url("roboto-mono-700.woff") format("woff");
}

@font-face {
	font-family: "Roboto Mono";
	font-style: italic;
	font-weight: 700;
	src: local("Roboto Mono Bold Italic"), local("RobotoMono-BoldItalic"),
		url("roboto-mono-700-italic.woff2") format("woff2"),
		url("roboto-mono-700-italic.woff") format("woff");
}</style></div><div class="paragraph style-paragraph collapsed" data-id="V2izxPgv" draggable="false" style name="Material Variables" __wid="84qQgf6L"><style data-type="content" type="text/css" codemirror="true" __wid="urheBVZS">:root {

	/* Material Colors */
	--material-color-red: #F44336;
	--material-color-pink: #E91E63;
	--material-color-purple: #9C27B0;
	--material-color-deep-purple: #673AB7;
	--material-color-indigo: #3F51B5;
	--material-color-blue: #2196F3;
	--material-color-light-blue: #03A9F4;
	--material-color-cyan: #00BCD4;
	--material-color-teal: #009688;
	--material-color-green: #4CAF50;
	--material-color-light-green: #8BC34A;
	--material-color-lime: #CDDC39;
	--material-color-yellow: #FFEB3B;
	--material-color-amber: #FFC107;
	--material-color-orange: #FF9800;
	--material-color-deep-orange: #FF5722;
	--material-color-brown: #795548;
	--material-color-grey: #9E9E9E;
	--material-color-blue-grey: #607D8B;
	--material-color-white: #FFFFFF;
	--material-color-black: #000000;

	--material-color-grey-50: #FAFAFA;
	--material-color-grey-100: #F5F5F5;
	--material-color-grey-200: #EEEEEE;
	--material-color-grey-300: #E0E0E0;
	--material-color-grey-400: #BDBDBD;
	--material-color-grey-500: #9E9E9E;
	--material-color-grey-600: #757575;
	--material-color-grey-700: #616161;
	--material-color-grey-800: #424242;
	--material-color-grey-850: #303030;
	--material-color-grey-900: #212121;

	/* Material Colors RGB */
	--material-color-red-rgb: 244, 67, 54;
	--material-color-pink-rgb: 233, 30, 99;
	--material-color-purple-rgb: 156, 39, 176;
	--material-color-deep-purple-rgb: 103, 58, 183;
	--material-color-indigo-rgb: 63, 81, 181;
	--material-color-blue-rgb: 33, 150, 243;
	--material-color-light-blue-rgb: 3, 169, 244;
	--material-color-cyan-rgb: 0, 188, 212;
	--material-color-teal-rgb: 0, 150, 136;
	--material-color-green-rgb: 76, 175, 80;
	--material-color-light-green-rgb: 139, 195, 74;
	--material-color-lime-rgb: 205, 220, 57;
	--material-color-yellow-rgb: 255, 235, 59;
	--material-color-amber-rgb: 255, 193, 7;
	--material-color-orange-rgb: 255, 152, 0;
	--material-color-deep-orange-rgb: 255, 87, 34;
	--material-color-brown-rgb: 121, 85, 72;
	--material-color-grey-rgb: 158, 158, 158;
	--material-color-blue-grey-rgb: 96, 125, 139;
	--material-color-white-rgb: 255, 255, 255;
	--material-color-black-rgb: 0, 0, 0;

	--material-color-grey-50-rgb: 250, 250, 250;
	--material-color-grey-100-rgb: 245, 245, 245;
	--material-color-grey-200-rgb: 238, 238, 238;
	--material-color-grey-300-rgb: 224, 224, 224;
	--material-color-grey-400-rgb: 189, 189, 189;
	--material-color-grey-500-rgb: 158, 158, 158;
	--material-color-grey-600-rgb: 117, 117, 117;
	--material-color-grey-700-rgb: 97, 97, 97;
	--material-color-grey-800-rgb: 66, 66, 66;
	--material-color-grey-850-rgb: 48, 48, 48;
	--material-color-grey-900-rgb: 33, 33, 33;

	/* Material Shadows */
	--material-shadow-z1: 0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px 0px rgba(0, 0, 0, 0.14), 0px 1px 3px 0px rgba(0, 0, 0, 0.12);
	--material-shadow-z2: 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);
	--material-shadow-z3: 0px 3px 3px -2px rgba(0, 0, 0, 0.2), 0px 3px 4px 0px rgba(0, 0, 0, 0.14), 0px 1px 8px 0px rgba(0, 0, 0, 0.12);
	--material-shadow-z4: 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12);
	--material-shadow-z5: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
	--material-shadow-z6: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);
	--material-shadow-z7:0px 4px 5px -2px rgba(0, 0, 0, 0.2), 0px 7px 10px 1px rgba(0, 0, 0, 0.14), 0px 2px 16px 1px rgba(0, 0, 0, 0.12);
	--material-shadow-z8: 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12);
	--material-shadow-z9: 0px 5px 6px -3px rgba(0, 0, 0, 0.2), 0px 9px 12px 1px rgba(0, 0, 0, 0.14), 0px 3px 16px 2px rgba(0, 0, 0, 0.12);
	--material-shadow-z10: 0px 6px 6px -3px rgba(0, 0, 0, 0.2), 0px 10px 14px 1px rgba(0, 0, 0, 0.14), 0px 4px 18px 3px rgba(0, 0, 0, 0.12);
	--material-shadow-z11: 0px 6px 7px -4px rgba(0, 0, 0, 0.2), 0px 11px 15px 1px rgba(0, 0, 0, 0.14), 0px 4px 20px 3px rgba(0, 0, 0, 0.12);
	--material-shadow-z12: 0px 7px 8px -4px rgba(0, 0, 0, 0.2), 0px 12px 17px 2px rgba(0, 0, 0, 0.14), 0px 5px 22px 4px rgba(0, 0, 0, 0.12);
	--material-shadow-z13: 0px 7px 8px -4px rgba(0, 0, 0, 0.2), 0px 13px 19px 2px rgba(0, 0, 0, 0.14), 0px 5px 24px 4px rgba(0, 0, 0, 0.12);
	--material-shadow-z14: 0px 7px 9px -4px rgba(0, 0, 0, 0.2), 0px 14px 21px 2px rgba(0, 0, 0, 0.14), 0px 5px 26px 4px rgba(0, 0, 0, 0.12);
	--material-shadow-z15: 0px 8px 9px -5px rgba(0, 0, 0, 0.2), 0px 15px 22px 2px rgba(0, 0, 0, 0.14), 0px 6px 28px 5px rgba(0, 0, 0, 0.12);
	--material-shadow-z16: 0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);
	--material-shadow-z17: 0px 8px 11px -5px rgba(0, 0, 0, 0.2), 0px 17px 26px 2px rgba(0, 0, 0, 0.14), 0px 6px 32px 5px rgba(0, 0, 0, 0.12);
	--material-shadow-z18: 0px 9px 11px -5px rgba(0, 0, 0, 0.2), 0px 18px 28px 2px rgba(0, 0, 0, 0.14), 0px 7px 34px 6px rgba(0, 0, 0, 0.12);
	--material-shadow-z19: 0px 9px 12px -6px rgba(0, 0, 0, 0.2), 0px 19px 29px 2px rgba(0, 0, 0, 0.14), 0px 7px 36px 6px rgba(0, 0, 0, 0.12);
	--material-shadow-z20: 0px 10px 13px -6px rgba(0, 0, 0, 0.2), 0px 20px 31px 3px rgba(0, 0, 0, 0.14), 0px 8px 38px 7px rgba(0, 0, 0, 0.12);
	--material-shadow-z21: 0px 10px 13px -6px rgba(0, 0, 0, 0.2), 0px 21px 33px 3px rgba(0, 0, 0, 0.14), 0px 8px 40px 7px rgba(0, 0, 0, 0.12);
	--material-shadow-z22: 0px 10px 14px -6px rgba(0, 0, 0, 0.2), 0px 22px 35px 3px rgba(0, 0, 0, 0.14), 0px 8px 42px 7px rgba(0, 0, 0, 0.12);
	--material-shadow-z23: 0px 11px 14px -7px rgba(0, 0, 0, 0.2), 0px 23px 36px 3px rgba(0, 0, 0, 0.14), 0px 9px 44px 8px rgba(0, 0, 0, 0.12);
	--material-shadow-z24:0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12);
}</style></div><div class="paragraph style-paragraph collapsed" data-id="ia4CUjdL" name="Animations (@keyframes)" style draggable="false" __wid="pdYjR8HH"><style data-type="content" type="text/css" codemirror="true" __wid="Vns5d6Yg">/* The animation code */
@keyframes blink-cursor {
	from { opacity: 1.0; }
	to { opacity: 0.0; }
}</style></div><div class="paragraph style-paragraph collapsed" data-id="Z2h2eCWM" name="Theme Variables" style draggable="false" __wid="j7FwBMLK"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="iuYbntEf">html:root {

	/* Fonts */
	--font-primary: "Roboto", "Avenir", sans-serif;
	--font-secondary: "Roboto", "Avenir", sans-serif;
	--font-monospace: "Roboto Mono", "Menlo", monospace;

	/* Colors */
	--color-primary: var(--material-color-black);
	--color-primary-shade-1: var(--material-color-grey-900);
	--color-primary-shade-2: var(--material-color-grey-850);
	--color-primary-shade-3: var(--material-color-grey-800);

	--color-primary-text: var(--material-color-grey-100);
	--color-secondary-text: var(--material-color-grey-300);
	--color-tertiary-text: var(--material-color-grey-500);

	--color-accent: var(--material-color-orange);
	--color-accent-text: var(--material-color-black);

		/* Colors RGB */
	--color-primary-rgb: var(--material-color-black-rgb);
	--color-primary-shade-1-rgb: var(--material-color-grey-900-rgb);
	--color-primary-shade-2-rgb-rgb: var(--material-color-grey-850-rgb);
	--color-primary-shade-3-rgb: var(--material-color-grey-800-rgb);

	--color-primary-text-rgb: var(--material-color-grey-100-rgb);
	--color-secondary-text-rgb: var(--material-color-grey-300-rgb);
	--color-tertiary-text-rgb: var(--material-color-grey-500-rgb);

	--color-accent-rgb: var(--material-color-orange-rgb);
	--color-accent-text-rgb: var(--material-color-black-rgb);

	/* Transitions */
	--navigation-transition: 250ms cubic-bezier(0.4, 0.0, 0.2, 1);
}</style></div>
<div class="paragraph style-paragraph collapsed" data-id="s3RFq8qg" name="Material Ripple" draggable="false" style __wid="MeFQkVJZ"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="L6VmY6jx">html .material-ripple-primary-text,
html .material-ripple-accen-text,
html .dialog .actions .button,
html #global-toolbar .toolbar-button,
html #snackbar .snackbar-button,
html #snackbar .action,
html #global-menu .menu-button,
html #global-menu .sub-menu > .label {
	position: relative;
	overflow: hidden;
	transform: translate3d(0, 0, 0);
}

html .material-ripple-primary-text:after,
html .material-ripple-accent-text:after,
html .dialog .actions .button:after,
html #global-toolbar .toolbar-button:after,
html #snackbar .snackbar-button:after,
html #snackbar .action:after,
html #global-menu .menu-button:after,
html #global-menu .sub-menu > .label:after {
	content: "";
	display: block;
	position: absolute;
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
	pointer-events: none;
	background-repeat: no-repeat;
	background-position: 50%;
	transform: scale(10, 10);
	opacity: 0;
	transition: transform 0.5s, opacity 1s;
}

html .material-ripple-primary-text:after,
html .dialog .actions .button:after,
html #global-toolbar .toolbar-button:after,
html #global-menu .menu-button:after,
html #global-menu .sub-menu > .label:after {
	background-image: radial-gradient(circle, var(--color-primary-text) 10%, transparent 10.01%);
}

html .material-ripple-accent-text:after,
html #snackbar .snackbar-button:after,
html #snackbar .action:after {
	background-image: radial-gradient(circle, var(--color-accent-text) 10%, transparent 10.01%);
}

html .material-ripple-primary-text:active:after,
html .material-ripple-accent-text:active:after,
html .dialog .actions .button:active:after,
html #global-toolbar .toolbar-button:active:after,
html #snackbar .snackbar-button:active:after,
html #snackbar .action:active:after,
html #global-menu .menu-button:active:after,
html #global-menu .sub-menu > .label:active:after {
	transform: scale(0, 0);
	opacity: 0.2;
	transition: 0s;
}</style></div><div class="paragraph style-paragraph collapsed" data-id="5uBKHKzL" name="Main" draggable="false" style __wid="dXCBt6NL"><style data-type="content" type="text/css" codemirror="true" class="themable" contenteditable="true" __wid="E5fUV2Rh">html,
html * {
	box-sizing: border-box;
}

html,
html input,
html button {
	font-family: var(--font-primary);
}

html select {
  color: var(--color-primary-text);
  background: transparent;
}

html,
html body {
	width: 100%;
	height: 100%;
	margin: 0;
	overflow-x: hidden;
	overflow-y: hidden;
}

html {
	background-color: var(--color-primary-shade-2);
	color: var(--color-primary-text);
}

html body #sections {
	width: 100%;
	height: calc(100% - 64px);
	margin: 0;
	margin-top: 64px;
	padding: 16px;
	padding-bottom: calc(25vh + 16px); /* For Snackbar */
	overflow: hidden;
	overflow-y: auto;
  -webkit-overflow-scrolling: touch;
	transition: margin var(--navigation-transition),
							width var(--navigation-transition);
}

html body #sections .section {
	width: 60em;
	margin: 0 auto;
	margin-bottom: 10px;
	max-width: 100%;
}

html body[transient-menu-pinned="true"] #sections {
	width: calc(100% - 288px);
	margin-left: 288px;
}

html body[transient-notification-pinned="true"] #sections {
	width: calc(100% - 384px);
	margin-right: 384px;
}

html body[transient-menu-pinned="true"][transient-notification-pinned="true"] #sections {
	width: calc(100% - 672px);
}

/* Fix Chrome setting h1 font-size to 1.17em in paragraphs within sections */
html h1 {
	font-size: 2em;
}

/* Fix issue with contenteditable not selectable on iOS */
html [contenteditable] {
  -webkit-user-select: text;
  user-select: text;
}</style></div><div class="paragraph style-paragraph collapsed" data-id="c8dz5get" name="Loading / Disconnected" draggable="false" style __wid="hvkwYygC"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="g24EDhCm">@-webkit-keyframes rotateplane {
	0% {
		-webkit-transform: perspective(120px);
	}
	50% {
		-webkit-transform: perspective(120px) rotateY(180deg);
	}
	100% {
		-webkit-transform: perspective(120px) rotateY(180deg) rotateX(180deg);
	}
}

@-moz-keyframes rotateplane {
	0% {
		-moz-transform: perspective(120px);
	}
	50% {
		-moz-transform: perspective(120px) rotateY(180deg);
	}
	100% {
		-moz-transform: perspective(120px) rotateY(180deg) rotateX(180deg);
	}
}

@-o-keyframes rotateplane {
	0% {
		-o-transform: perspective(120px);
	}
	50% {
		-o-transform: perspective(120px) rotateY(180deg);
	}
	100% {
		-o-transform: perspective(120px) rotateY(180deg) rotateX(180deg);
	}
}

@keyframes rotateplane {
	0% {
		-webkit-transform: perspective(120px) rotateX(0deg) rotateY(0deg);
		-moz-transform: perspective(120px) rotateX(0deg) rotateY(0deg);
		-o-transform: perspective(120px) rotateX(0deg) rotateY(0deg);
		transform: perspective(120px) rotateX(0deg) rotateY(0deg);
	}
	50% {
		-webkit-transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
		-moz-transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
		-o-transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
		transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
	}
	100% {
		-webkit-transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
		-moz-transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
		-o-transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
		transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
	}
}

html .overlay {
	position: fixed;
	display: block;
	top: 0;
	left: 0;
	bottom: 0;
	right: 0;
	background-color: var(--color-primary-shade-2);
	width: 100vw;
	height: 100vh;
	z-index: 395;
  pointer-events: none;
  transition: color 5000ms linear, background-color 5000ms linear;
}

html .overlay > div.center-piece {
	position: fixed;
	display: inline-block;
	left: 50%;
	top: 50%;
	transform: translate(-50%, -50%);
}

html .overlay > div.center-piece:after {
	position: absolute;
	top: 100%;
	left: 50%;
	width: 200px;
	transform: translate(-50%, 0);
	text-align: center;
}

html .overlay > div.center-piece > div.loading-indicator {
	position: relative;
	display: inline-block;
	top: 0;
	left: 0;
	width: 50px;
	height: 50px;
	border-radius: 2px;
  background-color: var(--color-tertiary-text);
  transition: color 5000ms linear, background-color 5000ms linear;
	-webkit-animation: rotateplane 1.5s infinite ease-in-out;
	-moz-animation: rotateplane 1.5s infinite ease-in-out;
	-o-animation: rotateplane 1.5s infinite ease-in-out;
	animation: rotateplane 1.5s infinite ease-in-out;
}

html .overlay > div.close {
	display: flex;
	position: fixed;
	top: 10px;
	right: 10px;
	cursor: pointer;
	border-radius: 50%;
	color: var(--color-primary-text);
	background-color: var(--color-primary-shade-2);
  transition: color 100ms linear, background-color 250ms linear;
  pointer-events: all;
}

html .overlay > div.close:hover {
	color: var(--color-primary-shade-2);
	background-color: var(--color-primary-text);
}

html .overlay.loading > div.center-piece:after {
	margin-top: 8px;
	content: "Loading";
}

html .overlay.disconnected > div.center-piece:after {
	content: "Disconnected";
}</style></div><div class="paragraph style-paragraph collapsed" name="Scrollbars" draggable="false" style data-id="aReAMqZa" __wid="wspvMxJp"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="VLfCHcEv">html *::-webkit-scrollbar {
	width: 5px;
	height: 5px;
	background: transparent;
}

html *::-webkit-scrollbar-track {
	background-color: var(--color-primary-shade-1);
}

html *::-webkit-scrollbar-thumb {
	border-radius: 1px;
	background-color: var(--color-secondary-text);
}

html *::-webkit-scrollbar-thumb:hover {
	background-color: var(--color-primary-text);
}</style></div><div class="paragraph style-paragraph collapsed" name="Tooltip" draggable="false" style data-id="ekcWCgH9" __wid="HpQSBedU"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="wmxghgw9">html .section-visible *[tooltip]:after {
	font-size: 1rem;
	font-family: var(--font-primary);
	position: absolute;
	bottom: 0px;
	left: 50%;
	z-index: 98;
	padding: 5px 15px;
	color: white;
	background-color: rgba(0, 0, 0, 0.8);
	border-radius: 2px;
	display: inline;
	width: 200px;
	text-align: center;
	transform: translate3d(-50%, -36px, 0);
	opacity: 0;
	pointer-events: none;
	-webkit-font-smoothing: antialiased; /* webkit text rendering fix */
}

/* Match all tooltip headers and move them down 60px */
html .section-visible .section-header *[tooltip]:after {
	bottom: -63px;
}
/* Match all tooltips except the first and move them back up, effectively making
the selector only match the first tooltip header. */
html .section-visible ~ .section-visible *[tooltip]:after {
	bottom: 0;
}

html *[tooltip]:before {
	content: "";
	border: solid;
	bottom: 0;
	border-color: rgba(0, 0, 0, 0.8) transparent;
	border-width: 6px 6px 0px 6px;
	left: 50%;
	transform: translate3d(-50%, -30px, 0);
	position: absolute;
	z-index: 99;
	opacity: 0;
	pointer-events: none;
	-webkit-font-smoothing: antialiased; /* Webkit text rendering fix */
}

/* Same principle as above, except this is for the tooltip triangle which needs
to be reversed. */
html .section-visible .section-header *[tooltip]:before {
	transform: translate3d(-50%, 0px, 0);
	border-width: 0px 6px 6px 6px;
}
html .section-visible ~ .section-visible *[tooltip]:before {
	transform: translate3d(-50%, -30px, 0);
	border-width: 6px 6px 0px 6px;
}

html *[tooltip]:hover:after,
html *[tooltip]:hover:before {
	opacity: 1.0;
	transition: opacity 200ms ease-in-out 300ms;
}

/******************************************************************************/

html *[tooltip]:after,
html *[tooltip]:before,
html .action:after {
	display: none !important;
}</style></div><div class="paragraph style-paragraph collapsed" name="Section Style" style data-id="Biib7BSP" draggable="false" __wid="cctXYYFP"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="9BGpNr4v">html .section {
	margin-bottom: 10px;
	position: relative;
}

html .section.section-hidden,
html .section.section-hidden * {
	display: none;
}

html .section[transient-focussed]:before {
	content: "";
	position: absolute;
	height: 100%;
	width: 0;
	left: -10px;
	border-left: 4px solid rgba(var(--color-accent-rgb), 0.3);
	border-radius: 4px;
}

/******************************************************************************/

html .section .section-header {
	display: flex;
	flex-direction: row-reverse;
	flex-wrap: nowrap;
	justify-content: flex-start;
	height: 40px;
	padding: 8px;
	background: var(--color-primary);
	font-size: 1.2em;
	margin-bottom: 10px;
	border-radius: 2px;
	overflow-x: auto;
	overflow-y: hidden;
}

html .section .section-header::-webkit-scrollbar {
	display: none;
}

html .section .section-header:before {
	font-family: "Material Icons";
	font-weight: normal;
	font-style: normal;
	line-height: 1;
	text-transform: none;
	letter-spacing: normal;
	word-wrap: normal;
	white-space: nowrap;
	direction: ltr;
	text-rendering: optimizeLegibility;
	font-feature-settings: "liga";

	flex: 0 0 auto;
	font-size: 22px;
	line-height: 22px;
	height: 22px;
	padding: 1px;
	margin-right: 8px;
	order: 999;
	content: "label";
}

html .section .section-header .action {
	display: flex;
	margin-right: 8px;
	cursor: pointer;
	font-size: 24px;
	opacity: 0.25;
	pointer-events: none;
	flex: 0 0 24px;
	align-self: flex-end;
	user-select: none;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

html .section .section-header:hover .action {
	opacity: 1.0;
	pointer-events: all;
}

html .section .section-header .action:hover {
	color: var(--color-accent);
}

/******************************************************************************/

html .section .section-header .name-input {
	cursor: text;
	flex: 1 0 auto;
	margin-right: 16px;
	order: 998;
	line-height: 24px;
	font-size: 20px;
}

html .section .section-header .id-input {
	display: none;
}

html .section .section-header .name-input:focus {
	outline: none;
}

html .section .section-header .name-input:empty:focus {
	padding-left: 1px;
	/*outline: 1px solid var(--color-primary-text);
	opacity: 1.0;
	animation-name: blink-cursor;
	animation-duration: 500ms;
	animation-direction: alternate;
	animation-iteration-count: infinite;
	animation-timing-function: ease-in-out;*/
}

html .section .section-header .name-input:empty:before {
	content: "No Name";
	opacity: 0.5;
}

html .section .section-header .name-input:empty:focus:before {
	content: "";
}

/******************************************************************************/

html .section .section-header .data-id-label {
	flex: 0 0 auto;
	user-select: all;
	background-color: rgba(var(--material-color-light-green-rgb), 0.75);
	font-size: 0.75em;
	font-family: var(--font-monospace);
	line-height: 20px;
	color: var(--color-primary);
	border-radius: 2px;
	padding: 2px 4px;
	font-weight: 700;
	margin-right: 8px;
	cursor: default;
}

html .section.uninstalled .section-header .data-id-label {
	background-color: rgba(var(--material-color-red-rgb), 0.75);
}

html .section .section-header .data-id-label:after {
	content: "Package ID";
}

html .section:not([data-type="package"]) .section-header .data-id-label {
	display: none;
}

/******************************************************************************/

html .section .section-header .delete-section:hover {
	color: var(--material-color-red);
}

/* Icon Delete */
html .section .section-header .delete-section i:after {
	content: "delete";
}

/* Tooltip Delete */
html .section .section-header .delete-section:after {
	content: "Delete";
}

/******************************************************************************/

/* Hide Collapsed Sections */
html .section.hide-collapsed-paragraphs .paragraph.collapsed {
	display: none;
}

html .section.hide-collapsed-paragraphs .hide-collapsed-paragraphs2 {
	opacity: 1.0;
}

/* Icon Show Collapsed Paragraphs */
html .section.hide-collapsed-paragraphs .hide-collapsed-paragraphs2 i:after {
	content: "visibility_off";
}

/* Tooltip Show Collapsed Paragraphs */
html .section.hide-collapsed-paragraphs .hide-collapsed-paragraphs2:after {
	content: "Show Collapsed Paragraphs";
}

/* Icon Hide Collapsed Paragraphs */
html .section:not(.hide-collapsed-paragraphs) .hide-collapsed-paragraphs2 i:after {
	content: "visibility";
}

/* Tooltip Hide Collapsed Paragraphs */
html .section:not(.hide-collapsed-paragraphs) .hide-collapsed-paragraphs2:after {
	content: "Hide Collapsed Paragraphs";
}

/******************************************************************************/

/* Icon Not System Section */
html .section .toggle-system-section i:after {
	content: var(--settings);
	font-family: "Material Design Icons";
}

/* Tooltip Not System Section */
html .section .toggle-system-section:after {
	content: "Activate System Section";
}

/* System Section */
html .section[data-type="system"] .toggle-system-section {
	color: var(--material-color-light-green);
	opacity: 1.0 !important;
}

/* Tooltip Not System Section */
html .section[data-type="system"] .toggle-system-section:after {
	content: "Deactivate System Section";
}

/******************************************************************************/

/* Icon Not Package Section */
html .section .toggle-package-section i:after {
	content: var(--cube-outline);
	font-family: "Material Design Icons";
}

/* Tooltip Not Package Section */
html .section .toggle-package-section:after {
	content: "Activate Package Section";
}

/* Package Section */
html .section[data-type="package"] .toggle-package-section {
	color: var(--material-color-light-green);
	opacity: 1.0 !important;
}

/* Tooltip Not Package Section */
html .section[data-type="package"] .toggle-package-section:after {
	content: "Deactivate Package Section";
}

/******************************************************************************/

/* Collapse Section */
html .section.collapsed .paragraph {
	display: none;
}

html .section .toggle-collapse i:after {
	content: "expand_less";
}

html .section .toggle-collapse:after {
	content: "Collapse";
}

html .section.collapsed .toggle-collapse i:after {
	content: "expand_more";
}

html .section.collapsed .toggle-collapse:after {
	content: "Expand";
}

/******************************************************************************/

/* Hide Section */
html .section .toggle-visibility-section i:after {
	content: "clear";
}

html .section .toggle-visibility-section:after {
	content: "Hide Section";
}

/******************************************************************************/

/* Hide Section */
html .section .drag-handle-section i:after {
	content: "drag_handle";
}

html .section .drag-handle-section:after {
	content: "Drag Section";
}

html .section.dragging-section {
	opacity: .5;
}

/******************************************************************************/

/* Spacing */
html .section .hide-collapsed-paragraphs2,
html .section .toggle-package-section {
	margin-left: 8px;
}

html .section .toggle-collapse {
	margin-right: 0 !important;
}</style></div><div class="paragraph style-paragraph collapsed" name="Paragraph Style" data-id="ZVLeTEZN" draggable="false" style __wid="TRpU3iPY"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="PDMDHNc9">html .paragraph {
	clear: both;
	position: relative;
	margin-top: 10px;
}

html .paragraph div:focus {
	outline: none;
}

html .paragraph pre {
	margin: 0px;
	padding: 0px;
}

html .paragraph pre[type]  {
	display: none;
}

html .paragraph[transient-focussed]:before {
	content: "";
	position: absolute;
	height: 100%;
	width: 0;
	left: -18px;
	border-left: 4px solid rgba(var(--color-accent-rgb), 0.45);
	border-radius: 4px;
}

/******************************************************************************/

html .paragraph .paragraph-header {
	display: flex;
	flex-direction: row-reverse;
	flex-wrap: nowrap;
	justify-content: flex-start;
	position: relative;
	background: var(--color-primary-shade-1);
	width: 100%;
	height: 30px;
	padding: 4px;
	border-radius: 2px;
	overflow-x: auto;
	overflow-y: hidden;
}

html .paragraph .paragraph-header::-webkit-scrollbar {
	display: none;
}

html .paragraph.body-paragraph [data-type="content"] {
	overflow: hidden;
}

/* Reset box-sizing of content paragraphs to their initial value */
html .paragraph.body-paragraph [data-type="content"] * {
	box-sizing: initial;
}

/******************************************************************************/

html .paragraph .paragraph-header .action {
	display: flex;
	cursor: pointer;
	margin-right: 8px;
	opacity: 0.25;
	pointer-events: none;
	font-size: 22px;
	width: 22px;
}

html .paragraph .paragraph-header .action i {
	font-size: 22px;
	width: 22px;
	height: 22px;
}

html .paragraph .paragraph-header .action:hover {
	color: var(--color-accent);
}

html .paragraph .paragraph-header:hover .action {
	pointer-events: initial;
	opacity: 1.0;
}

html .paragraph .paragraph-header .action .material-icons {
	position: relative;
	top: 50%;
	transform: translate3d(0, -50%, 0);
}

html .paragraph .paragraph-header .toggle-fullscreen {
	margin-left: 8px;
}

html .paragraph .paragraph-header .collapse-expand {
	margin-right: 4px;
}</style></div><div class="paragraph style-paragraph collapsed" data-id="zRGMQcXU" name="Paragraph Writing Style  " __wid="jWyyehZj"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="395Zdnp7">html .paragraph.body-paragraph .writing[data-type="content"],
html .paragraph.body-paragraph .section-documentation[data-type="content"] {
	position: inherit;
	font-family: var(--font-secondary);
	color: var(--color-secondary-text);
	font-size: 1rem;
	line-height: 1.5;
	box-sizing: border-box;
	margin: 4px;
	z-index: 0;
}

/******************************************************************************/

html .paragraph.body-paragraph .writing[data-type="content"] h1,
html .paragraph.body-paragraph .writing[data-type="content"] h2,
html .paragraph.body-paragraph .writing[data-type="content"] h3,
html .paragraph.body-paragraph .writing[data-type="content"] h4,
html .paragraph.body-paragraph .writing[data-type="content"] h5,
html .paragraph.body-paragraph .writing[data-type="content"] h6,
html .paragraph.body-paragraph .writing[data-type="content"] div:not([class]),
html .paragraph.body-paragraph .writing[data-type="content"] blockquote,
html .paragraph.body-paragraph .writing[data-type="content"] pre,
html .paragraph.body-paragraph .writing[data-type="content"] table,
html .paragraph.body-paragraph .writing[data-type="content"] ul,
html .paragraph.body-paragraph .writing[data-type="content"] ol,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h1,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h2,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h3,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h4,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h5,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h6,
html .paragraph.body-paragraph .section-documentation[data-type="content"] div:not([class]),
html .paragraph.body-paragraph .section-documentation[data-type="content"] blockquote,
html .paragraph.body-paragraph .section-documentation[data-type="content"] pre,
html .paragraph.body-paragraph .section-documentation[data-type="content"] table,
html .paragraph.body-paragraph .section-documentation[data-type="content"] ul,
html .paragraph.body-paragraph .section-documentation[data-type="content"] ol {
	margin-top: 0;
	margin-bottom: 16px;
}

html .paragraph.body-paragraph .writing[data-type="content"] li,
html .paragraph.body-paragraph .section-documentation[data-type="content"] li {
	margin-bottom: 4px;
}

html .paragraph.body-paragraph .writing[data-type="content"] > *:first-child,
html .paragraph.body-paragraph .section-documentation[data-type="content"] > *:first-child {
	margin-top: 0;
}

html .paragraph.body-paragraph .writing[data-type="content"] a,
html .paragraph.body-paragraph .section-documentation[data-type="content"] a {
	color: var(--color-accent);
}

/******************************************************************************/

html .paragraph.body-paragraph .writing[data-type="content"] h1,
html .paragraph.body-paragraph .writing[data-type="content"] h2,
html .paragraph.body-paragraph .writing[data-type="content"] h3,
html .paragraph.body-paragraph .writing[data-type="content"] h4,
html .paragraph.body-paragraph .writing[data-type="content"] h5,
html .paragraph.body-paragraph .writing[data-type="content"] h6,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h1,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h2,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h3,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h4,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h5,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h6 {
	color: var(--color-primary-text);
	font-weight: 500;
	letter-spacing: 0.02rem;
}

html .paragraph.body-paragraph .writing[data-type="content"] h1,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h1 {
	font-size: 2em;
	border-bottom: 4px solid var(--color-secondary-text);
	margin-top: 48px;
}

html .paragraph.body-paragraph .writing[data-type="content"] h2,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h2 {
	font-size: 1.5em;
	border-bottom: 2px solid var(--color-secondary-text);
	margin-top: 32px;
}

html .paragraph.body-paragraph .writing[data-type="content"] h3,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h3 {
	font-size: 1.25em;
	margin-top: 32px;
}

html .paragraph.body-paragraph .writing[data-type="content"] h4,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h4 {
	font-size: 1.125em;
	margin-top: 24px;
}

html .paragraph.body-paragraph .writing[data-type="content"] h5,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h5 {
	font-size: 1em;
	margin-top: 24px;
}

html .paragraph.body-paragraph .writing[data-type="content"] h6,
html .paragraph.body-paragraph .section-documentation[data-type="content"] h6 {
	font-size: 0.875em;
	margin-top: 16px;
}

/******************************************************************************/

html .paragraph.body-paragraph .writing[data-type="content"] hr,
html .paragraph.body-paragraph .section-documentation[data-type="content"] hr {
	height: 1px;
	padding: 0;
	margin: 16px 0;
	background-color: var(--color-tertiary-text);
	border: 0;
}

/******************************************************************************/

html .paragraph.body-paragraph .writing[data-type="content"] kbd,
html .paragraph.body-paragraph .section-documentation[data-type="content"] kbd {
	margin: 0 2px;
	color: #eee;
	border-radius: 3px;
	padding: 3px 7px;
	min-width: 1em;
	box-shadow: inset 0 0 2px #5a5a5a, 0 0.1em 0.11em rgba(0, 0, 0, 0.9);
	cursor: default;
	background: #000;
	text-align: center;
	text-shadow: none;
	background-color: #101010;
	background-repeat: repeat-x;
	font-family: monospace;
	font-size: 14px;
}

/******************************************************************************/


html .paragraph.body-paragraph .writing[data-type="content"] blockquote,
html .paragraph.body-paragraph .section-documentation[data-type="content"] blockquote {
	padding: 0 1em;
	border-left: 0.25em solid var(--color-secondary-text);
}

html .paragraph.body-paragraph .writing[data-type="content"] blockquote>:first-child,
html .paragraph.body-paragraph .section-documentation[data-type="content"] blockquote>:first-child {
	margin-top: 0;
}

html .paragraph.body-paragraph .writing[data-type="content"] blockquote>:last-child,
html .paragraph.body-paragraph .section-documentation[data-type="content"] blockquote>:last-child {
	margin-bottom: 0;
}

/******************************************************************************/

html .paragraph.body-paragraph .writing[data-type="content"] table,
html .paragraph.body-paragraph .section-documentation[data-type="content"] table {
	display: block;
	width: 100%;
	overflow: auto;
	border-collapse: collapse;
}

html .paragraph.body-paragraph .writing[data-type="content"] table th,
html .paragraph.body-paragraph .section-documentation[data-type="content"] table th {
	font-weight: 700;
	background: var(--color-primary-shade-3);
}

html .paragraph.body-paragraph .writing[data-type="content"] table th,
html .paragraph.body-paragraph .writing[data-type="content"] table td,
html .paragraph.body-paragraph .section-documentation[data-type="content"] table th,
html .paragraph.body-paragraph .section-documentation[data-type="content"] table td {
	padding: 8px;
}

html .paragraph.body-paragraph .writing[data-type="content"] table tr,
html .paragraph.body-paragraph .section-documentation[data-type="content"] table tr{
	background: var(--color-primary-shade-2);
}

html .paragraph.body-paragraph .writing[data-type="content"] table tr:nth-child(2n),
html .paragraph.body-paragraph .section-documentation[data-type="content"] table tr:nth-child(2n) {
	background: var(--color-primary-shade-3);
}

html .paragraph.body-paragraph .writing[data-type="content"] table img,
html .paragraph.body-paragraph .section-documentation[data-type="content"] table img {
	background-color: transparent;
}

/******************************************************************************/

html .paragraph.body-paragraph .writing[data-type="content"] code,
html .paragraph.body-paragraph .writing[data-type="content"] tt,
html .paragraph.body-paragraph .section-documentation[data-type="content"] code,
html .paragraph.body-paragraph .section-documentation[data-type="content"] tt {
	color: var(--color-primary-text);
	padding: 1px 4px;
	margin: 0;
	font-size: 0.9em;
	background-color: var(--color-primary-shade-3);
	border-radius: 3px;
	font-family: var(--font-monospace);
}

html .paragraph.body-paragraph .writing[data-type="content"] code br,
html .paragraph.body-paragraph .writing[data-type="content"] tt br,
html .paragraph.body-paragraph .section-documentation[data-type="content"] code br,
html .paragraph.body-paragraph .section-documentation[data-type="content"] tt br {
	display: none
}

html .paragraph.body-paragraph .writing[data-type="content"] del code,
html .paragraph.body-paragraph .section-documentation[data-type="content"] del code {
	text-decoration: inherit
}

html .paragraph.body-paragraph .writing[data-type="content"] pre,
html .paragraph.body-paragraph .section-documentation[data-type="content"] pre {
	word-wrap: normal
}

html .paragraph.body-paragraph .writing[data-type="content"] pre > code,
html .paragraph.body-paragraph .section-documentation[data-type="content"] pre > code {
	padding: 0;
	margin: 0;
	font-size: 100%;
	word-break: normal;
	white-space: pre;
	background: transparent;
	border: 0
}

html .paragraph.body-paragraph .writing[data-type="content"] .highlight,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .highlight {
	margin-bottom: 16px
}

html .paragraph.body-paragraph .writing[data-type="content"] .highlight pre,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .highlight pre {
	margin-bottom: 0;
	word-break: normal
}

html .paragraph.body-paragraph .writing[data-type="content"] .highlight pre,
html .paragraph.body-paragraph .writing[data-type="content"] pre,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .highlight pre,
html .paragraph.body-paragraph .section-documentation[data-type="content"] pre {
	padding: 16px;
	overflow: auto;
	font-size: 85%;
	line-height: 1.45;
	background-color: var(--color-primary-shade-3);
	border-radius: 3px;
}

html .paragraph.body-paragraph .writing[data-type="content"] pre code,
html .paragraph.body-paragraph .writing[data-type="content"] pre tt,
html .paragraph.body-paragraph .section-documentation[data-type="content"] pre code,
html .paragraph.body-paragraph .section-documentation[data-type="content"] pre tt {
	display: inline;
	max-width: auto;
	padding: 0;
	margin: 0;
	overflow: visible;
	line-height: inherit;
	word-wrap: normal;
	background-color: transparent;
	border: 0;
}

/******************************************************************************/

html .paragraph.body-paragraph .writing[data-type="content"] .info,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .info,
html .paragraph.body-paragraph .writing[data-type="content"] .warning,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .warning,
html .paragraph.body-paragraph .writing[data-type="content"] .danger,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .danger,
html .paragraph.body-paragraph .writing[data-type="content"] .success,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .success {
	display: block;
	font-size: 14px;
	margin: 16px 0;
	padding: 12px 24px 12px 60px;
	border-radius: 2px;
}

html .paragraph.body-paragraph .writing[data-type="content"] .info > *:last-child,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .info > *:last-child,
html .paragraph.body-paragraph .writing[data-type="content"] .warning > *:last-child,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .warning > *:last-child,
html .paragraph.body-paragraph .writing[data-type="content"] .danger > *:last-child,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .danger > *:last-child,
html .paragraph.body-paragraph .writing[data-type="content"] .success > *:last-child,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .success > *:last-child {
	margin-bottom: 0;
}

html .paragraph.body-paragraph .writing[data-type="content"] .info:before,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .info:before,
html .paragraph.body-paragraph .writing[data-type="content"] .warning:before,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .warning:before,
html .paragraph.body-paragraph .writing[data-type="content"] .danger:before,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .danger:before,
html .paragraph.body-paragraph .writing[data-type="content"] .success:before,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .success:before {
	float: left;
	font: normal normal normal 24px/1 'Material Icons';
	font-feature-settings: 'liga';
	text-rendering: optimizeLegibility;
	word-wrap: normal;
	margin-left: -36px;
}

html .paragraph.body-paragraph .writing[data-type="content"] .info,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .info {
	background: #e1f5fe;
	color: #0288d1;
}

html .paragraph.body-paragraph .writing[data-type="content"] .info:before,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .info:before {
	color: #039be5;
	content: 'star';
}

html .paragraph.body-paragraph .writing[data-type="content"] .warning,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .warning {
	background: #fff3e0;
	color: #dd2c00;
}

html .paragraph.body-paragraph .writing[data-type="content"] .warning:before,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .warning:before {
	color: #ff6e40;
	content: 'error';
}

html .paragraph.body-paragraph .writing[data-type="content"] .danger,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .danger {
	background: #fbe9e7;
	color: #d50000;
}

html .paragraph.body-paragraph .writing[data-type="content"] .danger:before,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .danger:before {
	color: #ff1744;
	content: 'warning';
}

html .paragraph.body-paragraph .writing[data-type="content"] .success,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .success {
	background: #e0f2f1;
	color: #00897b;
}

html .paragraph.body-paragraph .writing[data-type="content"] .success:before,
html .paragraph.body-paragraph .section-documentation[data-type="content"] .success:before {
	color: #00bfa5;
	content: 'check_circle';
}</style></div><div class="paragraph style-paragraph collapsed" name="Paragraph Title Style" draggable="false" data-id="n64A599U" __wid="6GPcWFDa"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="vVPsWf3M">html .paragraph .paragraph-header:before {
	font-family: "Material Icons";
	font-weight: normal;
	font-style: normal;
	display: inline-block;
	line-height: 1;
	text-transform: none;
	letter-spacing: normal;
	word-wrap: normal;
	white-space: nowrap;
	direction: ltr;
	text-rendering: optimizeLegibility;
	font-feature-settings: "liga";

	flex: 0 0 auto;
	font-size: 18px;
	padding: 2px;
	margin-right: 8px;
	order: 999;
	margin-left: 4px;
}

/******************************************************************************/

html .paragraph.body-paragraph .paragraph-header:before {
	content: "text_fields";
}

html .paragraph.code-paragraph .paragraph-header:before {
	content: "code";
}

html .paragraph.style-paragraph .paragraph-header:before {
	content: "brush";
}

html .paragraph.data-paragraph .paragraph-header:before {
	content: "storage";
}

/******************************************************************************/

html .paragraph .paragraph-header .input {
	font-size: 14px;
	line-height: 22px;
	margin-right: 16px;
	flex: 0 0 auto;
}

html .paragraph .paragraph-header .input:before {
	color: var(--color-accent);
}

html .paragraph .paragraph-header .input:focus {
	outline: none;
}

html .paragraph .paragraph-header .input:empty:focus {
	padding-left: 1px;
	/*outline: 1px solid var(--color-primary-text);
	opacity: 1.0;
	animation-name: blink-cursor;
	animation-duration: 500ms;
	animation-direction: alternate;
	animation-iteration-count: infinite;
	animation-timing-function: ease-in-out;*/
}

html .paragraph .paragraph-header .input:empty:focus:before {
	content: "";
}

html .paragraph .paragraph-header .input:empty:before {
	opacity: 0;
	pointer-events: none;
}

html .paragraph .paragraph-header:hover .input:empty:before {
	opacity: 1.0;
	pointer-events: all;
}

/******************************************************************************/

html .paragraph .paragraph-header .name-input {
	order: 998;
}

html .paragraph .paragraph-header .id-input {
	order: 997;
}

html .paragraph .paragraph-header .class-input {
	order: 996;
	flex: 1 0 auto;
}

/******************************************************************************/

html .paragraph .paragraph-header .name-input:empty:before {
	content: "name";
}

html .paragraph .paragraph-header .id-input:not(:empty):before {
	content: "#";
}

html .paragraph .paragraph-header .id-input:empty:before {
	content: "#id";
}

html .paragraph .paragraph-header .class-input:before {
	content: "class: ";
}

html .paragraph .paragraph-header select {
  border: 0;
  font-family: var(--font-primary);
	text-align-last: right;
  outline: 0;
  opacity: 0;
}

html .paragraph .paragraph-header:hover select {
  opacity: 1;
}</style></div><div class="paragraph style-paragraph collapsed" name="Paragraph Collapse Style" draggable="false" data-id="gKnfCRJB" __wid="ZKN2BPXz"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="NPTZD4Kb">/* Icon expanded */
html .collapse-expand i:after {
	content: "expand_less";
}

/* Tooltip expanded */
html .collapse-expand:after {
	content: "Collapse";
}

/* Icon collapsed */
html .paragraph.collapsed .collapse-expand i:after {
	content: "expand_more";
}

/* Tooltip collapsed */
html .paragraph.collapsed .collapse-expand:after {
	content: "Expand";
}

/* Hide all content of a paragraph except the paragraph header */
html .paragraph.collapsed > *:not(.paragraph-header) {
	display: none;
}</style></div><div class="paragraph style-paragraph collapsed" name="Lock Paragraph Style" draggable="false" data-id="LM22iaJk" style __wid="YVP4bUhe"><style data-type="content" type="text/css" codemirror="true" contenteditable="true" class="themable" __wid="wvtj3wHm">html .paragraph:not(:hover):not(.locked) .paragraph-header .lock-content {
	opacity: 0.25;
	pointer-events: none;
}

html .paragraph.locked .paragraph-header .lock-content {
	opacity: 1.0;
}

html .paragraph.locked .text-tools {
	display: none;
}

/* Icon Lock */
html .paragraph .paragraph-header .lock-content i:after {
	content: "lock_open";
}

/* Tooltip Lock */
html .paragraph .paragraph-header .lock-content:after {
	content: "Lock";
}

/* Icon Unlock */
html .paragraph.locked .paragraph-header .lock-content i:after {
	content: "lock_outline";
}

/* Tooltip Unlock */
html .paragraph.locked .paragraph-header .lock-content:after {
	content: "Unlock";
}</style></div><div class="paragraph style-paragraph collapsed" name="Paragraph Delete Action Style" draggable="false" data-id="8vZywFM8" __wid="TAAARdcR"><style data-type="content" type="text/css" codemirror="true" contenteditable="true" class="themable" __wid="LuYniJ5m">html .paragraph .delete-paragraph {
	margin-right: 10px;
}

/* Icon Delete */
html .paragraph .delete-paragraph i:after {
	content: "delete";
}

/* Tooltip Delete */
html .paragraph .delete-paragraph:after {
	content: "Delete";
}

html .paragraph .delete-paragraph:hover i:after {
	color: var(--material-color-red);
}</style></div><div class="paragraph style-paragraph collapsed" name="Paragraph Sortable Style" draggable="false" data-id="C6eX72vd" style __wid="fEPTDuHC"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="6p2i43aY">html .paragraph .drag-handle {
	cursor: -webkit-grabbing;
	cursor: move;
	opacity: 0;
	pointer-events: none;
}

html .paragraph.dragging > * {
	pointer-events: none;
}

html .paragraph.dragging {
	opacity: 0.5;
}

/* Icon Drag Handle */
html .paragraph .drag-handle i:after {
	content: "drag_handle";
}</style></div><div class="paragraph style-paragraph collapsed" name="Variable Style" draggable="false" data-id="LWYEJJ2X" style __wid="JGgRGVnj"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="hxKEFCRC">html .variable {
	position: relative;
	display: inline;
	color: var(--material-color-light-blue);
}

html .variable:empty:before {
	content: attr(data-name) " (unset)";
}

html .variable:before {
	content: attr(data-name) " = ";
	color: var(--color-accent);
	opacity: .5;
}

html .hide-variable-names .variable:not(:empty):before {
	display: none;
}

html .hide-variable-names .variable:not(:empty):hover:before {
	content: attr(data-name);
	position: absolute;
	top: 0;
	left: 0;
	transform: translate3d(0, -100%, 0);
	display: inline-block;
	border-radius: 2px;
	font-size: .8em;
	padding: 2px;
	color: white;
	background: rgb(135, 135, 129);
	opacity: 1.0;
	/* border: 5px solid transparent; */
}</style></div><div class="paragraph body-paragraph locked collapsed" data-id="cd3ZSwuB" name="Section-Documentation/Writing Style Examples" style draggable="false" __wid="BJ6xKZAV"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="writing" __wid="zvmXS3Rc"><h1 __wid="mNqfgfST">Header 1</h1>
<h2 __wid="LY78ArpF">Header 2</h2>
<h3 __wid="fxygBAib">Header 3</h3>
<h4 __wid="GiUJcHki">Header 4</h4>
<h5 __wid="Rya3PR2c">Header 5</h5>
<h6 __wid="thmZMKt5">Header 6</h6>
<hr __wid="me7dgRjM"/>
<ul __wid="SGfudT8W">
	<li __wid="m7tg2u5A">Unordered List 1</li>
	<li __wid="KvB59pTQ">Unordered List 2</li>
	<li __wid="s5dKmsiF">Unordered List 3</li>
</ul>
<hr __wid="gC8CApVp"/>
<ol __wid="fFsKfgeQ">
	<li __wid="f86YZkMG">Ordered List 1</li>
	<li __wid="Nq2PvRc8">Ordered List 2</li>
	<li __wid="bq6u6SDd">Ordered List 3</li>
</ol>
<hr __wid="dHwqGyuz"/>
<div __wid="aFNMVC4F">Preformatted code inline: <code __wid="TKp8hcEj">let fun = (a, b) => {}</code></div>
<hr __wid="s3gat9yB"/>
<div __wid="7uLLuyAJ">Preformatted code paragraph:</div>
<pre __wid="VUYPmrMn"><code __wid="zEA9QQAj">let fun = (a, b) => {
  return a + b;
};</code></pre>
<hr __wid="AuijGrfz"/>
<div __wid="JW3mJgqi">Keyboard shortcuts: <kbd __wid="vs6VByyc">Ctrl</kbd>+<kbd __wid="3WuugGfe">C</kbd></div>
<hr __wid="xGdV4QZ7"/>
<div class="info" __wid="pRDdCuzh">
	<div __wid="YxsjcSyb"><b __wid="XennpFfz">Info:</b> Important information.</div>
	<div __wid="Z8gb5P7Z">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</div>
</div>
<div class="warning" __wid="jTkMcvpG">
	<div __wid="K86k5exY"><b __wid="4EHNLcQU">Warning:</b> Important information.</div>
	<div __wid="pYTD7Qd8">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</div>
</div>
<div class="danger" __wid="pTQtbEAK">
	<div __wid="yYz6HZPF"><b __wid="tsfRCYku">Danger:</b> Important information.</div>
	<div __wid="YTHPxGJf">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</div>
</div>
<div class="success" __wid="4frCsLpX">
	<div __wid="CheG7PMm"><b __wid="DpM7wnHc">Success:</b> Important information.</div>
	<div __wid="FyTAniPC">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</div>
</div></div></div></div><div class="section section-hidden" data-id="4c7TWuGG" name="Tagging and Versioning" data-type="system" __wid="CYXEiFPy"><div class="paragraph body-paragraph" name="Documentation" data-id="3cSPW5AZ" __wid="yXZFTxUi"><div data-type="content" type="text/html" codemirror="true" contenteditable="true" class="section-documentation" __wid="EugxvDKc"><h2 __wid="5McmFeYn">Description</h2><div __wid="C9Cnknaw">Tagging and versioning support for Codestrates.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="7VpRRVdK" __wid="wqrhdbGK"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="4kcezc3N">{
  "version": "1.0",
  "description": "Tagging and versioning support for Codestrates.",
  "changelog": {
    "1.0": "Initial version."
  }
}</pre></div><div class="paragraph code-paragraph collapsed" last-execution-state="success" name="Show Tags Dialog" data-id="JTLwYcxH" style draggable="false" __wid="H7cgE65C"><pre data-type="content" type="text/javascript" id="tag-dialog" __wid="9fKLhCbH">/**
 * Shows a dialog displaying tags of the Codestrate and allowing for restoring them.
 */
exports.show = () => {
	const transient = document.createElement("transient");

	const tags = webstrate.tags();
	const keys = Object.keys(tags);
	keys.reverse();

	let tagElementsString = "&lt;ul class='tags'>";
	let len = keys.length > 10 ? 10 : keys.length;
	for (var i = 0; i &lt; len; i++) {
		tagElementsString += `&lt;li class="tag" data-key="${keys[i]}" data-tag="${tags[keys[i]]}">${tags[keys[i]]}&lt;/li>`;
	}
	tagElementsString += "&lt;/ul>";

	const elements = require("#dialog-template", {
		title: "Restore Codestrate",
		message: tagElementsString,
		actions: `&lt;div class="button cancel">Cancel&lt;/div>`,
		className: ""
	});

	elements.forEach(e => transient.appendChild(e));

	const tagElements = Array.from(transient.querySelectorAll(".tag"));
	tagElements.forEach(element => {
		element.addEventListener("click", e => {
			const tag = element.getAttribute("data-tag");
			webstrate.restore(tag);
			window.location.reload();
		});
	});

	const cancelBtn = transient.querySelector(".cancel");

	const cancel = () => {
		transient.remove();
	};

	cancelBtn.addEventListener("click", e => {
		transient.remove();
	});

	document.body.appendChild(transient);
};</pre></div><div class="paragraph style-paragraph collapsed" name="Show Tags Dialog Style" data-id="2yNTLyMH" style draggable="false" __wid="CfRPmJiz"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="YJUrD94J">html .dialog ul.tags {
	list-style-type: none;
	margin: 0;
	padding: 0;
}

html .dialog ul li.tag {
	padding: 6px 8px;
	cursor: pointer;
	border-radius: 2px;
}

html .dialog ul li.tag:hover {
	background-color: var(--color-primary-shade-2);
}</style></div><div class="paragraph code-paragraph collapsed" data-id="4hgY8Ghp" run-on-load="true" name="Toast message when tagged" __wid="wZSW5icx"><pre data-type="content" type="text/javascript" __wid="XkT5mtJf">webstrate.on("tag", (version, label) => {
  toast(`Codestrate tagged as ${label} at version ${version}`);
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="bpAafExi" name="Tagging command, menu item, and key binding" run-on-load="true" last-execution-state="success" __wid="p3XzxART"><pre data-type="content" type="text/javascript" __wid="TWYUXJ7X">const GlobalMenuUtils = require("#global-menu-utils");
const TagDialog = require("#tag-dialog");

/******************************************************************************/

Codestrate.addCommand("codestrates.tagCodestrate", "Tag Codestrate", async() => {
	const tagName = await prompt("Set a tag name:", "", "Tag Codestrate");
	if (tagName) {
		webstrate.tag(tagName);
	}
}, "Opens a tagging dialog to create a tag of the current codestrate version");

const tagCodestrateButton = GlobalMenuUtils.createButton("Tag Codestrate", false, () => {
	Codestrate.executeCommand("codestrates.tagCodestrate");
});

Codestrate.addKeyBinding("codestrates.tagCodestrate", "mod+alt+t");

/******************************************************************************/

Codestrate.addCommand("codestrates.restoreCodestrate", "Restore Codestrate", () => {
	TagDialog.show();
}, "Opens the restore tag dialog to restore a codestrate from a tagged version");

const restoreCodestrateButton = GlobalMenuUtils.createButton("Restore Codestrate", false, () => {
	Codestrate.executeCommand("codestrates.restoreCodestrate");
});

Codestrate.addKeyBinding("codestrates.restoreCodestrate", "mod+alt+r");

/******************************************************************************/

GlobalMenuUtils.addMenuItemToSubMenu(tagCodestrateButton, "Codestrate");
GlobalMenuUtils.addMenuItemToSubMenu(restoreCodestrateButton, "Codestrate");</pre></div></div><div class="section section-hidden" data-id="UnbAUgSD" name="Persistent Log" data-type="system" __wid="SQd93WBh"><div class="paragraph body-paragraph locked collapsed" data-id="CPbsSvPY" name="Documentation" __wid="qHHDhe5m"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="iwKcQAJw"><h2 __wid="hYuvhFF9">Description</h2>
<div __wid="fFwG2qLt">Provides a simple logging functionality for events. It is persistent over reloads and system section updates as it is written directly to the DOM.</div>
<h2 __wid="Sj8vNmpc">Usage</h2>
<div __wid="L9jwBvEN">The section provides the following functions:</div>
<ul __wid="WASMZErs">
	<li __wid="JtefTuSE"><code __wid="MKdKGm6f">Codestrate.persistentLog.log(message[, logName = "Default", rootDocument = document])</code></li><li __wid="zWdp5eGT"><code __wid="4JgXHgRS">Codestrate.persistentLog.debug(message[, logName = "Default", rootDocument = document])</code></li>
	<li __wid="pBfj5hyJ"><code __wid="MPUuPNvv">Codestrate.persistentLog.info(message[, logName = "Default", rootDocument = document])</code></li>
	<li __wid="PsUvd6uW"><code __wid="ykU3P7vj">Codestrate.persistentLog.warn(message[, logName = "Default", rootDocument = document])</code></li>
	<li __wid="ceQ472L3"><code __wid="jar76AAG">Codestrate.persistentLog.error(message[, logName = "Default", rootDocument = document])</code></li>
</ul>
<h2 __wid="rgT4rATC">Parameters</h2>
<ul __wid="XnaeDCXX">
	<li __wid="gj9BivEE">The content of the <code __wid="DVC6KZSd">message</code> will be written into a body paragraph in a section with the name "Codestrate Log".</li>
	<li __wid="HysF2CED">The optional <code __wid="FFfNXs5y">logName</code> parameter can be used to create multiple logging paragraphs (e.g. for different uses).</li>
	<li __wid="ZBcb684D">The other optional parameter <code __wid="kBLcVmtb">rootDocument</code> allows to set a different rootDocument to be used for logging (e.g. setting it <code __wid="fCLKHay4">iframe.contentWindow.document</code> allows for logging into other Codestrates).</li>
</ul></div></div><div class="paragraph data-paragraph locked collapsed" data-id="FuYkaiEG" name="Properties" __wid="HNxSMFJE"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="HFCzFvNk">{
	"version": "1.1",
	"description": "A log, which persists reloads and system section updates.",
	"changelog":
	{
		"1.1": "Renamed Log Output, added trimming of entries, added description.",
		"1.0.1": "Updated documentation.",
		"1.0": "Initial Release"
	}
}</pre></div><div class="paragraph code-paragraph collapsed" data-id="9X8hhTX2" name="Persistent Log" run-on-load="true" style draggable="false" last-execution-state="success" __wid="NpwxkMHQ"><pre data-type="content" type="text/javascript" __wid="GTFXmGeu">const ParagraphUtils = require("#paragraph-utils");

/******************************************************************************/

const persistentLogSectionName = "Codestrate Log";
const maxEntryCount = 1000;

/******************************************************************************/

Codestrate.persistentLog = {
	log: (message, logName, rootDocument) => addLogEntry(message, logName, rootDocument),
	debug: (message, logName, rootDocument) => addLogEntry(message, logName, rootDocument, "debug"),
	info: (message, logName, rootDocument) => addLogEntry(message, logName, rootDocument, "info"),
	warn: (message, logName, rootDocument) => addLogEntry(message, logName, rootDocument, "warn"),
	error: (message, logName, rootDocument) => addLogEntry(message, logName, rootDocument, "error")
};

/******************************************************************************/

// Computes an ID out of a log name
const logId = (logName) => {
	return `-${logName.toLowerCase().replace(/ /g,"-")}`;
};

// Creates a new log paragraph
const createLogParagraph = (logName) => {
	const bodyParagraph = ParagraphUtils.createBodyParagraph();
	bodyParagraph.setAttribute("name", `Persistent Log ${logName}`);
	bodyParagraph.classList.add("locked");

	const content = bodyParagraph.querySelector("[data-type='content']");
	content.setAttribute("contenteditable", "false");
	content.id = `persistent-log${logId(logName)}`;
	content.classList.add("persistent-log");

	return bodyParagraph;
};

// Creates the log section
const createLogSection = () => {
	const section = document.createElement("div");
	section.classList.add("section");
	section.classList.add("section-hidden");
	section.setAttribute("name", persistentLogSectionName);

	const description = ParagraphUtils.createBodyParagraph();
	description.setAttribute("name", "Documentation");
	description.classList.add("locked");

	const content = description.querySelector("[data-type='content']");
	content.setAttribute("contenteditable", "false");
	content.classList.add("section-documentation");

	content.innerHTML = `&lt;h2>Description&lt;/h2>
&lt;div>The &lt;b>Codestrate Log&lt;/b> logs acitivies like updates of system sections or packages.&lt;/div>
&lt;div>It can be removed at any time by the user. This section will be newly created automatically if it is not available.&lt;/div>`;

	section.appendChild(description);
	return section;
};

// Adds new entries to a log
const addLogEntry = (message, logName = "Default", rootDocument = false, logClass = false) => {

	if (!rootDocument) rootDocument = document;

	let persistentLogParagraph = rootDocument.getElementById(`persistent-log${logId(logName)}`);

	// Check if paragraph is already available
	if (!persistentLogParagraph) {
		let persistentLogSection = rootDocument.querySelector(`.section[name="${persistentLogSectionName}"]`);

		// Check if section is already available
		if (!persistentLogSection) {
			persistentLogSection = createLogSection();
			const sections = rootDocument.getElementById("sections");
			sections.insertBefore(persistentLogSection, sections.firstChild);
		}

		persistentLogParagraph = createLogParagraph(logName);
		persistentLogSection.appendChild(persistentLogParagraph);

		persistentLogParagraph = rootDocument.getElementById(`persistent-log${logId(logName)}`);
	}

	// Create new entry and add it to the log
	const entry = rootDocument.createElement("p");
	entry.innerHTML = `[${new Date().toISOString()}] ${message}`;
	if (logClass) entry.classList.add(logClass);

	persistentLogParagraph.insertBefore(entry, persistentLogParagraph.firstChild);

	// Trim lines
	while (persistentLogParagraph.childElementCount > maxEntryCount) {
		persistentLogParagraph.lastElementChild.remove();
	}

	return true;
};</pre></div><div class="paragraph style-paragraph collapsed" data-id="eGQSiWkH" name="Persistent Log Style" __wid="ZX8hmzB2"><style data-type="content" type="text/css" codemirror="true" __wid="TJN4Qgzp" class="themable">html .paragraph .persistent-log[data-type="content"] {
	font-family: var(--font-monospace);
	font-size: 0.875rem;
}

html .paragraph .persistent-log[data-type="content"] p {
	color: var(--color-primary-text);
	margin-top: 0;
	margin-bottom: 0;
}

html .paragraph .persistent-log[data-type="content"] p.debug {
	color: var(--color-tertiary-text);
}

html .paragraph .persistent-log[data-type="content"] p.info {
	color: var(--material-color-light-blue);
}

html .paragraph .persistent-log[data-type="content"] p.warn {
	color: var(--material-color-orange);
}

html .paragraph .persistent-log[data-type="content"] p.error {
	color: var(--material-color-red);
}</style></div></div><div class="section section-hidden" data-id="LCcYNngp" name="Section Pulling" data-type="system" data-group="editing" __wid="VtVNi9jG"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="kLGMzKFm" __wid="bZwZQVZc"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="mFiHeGZH"><h2 __wid="K7tyTHQt">Description</h2><div __wid="AkPE7tvy">Helper functions for package and system section pulling and updating.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="SMDkHRJ6" style __wid="b7zQ2YDq"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="iWZMudnC">{
  "version": "1.1.6",
  "description": "Helper functions for package and system section pulling.",
  "changelog": {
    "1.0": "Initial Release",
    "1.1": "Updated section pulling dialog.",
    "1.1.1": "Added the 'optional' dependency attribute to the package properties template.",
    "1.1.2": "Added the 'usage' property for optional dependencies.",
    "1.1.3": "Added 'github' to package property template.",
    "1.1.4": "Added 'tags' to package property template.",
    "1.1.5": "Renamed action buttons on pull section dialog.",
    "1.1.6": "Updated templates to use spaces instead of tabs."
  }
}</pre></div><div class="paragraph body-paragraph locked collapsed" data-id="xVvLC9p6" name="Documentation Template" __wid="8w84aHeZ"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" id="section-documentation-template" __wid="zcm2igBi"><h2 __wid="wVMJnvyc">Description</h2>
<div __wid="T9UNumDy">Your description...</div></div></div><div class="paragraph data-paragraph locked collapsed" data-id="bcEm6CE3" name="System Section Properties Template" __wid="NfV9VgfS"><pre data-type="content" type="application/json" contenteditable="false" id="system-section-properties-template" __wid="xcnayubr">{
  "version": "1.0",
  "description": "Your short description.",
  "changelog": {
    "1.0": "Initial version."
  }
}</pre></div><div class="paragraph data-paragraph locked collapsed" name="Package Section Properties Template" data-id="wN79wgzT" __wid="qHtgbr8D"><pre data-type="content" type="application/json" contenteditable="false" id="package-section-properties-template" __wid="Cw9m63Za">{
  "version": "1.0",
  "icon": "your_material_icon_string",
  "description": "Your short description.",
  "tags": [
    "Your tags"
  ],
  "assets": [
    "yourAssets.js"
  ],
  "dependencies": [
    {
      "id": "Dependency section-id",
      "name": "Dependency Name",
      "optional": false,
      "usage": "Short explanation for what features a optional dependeny is used."
    }
  ],
  "changelog": {
    "1.0": "Initial version."
  },
  "github": {
    "url": "https://github.com/UserName/Repository",
    "folder": "optional/path/to/package"
  }
}</pre></div><div class="paragraph code-paragraph collapsed" name="Section Pulling Utils" data-id="S3da4Svm" draggable="false" style __wid="UwnQrBHM"><pre data-type="content" type="text/javascript" id="section-pulling-utils" __wid="gdgrtvBN">/**
 * Gets the properties of a system section or package.
 *
 * @param sectionElement Section HTML element.
 *
 * @return Properties of the section as an object.
 */
exports.getSectionProperties = (sectionElement) => {
	const name = sectionElement.getAttribute("name") || "";
	const id = sectionElement.getAttribute("data-id") || "";
	const uninstalled = sectionElement.classList.contains("uninstalled");

	if (!name) console.warn("There are sections without an 'name' attribute!");
	if (!id) console.error("There are sections without an 'data-id' attribute!");

	const propertiesElement = sectionElement.querySelector(".section-properties");

	if (propertiesElement) {
		try {
			const properties = JSON.parse(propertiesElement.innerHTML);
			if (properties && typeof properties === "object") {
				properties.name = name;
				properties.id = id;
				properties.uninstalled = uninstalled;
				return properties;
			}
		} catch (e) {
			console.error(`Could not parse section properties for section "${name}" with id "${id}"!`);
		}
	} else {
		console.warn(`Could not find section properties for section "${name}" with id "${id}"!`);
	}

	return { name: name, id: id, uninstalled: uninstalled };
};

/******************************************************************************/

/**
 * Gets the properties of a multiple system sections or packages.
 *
 * @param sectionElements Array of section HTML elements.
 *
 * @return Properties of the section as an object.
 */
exports.getMultipleSectionProperties = (sectionElements) => {
	return sectionElements.map(sectionElement => exports.getSectionProperties(sectionElement));
};

/******************************************************************************/

/**
 * Extends the properties by getting information about the currently installed version.
 *
 * @param prototypeSectionProperties Properties of the sections of the prototype.
 * @param localSectionProperties     Properties of the sections of the local Codestrate.
 *
 * @return Comined section stati.
 */
exports.getSectionStati = (prototypeSectionProperties, localSectionProperties) => {
	const sectionStati = [];

	const prototypePropertiesCopy = [...prototypeSectionProperties];
	const localPropertiesCopy = [...localSectionProperties];

	while (prototypePropertiesCopy.length !== 0 ||
				 localPropertiesCopy.length !== 0) {

		// Get new properties pair
		let prototypeProperties;
		let localProperties;

		if (prototypePropertiesCopy.length !== 0) {
			prototypeProperties = prototypePropertiesCopy.shift();
			localProperties = localPropertiesCopy.find(properties => (properties.id === prototypeProperties.id));
			if (localProperties) {
				localProperties = localPropertiesCopy.splice(localPropertiesCopy.indexOf(localProperties), 1)[0];
			}
		} else {
			localProperties = localPropertiesCopy.shift();
		}

		// Set general status properties
		const sectionStatus = {};

		if (prototypeProperties) {
			sectionStatus.prototype = true;
			sectionStatus.prototypeProperties = prototypeProperties;
			sectionStatus.id = prototypeProperties.id;
			sectionStatus.name = prototypeProperties.name;
			if (prototypeProperties.icon) {
				sectionStatus.icon = prototypeProperties.icon;
			}
		} else {
			sectionStatus.prototype = false;
		}

		if (localProperties) {
			sectionStatus.local = true;
			sectionStatus.localProperties = localProperties;
			sectionStatus.id = localProperties.id;
			sectionStatus.name = localProperties.name;
			if (localProperties.icon) {
				sectionStatus.icon = localProperties.icon;
			}
		} else {
			sectionStatus.local = false;
		}

		// Compute new dependencies
		if (sectionStatus.prototype && sectionStatus.local) {
			sectionStatus.both = true;

			if (prototypeProperties.version && localProperties.version) {
				sectionStatus.versionChanged = (prototypeProperties.version !== localProperties.version);
			}
		} else {
			sectionStatus.both = false;
		}

		if (!sectionStatus.icon) {
			sectionStatus.icon = "";
		}

		sectionStati.push(sectionStatus);
	}

	return sectionStati;
};

/******************************************************************************/

/**
 * Helper function for finding sections with an specific ID.
 *
 * @param sections Section HTML elements to search from.
 * @param id       ID of the section to search.
 *
 * @return Found section element
 */
exports.findSection = (sections, id) => {
	return sections.find(section => (section.getAttribute("data-id") === id));
};

/******************************************************************************/

/**
 * Opens a dialog to select a Codestrate and version to pull from.
 *
 * @param defaultPullFrom    Default Codestrate to pull from.
 * @param defaultPullVersion Default version of Codestrate to pull from.
 * @param dialogTitle        The title of the dialog.
 * @param pullDataList       A list of commbinations of names and versions. Has
 *                           to be an array of pullData objects.
 *
 * @return User selected parent and version or false.
 */
exports.showPullSectionsDialog =
	(defaultPullFrom = "", defaultPullVersion = "HEAD", dialogTitle = "Pull Sections", pullDataList = false) => {

	return new Promise((resolve, reject) => {

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: dialogTitle,
			message: `${pullDataList ? `&lt;select class="pull-data-list">${pullDataList.map(pullData => `&lt;option value="${pullData.pullFrom};${pullData.pullVersion}">${pullData.pullFrom} ${pullData.pullVersion}&lt;/option>`).join("")}
&lt;/select>` : ""}
&lt;div>From what codestrate do you want to pull/push?&lt;/div>
&lt;input class="pull-from" value="${defaultPullFrom}" placeholder="Codestrate Name" required>
&lt;div>From what version do you want to pull/push?&lt;/div>
&lt;input class="pull-version" value="${defaultPullVersion}" placeholder="Codestrate Version or Tag" required>`,
			actions: `
&lt;div class="button ok">${pullDataList ? "Update" : "Overwrite"}&lt;/div>
&lt;div class="button cancel">Cancel&lt;/div>
`,
			className: ""
		});

		elements.forEach(e => transient.appendChild(e));

		const okBtn = transient.querySelector(".ok");
		const cancelBtn = transient.querySelector(".cancel");
		const pullDataListSelect = transient.querySelector(".pull-data-list");
		const pullFromInput = transient.querySelector(".pull-from");
		const pullVersionInput = transient.querySelector(".pull-version");

		const updateSelect = () => {
			if (pullDataListSelect) pullDataListSelect.value = pullFromInput.value + ";" + pullVersionInput.value;
		};

		const updateInputs = () => {
			const pullData = pullDataListSelect.value.split(";");
			pullFromInput.value = pullData[0];
			pullVersionInput.value = pullData[1];
		};

		if (pullDataListSelect) pullDataListSelect.addEventListener("change", () => updateInputs());
		pullFromInput.addEventListener("change", () => updateSelect());
		pullVersionInput.addEventListener("change", () => updateSelect());

		updateSelect();

		const ok = () => {
			const pullFrom = pullFromInput.value;
			const pullVersion = pullVersionInput.value;

			transient.remove();

			resolve({
				pullFrom,
				pullVersion
			});
		};

		const cancel = () => {
			transient.remove();
			resolve(false);
		};

		const inputEventHandler = (e) => {
			e.stopPropagation();

			if (e.keyCode === 13) {
				e.preventDefault();
				ok();
			}
			else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
		};

		pullFromInput.addEventListener("keydown", inputEventHandler);
		pullVersionInput.addEventListener("keydown", inputEventHandler);

		okBtn.addEventListener("click", ok);
		cancelBtn.addEventListener("click", cancel);

		document.body.appendChild(transient);

		pullFromInput.focus();
	});
};

/******************************************************************************/

/**
 * Generates URL to pull from using parent and version.
 *
 * @param pullFrom    Codestrate to pull from.
 * @param pullVersion Version of Codestrate to pull from.
 *
 * @return URL to the Codestrate.
 */
exports.generatePullUrl = (pullFrom, pullVersion) => {
	let versionOrTag = pullVersion;
	if (versionOrTag === "HEAD") {
		versionOrTag = null;
	}

	return versionOrTag ? `/${pullFrom}/${versionOrTag}/` : `/${pullFrom}/`;
};

/******************************************************************************/

/**
 * Loads a webstrate into an transient iframe for section pulling.
 *
 * @param url URL to the prototype.
 *
 * @return iFrame with prototype.
 */
exports.loadPrototype = (url) => {

	return new Promise((resolve, reject) => {

		const transient = document.createElement("transient");

		// Transclude prototype webstrate only once
		let iframe = document.querySelector(`iframe[src="${url}"]`);
		if (iframe) {
			if (iframe.webstrate.transcluded) {
				resolve(iframe);
				return;
			}
		} else {
			iframe = document.createElement("iframe");
			iframe.setAttribute("src", url);
			iframe.style.display = "none";
			transient.appendChild(iframe);
			document.body.appendChild(transient);
		}

		const timeout = setTimeout(() => {
			alert(`Failed to load prototype Codestrate from URL "${url}".`, "Prototype URL Error");
			resolve(iframe);
		}, 10000);

		iframe.webstrate.on("transcluded", (webstrateId) => {
			clearTimeout(timeout);
			resolve(iframe);
			return;
		});
	});
};</pre></div></div><div class="section section-hidden" data-id="g7rZgJGd" name="Pull System Section" data-type="system" data-group="editing" __wid="gAK3DF2r"><div class="paragraph body-paragraph locked collapsed" data-id="Yr4Nz8dH" name="Documentation" __wid="3kcBKPQx"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="97GCEn7v"><h2 __wid="ejMTd8Hq">Description</h2><div __wid="udKUW63w">Adds the functionality to update and overwrite system sections with the ones of other Codestrates. It adds the following entries to the global menu:</div>
<h3 __wid="DL8hUt8L">Update System Sections</h3><div __wid="KHPLBMLu">This action let's the user update selected system sections. It will only add or overwrite the <b __wid="ctGtSmsH">selected </b>system sections.</div>
<!--<h3>Update All System Sections</h3><div>This action updates all system sections, which are available <b>both </b>locally and on the remote Codestrate.</div>-->
<h3 __wid="LbTrN7Yi">Overwrite System Sections</h3><div __wid="DrCCKC4P">This action will overwrite <b __wid="CB5Sidj3">all </b>local system sections with <b __wid="VYZkErcp">all </b>system sections of the remote Codestrate.</div></div></div><div class="paragraph data-paragraph collapsed locked" data-id="prBhRkPf" name="Properties" __wid="47SZkeJL"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="stF9rjRf">{
  "version": "1.2.7",
  "description": "Functionality to update system sections.",
  "changelog": {
    "1.0": "Initial Release",
    "1.1": "Added documentation and fixed bug in 'Update All System Sections'.",
    "1.2": "Updated 'Update System Sections' dialog.",
    "1.2.1": "Added webstrate version to persistent logging.",
    "1.2.2": "Better section selection usability in dialog.",
    "1.2.3": "Commands API used.",
    "1.2.4": "Also display ids of updated sections in the tag.",
    "1.2.5": "Install dialog always at fixed Y to fix jumping dialogs.",
    "1.2.6": "Removed 'Update All System Sections' dialog.",
    "1.2.7": "Renamed action buttons on update dialog."
  }
}</pre></div><div class="paragraph code-paragraph collapsed" data-id="FJ9J8xCG" name="Parent of Codestrate Property" last-execution-state="success" draggable="false" style __wid="J2st3ijd"><pre data-type="content" type="text/javascript" __wid="iwqmJQxH">let fetched = false;
let parentId;

Object.defineProperty(Codestrate, "parent", {
	get: () => {
		if (!fetched) {
			return new Promise((resolve, reject) => {
				(async() => {
					let opsData = await fetch(`/${webstrate.webstrateId}/?ops`, { credentials: "same-origin" });
					let ops = await opsData.json();

					// Fetched flag is needed because webstrates create without the copy command do not have
					// the create id value causing the parent id always to be undefined
					fetched = true;
					parentId = ops[0].create.id;

					resolve(parentId);
				})();
			});
		}
		return parentId;
	}
});</pre></div><div class="paragraph code-paragraph collapsed" data-id="XhRtR9qf" name="Global Menu Entries" last-execution-state="success" style run-on-load="true" __wid="vWMnhkgx"><pre data-type="content" type="text/javascript" __wid="f6rijyfS">const GlobalMenuUtils = require("#global-menu-utils");
const PullSystemSectionsCode = require("#pull-system-sections-code");

/******************************************************************************/

Codestrate.addCommand("systemSections.udpateSystemSections", "Update System Sections", () => {
	PullSystemSectionsCode.updateSystemSections();
});
const updateSystemSectionsAction = GlobalMenuUtils.createButton("Update System Sections", null, event => {
	Codestrate.executeCommand("systemSections.udpateSystemSections");
});

/*Codestrate.addCommand("systemSections.udpateAllSystemSections", "Update All System Sections", () => {
	PullSystemSectionsCode.updateAllSystemSections();

});
const updateAllSystemSectionsAction = GlobalMenuUtils.createButton("Update All System Sections", null, event => {
	Codestrate.executeCommand("systemSections.udpateAllSystemSections");
});*/

Codestrate.addCommand("systemSections.overwriteSystemSections", "Overwrite System Sections", () => {
	PullSystemSectionsCode.overwriteSystemSections();
});
const overwriteSystemSectionsAction = GlobalMenuUtils.createButton("Overwrite System Sections", null, event => {
	Codestrate.executeCommand("systemSections.overwriteSystemSections");
});

/******************************************************************************/

const subMenuName = "System Sections";

GlobalMenuUtils.addMenuItemToSubMenu(updateSystemSectionsAction, subMenuName);
//GlobalMenuUtils.addMenuItemToSubMenu(updateAllSystemSectionsAction, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(overwriteSystemSectionsAction, subMenuName);</pre></div><div class="paragraph code-paragraph collapsed" name="Pull System Sections Code" data-id="SNwmebNQ" style last-execution-state="success" __wid="pYQVjA4L"><pre data-type="content" type="text/javascript" id="pull-system-sections-code" __wid="BM4RHLR9">const SectionPullingUtils = require("#section-pulling-utils");

const PullSystemSectionsLogger = require("#pull-system-sections-logger");
const PullSystemSectionsDialog = require("#pull-system-sections-dialog");

/******************************************************************************/

const systemSectionQuerySelector = ".section[data-type='system']";

let defaultParent = "Codestrate";
(async() => {
	defaultParent = await Codestrate.parent || defaultParent;
})();

/******************************************************************************/

/**
 * Shows a dialog to update only some system section and check for updates. Also makes it possible
 * to install individual system sections.
 */
exports.updateSystemSections = async() => {
	const dialogTitle = "Updating system sections";

	const data = await PullSystemSectionsDialog.updateSystemSectionsDialog();

	if (!data.selectedSectionIds) return;

	if (data.selectedSectionIds.length === 0) {
		alert("No system sections selected.", dialogTitle);
		return;
	}

	// Inform user and tag codestrate before update.
	toast(dialogTitle);
	webstrate.tag(`Tag of version ${webstrate.version} before update of ${data.selectedSectionIds.map(id => `"${id}"`).join(", ")} to "${data.url}"`);

	PullSystemSectionsLogger.actionStarted(`${dialogTitle} from ${data.url}`);

	const sectionRoot = document.querySelector("#sections");

	data.selectedSectionIds.forEach(selectedSectionId => {
		const currentStatus = data.sectionStati.find(systemStatus => (systemStatus.id === selectedSectionId));
		const currentSection = SectionPullingUtils.findSection(data.prototypeSystemSections, currentStatus.id);
		const newSection = document.importNode(currentSection, true);
		newSection.classList.remove("section-visible");
		newSection.classList.add("section-hidden");

		if (currentStatus.local) {
			const currentLocalSection = SectionPullingUtils.findSection(data.localSystemSections, currentStatus.id);
			currentLocalSection.replaceWith(newSection);
			PullSystemSectionsLogger.updatedSystemSection(selectedSectionId);
		} else {
			let entryPoint;

			// Find correct position of system section
			let index = data.sectionStati.indexOf(currentStatus) + 1;

			if (index &lt; data.sectionStati.length) {
				let notFound = true;
				while (!entryPoint && (index &lt; data.sectionStati.length)) {
					entryPoint = SectionPullingUtils.findSection(data.localSystemSections, data.sectionStati[index].id);
					index++;
				}
			}

			// Place in end of system sections otherwise
			if (!entryPoint) {
				const currentLocalSystemSections = Array.from(document.querySelectorAll(systemSectionQuerySelector));
				entryPoint = currentLocalSystemSections[currentLocalSystemSections.length - 1].nextSibling;
			}

			if (entryPoint) {
				sectionRoot.insertBefore(newSection, entryPoint);
			} else {
				sectionRoot.appendChild(newSection);
			}
			PullSystemSectionsLogger.installedNewSystemSection(selectedSectionId);
		}
	});

	PullSystemSectionsLogger.actionFinished(`${dialogTitle} from ${data.url}`);

	// Reload all clients that have the same codestrate open to reinitialize the codestrate environment.
	Codestrate.reloadAll("System sections updated. Therefore, the codestrate will reload after updating is completed.");
};

/******************************************************************************/

/**
 * Updates all installed system sections, which are also available on the selected codestrate.
 */
exports.updateAllSystemSections = async() => {
	const dialogTitle = "Updating all system sections";

	// Open dialog for codestrate selection
	const pullData = await SectionPullingUtils.showPullSectionsDialog(defaultParent, "HEAD", dialogTitle);
	if (!pullData) return;

	// Inform user and tag codestrate before update.
	toast(dialogTitle);

	// Pull Codestrate in iFrame
	const url = SectionPullingUtils.generatePullUrl(pullData.pullFrom, pullData.pullVersion);
	const iframe = await SectionPullingUtils.loadPrototype(url + "?exec=no");
	if (!iframe) return;

	// Tag codestrate before update.
	webstrate.tag(`Tag of version ${webstrate.version} before update to "${url}"`);

	PullSystemSectionsLogger.actionStarted(`${dialogTitle} from ${url}`);

	const prototypeSystemSections =
				Array.from(iframe.contentWindow.document.querySelectorAll(systemSectionQuerySelector));
	const transient = iframe.parentNode;
	transient.remove();

	const localSystemSections = Array.from(document.querySelectorAll(systemSectionQuerySelector));

	localSystemSections.forEach(localSystemSection => {
		const id = localSystemSection.getAttribute("data-id");
		const currentSection = SectionPullingUtils.findSection(prototypeSystemSections, id);

		if (!currentSection) {
			PullSystemSectionsLogger.updateSystemSectionFailed(id);
			return;
		}

		const newSection = document.importNode(currentSection, true);
		newSection.classList.remove("section-visible");
		newSection.classList.add("section-hidden");

		localSystemSection.replaceWith(newSection);
		PullSystemSectionsLogger.updatedSystemSection(id);
	});

	PullSystemSectionsLogger.actionFinished(`${dialogTitle} from ${url}`);

	// Reload all clients that have the same codestrate open to reinitialize the codestrate environment.
	Codestrate.reloadAll("All system sections updated. Therefore, the codestrate will reload after updating is completed.");
};

/******************************************************************************/

/**
 * Overwrites all local installed system sections with the one of the selected codestrate. Like the
 * old "Pull System Sections" action.
 */
exports.overwriteSystemSections = async() => {
	const dialogTitle = "Overwriting system sections";

	// Open dialog for codestrate selection
	const pullData = await SectionPullingUtils.showPullSectionsDialog(defaultParent, "HEAD", dialogTitle);
	if (!pullData) return;

	// Inform user and tag codestrate before update.
	toast(dialogTitle);

	// Pull Codestrate in iFrame
	const url = SectionPullingUtils.generatePullUrl(pullData.pullFrom, pullData.pullVersion);
	const iframe = await SectionPullingUtils.loadPrototype(url + "?exec=no");
	if (!iframe) return;

	// Tag codestrate before update.
	webstrate.tag(`Tag of version ${webstrate.version} before update to "${url}"`);

	PullSystemSectionsLogger.actionStarted(`${dialogTitle} from "${url}"`);

	let oldSections = Array.from(document.querySelectorAll(systemSectionQuerySelector));
	let newSections = Array.from(iframe.contentWindow.document.querySelectorAll(systemSectionQuerySelector));
	const transient = iframe.parentNode;
	transient.remove();

	let lastSectionInserted;

	// Replace old sections with new sections
	oldSections.forEach(oldSection => {

		// Replace new section with an old section as long as there are new sections left.
		// Otherwise, remove remaining old sections.
		if (newSections.length > 0) {
			// Create a clone of section!!!
			let section = newSections.splice(0, 1)[0];
			let newSection = document.importNode(section, true);
			newSection.classList.remove("section-visible");
			newSection.classList.add("section-hidden");
			oldSection.replaceWith(newSection);
			lastSectionInserted = newSection;
		} else {
			oldSection.remove();
		}
	});

	// Append all remaining new sections
	newSections.forEach(section => {

		// Create a clone of section!!!
		let newSection = document.importNode(section, true);
		newSection.classList.remove("section-visible");
		newSection.classList.add("section-hidden");

		// If no section was inserted then find the last system section in the document
		// to append the remaining new sections
		if (!lastSectionInserted) {
			let systemSections = document.querySelectorAll(systemSectionQuerySelector);
			if (systemSections.length > 0) {
				lastSectionInserted = systemSections[systemSections.length - 1];
			} else {
				lastSectionInserted = document.body.firstElementChild;
			}
		}

		let parentElement = lastSectionInserted.parentElement;
		parentElement.insertBefore(newSection, lastSectionInserted.nextSibling);
		lastSectionInserted = newSection;
	});

	PullSystemSectionsLogger.actionFinished(`${dialogTitle} from ${url}`);

	// Reload all clients that have the same codestrate open to reinitialize the codestrate environment.
	Codestrate.reloadAll("All system sections overwritten. Therefore, the codestrate will reload after updating is completed.");
};</pre></div>
<div class="paragraph code-paragraph collapsed" name="Pull System Sections Logger" data-id="pqctX5YK" __wid="MnHxySpE"><pre data-type="content" type="text/javascript" id="pull-system-sections-logger" __wid="j8GbzHc3">exports.logName = "Pull System Sections";

/******************************************************************************/

exports.actionStarted = (action) => {
	Codestrate.persistentLog.info(`${action} started (version ${webstrate.version}).`, exports.logName);
};

exports.actionFinished = (action) => {
	Codestrate.persistentLog.info(`${action} finished (version ${webstrate.version}).`, exports.logName);
};

/******************************************************************************/

exports.installedNewSystemSection = (id) => {
	Codestrate.persistentLog.log(`Added new system section "${id}".`, exports.logName);
};

exports.updatedSystemSection = (id) => {
	Codestrate.persistentLog.log(`Updated system section "${id}".`, exports.logName);
};

exports.updateSystemSectionFailed = (id) => {
	Codestrate.persistentLog.warn(`Could not update system section "${id}".`, exports.logName);
};</pre></div><div class="paragraph code-paragraph collapsed" name="Pull System Sections Dialog" last-execution-state="success" style data-id="AN2dAc9A" __wid="hAbMWeuR"><pre data-type="content" type="text/javascript" id="pull-system-sections-dialog" __wid="sLrWkBdU">const SectionPullingUtils = require("#section-pulling-utils");

/******************************************************************************/

const systemSectionQuerySelector = ".section[data-type='system']";

/******************************************************************************/

exports.updateSystemSectionsDialog = (defaultName = "Codestrate", defaultTag = "HEAD") => {

	return new Promise((resolve, reject) => {

		const data = {};

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: "Update System Sections",
			message: `&lt;div>Select the Codestrate you want to update system sections from:&lt;/div>
&lt;div class="pullData">
	&lt;input type="text" class="codestrate-name" placeholder="Codestrate Name" name="codestrate-name" title="Codestrate Name" required>
	&lt;input type="text" class="codestrate-tag" placeholder="Codestrate Tag" name="codestrate-tag" title="Codestrate Tag" required>
	&lt;div class="update-section-list button">Update List&lt;/div>
&lt;/div>
&lt;div>Select the system sections you want to install or update from &lt;b>&lt;span class="current-codestrate">&lt;/span>&lt;/b>:&lt;/div>
&lt;table class="update-system-sections">
	&lt;thead>
		&lt;tr>
			&lt;th>&lt;i class="material-icons" id="checkbox-all">&lt;/th>
			&lt;th>Status&lt;/th>
			&lt;th>Installed Version&lt;/th>
			&lt;th>Parent Version&lt;/th>
			&lt;th>Name&lt;/th>
			&lt;th>Description&lt;/th>
			&lt;th>Changelog&lt;/th>
		&lt;/tr>
	&lt;/thead>
	&lt;tbody>&lt;/tbody>
&lt;/table>`,
			actions: `&lt;div class="button ok">Update&lt;/div>
&lt;div class="button cancel">Cancel&lt;/div>`,
			className: "update-system-sections"
		});

		elements.forEach(e => transient.appendChild(e));

		const codestrateNameInput = transient.querySelector(".codestrate-name");
		const codestrateTagInput = transient.querySelector(".codestrate-tag");
		const updateSectionListButton = transient.querySelector(".update-section-list");
		const currentCodestrateSpan = transient.querySelector(".current-codestrate");
		const checkboxAll = transient.querySelector("#checkbox-all");
		const tbody = transient.querySelector("table.update-system-sections tbody");

		const updateButton = () => {
			if (data.pullData && (data.pullData.pullFrom !== codestrateNameInput.value || data.pullData.pullVersion !== codestrateTagInput.value)) {
				updateSectionListButton.classList.add("update-needed");
			} else {
				updateSectionListButton.classList.remove("update-needed");
			}

			if (codestrateNameInput.value === "" || codestrateTagInput.value === "") {
				updateSectionListButton.classList.add("invalid");
			} else {
				updateSectionListButton.classList.remove("invalid");
			}
		};

		const updateTable = async() => {

			// Open dialog for Codestrate selection
			if (codestrateNameInput.value === "" || codestrateTagInput.value === "") return;

			data.pullData = {
				pullFrom: codestrateNameInput.value,
				pullVersion: codestrateTagInput.value
			};

			tbody.innerHTML = "";
			updateButton();

			// Pull Codestrate in iFrame
			data.url = SectionPullingUtils.generatePullUrl(data.pullData.pullFrom, data.pullData.pullVersion);
			const iframe = await SectionPullingUtils.loadPrototype(data.url + "?exec=no");
			if (!iframe) return;

			// Extract system sections from pulled Codestrate and remove it
			data.prototypeSystemSections = Array.from(iframe.contentWindow.document.querySelectorAll(systemSectionQuerySelector));
			const transient = iframe.parentNode;
			transient.remove();

			data.localSystemSections = Array.from(document.querySelectorAll(systemSectionQuerySelector));

			// Get stati of system sections
			data.sectionStati = SectionPullingUtils.getSectionStati(
				SectionPullingUtils.getMultipleSectionProperties(data.prototypeSystemSections),
				SectionPullingUtils.getMultipleSectionProperties(data.localSystemSections));

			currentCodestrateSpan.innerText = data.pullData.pullFrom + " " + data.pullData.pullVersion;

			updateTableBody();
		};

		const updateTableBody = () => {
			tbody.innerHTML = "";
			tbody.innerHTML = `${data.sectionStati.filter(x => x.prototype).map(status => `&lt;tr local="${status.local}" version-changed="${status.versionChanged}" data-id="${status.id}">
			&lt;td>&lt;i class="material-icons checkbox">&lt;/td>
			&lt;td>${status.local ? (status.versionChanged !== null ? (status.versionChanged ? "Version changed" : "Up to date") : "Unknown version installed") : "Not installed"}&lt;/td>
			&lt;td>${status.local ? (status.localProperties.version || "-") : "-"}&lt;/td>
			&lt;td>${status.prototypeProperties.version || "-"}&lt;/td>
			&lt;td>${status.prototypeProperties.name || "-"}&lt;/td>
			&lt;td>${status.prototypeProperties.description || "-"}&lt;/td>
			&lt;td>${status.prototypeProperties.changelog ? (status.prototypeProperties.changelog[status.prototypeProperties.version] || "-") : "-"}&lt;/td>
		&lt;/tr>`).join("")}`;
			updateCheckboxAll();
		};

		const updateCheckboxAll = () => {
			const checked = (tbody.querySelector("tr.selected") !== null);
			const unchecked = (tbody.querySelector("tr:not(.selected)") !== null);

			if (checked) {
				if (unchecked) {
					checkboxAll.classList.add("indeterminate");
					checkboxAll.classList.remove("checked");
				} else {
					checkboxAll.classList.remove("indeterminate");
					checkboxAll.classList.add("checked");
				}
			} else {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.remove("checked");
			}
		};

		// System section list events
		codestrateNameInput.addEventListener("change", () => {
			updateButton();
		});
		codestrateTagInput.addEventListener("change", () => {
			updateButton();
		});

		codestrateNameInput.addEventListener("keydown", e => {
			e.stopPropagation();
			if (e.keyCode === 13) {
				e.preventDefault();
				updateTable();
			} else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
		});

		codestrateTagInput.addEventListener("keydown", e => {
			e.stopPropagation();
			if (e.keyCode === 13) {
				e.preventDefault();
				updateTable();
			} else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
		});

		updateSectionListButton.addEventListener("click", () => updateTable());

		// Checkbox events
		checkboxAll.addEventListener("click", () => {
			let selected;
			if (checkboxAll.classList.contains("checked")) {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.remove("checked");
				selected = false;
			} else {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.add("checked");
				selected = true;
			}
			Array.from(tbody.querySelectorAll("tr")).forEach(tr => {
				if (selected) {
					tr.classList.add("selected");
				} else {
					tr.classList.remove("selected");
				}
			});
		});

		tbody.addEventListener("click", e => {
			if (e.target === null || e.target.closest("tr") === null) return;
			e.target.closest("tr").classList.toggle("selected");
			updateCheckboxAll();
		});

		codestrateNameInput.value = defaultName;
		codestrateTagInput.value = defaultTag;
		updateTable();

		// Dialog actions
		const okBtn = transient.querySelector('.ok');
		const cancelBtn = transient.querySelector('.cancel');

		const ok = () => {
			data.selectedSectionIds = Array.from(
					tbody.querySelectorAll("tr.selected")).map(tr => tr.getAttribute("data-id"));
			transient.remove();
			resolve(data);
		};

		const cancel = () => {
			transient.remove();
			resolve(false);
		};

		okBtn.addEventListener("click", ok);
		cancelBtn.addEventListener("click", cancel);

		document.body.appendChild(transient);

		codestrateNameInput.focus();
	});
};</pre></div><div class="paragraph style-paragraph collapsed" name="Pull System Sections Dialog Style" data-id="GNFbi7e6" __wid="7GwX5Giu"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="3G2DmXML">html .dialog.update-system-sections {
	transform: translate(-50%, 0);
	top: 5vh;
	max-height: 90vh;
}

html .update-system-sections .body {
	max-width: 90vw;
}

html table.update-system-sections {
	width: 85vw;
	border-collapse: collapse;
	margin-top: 16px;
}

html table.update-system-sections td,
html table.update-system-sections th {
	padding: 8px;
}

html table.update-system-sections .checkbox:before,
html table.update-system-sections #checkbox-all:before {
	content: "check_box_outline_blank";
}

html table.update-system-sections .selected .checkbox:before,
html table.update-system-sections #checkbox-all.checked:before {
	content: "check_box";
}

html table.update-system-sections #checkbox-all.indeterminate:before {
	content: "indeterminate_check_box";
}

html table.update-system-sections td,
html table.update-system-sections #checkbox-all {
	cursor: pointer;
}

/******************************************************************************/

html .update-system-sections .pullData {
	display: flex;
	margin-bottom: 32px;
	margin-top: 16px;
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	height: 48px;
	background: var(--color-primary-shade-2);
	padding: 8px;
	width: 100%;
}

html .update-system-sections .pullData > * {
	flex: 0 1 auto;
	height: 32px;
	margin: 0 !important;
}

html .update-system-sections .pullData > * + * {
	margin-left: 32px !important;
}

html .update-system-sections .pullData .update-section-list {
	flex: 0 0 auto;
}

html .update-system-sections .pullData .update-section-list:hover {
	background: var(--color-primary-shade-3);
}

html .update-system-sections .pullData .update-section-list.update-needed {
	background: rgba(var(--material-color-green-rgb), 0.75);
}

html .update-system-sections .pullData .update-section-list.update-needed:hover {
	background: var(--material-color-green);
}

html .update-system-sections .pullData .update-section-list.invalid {
	background: var(--material-color-grey) !important;
	cursor: default;
}

/******************************************************************************/

html table.update-system-sections tr:nth-child(even) {
	background: var(--color-primary-shade-2);
}

html table.update-system-sections tr[local="true"][version-changed="true"] {
	background: var(--material-color-orange);
	color: var(--material-color-grey-100);
}

html table.update-system-sections tr[local="true"][version-changed="false"] {
	background: var(--material-color-green);
	color: var(--material-color-grey-100);
}

html table.update-system-sections tr[local="true"][version-changed="undefined"] {
	background: var(--material-color-teal);
	color: var(--material-color-grey-100);
}</style></div></div><div class="section section-hidden" data-group="editing" data-id="VKHriGtH" name="Package Management" __wid="gGiZrzwV" data-type="system"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="juE5JLby" __wid="kM45dzX3"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="aVtb9ibF"><h2 __wid="2WqV8xbV">Packages</h2><div __wid="EyxvuS4y">A package is a extension of the functionality of a codestrate. A package thereby consists of a single section in a codestrate. All functionality needs to reside in that section. In addition to that a package can have dependencies and assets. These are defined in the properties of a package, besides some other meta information like the version or a description.</div><div __wid="5JWPiqs8">A user section can be toggled as a package by using the "Activate Package Section" button in the section-header.</div><h3 __wid="Ntj9zwuu">Package ID</h3><div __wid="NWJ2FXY8">A package is identified by a unique data-id. The ID of a package is the value of the <code __wid="WX3z5mAA">data-id</code>-attribute of the respective section. The name of a package section is not used to identify a package, so it may be changed.</div><div __wid="4UB4Xfua"><b __wid="4a6xNHBS">Hint</b>: When a section is a package the data-id will be displayed in a box in the section-header.</div><h3 __wid="Nks8y4Fk">Documentation</h3><div __wid="jqd68inc">The first paragraph in every package should be the "Documentation" body-paragraph (<code __wid="jc8FYYnB">.section-documentation</code>). The functionality and usage of a package should be documented in that paragraph. Also shortcuts and other information can be added here.</div><h3 __wid="mY6cjASi">Properties</h3><div __wid="aMgnkZ4Z">The second paragraph after the documentation is the "Propterties" data-paragraph (<code __wid="b4AK2Vg6">.section-properties</code>). In this paragraph meta information and alike should be added. A template with all available properties of a package can be found in the "Section Pulling" system section.</div><div __wid="cndRDk6E">An example of properties can be seen here:</div><pre __wid="unSGz8F3"><code __wid="CXt2xDpG">{
  "version": "1.1",
  "icon": "example_icon",
  "description": "This is an example.",
  "changelog":
  {
    "1.1": "Changed something in the code.",
    "1.0": "Initial version."
  }
}</code></pre><div __wid="FePgfRbA"><b __wid="KeJWr7KW">Hint</b>: When toggling an user section without properties as a package, Codestrates will offer to copy the templates into the new package. The template can then be adjusted to the own needs.</div><h3 __wid="v6NwDXVN">Dependencies</h3><div __wid="ycer4t5b">Packages can depend on the functionality of other packages. When an package gets installed, the dependencies will also be installed. If there are optional dependencies, the user will be asked, if he wants to install them.</div><div __wid="ZdCTVgV8">Dependencies can be defined in the properties of a package. An example of a dependency can be seen here:</div><pre __wid="WajeTkB4"><code __wid="7aivgRze">"dependencies": [
  {
    "id": "MaIHJaI9",
    "name": "Dependency Example (will always be installed)"
  },
  {
    "id": "VKHriGtH",
    "name": "Optional Dependency Example",
    "optional": true,
    "usage": "This dependency is needed to user the extended feature xyz."
  }
]</code></pre><div __wid="zMgnzKPh">A dependency consists of the following parts:</div><div __wid="itKZM4B6"><ul __wid="J2nUkpvc"><li __wid="KkpihGGF"><code __wid="3iDJaukD">id</code>: The package ID of the dependency (used to identify the dependency).</li><li __wid="gG8bn83b"><code __wid="D6UvbUms">name</code>: Human readable name of the dependency.</li><li __wid="Dj9PPpU5"><code __wid="T2HdpXjK">optional</code>: Sets whether the dependency is optional or mandatory (default: <code __wid="n9SNdP29">false</code>).</li><li __wid="UNsUMhNz"><code __wid="Ui37icc2">usage</code>: Short explanation what the dependency is used for. If the dependency is optional, this message will be shown to a user in the dialog while installation.</li></ul></div><h3 __wid="JBX3dbhV">Assets</h3><div __wid="MC7YGiEx">Besides depending on other packages, a package can also have assets like images or JavaScript libraries. Assets will be stored as Webstrates assets. When installing or pushing packages, assets will also be pulled or pushed in the other codestrate.</div><div __wid="faEK53CC">Like dependencies assets are defined in the properties. An example can be seen below:</div><pre __wid="bJmw5spF"><code __wid="JwcqFpUN">"assets": [
  "myLibrary.min.js",
  "myImage.png"
]</code></pre><h3 __wid="jWwKQTxK">Persistent Paragraphs</h3><div __wid="iUupk3kr">Sometimes packages need a CSS style to give a proper representation of their content (like slides in the "Presentations" package or a canvas in the "Drawing" package). These styles are still needed after a package has been removed (to for example have a canvas but without the drawing tools). To tackle this it is possible to set the class of paragraphs to <code __wid="tYegh3MT">persistent</code>.</div><div __wid="AhcYFEq4">Paragraphs of a package, which have the class <code __wid="kPZ7wLeK">persistent</code> will remain in a codestrate after the package has been removed, so the functionality of a package can be removed, while being sure the created content is still correctly displayed inside the Codestrate.</div><div __wid="hpQqHJLM"><b __wid="Q5faC9tv">Hint</b>: Removing a package with only persistent parts left a second time, will also remove the persistent parts of it.</div><h2 __wid="RK7tNCby">Repositories</h2><div __wid="UYNs5bk4">A repository is a codestrate, which contains and distributes packages, that can be pulled into another codestrate. In Codestrates packages can be pulled from <b __wid="7ipNm65d">any </b>codestrate and can be pushed into <b __wid="TfCE3me9">any </b>codestrate (given the user has read and write rights). Usually it makes sense to pull and push from/to a shared codestrate, the repository.</div><div __wid="VS4bdw6J">One can for example create multiple repositories for different groups of packages (e.g. collaboration packages).</div><h3 __wid="ymVBrhzL">Managing Repositories</h3><div __wid="vzLvaGFX">The default repository is the codestrate with the name "Codestrate-Packages" and the tag "HEAD" (so the most recent version). But it is also possible to add new repositories and tags, which are then available in the select-box in the Packages dialogs.</div><div __wid="EYeBLnqt">When pulling or pushing packages to a repository, which is not in the list, it will automatically be added. The entries can be modified or removed using the "Manage Package Repositories" button in the global menu.</div><h3 __wid="CdkpH7pu">Repository List</h3><div __wid="jqcgpXRD">The list of repositories is stored inside a Webstrates "anywhere cookie". So it will be available across all codestrates when the user is logged in and even across devices and web browsers. If the user is not logged in, the list will be stored inside the local storage of the web browser.</div><h2 __wid="mZcChaQ6">Package Management</h2><h3 __wid="z3BUjr72">Installation</h3><div __wid="RJwuuqhe">To install packages one can use the "Install and Update Packages" button in the global menu. Installing a package will copy the section of the package to the current codestrate, copy the assets and also install the dependencies (for optional dependencies a dialog will be shown).</div><div __wid="g6fbJy2R">The installation dialog will show all packages available in the repository. The colors in the dialog have the following meanings:</div><div __wid="VHY79hnf"><ul __wid="LSuT6Fpv"><li __wid="E38zfUYi"><b __wid="Ve2nwtbu">Uncolored</b>: The package is not installed.</li><li __wid="BAedp32Y"><b style="color: var(--material-color-green);" __wid="wMJQg58n">Green</b>: The package is installed and has the same version as the one in the repository.</li><li __wid="NND7h96C"><b style="color: var(--material-color-orange);" __wid="RQed6Ldy">Orange</b>: The package is installed, but has a different version as the one in the repository.</li><li __wid="jwrbQYm6"><b style="color: var(--material-color-red);" __wid="PYVnFkfC">Red</b>: The package is uninstalled (only the persistent paragraphs of the package are left in the codestrate).</li><li __wid="6vURYPgu"><b style="color: var(--material-color-teal);" __wid="Qc6AandB">Teal</b>: The package is installed, but either the installed package or the package in the repository has no version or properties to match the version of the packages.</li></ul></div><h3 __wid="nxFMQRY6">Updates</h3><div __wid="TM5ugvEB">To update installed packages one can use either the "Install and Update Packages" button to update individual packages or the "Update All Packages" button to update all packages. Updating a package will overwrite the installed package with the one from the repository, so <b __wid="q7cSY6cX">local changes inside the package section will be overwritten</b>.</div><div __wid="gfaPDxjU">Assets will also be updated when updating a package. Dependencies will not be updated, if they are already installed, but will be pulled again if they are not available anymore in the codestrate.</div><h3 __wid="yevscvp6">Pushing</h3><div __wid="N7wmzg5i">To push package to a repository one can use the "Push Packages" button in the global menu. Pushing a package will technically install or update the package on the repository with the locally installed one. When pushing a package it always needs to be pushed to the "HEAD" tag of a codestrate.</div><div __wid="buneD435"><b __wid="FppWD38x">Hint</b>: Uninstalled packages (packages with only persistent paragraphs left) cannot be pushed.</div><h3 __wid="zAYdBVGu">Removing</h3><div __wid="xFVbZb8Z">To remove packages one can use the "Remove Packages" button in the global menu. By removing packages the section will be removed from the codestrate (except when having persistent paragraphs, see above). Assets and dependencies stay in the codestrate.</div><div __wid="8h9rbzkQ"><b __wid="hYDMPEVb">Hint</b>: Packages should always be removed using the "Remove Packages" dialog and not by removing the section manually.</div><h2 __wid="idUH8Hag">Export and Import</h2><div __wid="mpJQMY9i">Packages can be ex- and imported from/to a codestrate. An exported package consists is a zip-file containing the section of a paragraph, a generated readme file (out of section-documentation and section-properties) and the assets of the package. This zip-file can be uploaded to a codestrate to import the packages, i.e. installing them.</div><div __wid="RMAQ7tBK">Exporting packages allows to easily share packages between different webstrates servers or in case one doesn't want to grant other people access to whole codestrates.</div><h3 __wid="ZYRVYKgN">Export</h3><div __wid="xS95jPMB">Packages can either be exported indivually using the icon in the section-header of a package or using a the "Export Packages" button in the global menu. When selecting multiple packages each package will be exported ina separate folder inside the zip-file.</div><div __wid="J7FuTsQt"><b __wid="M3Req2T5">Hint</b>: Dependencies have to be selected manually when exporting packages.</div><h3 __wid="3ccXKm47">Import</h3><div __wid="GaxAa2wt">Packages can be imported using the "Import Packages" button in the global menu. Importing packages technically installs or updates them in the codestrate. So the package section will be copied into the codestrate (or replaces the section if the package is already installed) and assets will be imported. It is possible to provide the zip-file via file upload or by providing a link.</div><div __wid="DRLwCkKb"><b __wid="9qZv2bEq">Hint</b>: Because of cross-origin policies the zip-file has to be on the same server as the codestrate when providing it as a link.</div><h2 __wid="XhVYrgM8">GitHub Export and Import</h2><div __wid="fhhGvZ9d">Besides exporting packages as zip-files it is also possible to push them directly to a GitHub repository or pull them from there.</div><h3 __wid="b3GbPE4t">Access Token</h3><div __wid="Ey4GTCds">Codestrates uses the GitHub Contents API (<a href="https://developer.github.com/v3/repos/contents/" target="_blank" __wid="WjvEbg6s">link</a>) to pull or push packages from/to GitHub. The API only allows 60 REST calls per hour without an access token. This is not enough, if many packages are pulled at once. Therefore it is advised to provide an access token, which increases the REST call limit to 5000.</div><div __wid="fpqxezhA">For imports from GitHub the access token needs no additional permission. For exporting to GitHub the token needs to have repository permissions. As for security the token is not stored inside a codestrate or cookie and needs to be re-entered on every page load. The token needs the following scope:</div><div __wid="sTEb6x66"><ul __wid="Q62wtwvr"><li __wid="9aGbQCh7"><code __wid="QgAF4R34">public_repo</code> for public repositories</li><li __wid="rncVjBxY"><code __wid="2FxrfzYQ">repo</code> for private repositories</li></ul></div><h3 __wid="q7Uxj9kM">Export to GitHub</h3><div __wid="Eh6YAyUC">To export packages to GitHub one can use the button in the section-header of packages. When exporting a package a user needs to fill in the usual commit information: a commit message, a name and a email address. In addition a link to a repository needs to be provided and optionally a folder in which the package should be exported to. Every file changed will appear as a separate commit in the git log.</div><div __wid="TTUpebkf">The option "Cleanup repository" allows to cleanup the repository (e.g. when assets were removed from a package). The cleanup will remove all files from the repository or the respective folder (if a folder is set) before the commit.</div><h3 __wid="rH7qmZPU">Import from GitHub</h3><div __wid="MQE6rhgY">To import packages from GitHub one can use the "Import Packages" dialog in the global menu. Instead of providing a URL to a zip-file one simply has to enter the URL of the GitHub repository (the root URL to the repository, e.g. <code __wid="ym9pfpBv">https://github.com/UserName/RepositoryName</code>).</div><h3 __wid="xcmSmVER">Compatiblity with ZIP-Files</h3><div __wid="ufE8HZzZ">The structure of a GitHub export and zip-file export is the same. So it is possible to export a package as a zip-file and upload it's contents to a GitHub repository and later import it directly off the repository or vice-versa.</div><h2 __wid="9N2D2YMQ">Other</h2><h3 __wid="pPpaRNG6">Install Packages with Visible Section</h3><div __wid="XqJW6Cq7">When packages are installed the sections are added in a hidden state by default. If the sections should be visible upon installation or update add the <code __wid="zyGmUvNS">package-visible</code> class to the package section.</div></div></div><div class="paragraph data-paragraph collapsed locked" name="Properties" data-id="iy5QSnEW" __wid="gtGhbp9J"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="P5Bu2CEF">{
  "version": "1.7.5",
  "description": "Functionality to pull and manage packages.",
  "changelog": {
    "1.0": "Initial Release",
    "1.1": "Added export and import functionality.",
    "1.2": "Updated dialogs.",
    "1.2.1": "Added prompt for optional dependencies and updated tag and logging strings.",
    "1.2.2": "Added the 'usage' property for optional dependencies.",
    "1.2.3": "Fixed the dependency warning on removing packages.",
    "1.3": "Exporting packages generates a 'README.md'.",
    "1.4": "Added GitHub export and import capabilities.",
    "1.4.1": "Added documentation.",
    "1.4.2": "Updated cleanup to only cleanup the prefixed folder and allowed prefix on import.",
    "1.5": "Added dependency graph generation and automatically run installed packages (no reload on install).",
    "1.6": "Added tag filtering and package search and updated usability of package selection.",
    "1.6.1": "Updated export to export tags and removed 'package-' from export name.",
    "1.6.2": "Commands API used.",
    "1.6.3": "Added title for export action buttons.",
    "1.6.4": "Install dialog always at fixed Y to fix jumping dialogs.",
    "1.6.5": "Only reload on package update during import.",
    "1.6.6": "Added token scope to documentation of GitHub export.",
    "1.7": "Only prompt users with optional dependencies, if they are not already selected. Check whether dependencies need to be updated, when installing a dependent package. Repository Manager uses inputs instead of contenteditable. Install dialog uses flex-wrap for repo selection. Searching or filtering doesn't reset selection of packages.",
    "1.7.1": "Better style for repository manager inputs.",
    "1.7.2": "Bold package titles in dialogs and icons in dialogs.",
    "1.7.3": "Renamed action buttons on various install,update,remove,export dialogs.",
    "1.7.4": "Added 'package-visible' class to install packages with an visible section",
    "1.7.5": "Fixed a bug with btoa and escape charaters in GitHub Export and Import, fixed always reloading on GitHub import, added action to update from GitHub."
  }
}</pre></div><div class="paragraph code-paragraph collapsed" name="Global Menu Entries" run-on-load="true" last-execution-state="success" data-id="iTmARxY2" __wid="LfEjTbCU"><pre data-type="content" type="text/javascript" __wid="uiNBFvYx">const GlobalMenuUtils = require("#global-menu-utils");
const PackageManagementCode = require("#package-management-code");
const PackageRepositoryManager = require("#package-repository-manager");

/******************************************************************************/

Codestrate.addCommand("packages.installAndUpdatePackages", "Install and Update Packages", () => {
	PackageManagementCode.installAndUpdatePackages();
});
const installAndUpdatePackagesButton = GlobalMenuUtils.createButton("Install and Update Packages", null, event => {
	Codestrate.executeCommand("packages.installAndUpdatePackages");
});

Codestrate.addCommand("packages.updateAllPackages", "Update All Packages", () => {
	PackageManagementCode.updateAllPackages();
});
const updateAllPackagesButton = GlobalMenuUtils.createButton("Update All Packages", null, event => {
	Codestrate.executeCommand("packages.updateAllPackages");
});

Codestrate.addCommand("packages.pushPackages", "Push Packages", () => {
	PackageManagementCode.pushPackages();
});
const pushPackagesButton = GlobalMenuUtils.createButton("Push Packages", null, event => {
	Codestrate.executeCommand("packages.pushPackages");
});

Codestrate.addCommand("packages.removePackages", "Remove Packages", () => {
	PackageManagementCode.removePackages();
});
const removePackagesButton = GlobalMenuUtils.createButton("Remove Packages", null, event => {
	Codestrate.executeCommand("packages.removePackages");
});

Codestrate.addCommand("packages.exportPackages", "Export Packages", () => {
	PackageManagementCode.exportPackages();
});
const exportPackagesButton = GlobalMenuUtils.createButton("Export Packages", null, event => {
	Codestrate.executeCommand("packages.exportPackages");
});

Codestrate.addCommand("packages.importPackages", "Import Packages", () => {
	PackageManagementCode.importPackages();
});
const importPackagesButton = GlobalMenuUtils.createButton("Import Packages", null, event => {
	Codestrate.executeCommand("packages.importPackages");
});

Codestrate.addCommand("packages.managePackageRepositories", "Manage Package Repositories", () => {
	PackageRepositoryManager.openPackageRepositoryManagerDialog();
});
const managePackageRepositoriesButton = GlobalMenuUtils.createButton("Manage Package Repositories", null, event => {
	Codestrate.executeCommand("packages.managePackageRepositories");
});

/******************************************************************************/

const subMenuName = "Package Management";

GlobalMenuUtils.addMenuItemToSubMenu(installAndUpdatePackagesButton, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(updateAllPackagesButton, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(pushPackagesButton, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(removePackagesButton, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(exportPackagesButton, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(importPackagesButton, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(managePackageRepositoriesButton, subMenuName);</pre></div><div class="paragraph code-paragraph collapsed" data-id="qLQeREve" name="Dependency Graph Utils" __wid="YN2BXCZQ"><pre data-type="content" type="text/javascript" id="dependency-graph-utils" __wid="tuA9jaSQ">/**
 * A simple dependency graph
 *
 * Borrowed from:
 * @see https://raw.githubusercontent.com/jriecken/dependency-graph/master/lib/dep_graph.js
 */

/**
 * Helper for creating a Depth-First-Search on
 * a set of edges.
 *
 * Detects cycles and throws an Error if one is detected.
 *
 * @param edges The set of edges to DFS through
 * @param leavesOnly Whether to only return "leaf" nodes (ones who have no edges)
 * @param result An array in which the results will be populated
 * @param circular A boolean to allow circular dependencies
 */
function createDFS(edges, leavesOnly, result, circular) {
  var currentPath = [];
  var visited = {};
  return function DFS(currentNode) {
    visited[currentNode] = true;
    currentPath.push(currentNode);
    edges[currentNode].forEach(function (node) {
      if (!visited[node]) {
        DFS(node);
      } else if (currentPath.indexOf(node) >= 0) {
        currentPath.push(node);
        if (!circular) {
          throw new Error('Dependency Cycle Found: ' + currentPath.join(' -> '));
        }
      }
    });
    currentPath.pop();
    if ((!leavesOnly || edges[currentNode].length === 0) && result.indexOf(currentNode) === -1) {
      result.push(currentNode);
    }
  };
}

/**
 * Simple Dependency Graph
 */
var DepGraph = exports.DepGraph = function DepGraph(opts) {
  this.nodes = {}; // Node -> Node/Data (treated like a Set)
  this.outgoingEdges = {}; // Node -> [Dependency Node]
  this.incomingEdges = {}; // Node -> [Dependant Node]
  this.circular = opts && !!opts.circular; // Allows circular deps
};

DepGraph.prototype = {
  /**
   * The number of nodes in the graph.
   */
  size:function () {
    return Object.keys(this.nodes).length;
  },
  /**
   * Add a node to the dependency graph. If a node already exists, this method will do nothing.
   */
  addNode:function (node, data) {
    if (!this.hasNode(node)) {
      // Checking the arguments length allows the user to add a node with undefined data
      if (arguments.length === 2) {
        this.nodes[node] = data;
      } else {
        this.nodes[node] = node;
      }
      this.outgoingEdges[node] = [];
      this.incomingEdges[node] = [];
    }
  },
  /**
   * Remove a node from the dependency graph. If a node does not exist, this method will do nothing.
   */
  removeNode:function (node) {
    if (this.hasNode(node)) {
      delete this.nodes[node];
      delete this.outgoingEdges[node];
      delete this.incomingEdges[node];
      [this.incomingEdges, this.outgoingEdges].forEach(function (edgeList) {
        Object.keys(edgeList).forEach(function (key) {
          var idx = edgeList[key].indexOf(node);
          if (idx >= 0) {
            edgeList[key].splice(idx, 1);
          }
        }, this);
      });
    }
  },
  /**
   * Check if a node exists in the graph
   */
  hasNode:function (node) {
    return this.nodes.hasOwnProperty(node);
  },
  /**
   * Get the data associated with a node name
   */
  getNodeData:function (node) {
    if (this.hasNode(node)) {
      return this.nodes[node];
    } else {
      throw new Error('Node does not exist: ' + node);
    }
  },
  /**
   * Set the associated data for a given node name. If the node does not exist, this method will throw an error
   */
  setNodeData:function (node, data) {
    if (this.hasNode(node)) {
      this.nodes[node] = data;
    } else {
      throw new Error('Node does not exist: ' + node);
    }
  },
  /**
   * Add a dependency between two nodes. If either of the nodes does not exist,
   * an Error will be thrown.
   */
  addDependency:function (from, to) {
    if (!this.hasNode(from)) {
      throw new Error('Node does not exist: ' + from);
    }
    if (!this.hasNode(to)) {
      throw new Error('Node does not exist: ' + to);
    }
    if (this.outgoingEdges[from].indexOf(to) === -1) {
      this.outgoingEdges[from].push(to);
    }
    if (this.incomingEdges[to].indexOf(from) === -1) {
      this.incomingEdges[to].push(from);
    }
    return true;
  },
  /**
   * Remove a dependency between two nodes.
   */
  removeDependency:function (from, to) {
    var idx;
    if (this.hasNode(from)) {
      idx = this.outgoingEdges[from].indexOf(to);
      if (idx >= 0) {
        this.outgoingEdges[from].splice(idx, 1);
      }
    }

    if (this.hasNode(to)) {
      idx = this.incomingEdges[to].indexOf(from);
      if (idx >= 0) {
        this.incomingEdges[to].splice(idx, 1);
      }
    }
  },
  /**
   * Return a clone of the dependency graph. If any custom data is attached
   * to the nodes, it will only be shallow copied.
   */
  clone:function () {
    var source = this;
    var result = new DepGraph();
    var keys = Object.keys(source.nodes);
    keys.forEach(function (n) {
      result.nodes[n] = source.nodes[n];
      result.outgoingEdges[n] = source.outgoingEdges[n].slice(0);
      result.incomingEdges[n] = source.incomingEdges[n].slice(0);
    });
    return result;
  },
  /**
   * Get an array containing the nodes that the specified node depends on (transitively).
   *
   * Throws an Error if the graph has a cycle, or the specified node does not exist.
   *
   * If `leavesOnly` is true, only nodes that do not depend on any other nodes will be returned
   * in the array.
   */
  dependenciesOf:function (node, leavesOnly) {
    if (this.hasNode(node)) {
      var result = [];
      var DFS = createDFS(this.outgoingEdges, leavesOnly, result, this.circular);
      DFS(node);
      var idx = result.indexOf(node);
      if (idx >= 0) {
        result.splice(idx, 1);
      }
      return result;
    }
    else {
      throw new Error('Node does not exist: ' + node);
    }
  },
  /**
   * get an array containing the nodes that depend on the specified node (transitively).
   *
   * Throws an Error if the graph has a cycle, or the specified node does not exist.
   *
   * If `leavesOnly` is true, only nodes that do not have any dependants will be returned in the array.
   */
  dependantsOf:function (node, leavesOnly) {
    if (this.hasNode(node)) {
      var result = [];
      var DFS = createDFS(this.incomingEdges, leavesOnly, result, this.circular);
      DFS(node);
      var idx = result.indexOf(node);
      if (idx >= 0) {
        result.splice(idx, 1);
      }
      return result;
    } else {
      throw new Error('Node does not exist: ' + node);
    }
  },
  /**
   * Construct the overall processing order for the dependency graph.
   *
   * Throws an Error if the graph has a cycle.
   *
   * If `leavesOnly` is true, only nodes that do not depend on any other nodes will be returned.
   */
  overallOrder:function (leavesOnly) {
    var self = this;
    var result = [];
    var keys = Object.keys(this.nodes);
    if (keys.length === 0) {
      return result; // Empty graph
    } else {
      // Look for cycles - we run the DFS starting at all the nodes in case there
      // are several disconnected subgraphs inside this dependency graph.
      var CycleDFS = createDFS(this.outgoingEdges, false, [], this.circular);
      keys.forEach(function(n) {
        CycleDFS(n);
      });

      var DFS = createDFS(this.outgoingEdges, leavesOnly, result, this.circular);
      // Find all potential starting points (nodes with nothing depending on them) an
      // run a DFS starting at these points to get the order
      keys.filter(function (node) {
        return self.incomingEdges[node].length === 0;
      }).forEach(function (n) {
        DFS(n);
      });

      return result;
    }
  }
};</pre></div><div class="paragraph code-paragraph collapsed" name="Package Management Code" data-id="X3n8WYiT" __wid="AdMzUvnN"><pre data-type="content" type="text/javascript" id="package-management-code" __wid="rj9gtSFK">const SectionPullingUtils = require("#section-pulling-utils");

const PackageManagementHelper = require("#package-management-helper");
const PackageExportImport = require("#package-export-import");
const PackageManagementDialogs = require("#package-management-dialogs");
const PackageRepositoryManager = require("#package-repository-manager");

/******************************************************************************/

const packageSectionQuerySelector = ".section[data-type='package']";

/******************************************************************************/

/**
 * Makes it possible to install new packages or update installed packages by selecting them in a
 * dialog.
 */
exports.installAndUpdatePackages = async() => {
  const dialogTitle = "Install and Update Packages";

  // Open package selection dialog
  const data = await PackageManagementDialogs.installAndUpdatePackagesDialog();

  if (!data.selectedPackageIds) return;

  if (data.selectedPackageIds.length === 0) {
    alert("No packages selected.", dialogTitle);
    return;
  }

  // Install and update packages
  PackageManagementHelper.installAndUpdateSelectedPackages(data.prototypePackageSections,
    data.localPackageSections,
    data.selectedPackageIds,
    data.url);
};

/******************************************************************************/

/**
 * Updates all installed packages, which are available on the selected prototype.
 */
exports.updateAllPackages = async() => {
  const dialogTitle = "Update All Packages";

  // Check if any packages are installed
  const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

  if (!localPackageSections || localPackageSections.length === 0) {
    alert("No packages are installed.", dialogTitle);
    return;
  }

  // Select installed packages
  const selectedPackageIds = localPackageSections.filter(x => !x.classList.contains("uninstalled")).map(
    packageSection => packageSection.getAttribute("data-id"));

  // Open dialog for repository selection
  const pullDataList = PackageRepositoryManager.packageRepositories.map(packageRepository => {
    return {
      pullFrom: packageRepository.packageRepositoryName,
      pullVersion: packageRepository.packageRepositoryTag
    };
  });

  const pullData = await SectionPullingUtils.showPullSectionsDialog(PackageRepositoryManager.currentPackageRepositoryName, PackageRepositoryManager.currentPackageRepositoryTag, dialogTitle, pullDataList);
  if (!pullData) return;

  PackageRepositoryManager.selectPackageRepository(pullData.pullFrom, pullData.pullVersion);
  PackageRepositoryManager.addPackageRepository(pullData.pullFrom, pullData.pullVersion);

  // Pull Codestrate in iFrame
  const url = SectionPullingUtils.generatePullUrl(pullData.pullFrom, pullData.pullVersion);
  const iframe = await SectionPullingUtils.loadPrototype(url + "?exec=no");
  if (!iframe) return;

  // Extract packages from pulled Codestrate and remove it
  const prototypePackageSections = Array.from(
    iframe.contentWindow.document.querySelectorAll(packageSectionQuerySelector));
  const transient = iframe.parentNode;
  transient.remove();

  // Update all packages
  PackageManagementHelper.installAndUpdateSelectedPackages(prototypePackageSections,
    localPackageSections,
    selectedPackageIds,
    url);
};

/******************************************************************************/

/**
 * Makes it possible to push selected packages to another Codestrate.
 */
exports.pushPackages = async() => {
  const dialogTitle = "Push Packages";

  // Check if any packages are installed
  const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

  if (!localPackageSections || localPackageSections.length === 0) {
    alert("No packages are installed.", dialogTitle);
    return;
  }

  // Get properties
  const packageProperties = SectionPullingUtils.getMultipleSectionProperties(localPackageSections);

  // Open package selection dialog
  const data = await PackageManagementDialogs.selectPackagesDialog(packageProperties, false, {
    message: "Select the packages you want to push:",
    title: dialogTitle,
    repoSelection: true,
    repoSelectionMessage: "Select the repository you want to push to:",
    trueLabel: "Push"
  });

  if (!data.selectedPackageIds) return;

  if (data.selectedPackageIds.length === 0) {
    alert("No packages selected.", dialogTitle);
    return;
  }

  PackageRepositoryManager.selectPackageRepository(data.pullData.pullFrom, data.pullData.pullVersion);
  PackageRepositoryManager.addPackageRepository(data.pullData.pullFrom, data.pullData.pullVersion);

  if (data.pullData.pullVersion !== "HEAD") {
    alert("It is only possible to push to a HEAD of a Codestrate!", dialogTitle);
    return;
  }

  // Pull Codestrate in iFrame
  const url = SectionPullingUtils.generatePullUrl(data.pullData.pullFrom, data.pullData.pullVersion);
  const iframe = await SectionPullingUtils.loadPrototype(url + "?exec=no");
  if (!iframe) return;

  // Push packages
  PackageManagementHelper.pushPackages(localPackageSections, data.selectedPackageIds, iframe, url);
};

/******************************************************************************/

/**
 * Makes it possible to select and remove packages. If a package contains
 * persistent paragraphs it will be marked with the "uninstalled" class.
 * Removing these packages again removes also the persistent paragraphs.
 */
exports.removePackages = async() => {
  const dialogTitle = "Remove Packages";

  // Check if any packages are installed
  const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

  if (!localPackageSections || localPackageSections.length === 0) {
    alert("No packages are installed.", dialogTitle);
    return;
  }

  // Get properties
  const packageProperties = SectionPullingUtils.getMultipleSectionProperties(localPackageSections);

  // Open package selection dialog
  const data = await PackageManagementDialogs.selectPackagesDialog(packageProperties, true, {
    message: "Select the packages you want to remove:",
    title: dialogTitle,
    trueLabel: "Remove"
  });

  if (!data.selectedPackageIds) return;

  if (data.selectedPackageIds.length === 0) {
    alert("No packages selected.", dialogTitle);
    return;
  }

  // Remove selected packages
  PackageManagementHelper.removePackages(localPackageSections, data.selectedPackageIds);
};

/******************************************************************************/

/**
 * Makes it possible to export packages as a zip-file.
 */
exports.exportPackages = async() => {
  const dialogTitle = "Export Packages";

  // Check if any packages are installed
  const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

  if (!localPackageSections || localPackageSections.length === 0) {
    alert("No packages are installed.", dialogTitle);
    return;
  }

  // Get properties
  const packageProperties = SectionPullingUtils.getMultipleSectionProperties(localPackageSections);

  // Open package selection dialog
  const data = await PackageManagementDialogs.selectPackagesDialog(packageProperties, false, {
    message: "Select the packages you want to export:",
    title: dialogTitle,
    trueLabel: "Export"
  });

  if (!data.selectedPackageIds) return;

  if (data.selectedPackageIds.length === 0) {
    alert("No packages selected.", dialogTitle);
    return;
  }

  PackageExportImport.exportByDataId(data.selectedPackageIds);
};

/**
 * Makes it possible to import packages from a zip-file.
 */
exports.importPackages = async() => {
  const dialogTitle = "Import Packages";

  const result = await PackageManagementDialogs.importPackagesDialog();

  if (typeof result === "undefined") {
    alert("No zip-file or GitHub repository provided.", dialogTitle);
  }

  if (!result) return;

  if (typeof result === "string") {
    PackageExportImport.importByUrl(result);
  } else if (typeof result.url === "string" && result.url !== "") {
    PackageExportImport.importByGitHub(result.url, result.folder);
  } else {
    PackageExportImport.importByBlob(result);
  }
};</pre></div><div class="paragraph code-paragraph collapsed" name="Package Management Helper" data-id="RcAdaK3d" style __wid="GkJ3wF6L"><pre data-type="content" type="text/javascript" id="package-management-helper" __wid="bGvmFnnR">const SectionPullingUtils = require("#section-pulling-utils");
const AssetUtils = require("#asset-utils");
const DepGraph = require('#dependency-graph-utils').DepGraph;

const PackageManagementLogger = require("#package-management-logger");

/******************************************************************************/

const packageSectionQuerySelector = ".section[data-type='package']";
const systemSectionQuerySelector = ".section[data-type='system']";

/******************************************************************************/

const fetchAssets = async(url, packageToInstall, assets) => {
  // Fetch assets
  if (Array.isArray(assets)) {
    for (let i = 0; i &lt; assets.length; i++) {
      let assetName = url + assets[i];
      let response = await fetch(assetName, {
        credentials: "include"
      });
      let blob = await response.blob();
      let asset = await AssetUtils.uploadBlob(assetName, blob);

      PackageManagementLogger.pulledAsset(packageToInstall, assetName);
    }
  }
};

const addDependencyToGraph = (depGraph, id, dependencyId, packagesToBuildGraph) => {
  if (!depGraph.hasNode(dependencyId)) {
    packagesToBuildGraph.push(dependencyId);
  }

  depGraph.addNode(dependencyId);
  depGraph.addDependency(id, dependencyId);
}

/**
 * Build dependency graph for packages to install including its dependencies and dependencies of
 * dependencies.
 */
const buildDependencyGraph = async(selectedPackageIds, packageStati, dialogTitle) => {

  const depGraph = new DepGraph();

  let packagesToBuildGraph = [...selectedPackageIds];
  let optionalDependencies = [];

  while (packagesToBuildGraph.length !== 0 || optionalDependencies.length !== 0) {
    while (packagesToBuildGraph.length !== 0) {
      let packageToInstall = packagesToBuildGraph.pop();

      // Add the "main" id package as root node to the dependency graph
      depGraph.addNode(packageToInstall);

      const currentStatus = packageStati.find(status => (status.id === packageToInstall));

      // Add dependencies to install
      if (Array.isArray(currentStatus.prototypeProperties.dependencies)) {
        for (let i = 0; i &lt; currentStatus.prototypeProperties.dependencies.length; i++) {
          const dependency = currentStatus.prototypeProperties.dependencies[i];
          const currentDepStatus = packageStati.find(status => (status.id === dependency.id));

          // Only add dependency if it is not installed or if the version changed
          if (!currentDepStatus ||
              (currentDepStatus &&
               (!currentDepStatus.both || (currentDepStatus.both && currentDepStatus.versionChanged)))) {
            if (dependency.optional) {
              optionalDependencies.push({
                packageToInstall: packageToInstall,
                dependency: dependency,
                currentStatus: currentStatus
              });
            } else {
              addDependencyToGraph(depGraph, packageToInstall, dependency.id, packagesToBuildGraph);
            }
          }
        }
      }
    }

    // Check whether optional packages exist, which are not in the dependency graph already
    while (optionalDependencies.length !== 0) {
      let optionalDependency = optionalDependencies.pop();
      let packageToInstall = optionalDependency.packageToInstall;
      let dependency = optionalDependency.dependency;
      let currentStatus = optionalDependency.currentStatus;

      if (!depGraph.hasNode(dependency.id)) {
        const result = await confirm(`The package "${currentStatus.name}" (${packageToInstall}) has an optional dependency "${dependency.name}" (${dependency.id}).${dependency.usage ? ` The dependency is needed for the following features:&lt;br>&lt;br>"${dependency.usage}"` : ""}&lt;br>&lt;br>Do you want to install it?`, dialogTitle, {
          trueLabel: "Yes",
          falseLabel: "No"
        });
        if (result) {
          addDependencyToGraph(depGraph, packageToInstall, dependency.id, packagesToBuildGraph);
        }
      }
    }
  }

  return depGraph.overallOrder();
};

/**
 * Function to install or update selected packages.
 *
 * @param (Array) Packages installed on prototype
 * @param (Array) Locally installed package section elements
 * @param (Array) Ids of packages to be installed or updated
 * @param (String) URL of prototype to push to
 */
exports.installAndUpdateSelectedPackages =
	async(prototypePackageSections, localPackageSections, selectedPackageIds, url) => {

	let hasUpdatedPackage = false;

	const dialogTitle = "Install and Update Packages";

	// Get stati of packages
	const packageStati = SectionPullingUtils.getSectionStati(
		SectionPullingUtils.getMultipleSectionProperties(prototypePackageSections),
		SectionPullingUtils.getMultipleSectionProperties(localPackageSections));

	webstrate.tag(`Tag of version ${webstrate.version} before update of packages "${selectedPackageIds.join(", ")}" from "${url}"`);
	PackageManagementLogger.actionStarted(`${dialogTitle} from ${url}`);

	// Get point to paste new packages
	const sectionRoot = document.querySelector("#sections");

	let packagesToInstall;
	try {
		// Repository installed packages for dependency management
		packagesToInstall = await buildDependencyGraph(selectedPackageIds, packageStati, dialogTitle);
	} catch (error) {
		// Dependency graph may have detected a cycle
		alert(`Coult not install packages because ${error.message}`, dialogTitle);
		return false;
	}

	// Install packages and dependencies
	for (let i = 0; i &lt; packagesToInstall.length; i++) {

		let packageToInstall = packagesToInstall[i];

		// Get the status of the locally installed package and the remote package, which allows to check
		// if the package already exists locally and if it needs to be replaced with a newer remote
		// version.
		const currentStatus = packageStati.find(status => (status.id === packageToInstall));

		if (!currentStatus) {
			Codestrate.persistentLog.warn(`Could not find package "${packageToInstall}"!`, PackageManagementLogger.logName);
			continue;
		}

		// Get package section to be installed or updated
		const currentPrototypeSection = SectionPullingUtils.findSection(prototypePackageSections, currentStatus.id);

		if (currentPrototypeSection) {

			// Get/install all assets for the dependency
			await fetchAssets(url, packageToInstall, currentStatus.prototypeProperties.assets);

			// Import section from packages codestrate
			const newSection = document.importNode(currentPrototypeSection, true);
      if (newSection.classList.contains("package-visible")) {
        newSection.classList.remove("section-hidden");
        newSection.classList.add("section-visible");
      } else {
        newSection.classList.remove("section-visible");
        newSection.classList.add("section-hidden");
      }

			// Paste section into codestrate
			if (currentStatus.local) {
				const currentLocalSection = SectionPullingUtils.findSection(localPackageSections, currentStatus.id);
				currentLocalSection.replaceWith(newSection);
				if (currentStatus.localProperties.uninstalled) {
					PackageManagementLogger.installedNonPersistent(packageToInstall);
				} else {
					PackageManagementLogger.updatedPackage(packageToInstall);
					hasUpdatedPackage = true;
				}
			} else {
				let entryPoint;

				// Find correct position of package
				let index = packageStati.indexOf(currentStatus) + 1;
				const currentPackagesAndSystemSections = Array.from(
					document.querySelectorAll('.section[data-type="package"], .section[data-type="system"]'));

				if (index &lt; packageStati.length) {
					let notFound = true;
					while (!entryPoint && (index &lt; packageStati.length)) {
						entryPoint = SectionPullingUtils.findSection(currentPackagesAndSystemSections,
																												 packageStati[index].id);
						index++;
					}
				}

				// Place in end of packages or system sections otherwise
				if (!entryPoint) {
					entryPoint = currentPackagesAndSystemSections[currentPackagesAndSystemSections.length - 1].nextSibling;
				}

				if (entryPoint) {
					sectionRoot.insertBefore(newSection, entryPoint);
				} else {
					sectionRoot.appendChild(newSection);
				}
				PackageManagementLogger.installedPackage(packageToInstall);
			}
		} else {
			Codestrate.persistentLog.warn(`Could not install package "${packageToInstall}"!`, PackageManagementLogger.logName);
		}
	}

	// Log finish
	PackageManagementLogger.actionFinished(`${dialogTitle} from ${url}`);

	// Reload of codestrate is required because at least one package was updated
	if (hasUpdatedPackage) {

		// Reload all clients that have the same codestrate open to reinitialize the codestrate environment.
		Codestrate.reloadAll("At least one package was updated. Therefore, the codestrate will reload after updating is completed.");
	}
};

/******************************************************************************/

/**
 * Function for pushing packages.
 *
 * @param (Array) Locally installed package section elements
 * @param (Array) Ids of packages to be removed
 * @param (Element) iFrame with prototype to push to
 * @param (String) URL of prototype to push to
 */
exports.pushPackages = async(localPackageSections, selectedPackageIds, iframe, url) => {
	const dialogTitle = "Push Packages";

	const iframeDoc = iframe.contentWindow.document;

	// Tag and log start
	iframe.contentWindow.webstrate.tag(`Tag of version ${iframe.contentWindow.webstrate.version} before push of packages "${selectedPackageIds.join(", ")}" from "${location.pathname}"`);
	PackageManagementLogger.actionStarted(`${dialogTitle} to ${url}`);
	PackageManagementLogger.actionStarted(`${dialogTitle} from ${window.location.pathname} by "${webstrate.user.username}"`, iframeDoc, iframe.contentWindow.webstrate.version);

	// Get properties
	const packageProperties = SectionPullingUtils.getMultipleSectionProperties(localPackageSections);

	// Extract packages from pulled Codestrate
	const prototypePackageSections = Array.from(iframeDoc.querySelectorAll(packageSectionQuerySelector));

	// Get point to paste new packages
	const sectionRoot = iframeDoc.querySelector("#sections");
	let entryPoint = iframeDoc.querySelectorAll(".section[data-type='package']");
	if (entryPoint.length === 0) {
		entryPoint = iframeDoc.querySelectorAll(".section[data-type='system']");
	}
	entryPoint = entryPoint[entryPoint.length - 1];

	// Push packages
	while (selectedPackageIds.length !== 0) {
		const selectedPackageId = selectedPackageIds.shift();

		const prototypePackageSection =
					SectionPullingUtils.findSection(prototypePackageSections, selectedPackageId);
		const localPackageSection =
					SectionPullingUtils.findSection(localPackageSections, selectedPackageId);

		if (localPackageSection) {

			const newSection = iframeDoc.importNode(localPackageSection, true);
			newSection.classList.remove("section-visible");
			newSection.classList.add("section-hidden");

			if (prototypePackageSection) {
				prototypePackageSection.replaceWith(newSection);
				PackageManagementLogger.pushedPackageUpdate(selectedPackageId, iframeDoc);
			} else {
				sectionRoot.insertBefore(newSection, entryPoint.nextSibling);
				PackageManagementLogger.pushedNewPackage(selectedPackageId, iframeDoc);
			}

			// Push assets
			const assets = packageProperties.find(p => p.id === selectedPackageId).assets;
			if (Array.isArray(assets)) {
				for (let i = 0; i &lt; assets.length; i++) {
					let assetName = assets[i];
					let response = await fetch(window.location.pathname + assetName, {
						credentials: "include"
					});
					let blob = await response.blob();
					let asset = await AssetUtils.uploadBlob(url + assetName, blob, false, url);
					PackageManagementLogger.pushedAsset(selectedPackageId, assetName, iframeDoc);
				}
			}
		} else {
			Codestrate.persistentLog.warn(`Could not push package "${selectedPackageId}"!`, PackageManagementLogger.logName);
		}
	}

	// Log end, send refresh signal and remove iframe
	PackageManagementLogger.actionFinished(`${dialogTitle} to ${url}`);
	PackageManagementLogger.actionFinished(`${dialogTitle} from ${window.location.pathname} by "${webstrate.user.username}"`, iframeDoc, iframe.contentWindow.webstrate.version);
	toast(`Pushed packages to ${url}`);

	(async() => {
		await iframe.contentWindow.webstrate.dataSaved();

		// Reload all clients that have the transcluded codestrate open to reinitialize the codestrate
		// environment.
		// FIXME: reloadAll not working on ?exec=no codestrate
		//iframe.contentWindow.Codestrate.reloadAll("Packages pushed to codestrate. It will reload automatically.");

		// Give the transcluded codestrate some time to send signals to other clients of the same
		// codestrate.
		setTimeout(() => {
			const transient = iframe.parentNode;
			transient.remove();
		}, 5000);
	})();
};

/******************************************************************************/

/**
 * Function for removing packages.
 *
 * @param (Array) Locally installed package section elements
 * @param (Array) Ids of packages to be removed
 * @param (bool) Set true if persistent paragraphs should be removed also
 */
exports.removePackages =
	async(localPackageSections, selectedPackageIds, removePersistent = false) => {

	const dialogTitle = "Remove Packages";

	// Warn user, create tag and log start
	webstrate.tag(`Tag of version ${webstrate.version} before removal of packages "${selectedPackageIds.join(", ")}"`);
	PackageManagementLogger.actionStarted(dialogTitle);

	// Setup for warning about dependencies
	let localPackageProperties = SectionPullingUtils.getMultipleSectionProperties(localPackageSections);
	localPackageProperties = localPackageProperties.filter(properties => !selectedPackageIds.includes(properties.id))

	let remainingDependencies = [];
	localPackageProperties.forEach(properties => {
		if (Array.isArray(properties.dependencies)) {
			remainingDependencies.push(...properties.dependencies);
		}
	});

	// Loop over selected ids
	let packagesToRemove = [...selectedPackageIds];
  let packagesRemoved = false;

	while (packagesToRemove.length !== 0) {
		let selectedPackageId = packagesToRemove.shift();

		let remainingDependency = remainingDependencies.filter(dependency => dependency.id === selectedPackageId);

		if (remainingDependency.length > 0) {
			const result = await confirm(`The package "${remainingDependency[0].name}" (${selectedPackageId}) is  a dependency of another installed package.&lt;br>&lt;br>Do you want to remove it anyway?`, dialogTitle, {
          trueLabel: "Yes",
          falseLabel: "No"
        });
			if (!result) continue;
		}

		const packageSection = SectionPullingUtils.findSection(localPackageSections, selectedPackageId);

		if (packageSection) {

			// If only persistent parts left, it will also remove these
			const uninstalled = packageSection.classList.contains("uninstalled");
			const hasPersistent = packageSection.querySelector(".persistent[data-type='content']");

			// Check for persistent paragraphs
			if (!removePersistent && !uninstalled && hasPersistent) {
				packageSection.querySelectorAll(".paragraph").forEach(paragraph => {
					const content = paragraph.querySelector("[data-type='content']");
					if (!content.classList.contains("persistent") &&
							!content.classList.contains("section-documentation") &&
							!content.classList.contains("section-properties")) {
						paragraph.remove();
					}
				});
				packageSection.classList.add("uninstalled");
				PackageManagementLogger.removedPackage(selectedPackageId);
      } else {
        packageSection.remove();
        PackageManagementLogger.removedPackagePersistent(selectedPackageId, hasPersistent);
      }

      packagesRemoved = true;
		} else {
			Codestrate.persistentLog.warn(`Could not remove package "${selectedPackageId}"!`, PackageManagementLogger.logName);
		}
	}

	// Log end and send refresh signal
	PackageManagementLogger.actionFinished(dialogTitle);

  // Reload all clients that have the same codestrate open to reinitialize the codestrate environment
  if (packagesRemoved) {
    Codestrate.reloadAll("At least one package was removed. Therefore, the codestrate will reload after removing is completed.");
  }
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="ikbGVj8X" name="Package Export and Import" style __wid="QvfMNNpg"><pre data-type="content" type="text/javascript" id="package-export-import" __wid="dvDMr4Et">const SectionPullingUtils = require("#section-pulling-utils");
const PackageExportImportHelper = require("#package-export-import-helper");
const PackageManagementDialogs = require("#package-management-dialogs");
const PackageManagementLogger = require("#package-management-logger");
const AssetUtils = require("#asset-utils");
const AssetMimeType = require("#asset-mime-type");

/******************************************************************************/

const packageSectionQuerySelector = ".section[data-type='package']";
const packageFileExtension = "csp";

// GitHub
const apiPath = "https://api.github.com/repos";
const contentPath = "contents";

/******************************************************************************/

importLib([
	"FileSaver.min.js",
	"jszip.min.js"
]).then(() => {

	exports.exportByDataId = (dataIds) => {
		const sections = [];
		let dataIdsArray = dataIds;
		if (!Array.isArray(dataIdsArray)) dataIdsArray = [dataIds];

		dataIdsArray.forEach(dataId => {
			const section = document.querySelector(`.section[data-id="${dataId}"]`);
			if (section) {
				sections.push(section);
			} else {
				console.warn(`Could not find section "${dataId}" for export!`);
			}
		});

		exports.exportBySection(sections);
	};

/******************************************************************************/

	const addPackageToZip = (zip, section, prefix = "") => {
		return new Promise(async(resolve, reject) => {
			const exportSection = section.cloneNode(true);
			const properties = SectionPullingUtils.getSectionProperties(exportSection);

			// Remove transients
			const transients = Array.from(exportSection.querySelectorAll("transient"));
			transients.forEach(transient => transient.remove());

			// Add file
			zip.file(prefix + PackageExportImportHelper.packageFileName(section) + "." + packageFileExtension, exportSection.outerHTML);

			// Add README.md
			const readMe = PackageExportImportHelper.generateReadMe(exportSection, properties);
			zip.file(prefix + "README.md", readMe);

			// Get assets list
			if (properties) {
				const assets = properties.assets;

				// Add assets
				if (assets && Array.isArray(assets)) {
					for (let i = 0; i &lt; assets.length; i++) {
						let assetName = assets[i];
						let assetPath = window.location.origin + window.location.pathname + assetName;
						let response = await fetch(assetPath, { credentials: "include" });
						let blob = await response.blob();
						zip.file(prefix + "assets/" + assetName, blob);
					}
				}
			}

			resolve(true);
		});
	};

	exports.exportBySection = async(sections) => {
		const zip = new JSZip();
		let zipName = "packages";

		if (Array.isArray(sections) && sections.length > 1) {
			for (let i = 0; i &lt; sections.length; i++) {
				let prefix = i + 1 + "_";
				while (prefix.length &lt; (sections.length + 1 + "_").length) prefix = "0" + prefix;
				await addPackageToZip(zip, sections[i], prefix + PackageExportImportHelper.packageFileName(sections[i]) + "/");
			}
		} else if (Array.isArray(sections)) {
			await addPackageToZip(zip, sections[0]);
			zipName = PackageExportImportHelper.packageFileName(sections[0]);
		} else {
			await addPackageToZip(zip, sections);
			zipName = PackageExportImportHelper.packageFileName(sections);
		}

		// Create file for download
		zip.generateAsync({type:"blob"}).then(function (blob) {
			saveAs(blob, zipName + ".zip");
		}, function (err) {
			console.error(err);
		});
	};

/******************************************************************************/

	exports.importByUrl = async(url) => {
		const response = await fetch(url, { credentials: "include" });
		const blob = await response.blob();
		exports.importByBlob(blob);
	};

/******************************************************************************/

	exports.importByBlob = async(blob) => {
		const dialogTitle = "Import Packages";
		let zip;
		let hasUpdatedPackage = false;

		try {
			zip = await JSZip.loadAsync(blob);
		} catch (e){
			alert("Parsing of zip-file failed!", dialogTitle);
			console.error(e);
			return;
		}

		webstrate.tag(`Tag of version ${webstrate.version} before package import`);
		PackageManagementLogger.actionStarted(dialogTitle);

		const files = zip.file(/.*/);

		for (let i = 0; i &lt; files.length; i++) {
			let file = files[i];
			let relativePath = file.name;

			if (relativePath.endsWith("." + packageFileExtension)) {

				// Extract and generate section
				const packageContent = await file.async("text");
				const template = document.createElement("template");
				template.innerHTML = packageContent;

				const newSection = template.content.firstChild;
				newSection.classList.remove("section-visible");
				newSection.classList.add("section-hidden");
				const dataId = newSection.getAttribute("data-id");

				// Replace or insert section
				const oldSection = document.querySelector(`.section[data-id="${dataId}"]`);

				if (oldSection) {
					oldSection.replaceWith(newSection);
					hasUpdatedPackage = true;
				} else {
					const sections = document.querySelector("#sections");
					const packagesAndSystemSections = Array.from(sections.querySelectorAll(".section[data-type='package'], .section[data-type='system']"));
					const lastSection = packagesAndSystemSections[packagesAndSystemSections.length - 1];
					sections.insertBefore(newSection, lastSection.nextSibling);
				}

				PackageManagementLogger.importedPackage(dataId);
			} else if (relativePath.endsWith("README.md")) {
				// Don't import readme
			} else {

				// Import assets
				let arraybuffer = await file.async("arraybuffer");
				let blob = await new Blob([arraybuffer], {type : AssetMimeType.getMimeType(relativePath)});
				let asset = await AssetUtils.uploadBlob(relativePath, blob);
				PackageManagementLogger.importedAsset(relativePath);
			}
		}

		PackageManagementLogger.actionFinished(dialogTitle);

		// Reload of codestrate is required because at least one package was updated
		if (hasUpdatedPackage) {

			// Reload all clients that have the same codestrate open to reinitialize the codestrate environment.
			Codestrate.reloadAll("At least one package was updated during the import. Therefore, the codestrate will reload after import is completed.");
		}
	};
});

/******************************************************************************/

const importContents = (contents) => {
	return new Promise(async(resolve, reject) => {
    let hasUpdatedPackage = false;

		for (let i = 0; i &lt; contents.length; i++) {
			const element = contents[i];

			if (element.type === "dir") {

				// Recursively iterate through repository
				const directory = await PackageExportImportHelper.getApiObject(element.url);
				await importContents(directory);

			} else if (element.type === "file") {

				if (element.name.endsWith("." + packageFileExtension)) {

					// Extract and generate section
					const data = await PackageExportImportHelper.getApiObject(element.git_url);
					const packageContent = decodeURIComponent(escape(window.atob(data.content)));
					const template = document.createElement("template");
					template.innerHTML = packageContent;

					const newSection = template.content.firstChild;
					newSection.classList.remove("section-visible");
					newSection.classList.add("section-hidden");
					const dataId = newSection.getAttribute("data-id");

					// Replace or insert section
					const oldSection = document.querySelector(`.section[data-id="${dataId}"]`);

					if (oldSection) {
						oldSection.replaceWith(newSection);
            hasUpdatedPackage = true;
					} else {
						const sections = document.querySelector("#sections");
						const packagesAndSystemSections = Array.from(sections.querySelectorAll(".section[data-type='package'], .section[data-type='system']"));
						const lastSection = packagesAndSystemSections[packagesAndSystemSections.length - 1];
						sections.insertBefore(newSection, lastSection.nextSibling);
					}

					PackageManagementLogger.importedPackage(dataId);
				} else if (element.name.endsWith("README.md")) {
					// Don't import readme
				} else {

					// Import assets
					const data = await PackageExportImportHelper.getApiObject(element.git_url);
					const blob = PackageExportImportHelper.b64ToBlob(data.content, AssetMimeType.getMimeType(element.name));
					let asset = await AssetUtils.uploadBlob(element.name, blob);
					PackageManagementLogger.importedAsset(element.name);
				}
			}
		}
		resolve(hasUpdatedPackage);
	});
};

exports.importByGitHub = async(url, folder) => {
	const dialogTitle = "Import Packages from GitHub";

	const accessToken = await PackageExportImportHelper.checkApiToken(dialogTitle);
	if (accessToken === false) return;

	webstrate.tag(`Tag of version ${webstrate.version} before package import`);
	PackageManagementLogger.actionStarted(dialogTitle);

	const repository = url.replace("https://github.com/", "");
	const api = apiPath + "/" + repository + "/" + contentPath;
	const path = folder ? "/" + folder : "";

	const contents = await PackageExportImportHelper.getApiObject(api + "/" + path);
	const hasUpdatedPackage = await importContents(contents);

	PackageManagementLogger.actionFinished(dialogTitle);

  // Reload of codestrate is required because at least one package was updated
  if (hasUpdatedPackage) {

    // Reload all clients that have the same codestrate open to reinitialize the codestrate environment.
    Codestrate.reloadAll("Packages were imported. Therefore, the codestrate will reload after import is completed.");
  }
};

/******************************************************************************/

const cleanUpRepo = (contents, commitData) => {
	return new Promise(async(resolve, reject) => {
		for (let i = 0; i &lt; contents.length; i++) {
			const element = contents[i];

			if (element.type === "dir") {
				const directory = await PackageExportImportHelper.getApiObject(element.url);
				await cleanUpRepo(directory, commitData);
			} else if (element.type === "file") {
				const element = contents[i];
				await PackageExportImportHelper.makeRequest("DELETE", element.url, JSON.stringify({
					message: "Cleanup: " + commitData.message,
					commiter: {
						name: commitData.name,
						email: commitData.email
					},
					sha: element.sha
				}));
			}
		}

		resolve(true);
	});
};

const pushFile = (path, content, commitData) => {
	return new Promise(async(resolve, reject) => {

		// Set sha if file is already in repo
		const commit = {
			message: commitData.message,
			commiter: {
				name: commitData.name,
				email: commitData.email
			},
			content: content
		};

		try {

			// Get parent folder of file, as if file is too big it will return 404
			const dir = await PackageExportImportHelper.getApiObject(path.replace(/\/[^\/]*$/, ""));
			const element = dir.find((el) => el.name === path.replace(/.*\//, ""));
			commit.sha = element.sha;

			const gitElement = await PackageExportImportHelper.getApiObject(element.git_url);

			if (window.atob(gitElement.content) === window.atob(content)) {
				console.log(`Skipped file "${path}" as contents are equal.`);
				return resolve(true);
			}
		} catch (e) {
			// Do nothing, file is not available in repo
		}

		// Send commit of file
		await PackageExportImportHelper.makeRequest("PUT", path, JSON.stringify(commit));
		resolve(true);
	});
};

exports.exportToGitHub = async(section) => {
	const dialogTitle = "Export Package to GitHub";

	const accessToken = await PackageExportImportHelper.checkApiToken(dialogTitle);
	if (accessToken === false) return;
	if (accessToken === "") {
		alert("You need to enter an access token to export to GitHub!", dialogTitle);
		return;
	}

	// Start export
	const exportSection = section.cloneNode(true);
	const properties = SectionPullingUtils.getSectionProperties(exportSection);

	// Show commit dialog
	const commitData = await PackageManagementDialogs.exportPackageToGitHubDialog(properties);
	if (!commitData) return;

	const repository = commitData.url.replace("https://github.com/", "");
	const api = apiPath + "/" + repository + "/" + contentPath;
	const path = commitData.folder ? "/" + commitData.folder : "";

	// Cleanup repo
	if (commitData.cleanUp) {
		const contents = await PackageExportImportHelper.getApiObject(api + "/" + path);
		await cleanUpRepo(contents, commitData);
	}

	// Remove transients
	const transients = Array.from(exportSection.querySelectorAll("transient"));
	transients.forEach(transient => transient.remove());

	// Add file
	await pushFile(api + path + "/" + PackageExportImportHelper.packageFileName(section) + "." + packageFileExtension, window.btoa(unescape(encodeURIComponent(exportSection.outerHTML))), commitData);

	// Add README.md
	let readMe = PackageExportImportHelper.generateReadMe(exportSection, properties);
	await pushFile(api + path + "/README.md", window.btoa(readMe), commitData);

	// Get assets list
	if (properties) {
		const assets = properties.assets;
		const reader  = new FileReader();

		// Add assets
		if (assets && Array.isArray(assets)) {
			for (let i = 0; i &lt; assets.length; i++) {
				let assetName = assets[i];
				let assetPath = window.location.origin + window.location.pathname + assetName;
				let response = await fetch(assetPath, { credentials: "include" });
				let blob = await response.blob();
				let data = await PackageExportImportHelper.blobToB64(blob);
				await pushFile(api + path + "/assets/" + assetName, data, commitData);
			}
		}
	}

	toast("Pushed package to GitHub");
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="MTEmfFRm" name="Package Export and Import Helper" __wid="SznWugej"><pre data-type="content" type="text/javascript" id="package-export-import-helper" __wid="8qVFmj54">let accessToken = "";

/******************************************************************************/

exports.packageFileName = (section) => `${section.getAttribute("data-id")}-${section.getAttribute("name") ? section.getAttribute("name").replace(/ /g, "_") : "No_Name"}`;

exports.generateReadMe = (exportSection, properties) => {
	let readMe = "";

	const sectionDocumentation = exportSection.querySelector(".section-documentation[data-type='content']");
	if (sectionDocumentation) readMe += sectionDocumentation.innerHTML.replace(/&lt;div>/g, "&lt;p>").replace(/&lt;\/div>/g, "&lt;/p>");

	if (properties) {
		readMe += `

# Properties

| Property | Value |
| :--- | :--- |
| Name | ${properties.name || "-"} |
| ID | ${properties.id || "-"} |
| Version | ${properties.version || "-"} |
| Description | ${properties.description || "-"} |
| Tags | ${properties.tags ? properties.tags.length > 0 ? "`" + properties.tags.join(", ") + "`" : ("-") : "-"} |
| Assets | ${properties.assets ? properties.assets.length > 0 ? "`" + properties.assets.join(", ") + "`" : ("-") : "-"} |
| Dependencies | ${properties.dependencies ? properties.dependencies.length > 0 ? "`" + JSON.stringify(properties.dependencies) + "`" : "-" : "-"} |
| Changelog | ${properties.changelog ? "`" + JSON.stringify(properties.changelog) + "`" : "-"} |`;
	}

	return readMe;
};

/******************************************************************************/

exports.checkApiToken = async(dialogTitle) => {
	return new Promise(async(resolve, reject) => {
		if (!accessToken) {
			accessToken = await prompt(`&lt;div>The GitHub API allows up to 60 REST calls per hour. Using an access token increases this limit to 5000. For pushing of packages an access token is always needed.&lt;/div>&lt;br>&lt;div>Enter a GitHub access token (optional):&lt;/div>`, "", dialogTitle);
		}
		resolve(accessToken);
	});
}

exports.makeRequest = (method, url, data = false) => {
	return new Promise((resolve, reject) => {
		const xhr = new XMLHttpRequest();

		// Add random string to prevent using cached versions
		const params = accessToken ? "?access_token=" + accessToken + "&" + Codestrate.util.randomString() : "?" + Codestrate.util.randomString()
		xhr.open(method, url.replace("?ref=master", "") + params);

		xhr.onload = function () {
			if (this.status >= 200 && this.status &lt; 300) {
				resolve(xhr.response);
			} else {
				reject({
					status: this.status,
					statusText: xhr.statusText
				});
			}
		};

		xhr.onerror = function () {
			reject({
				status: this.status,
				statusText: xhr.statusText
			});
		};

		xhr.send(data);
	});
};

exports.getApiObject = (url) => {
	return new Promise(async(resolve, reject) => {
		try {
			const object = await exports.makeRequest("GET", url);
			resolve(JSON.parse(object));
		} catch (e) {
			resolve(false);
		}
	});
};

/******************************************************************************/

exports.b64ToBlob = (b64Data, contentType = "", sliceSize = 512) => {
	const byteCharacters = atob(b64Data);
	const byteArrays = [];

	for (let offset = 0; offset &lt; byteCharacters.length; offset += sliceSize) {
		const slice = byteCharacters.slice(offset, offset + sliceSize);

		const byteNumbers = new Array(slice.length);
		for (let i = 0; i &lt; slice.length; i++) {
			byteNumbers[i] = slice.charCodeAt(i);
		}

		const byteArray = new Uint8Array(byteNumbers);

		byteArrays.push(byteArray);
	}

	const blob = new Blob(byteArrays, {type: contentType});
	return blob;
};

exports.blobToB64 = (blob) => {
	return new Promise((resolve, reject) => {
		const fileReader = new FileReader();
		fileReader.onload = (readerEvt) => {
			resolve(window.btoa(readerEvt.target.result));
		};
		fileReader.readAsBinaryString(blob);
	});
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="Ddw5QYTr" name="Package Import URL (disabled)" last-execution-state="success" style __wid="CHQPUiG4"><pre data-type="content" type="text/javascript" __wid="HNRx7SKs">const PackageExportImport = require("#package-export-import");

/******************************************************************************/

const url_string =  window.location.href;
const url = new URL(url_string);
const value = url.searchParams.get("importPackage");

if (value) {
	(async() => {
		const result = await confirm(`Do you want to import packages from "${value}"?`, "Import Packages");
		if (result) {
			PackageExportImport.importByUrl(value);
		} else {
			window.location = window.location.origin + window.location.pathname;
		}
	})();
}</pre></div><div class="paragraph code-paragraph collapsed" data-id="ZcGzgrsy" name="Package Export UI" run-on-load="true" draggable="false" style last-execution-state="success" __wid="isRGS2Kz"><pre data-type="content" type="text/javascript" __wid="Lqtf5cuf">const PackageExportImport = require("#package-export-import");
const ActionUtils = require("#action-utils");
const SectionPullingUtils = require("#section-pulling-utils");

/******************************************************************************/

const sectionQuery = document.liveQuerySelectorAll(".section-header").added((sectionHeader) => {
  const section = sectionHeader.closest(".section");
  if (!section || section.querySelector(".export-package")) return;

  const actionExport = ActionUtils.create(() => {
    PackageExportImport.exportBySection(section);
  }, {
    classNames: "export-package",
    tooltip: true,
    title: "Export Package"
  });

  sectionHeader.appendChild(actionExport);

  const actionGithubExport = ActionUtils.create(() => {
    PackageExportImport.exportToGitHub(section);
  }, {
    classNames: "export-github-package",
    tooltip: true,
    title: "Export Package to GitHub"
  });

  sectionHeader.appendChild(actionGithubExport);

  const actionGithubImport = ActionUtils.create(() => {
    const sectionProperties = SectionPullingUtils.getSectionProperties(section);
    if (sectionProperties.github &&
        sectionProperties.github.url &&
        sectionProperties.github.folder) {
      PackageExportImport.importByGitHub(sectionProperties.github.url, sectionProperties.github.folder);
    } else {
      alert("No github.url or github.folder properties defined for import.", "Import by GitHub");
    }
  }, {
    classNames: "import-github-package",
    tooltip: true,
    title: "Import Package from GitHub"
  });

  sectionHeader.appendChild(actionGithubImport);
});</pre></div><div class="paragraph style-paragraph collapsed" data-id="RsTYGeWK" name="Package Export UI Style" style __wid="EDqugukr"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="nZgcetNi">html .section:not([data-type="package"]) .export-package,
html .section.uninstalled .export-package,
html .section:not([data-type="package"]) .export-github-package,
html .section.uninstalled .export-github-package,
html .section:not([data-type="package"]) .import-github-package,
html .section.uninstalled .import-github-package {
	display: none;
}

html .section .export-package i:after {
	content: var(--arrow-up-bold-hexagon-outline);
	font-family: "Material Design Icons";
}

html .section .export-package:after {
	content: "Export Package";
}

html .section .export-github-package i:after {
	content: var(--cloud-upload);
	font-family: "Material Design Icons";
}

html .section .export-github-package:after {
	content: "Export Package to GitHub";
}

html .section .import-github-package i:after {
	content: var(--cloud-download);
	font-family: "Material Design Icons";
}

html .section .import-github-package:after {
	content: "Import Package from GitHub";
}</style></div><div class="paragraph code-paragraph collapsed" data-id="e9Wd4ts2" name="Package Management Logger" draggable="false" style __wid="VCYFKGey"><pre data-type="content" type="text/javascript" id="package-management-logger" __wid="mLbSYE2Z">exports.logName = "Package Management";

/******************************************************************************/

exports.actionStarted = (action, rootDocument = false, rootVersion = false) => {
	Codestrate.persistentLog.info(`${action} started (version ${rootVersion ? rootVersion : webstrate.version}).`, exports.logName, rootDocument);
};

exports.actionFinished = (action, rootDocument = false, rootVersion = false) => {
	Codestrate.persistentLog.info(`${action} finished (version ${rootVersion ? rootVersion : webstrate.version}).`, exports.logName, rootDocument);
};

/******************************************************************************/

exports.installedPackage = (id) => {
	Codestrate.persistentLog.log(`Installed new package "${id}".`, exports.logName);
};

exports.installedNonPersistent = (id) => {
	Codestrate.persistentLog.log(`Installed non-persistant paragraphs of package "${id}".`, exports.logName);
};

exports.updatedPackage = (id) => {
	Codestrate.persistentLog.log(`Updated package "${id}".`, exports.logName);
};

/******************************************************************************/

exports.removedPackage = (id) => {
	Codestrate.persistentLog.log(`Removed package "${id}" without persistent paragraphs.`, exports.logName);
};

exports.removedPackagePersistent = (id, hasPersistent) => {
	Codestrate.persistentLog.log(`Removed package "${id}"${hasPersistent ? " with persistent paragraphs" : ""}.`, exports.logName);
};

/******************************************************************************/

exports.pushedNewPackage = (id, rootDocument) => {
	Codestrate.persistentLog.log(`Pushed new package "${id}".`, exports.logName);
	Codestrate.persistentLog.log(`New package "${id}" was pushed.`, exports.logName, rootDocument);
};

exports.pushedPackageUpdate = (id, rootDocument, url) => {
	Codestrate.persistentLog.log(`Pushed update to package "${id}".`, exports.logName);
	Codestrate.persistentLog.log(`Update to package "${id}" was pushed.`, exports.logName, rootDocument);
};

/******************************************************************************/

exports.pushedAsset = (id, assetName, rootDocument) => {
	Codestrate.persistentLog.log(`Pushed asset "${assetName}" of package "${id}".`, exports.logName);
	Codestrate.persistentLog.log(`Asset "${assetName}" of package "${id}" was pushed.`, exports.logName, rootDocument);
};

exports.pulledAsset = (id, assetName) => {
	Codestrate.persistentLog.log(`Pulled asset "${assetName}" of package "${id}".`, exports.logName);
};

/******************************************************************************/

exports.importedPackage = (id) => {
	Codestrate.persistentLog.log(`Imported package "${id}".`, exports.logName);
};

exports.importedAsset = (fileName) => {
	Codestrate.persistentLog.log(`Imported asset "${fileName}".`, exports.logName);
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="xGaF3wLU" draggable="false" style name="Package Repository Manager" __wid="SzZW2wwZ"><pre data-type="content" type="text/javascript" id="package-repository-manager" __wid="5wcx2eKq">const defaultPackageRepository = {
	packageRepositoryName : "Codestrate-Packages",
	packageRepositoryTag: "HEAD"
};

const defaultPackageRepositorys = [
	defaultPackageRepository
];

const packageRepositoryKey = "package-repositories";
const currentPackageRepositoryKey = "current-package-repository";

/******************************************************************************/

exports.usesCookies = !!webstrate.user.cookies;

/******************************************************************************/

const getValue = (key) => {
	let value;
	if (exports.usesCookies) {
		value = webstrate.user.cookies.anywhere.get(key);
	} else if (localStorage) {
		value = JSON.parse(localStorage.getItem(key));
	}
	return value;
};

const setValue = (key, value) => {
	if (exports.usesCookies) {
		webstrate.user.cookies.anywhere.set(key, value);
	} else if (localStorage) {
		localStorage.setItem(key, JSON.stringify(value));
	}
};

/******************************************************************************/

const getPackageRepositories = () => {
	let packageRepositories = getValue(packageRepositoryKey);

	// Init if unavailable
	if (!packageRepositories ||
			!Array.isArray(packageRepositories) ||
			(packageRepositories.length === 0)) {
		packageRepositories = defaultPackageRepositorys;
		setPackageRepositories(packageRepositories);
	}

	exports.packageRepositories = packageRepositories;
	return packageRepositories;
};

const setPackageRepositories = (packageRepositories) => {
	setValue(packageRepositoryKey, packageRepositories);
	exports.packageRepositories = packageRepositories;
};

/******************************************************************************/

const getCurrentPackageRepository = () => {
	let currentPackageRepository = getValue(currentPackageRepositoryKey);

	// Init if unavailable
	if (!currentPackageRepository) {
		currentPackageRepository = defaultPackageRepository;
		setCurrentPackageRepository(currentPackageRepository);
	}

	exports.currentPackageRepository = currentPackageRepository;
	exports.currentPackageRepositoryName = currentPackageRepository.packageRepositoryName;
	exports.currentPackageRepositoryTag = currentPackageRepository.packageRepositoryTag;
	return currentPackageRepository;
};

const setCurrentPackageRepository = (currentPackageRepository) => {
	setValue(currentPackageRepositoryKey, currentPackageRepository);
	exports.currentPackageRepository = currentPackageRepository;
	exports.currentPackageRepositoryName = currentPackageRepository.packageRepositoryName;
	exports.currentPackageRepositoryTag = currentPackageRepository.packageRepositoryTag;
};

/******************************************************************************/

exports.packageRepositories = getPackageRepositories();
exports.packageRepositoryNames = () => {
	const names = [];
	return getPackageRepositories().map(repository => {
		const name = repository.packageRepositoryName;
		if (names.includes(name)) {
			return false;
		} else {
			names.push(name);
			return name;
		}
	}).filter(e => !!e).sort();
};
exports.packageRepositoryTags = () => {
	const tags = [];
	return getPackageRepositories().map(repository => {
		const tag = repository.packageRepositoryTag;
		if (tags.includes(tag)) {
			return false;
		} else {
			tags.push(tag);
			return tag;
		}
	}).filter(e => !!e).sort();
};

exports.currentPackageRepository = getCurrentPackageRepository();
exports.currentPackageRepositoryName = exports.currentPackageRepository.packageRepositoryName;
exports.currentPackageRepositoryTag = exports.currentPackageRepository.packageRepositoryTag;

/******************************************************************************/

exports.selectPackageRepository = (packageRepositoryName, packageRepositoryTag) => {
	setCurrentPackageRepository({
		packageRepositoryName: packageRepositoryName,
		packageRepositoryTag: packageRepositoryTag
	});
};

/******************************************************************************/

exports.addPackageRepository = (packageRepositoryName, packageRepositoryTag) => {
	const packageRepositories = getPackageRepositories();
	if (!packageRepositoryName || !packageRepositoryTag) return;
	if (packageRepositories.find(repository => (repository.packageRepositoryName === packageRepositoryName &&
																	 repository.packageRepositoryTag === packageRepositoryTag))) return;
	packageRepositories.push({ packageRepositoryName: packageRepositoryName, packageRepositoryTag: packageRepositoryTag });
	setPackageRepositories(packageRepositories);
};

/******************************************************************************/

exports.removePackageRepository = (packageRepositoryName, packageRepositoryTag) => {
	const packageRepositories = getPackageRepositories();
	const repositoryToRemove = packageRepositories.find(repository => ((repository.packageRepositoryName === packageRepositoryName) && (repository.packageRepositoryTag === packageRepositoryTag)));

	if (!repositoryToRemove) return false;

	const index = packageRepositories.indexOf(repositoryToRemove);
	packageRepositories.splice(index, 1);

	setPackageRepositories(packageRepositories);
};

/******************************************************************************/

exports.openPackageRepositoryManagerDialog = () => {
	const transient = document.createElement("transient");

	const elements = require("#dialog-template", {
		title: "Manage Package Repositories",
		message: `&lt;div>Package repositories are retrieved from ${exports.usesCookies ? "webstrate cookies" : "LocalStorage"}.&lt;/div>
&lt;table class="packages package-repositories">
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Tag&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;/tbody>
&lt;/table>`,
		actions: `&lt;div class="button add">Add&lt;/div>
&lt;div class="button ok">OK&lt;/div>
&lt;div class="button cancel">Cancel&lt;/div>`,
		className: ""
	});

	elements.forEach(e => transient.appendChild(e));

	const createRow = (name = "", tag = "") => {
		const tr = document.createElement("tr");
		tr.innerHTML = `&lt;td class="package-repository-name">&lt;input type="text" value="${name}" placeholder="name">&lt;/td>
&lt;td class="package-repository-tag">&lt;input type="text" value="${tag}" placeholder="tag">&lt;/td>`;

		const removeTd = document.createElement("td");
		removeTd.classList.add("remove-package-repository");
		removeTd.innerHTML = `&lt;i class="material-icons">&lt;/i>`;
		removeTd.addEventListener("click", () => tr.remove());

		tr.appendChild(removeTd);
		return tr;
	};

	const table = transient.querySelector(".package-repositories > tbody");
	const oldPackageRepositories = getPackageRepositories();
	oldPackageRepositories.forEach(repository => {
		table.appendChild(createRow(repository.packageRepositoryName, repository.packageRepositoryTag));
	});

	const addBtn = transient.querySelector(".add");
	const okBtn = transient.querySelector(".ok");
	const cancelBtn = transient.querySelector(".cancel");

	const add = () => {
		table.appendChild(createRow());
	};

	const ok = () => {
		const rows = Array.from(table.querySelectorAll("tr"));
		const packageRepositories = [];

		if (rows) {
			rows.forEach(row => {
				const name = row.querySelector(".package-repository-name input");
				const tag = row.querySelector(".package-repository-tag input");
				if (name && tag && name.value !== "" && tag.value !== "") {
					packageRepositories.push({packageRepositoryName: name.value, packageRepositoryTag: tag.value});
				}
			});
		}
		setPackageRepositories(packageRepositories);
		transient.remove();
		toast("Set new package repositories", 5000, () => setPackageRepositories(oldPackageRepositories), "Undo");
	};

	const cancel = () => {
		transient.remove();
	};

	addBtn.addEventListener("click", e => add());
	okBtn.addEventListener("click", e => ok());
	cancelBtn.addEventListener("click", e => cancel());

	document.body.appendChild(transient);
};</pre></div><div class="paragraph style-paragraph collapsed" data-id="kk2sTtWu" name="Package Repository Manager Style" __wid="DXenE4ap"><style data-type="content" type="text/css" codemirror="true" __wid="ZUGWEMrt">html .dialog table.package-repositories input {
  margin-bottom: 8px;
}</style></div><div class="paragraph body-paragraph collapsed" data-id="3EuDgYs5" name="Package Management Dialog Template" __wid="SfYVmTLV"><div data-type="content" type="text/html" codemirror="true" contenteditable="true" id="package-management-dialog-template" __wid="92rD3J6q"><div class="modal" __wid="sSJzhbRa"></div>
<div class="dialog packages ${className}" __wid="J8EzCQAH">
	<div class="title" __wid="VegHZhRb">${title}</div>
	<div class="body" __wid="URpRyrN8">
		<div __wid="9g2sXvtA">Select the repository you want to install or update packages from:</div>
		<div class="pullData" __wid="sYdKM6Fu">
			<select class="repositories" __wid="fQRMSgDT">${PackageRepositoryManager.packageRepositories.map(repository => `<option value="${repository.packageRepositoryName};${repository.packageRepositoryTag}" __wid="CfGEg59a">${repository.packageRepositoryName} ${repository.packageRepositoryTag}</option>`).join("")}</select>
			<input type="text" class="repository-name" placeholder="Repository Name" name="repository-name" title="Repository Name" required __wid="h2SERhmQ"/>
			<input type="text" class="repository-tag" placeholder="Repository Tag" name="repository-tag" title="Repository Tag" required __wid="XRHgT7gn"/>
			<div class="update-package-list button" __wid="mYpumTZa">Update List</div>
		</div>
		<div __wid="WZrr7A3R">Select tags to filter for them:</div>
		<div class="tag-filter-container" __wid="b27VNuNN"></div>
		<div __wid="pDD4ujH7">Select the packages you want to install or update from <b __wid="ahemNGTi"><span class="current-repository" __wid="qu2XSfCJ"></span></b>:</div>
		<table class="packages install-and-update-packages" __wid="usGzrQCE">
		<thead __wid="a7u2rjfQ">
		<tr __wid="isjqc2R2">
			<th __wid="EtWx6hY6"><i class="material-icons" id="checkbox-all" __wid="apSCNsSZ"></i></th>
			<th __wid="cxuZUVrj">Status</th>
			<th __wid="yUuDk45D">Installed Version</th>
			<th __wid="XaAPEbWy">Repository Version</th>
			<th __wid="XavjKi9H">Name</th>
			<th __wid="gVt4rnBY">Description</th>
			<th __wid="NtS3rdw9">Tags</th>
			<th __wid="75R4wjeC">Dependencies</th>
			<th __wid="FKgWMJxm">Changelog</th>
		</tr>
		</thead>
		<tbody __wid="EymGrBgG"></tbody>
		</table>
	</div>
	<div class="actions" __wid="hApXEfRM">
		<div class="button ok" __wid="FhzTVCYt">OK</div>
		<div class="button cancel" __wid="Au2NAeHE">Cancel</div>
	</div>
</div></div></div><div class="paragraph code-paragraph collapsed" name="Package Management Dialogs" data-id="7epQSVbJ" style __wid="Rhuu6ZSC"><pre data-type="content" type="text/javascript" id="package-management-dialogs" __wid="6YGfa543">const SectionPullingUtils = require("#section-pulling-utils");
const PackageRepositoryManager = require("#package-repository-manager");

/******************************************************************************/

const packageSectionQuerySelector = ".section[data-type='package']";

/******************************************************************************/

exports.installAndUpdatePackagesDialog = () => {

	return new Promise((resolve, reject) => {

		const data = {};
		let currentPackageStati = [];
		let selectedTags = [];

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: "Install and Update Packages",
			message: `&lt;div>Select the repository you want to install or update packages from:&lt;/div>
&lt;div class="pullData">
	&lt;select class="repositories">${PackageRepositoryManager.packageRepositories.map(repository => `&lt;option value="${repository.packageRepositoryName};${repository.packageRepositoryTag}">${repository.packageRepositoryName} ${repository.packageRepositoryTag}&lt;/option>`).join("")}&lt;/select>
	&lt;input type="text" class="repository-name" placeholder="Repository Name" name="repository-name" title="Repository Name" required>
	&lt;input type="text" class="repository-tag" placeholder="Repository Tag" name="repository-tag" title="Repository Tag" required>
	&lt;div class="update-package-list button">Update List&lt;/div>
&lt;/div>
&lt;div>Select tags to filter for them:&lt;/div>
&lt;div class="tag-filter-container">&lt;/div>
&lt;div>Select the packages you want to install or update from &lt;b>&lt;span class="current-repository">&lt;/span>&lt;/b>:&lt;/div>
&lt;div class="package-search">
	&lt;input type="text" class="package-search-input" placeholder="Package Name" title="Search Packages">
&lt;/div>
&lt;table class="packages install-and-update-packages">
&lt;thead>
&lt;tr>
	&lt;th>&lt;i class="material-icons" id="checkbox-all">&lt;/th>
	&lt;th>Status&lt;/th>
	&lt;th>Installed Version&lt;/th>
	&lt;th>Repository Version&lt;/th>
	&lt;th>Name&lt;/th>
	&lt;th>Description&lt;/th>
	&lt;th>Tags&lt;/th>
	&lt;th>Dependencies&lt;/th>
	&lt;th>Changelog&lt;/th>
	&lt;th>Icon&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>&lt;/tbody>
&lt;/table>`,
			actions: `&lt;div class="button ok">Install / Update&lt;/div>
&lt;div class="button cancel">Cancel&lt;/div>`,
			className: "packages install-and-update-packages"
		});

		elements.forEach(e => transient.appendChild(e));

		const repositorySelect = transient.querySelector(".repositories");
		const repositoryNameInput = transient.querySelector(".repository-name");
		const repositoryTagInput = transient.querySelector(".repository-tag");
		const updatePackageListButton = transient.querySelector(".update-package-list");
		const currentRepositorySpan = transient.querySelector(".current-repository");
		const tagFilterContainer = transient.querySelector(".tag-filter-container");
		const packageSearchInput = transient.querySelector(".package-search-input");
		const checkboxAll = transient.querySelector("#checkbox-all");
		const tbody = transient.querySelector("table.packages tbody");

		// Repository selection
		const updateSelect = () => {
			repositorySelect.value = repositoryNameInput.value + ";" + repositoryTagInput.value;
		};

		const updateInputs = () => {
			const repository = repositorySelect.value.split(";");
			repositoryNameInput.value = repository[0];
			repositoryTagInput.value = repository[1];
		};

		const updateButton = () => {
			if (data.pullData && (data.pullData.pullFrom !== repositoryNameInput.value || data.pullData.pullVersion !== repositoryTagInput.value)) {
				updatePackageListButton.classList.add("update-needed");
			} else {
				updatePackageListButton.classList.remove("update-needed");
			}

			if (repositoryNameInput.value === "" || repositoryTagInput.value === "") {
				updatePackageListButton.classList.add("invalid");
			} else {
				updatePackageListButton.classList.remove("invalid");
			}
		};

		const updateTable = async() => {

			// Open dialog for repository selection
			if (repositoryNameInput.value === "" || repositoryTagInput.value === "") return;

			data.pullData = {
				pullFrom: repositoryNameInput.value,
				pullVersion: repositoryTagInput.value
			};

			tbody.innerHTML = "";
			tagFilterContainer.innerHTML = "";
			selectedTags = [];
			updateButton();

			// Pull Codestrate in iFrame
			data.url = SectionPullingUtils.generatePullUrl(data.pullData.pullFrom, data.pullData.pullVersion);
			const iframe = await SectionPullingUtils.loadPrototype(data.url + "?exec=no");
			if (!iframe) return;

			// Extract packages from pulled Codestrate and remove it
			data.prototypePackageSections = Array.from(iframe.contentWindow.document.querySelectorAll(packageSectionQuerySelector));
			const transient = iframe.parentNode;
			transient.remove();

			data.localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

			// Get stati of packages
			currentPackageStati = SectionPullingUtils.getSectionStati(
				SectionPullingUtils.getMultipleSectionProperties(data.prototypePackageSections),
				SectionPullingUtils.getMultipleSectionProperties(data.localPackageSections));

			currentRepositorySpan.innerText = data.pullData.pullFrom + " " + data.pullData.pullVersion;

			// Get tags, sort and make unique
			let tagList = [];
			currentPackageStati.filter(x => x.prototype).forEach(status => {
				if (Array.isArray(status.prototypeProperties.tags)) {
					tagList.push(...Array.from(status.prototypeProperties.tags));
				}
			});
			tagList = tagList.filter(function(item, pos) {
				return tagList.indexOf(item) == pos;
			});
			tagList = tagList.sort();
			tagFilterContainer.innerHTML = `${tagList.map(tag => `&lt;div class="tag-filter">${tag}&lt;/div>`).join("")}`;

			updateTableBody();
		};

		const updateTableBody = () => {
			tbody.innerHTML = "";
			tbody.innerHTML = `${currentPackageStati.filter(status => {
				if (status.prototype) {
					if (selectedTags.length === 0) {
						return true;
					} else if (Array.isArray(status.prototypeProperties.tags) && status.prototypeProperties.tags.length > 0) {
						for (let i = 0; i &lt; selectedTags.length; i++) {
							if (!status.prototypeProperties.tags.includes(selectedTags[i])) {
								return false;
							}
						}
						return true;
					}
				}
				return false;
			}).filter(status => {
				if (packageSearchInput.value !== "") {
					if (status.name.toLowerCase().indexOf(packageSearchInput.value.toLowerCase()) > -1) {
						return true;
					} else {
						return false;
					}
				} else {
					return true;
				}
			}).map(status => `&lt;tr local="${status.local}" version-changed="${status.versionChanged}" ${status.local ? `uninstalled="${status.localProperties.uninstalled ? "true" : "false"}"` : ""} data-id="${status.id}" ${status.selected ? `class="selected"` : ""}>
	&lt;td>&lt;i class="material-icons checkbox">&lt;/td>
	&lt;td>${status.local ? (status.localProperties.uninstalled ? "Persistent parts only" : (status.versionChanged !== undefined ? (status.versionChanged ? "Version changed" : "Up to date") : "Unknown version installed")) : "Not installed"}&lt;/td>
	&lt;td>${status.local ? (status.localProperties.version || "-") : "-"}&lt;/td>
	&lt;td>${status.prototypeProperties.version || "-"}&lt;/td>
	&lt;td>&lt;b>${status.prototypeProperties.name || "-"}&lt;/b>&lt;/td>
	&lt;td>${status.prototypeProperties.description || "-"}&lt;/td>
	&lt;td>${Array.isArray(status.prototypeProperties.tags) ? (status.prototypeProperties.tags.length > 0 ? status.prototypeProperties.tags.map(tag => `${tag}`).join(", ") : "-") : "-"}&lt;/td>
	&lt;td>${Array.isArray(status.prototypeProperties.dependencies) ? (status.prototypeProperties.dependencies.length > 0 ? status.prototypeProperties.dependencies.map(dependency => `${dependency.name}`).join(", ") : "-") : "-"}&lt;/td>
	&lt;td>${status.prototypeProperties.changelog ? (status.prototypeProperties.changelog[status.prototypeProperties.version] || "-") : "-"}&lt;/td>
	&lt;td class="package-icon">${status.prototypeProperties.icon ? `&lt;i class="material-icons">${status.prototypeProperties.icon}&lt;/i>` : ""}&lt;/td>
&lt;/tr>`).join("")}`;
			updateCheckboxAll();
		};

		const updateCheckboxAll = () => {
			const checked = (tbody.querySelector("tr.selected") !== null);
			const unchecked = (tbody.querySelector("tr:not(.selected)") !== null);

			if (checked) {
				if (unchecked) {
					checkboxAll.classList.add("indeterminate");
					checkboxAll.classList.remove("checked");
				} else {
					checkboxAll.classList.remove("indeterminate");
					checkboxAll.classList.add("checked");
				}
			} else {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.remove("checked");
			}
		};

		// Repository selection events
		repositorySelect.addEventListener("change", () => {
			updateInputs();
			updateTable();
			updateButton();
		});
		repositoryNameInput.addEventListener("change", () => {
			updateSelect();
			updateButton();
		});
		repositoryTagInput.addEventListener("change", () => {
			updateSelect();
			updateButton();
		});

		repositoryNameInput.addEventListener("keydown", e => {
			e.stopPropagation();
			if (e.keyCode === 13) {
				e.preventDefault();
				updateTable();
			} else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
		});

		repositoryTagInput.addEventListener("keydown", e => {
			e.stopPropagation();
			if (e.keyCode === 13) {
				e.preventDefault();
				updateTable();
			} else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
		});

		updatePackageListButton.addEventListener("click", () => updateTable());

		// Checkbox events
		checkboxAll.addEventListener("click", () => {
			let selected;
			if (checkboxAll.classList.contains("checked")) {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.remove("checked");
				selected = false;
			} else {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.add("checked");
				selected = true;
			}
			Array.from(tbody.querySelectorAll("tr")).forEach(tr => {
				if (selected) {
					tr.classList.add("selected");
          currentPackageStati.find((status) => status.id === tr.getAttribute("data-id")).selected = true;
				} else {
					tr.classList.remove("selected");
          currentPackageStati.find((status) => status.id === tr.getAttribute("data-id")).selected = false;
				}
			});
		});

		tbody.addEventListener("click", e => {
			if (e.target === null || e.target.closest("tr") === null) return;
			const tr  = e.target.closest("tr");
      tr.classList.toggle("selected");
      currentPackageStati.find((status) => status.id === tr.getAttribute("data-id")).selected = tr.classList.contains("selected");
			updateCheckboxAll();
		});

		repositoryNameInput.value = PackageRepositoryManager.currentPackageRepository.packageRepositoryName;
		repositoryTagInput.value = PackageRepositoryManager.currentPackageRepository.packageRepositoryTag;
		updateSelect();
		updateTable();

		// Tag filter event
		tagFilterContainer.addEventListener("click", e => {
			if (e.target === null || !e.target.classList.contains("tag-filter")) return;

			const newTag = e.target.innerText;
			if (selectedTags.includes(newTag)) {
				selectedTags.splice(selectedTags.indexOf(newTag), 1);
				e.target.classList.remove("selected");
			} else {
				selectedTags.push(newTag);
				e.target.classList.add("selected");
			}

			updateTableBody();
		});

		// Search
		packageSearchInput.addEventListener("keyup", e => {
			e.stopPropagation();
			if (e.keyCode === 13) {
				e.preventDefault();
			} else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
			updateTableBody();
		});

		// Dialog actions
		const okBtn = transient.querySelector(".ok");
		const cancelBtn = transient.querySelector(".cancel");

		const ok = () => {
			PackageRepositoryManager.selectPackageRepository(data.pullData.pullFrom, data.pullData.pullVersion);
			PackageRepositoryManager.addPackageRepository(data.pullData.pullFrom, data.pullData.pullVersion);
      data.selectedPackageIds = currentPackageStati.filter((status) => status.selected).map((status) => status.id);
			transient.remove();
			resolve(data);
		};

		const cancel = () => {
			transient.remove();
			resolve(false);
		};

		okBtn.addEventListener("click", ok);
		cancelBtn.addEventListener("click", cancel);

		document.body.appendChild(transient);
		packageSearchInput.focus();
	});
};

/*****************************************************************/

exports.selectPackagesDialog = (packageProperties, showUninstalled = true, options = {}) => {

	return new Promise((resolve, reject) => {

    const mergedOptions = Object.assign({
      message: "Select the packages:",
      title: "Select Packages",
      repoSelection: false,
      repoSelectionMessage: "Select the repository:",
      trueLabel: "OK",
      falseLabel: "Cancel"
    }, options);

		const data = {};

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: mergedOptions.title,
			message: `${mergedOptions.repoSelection ? `&lt;div>${mergedOptions.repoSelectionMessage}&lt;/div>
&lt;div class="pullData">
	&lt;select class="repositories">${PackageRepositoryManager.packageRepositories.map(repository => `&lt;option value="${repository.packageRepositoryName};${repository.packageRepositoryTag}">${repository.packageRepositoryName} ${repository.packageRepositoryTag}&lt;/option>`).join("")}&lt;/select>
	&lt;input type="text" class="repository-name" placeholder="Repository Name" name="repository-name" title="Repository Name" required>
	&lt;input type="text" class="repository-tag" placeholder="Repository Tag" name="repository-tag" title="Repository Tag" required>
&lt;/div>` : ""}
&lt;div>${mergedOptions.message}&lt;/div>
&lt;table class="packages select-packages">
&lt;thead>
&lt;tr>
	&lt;th>&lt;i class="material-icons" id="checkbox-all">&lt;/th>
	&lt;th>Installed Version&lt;/th>
	&lt;th>Name&lt;/th>
	&lt;th>Description&lt;/th>
	&lt;th>Dependencies&lt;/th>
	&lt;th>Icon&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
${packageProperties.filter(x => (showUninstalled || !x.uninstalled)).map(property => `&lt;tr uninstalled="${property.uninstalled}" data-id="${property.id}">
	&lt;td>&lt;i class="material-icons checkbox">&lt;/td>
	&lt;td>${property.version || "-"}&lt;/td>
	&lt;td>&lt;b>${property.name || "-"}&lt;/b>&lt;/td>
	&lt;td>${property.description || "-"}&lt;/td>
	&lt;td>${Array.isArray(property.dependencies) ? (property.dependencies.length > 0 ? property.dependencies.map(dependency => `${dependency.name}`).join(", ") : "-") : "-"}&lt;/td>
	&lt;td class="package-icon">${property.icon ? `&lt;i class="material-icons">${property.icon}&lt;/i>` : ""}&lt;/td>
&lt;/tr>`).join("")}
&lt;/tbody>
&lt;/table>`,
			actions: `&lt;div class="button ok">${mergedOptions.trueLabel}&lt;/div>
&lt;div class="button cancel">${mergedOptions.falseLabel}&lt;/div>`,
			className: "packages select-packages"
		});

		elements.forEach(e => transient.appendChild(e));

		const repositorySelect = transient.querySelector(".repositories");
		const repositoryNameInput = transient.querySelector(".repository-name");
		const repositoryTagInput = transient.querySelector(".repository-tag");
		const checkboxAll = transient.querySelector("#checkbox-all");
		const tbody = transient.querySelector("table.packages tbody");

		// Repository selection
		if (mergedOptions.repoSelection) {
			const updateSelect = () => {
				repositorySelect.value = repositoryNameInput.value + ";" + repositoryTagInput.value;
			};

			const updateInputs = () => {
				const repository = repositorySelect.value.split(";");
				repositoryNameInput.value = repository[0];
				repositoryTagInput.value = repository[1];
			};

			repositorySelect.addEventListener("change", () => updateInputs());
			repositoryNameInput.addEventListener("change", () => updateSelect());
			repositoryTagInput.addEventListener("change", () => updateSelect());

			repositoryNameInput.value = PackageRepositoryManager.currentPackageRepository.packageRepositoryName;
			repositoryTagInput.value = PackageRepositoryManager.currentPackageRepository.packageRepositoryTag;
			updateSelect();
		}

		// Checkboxes
		const updateCheckboxAll = () => {
			const checked = (tbody.querySelector("tr.selected") !== null);
			const unchecked = (tbody.querySelector("tr:not(.selected)") !== null);

			if (checked) {
				if (unchecked) {
					checkboxAll.classList.add("indeterminate");
					checkboxAll.classList.remove("checked");
				} else {
					checkboxAll.classList.remove("indeterminate");
					checkboxAll.classList.add("checked");
				}
			} else {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.remove("checked");
			}
		};

		checkboxAll.addEventListener("click", () => {
			let selected;
			if (checkboxAll.classList.contains("checked")) {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.remove("checked");
				selected = false;
			} else {
				checkboxAll.classList.remove("indeterminate");
				checkboxAll.classList.add("checked");
				selected = true;
			}
			Array.from(tbody.querySelectorAll("tr")).forEach(tr => {
				if (selected) {
					tr.classList.add("selected");
				} else {
					tr.classList.remove("selected");
				}
			});
		});

		tbody.addEventListener("click", e => {
			if (e.target === null || e.target.closest("tr") === null) return;
			e.target.closest("tr").classList.toggle("selected");
			updateCheckboxAll();
		});

		const okBtn = transient.querySelector(".ok");
		const cancelBtn = transient.querySelector(".cancel");

		const ok = () => {
			if (mergedOptions.repoSelection) {
				data.pullData = {
					pullFrom: repositoryNameInput.value,
					pullVersion: repositoryTagInput.value
				};
			}
			data.selectedPackageIds = Array.from(
					tbody.querySelectorAll("tr.selected")).map(tr => tr.getAttribute("data-id"));
			transient.remove();
			resolve(data);
		};

		const cancel = () => {
			transient.remove();
			resolve(false);
		};

		okBtn.addEventListener("click", ok);
		cancelBtn.addEventListener("click", cancel);

		document.body.appendChild(transient);
	});
};

/******************************************************************************/

exports.importPackagesDialog = () => {

	return new Promise((resolve, reject) => {

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: "Import Packages",
			message: `&lt;div>Enter an URL to a zip-file or upload a zip-file:&lt;/div>
&lt;input class="import-package-url-input" type="url" placeholder="http://www.codestrates.org/packages.zip" pattern=".*\.zip$">
&lt;input class="import-package-file-input" type="file" accept="application/zip">
&lt;br>&lt;br>
&lt;div>Enter an GitHub URL to a repository and optionally a folder:&lt;/div>
&lt;input class="import-package-github-url-input" type="url" placeholder="https://github.com/User/Repository" pattern="https://github.com/.*">
&lt;input class="import-package-github-folder-input" placeholder="path/to/package (optional)">`,
			actions: `&lt;div class="button ok">Import&lt;/div>
&lt;div class="button cancel">Cancel&lt;/div>`,
			className: "packages import-packages"
		});

		elements.forEach(e => transient.appendChild(e));

		const okBtn = transient.querySelector(".ok");
		const cancelBtn = transient.querySelector(".cancel");
		const urlInput = transient.querySelector(".import-package-url-input");
		const fileInput = transient.querySelector(".import-package-file-input");
		const gitHubUrlInput = transient.querySelector(".import-package-github-url-input");
		const gitHubFolderInput = transient.querySelector(".import-package-github-folder-input");

		const ok = () => {
			let result;

			if (fileInput.files.length === 1) {
				result = fileInput.files.item(0);
			} else if (urlInput.value !== "") {
				result = urlInput.value;
			} else if (gitHubUrlInput !== "") {
				result = {
					url: gitHubUrlInput.value,
					folder: gitHubFolderInput.value
				}
			}

			transient.remove();
			resolve(result);
		};

		const cancel = () => {
			transient.remove();
			resolve(false);
		};

		const inputAction = (e) => {
			e.stopPropagation();

			if (e.keyCode === 13) {
				e.preventDefault();
				ok();
			} else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
		};

		urlInput.addEventListener("keydown", (e) => inputAction(e));
		gitHubUrlInput.addEventListener("keydown", (e) => inputAction(e));
		gitHubFolderInput.addEventListener("keydown", (e) => inputAction(e));

		okBtn.addEventListener("click", ok);
		cancelBtn.addEventListener("click", cancel);

		document.body.appendChild(transient);

		urlInput.focus();
	});
};

/******************************************************************************/

exports.exportPackageToGitHubDialog = (properties) => {

	return new Promise((resolve, reject) => {

		let url = "";
		let folder = "";
		if (properties && properties.github) {
			url = properties.github.url || "";
			folder = properties.github.folder || "";
		}

		const transient = document.createElement("transient");

		const elements = require("#dialog-template", {
			title: "Export Package to GitHub",
			message: `&lt;div>Enter the URL to the GitHub repository:&lt;/div>
&lt;input class="url-input" placeholder="https://github.com/User/Repository" value="${url}">
&lt;div>Enter a folder/folder (optional):&lt;/div>
&lt;input class="folder-input" placeholder="path/to/package (optional)" value="${folder}">
&lt;br>&lt;br>
&lt;div>Enter a commit message:&lt;/div>
&lt;input class="message-input">
&lt;div>Enter the name of the committer:&lt;/div>
&lt;input class="name-input" value="${webstrate.user.displayName}">
&lt;div>Enter the email of the committer:&lt;/div>
&lt;input class="email-input" value="${webstrate.user.username}@users.noreply.github.com">
&lt;br>&lt;br>
&lt;div>Do you want to clean up the repository before pushing?&lt;/div>
&lt;input class="cleanup-input" type="checkbox">`,
			actions: `&lt;div class="button ok">Export&lt;/div>
&lt;div class="button cancel">Cancel&lt;/div>`,
			className: "packages export-package-to-github"
		});

		elements.forEach(e => transient.appendChild(e));

		const okBtn = transient.querySelector(".ok");
		const cancelBtn = transient.querySelector(".cancel");
		const urlInput = transient.querySelector(".url-input");
		const folderInput = transient.querySelector(".folder-input");
		const messageInput = transient.querySelector(".message-input");
		const nameInput = transient.querySelector(".name-input");
		const emailInput = transient.querySelector(".email-input");
		const cleanUpInput = transient.querySelector(".cleanup-input");

		const ok = () => {
			const commitData = {
				url: urlInput.value,
				folder: folderInput.value,
				message: messageInput.value,
				name: nameInput.value,
				email: emailInput.value,
				cleanUp: cleanUpInput.checked
			}

			transient.remove();
			resolve(commitData);
		};

		const cancel = () => {
			transient.remove();
			resolve(false);
		};

		const inputAction = (e) => {
			e.stopPropagation();

			if (e.keyCode === 13) {
				e.preventDefault();
				ok();
			} else if (e.keyCode === 27) {
				e.preventDefault();
				cancel();
			}
		};

		okBtn.addEventListener("click", ok);
		cancelBtn.addEventListener("click", cancel);
		urlInput.addEventListener("keydown", (e) => inputAction(e));
		messageInput.addEventListener("keydown", (e) => inputAction(e));
		nameInput.addEventListener("keydown", (e) => inputAction(e));
		emailInput.addEventListener("keydown", (e) => inputAction(e));

		document.body.appendChild(transient);

		urlInput.focus();
	});
};</pre></div><div class="paragraph style-paragraph collapsed" name="Package Management Dialogs Style" data-id="aaSLkDgy" style __wid="RaQ8rWZi"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="r84939R9">html .dialog.install-and-update-packages {
	transform: translate(-50%, 0);
	top: 5vh;
	max-height: 90vh;
}

html .install-and-update-packages .body,
html .select-packages .body {
	max-width: 90vw;
}

html table.packages {
	border-collapse: collapse;
	margin-top: 16px;
}

html table.install-and-update-packages {
	width: 85vw;
}

html table.select-packages,
html table.package-repositories {
	width: 100%;
	max-height: 90vh;
}

html table.packages td,
html table.packages th {
	padding: 8px;
}

html table.packages .checkbox:before,
html table.packages #checkbox-all:before {
	content: "check_box_outline_blank";
}

html table.packages .selected .checkbox:before,
html table.packages #checkbox-all.checked:before {
	content: "check_box";
}

html table.packages #checkbox-all.indeterminate:before {
	content: "indeterminate_check_box";
}

html table.packages td,
html table.packages #checkbox-all {
	cursor: pointer;
}

html table.packages td.package-icon {
  max-width: 32px;
  overflow: hidden;
  text-align: center;
}

/******************************************************************************/

html .packages .pullData,
html .packages .package-search {
	display: flex;
	margin-bottom: 24px;
	margin-top: 16px;
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
  flex-wrap: wrap;
	min-height: 48px;
	background: var(--color-primary-shade-2);
	padding: 8px;
	width: 100%;
}

html .packages .pullData > * {
	flex: 0 1 auto;
	height: 32px;
	margin: 0 !important;
}

html .packages .pullData > input {
	flex: 1 0 192px;
}

html .packages .pullData > * + *,
html .packages .package-search > * + *{
	margin-left: 32px !important;
}

html .packages .pullData .repositories {
	width: auto;
	margin: 0;
}

html .packages .pullData .update-package-list,
html .packages .package-search .search-packages {
	flex: 0 0 auto;
}

html .packages .pullData .update-package-list:hover,
html .packages .package-search .search-packages:hover {
	background: var(--color-primary-shade-3);
}

html .packages .pullData .update-package-list.update-needed {
	background: rgba(var(--material-color-green-rgb), 0.75);
}

html .packages .pullData .update-package-list.update-needed:hover {
	background: var(--material-color-green);
}

html .packages .pullData .update-package-list.invalid {
	background: var(--material-color-grey) !important;
	cursor: default;
}

/******************************************************************************/

html table.packages tr:nth-child(even),
html table.packages thead {
	background: var(--color-primary-shade-2);
}

html table.packages tr[local="true"][version-changed="true"] {
	background: var(--material-color-orange);
	color: var(--material-color-grey-100);
}

html table.packages tr[local="true"][version-changed="false"] {
	background: var(--material-color-green);
	color: var(--material-color-grey-100);
}

html table.packages tr[local="true"][version-changed="undefined"] {
	background: var(--material-color-teal);
	color: var(--material-color-grey-100);
}

html table.packages tr[uninstalled="true"] {
	background: var(--material-color-red) !important;
	color: var(--material-color-grey-100);
}

/******************************************************************************/

html table.package-repositories .package-repository-name,
html table.package-repositories .package-repository-tag {
	cursor: text;
	outline: none;
}

html table.package-repositories .package-repository-name:empty:before {
	content: "name";
	opacity: 0.5;
}

html table.package-repositories .package-repository-tag:empty:before {
	content: "tag";
	opacity: 0.5;
}

html table.package-repositories .remove-package-repository {
	cursor: pointer;
}

html table.package-repositories .remove-package-repository:hover {
	color: var(--material-color-red);
}

html table.package-repositories .remove-package-repository i:after {
	content: "delete";
}

/******************************************************************************/

html .cleanup-input {
	width: auto !important;
	margin: 16px 0  0!important;
}

html .cleanup-input:after {
	content: "Cleanup Repository ";
	position: relative;
	float: left;
	white-space: nowrap;
	line-height: 13px;
	left: 20px;
}

/******************************************************************************/

html .tag-filter-container {
	display: flex;
	flex-wrap: wrap;
	margin-bottom: 16px;
	margin-top: 16px;
	flex-direction: row;
	align-items: flex-start;
	width: 100%;
}

html .tag-filter {
	flex: 0 1 auto;
	background: var(--color-primary-shade-3);
	color: var(--color-primary-text);
	border-radius: 16px;
	height: 32px;
	line-height: 16px;
	padding: 8px 12px;
	margin-right: 8px;
	margin-bottom: 8px;
	cursor: pointer;
}

html .tag-filter.selected {
	background: var(--color-accent);
	color: var(--color-accent-text);
}</style></div><div class="paragraph code-paragraph collapsed" data-id="RWa722Wd" name="Execute installed packages" run-on-load="true" last-execution-state="success" __wid="Lqk9L3ZF"><pre data-type="content" type="text/javascript" __wid="BP7NmcSt">const SectionPullingUtils = require('#section-pulling-utils');

let liveSelector = document.liveQuerySelectorAll('.section[data-type="package"]');
liveSelector.added((section) => {
	if (Codestrate.loaded) {
		const properties = SectionPullingUtils.getSectionProperties(section);

		let paragraphs = [...section.querySelectorAll('.code-paragraph[run-on-load="true"]')];
		Codestrate.executeParagraphsSync(paragraphs);

		toast(`Installed ${properties.name} package`);
	}
});</pre></div></div><div class="section section-hidden" data-type="system" data-group="editing" data-id="NhNX5mz9" name="Fullscreen" __wid="hbyVCHAM"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="DExH2kba" draggable="false" __wid="wkRPYS4Z"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="7Zh6PXvi"><h2 __wid="vzEmx2HZ">Description</h2><div __wid="vzK4zKSw">This section adds the functionality to view paragraphs in fullscreen. The fullscreen can be toggled in two modes: transient and persisted fullscreen. While in fullscreen the paragraph header is still visible. Upon locking a fullscreen paragraph it will be hidden.</div><h3 __wid="Ke3pqzyA">Transient Fullscreen</h3><div __wid="KarFkVme">The transient fullscreen is as the name says transient, so only locally. It only adds a transient attribute. It can be activated by clicking on the fullscreen icon in the paragraph header of a section.</div><div __wid="zXXB2qbU"><b __wid="cE5taZPs">Hint</b>: Activating the transient fullscreen while the persisted fullscreen is active, deactivates the fullscreen just locally.</div><h3 __wid="DByv8hJk">Persisted Fullscreen</h3><div __wid="rS5mMEw5">The persisted fullscreen adds a class to the paragraph, which is currently in fullscreen and therefore toggles it fullescreen on all clients. It can be toggled by long-pressing on the fullscreen icon or pressing the shortcut <kbd __wid="hGhzxKGh">Ctrl</kbd>+<kbd __wid="SnwgyHts">Shift</kbd>+<kbd __wid="CF2SvyLZ">F</kbd>.</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="S5yMHJz2" __wid="Y39gitwG"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="R87xsUbb">{
  "version": "1.3.1",
  "description": "Adds the functionality to view paragraphs in fullscreen.",
  "changelog": {
    "1.0": "Initital Release",
    "1.1": "Fixed z-index issue with toolbar.",
    "1.1.1": "Added documentation.",
    "1.2": "Commands API used.",
    "1.2.1": "Fixed bug with new flexbox headers.",
    "1.2.2": "Fixed bug where the toolbar and the snackbar were still visible even though a paragraph was locked and in fullscreen.",
    "1.3": "Exit fullscreen when transient-fullscreen=\"false\" paragraph gets deleted, which could result in an inconsistent state in the past. Also, the name of the transient fullscreen indicator updates when the name of the transient fullscreen paragraph is updated.",
		"1.3.1": "Moved exit fullscreen fix to Paragraph Fullscreen code."
  }
}</pre></div>
<div class="paragraph code-paragraph collapsed" name="Fullscreen Utils" data-id="SShXZSND" style draggable="false" __wid="rqTKiiXY"><pre data-type="content" type="text/javascript" id="fullscreen-utils" __wid="Vauc3WP9">const setFullscreen = (paragraph, enable, enableFullscreen, disableFullscreen) => {

  if (paragraph.classList.contains("collapsed")) {
    paragraph.classList.remove("collapsed");
  }

  let paragraphs = document.querySelectorAll(".paragraph.fullscreen,.paragraph[transient-fullscreen]");
  if (enable) {
    // Remove fullscreen from all paragraphs -> just in case
    Array.prototype.forEach.call(paragraphs, (paragraph) => disableFullscreen(paragraph));
    enableFullscreen();
  } else {
    disableFullscreen();

    // Remove fullscreen from all paragraphs -> just in case
    Array.prototype.forEach.call(paragraphs, (paragraph) => disableFullscreen(paragraph));

    // Refresh CodeMirror instances, otherwise they will be collapsed
    const contents = document.querySelectorAll(".section:not(.section-hidden) .paragraph:not(.collapsed) [data-type='content']");
    Array.prototype.forEach.call(contents, (content) => {
      if (content && content.__editor && content.__editor.editor) {
        content.__editor.editor.refresh();
      }
    });
  }
};

const setPersistedFullscreen = (enable, paragraph) => {

  // Disable transient fullscreen when set paragraph to real fullscreen
  if (enable) {
    setTransientFullscreen(false, paragraph, true);
  }

  const enableFullscreen = () => {
    paragraph.classList.add("fullscreen");
    document.body.classList.add("fullscreen");
    document.documentElement.classList.add("fullscreen");
    toast("Persisted fullscreen activated", 1500);
  };

  const disableFullscreen = (paragraph) => {
    if (paragraph) {
      paragraph.classList.remove("fullscreen");
    } else {

      // Replace body fullscreen with html fullscreen
      let documentElement = document.documentElement;
      if (documentElement.classList.contains("fullscreen")) {
        documentElement.classList.remove("fullscreen");
      }

      // @deprecated body fullscreen will be removed because it is replaced
      // by html fullscreen
      let body = document.body;
      if (body.classList.contains("fullscreen")) {
        body.classList.remove("fullscreen");
      }
      toast("Persisted fullscreen deactivated", 1500);
    }
  };

  setFullscreen(paragraph, enable, enableFullscreen, disableFullscreen);
};

const setTransientFullscreen = (enable, paragraph, removeAttribute = false) => {

  const enableFullscreen = () => {
    paragraph.setAttribute("transient-fullscreen", "true");
    document.body.setAttribute("transient-fullscreen", "true");
    document.documentElement.setAttribute("transient-fullscreen", "true");
  };

  const disableFullscreen = (paragraph) => {

    if (paragraph) {
      paragraph.setAttribute("transient-fullscreen", "false");

      if (removeAttribute) {
        paragraph.removeAttribute("transient-fullscreen");
      }
    } else {
      if (removeAttribute) {
        document.documentElement.removeAttribute("transient-fullscreen");
      } else {
        document.documentElement.setAttribute("transient-fullscreen", "false");
      }

      if (removeAttribute) {
        document.body.removeAttribute("transient-fullscreen");
      } else {
        document.body.setAttribute("transient-fullscreen", "false");
      }
    }
  };

  setFullscreen(paragraph, enable, enableFullscreen, disableFullscreen);
};

const togglePersistedFullscreen = (paragraph) => {
  const isFullscreen = paragraph.classList.contains("fullscreen");
  setPersistedFullscreen(!isFullscreen, paragraph);
};

const toggleTransientFullscreen = (paragraph) => {

  const isFullscreen = (
    // Paragraph is in fullscreen but transient-fullscreen is not set
    (
      document.body.classList.contains("fullscreen") &&
      !document.body.hasAttribute("transient-fullscreen")
    ) ||
    document.body.matches("[transient-fullscreen='true']")
  );

  setTransientFullscreen(!isFullscreen, paragraph);
};

const exitFullscreen = (paragraph) => {

  if (paragraph) {
		paragraph.classList.remove("fullscreen");
		paragraph.removeAttribute("transient-fullscreen");
  }

	document.body.classList.remove("fullscreen");
	document.documentElement.classList.remove("fullscreen");

	document.body.removeAttribute("transient-fullscreen");
	document.documentElement.removeAttribute("transient-fullscreen");
};

/******************************************************************************/

exports.setPersistedFullscreen = setPersistedFullscreen;
exports.setTransientFullscreen = setTransientFullscreen;
exports.togglePersistedFullscreen = togglePersistedFullscreen;
exports.toggleTransientFullscreen = toggleTransientFullscreen;
exports.exitFullscreen = exitFullscreen;</pre></div><div class="paragraph code-paragraph collapsed" data-id="4nAY6Jw8" name="Paragraph Fullscreen" draggable="false" run-on-load="true" last-execution-state="success" style __wid="CYCFEkeJ"><pre data-type="content" type="text/javascript" __wid="gLnuTiiE">const FullscreenUtils = require("#fullscreen-utils");

/******************************************************************************/

importLib([
	"hammer.min.js",
	"hammer-time.min.js"
]).then(() => {

	const ParagraphUtils = require("#paragraph-utils");

	let addFullscreenButton = (paragraph) => {

		let header = ParagraphUtils.getHeaderElement(paragraph);

		// Make sure to add action only once, e.g. triggered multiple times on paragraph drag and drop
		if (header.querySelector(".action.toggle-fullscreen")) {
			return;
		}

		let action = document.createElement("div");
		action.classList.add("action");
		action.classList.add("toggle-fullscreen");
		action.setAttribute("tooltip", "true");

		let icon = document.createElement("i");
		icon.classList.add("material-icons");
		action.appendChild(icon);
		header.appendChild(action);

		var mc = new Hammer.Manager(action);
		mc.add(new Hammer.Tap({
			event: "tap",
			taps: 1
		}));

		mc.add(new Hammer.Press({
			event: "longpress",
			time: 250
		}));

		mc.on("tap", () => {
			FullscreenUtils.toggleTransientFullscreen(paragraph);
		});
		mc.on("longpress", (event) => {
			FullscreenUtils.togglePersistedFullscreen(paragraph);
		});
	};

	document.liveQuerySelectorAll(".paragraph").added(addFullscreenButton);
});

/******************************************************************************/

// Exit fullscreen when transient fullscreen paragraph was deleted
const selector = document.liveQuerySelectorAll('.paragraph.fullscreen');
selector.removed(FullscreenUtils.exitFullscreen);

/******************************************************************************/

Codestrate.addCommand("codestrates.fullscreen", "Fullscreen", (event) => {
	let paragraph;
	if (event !== null && event.target !== null) {
		let target = event.target;
		paragraph = target.closest(".paragraph");
	} else {
		paragraph = Codestrate.focussedParagraph;
	}

	if (!paragraph) {
		paragraph = document.querySelector(".paragraph.fullscreen:not([transient-fullscreen='false']),.paragraph[transient-fullscreen='true']");
	}

	if (paragraph) {
		FullscreenUtils.togglePersistedFullscreen(paragraph);
	}
});
Codestrate.addKeyBinding("codestrates.fullscreen", "ctrl+shift+f", true);</pre></div><div class="paragraph code-paragraph collapsed" name="Update Fullscreen Indicator" data-id="mBmpfXnA" style draggable="false" run-on-load="true" last-execution-state="success" __wid="mQpsSbha"><pre data-type="content" type="text/javascript" __wid="SCAaCjDf">const FullscreenUtils = require("#fullscreen-utils");

/******************************************************************************/

let indicator = document.createElement("transient");
indicator.setAttribute("id", "fullscreen-indicator");
indicator.classList.add("hidden");
indicator.addEventListener("click", (event) => {
	let paragraph = document.querySelector(".paragraph.fullscreen");
	FullscreenUtils.setPersistedFullscreen(true, paragraph);
});
document.body.appendChild(indicator);

let nameLiveAttribute;

const updateFullscreenIndicator = () => {
	let persistedFullscreenParagraph = document.querySelector(".paragraph.fullscreen");
	let transientFullscreenParagraph = document.querySelector(".paragraph[transient-fullscreen]");
	// console.log("update here", persistedFullscreenParagraph);

	// stop previous name live attribute
	if (nameLiveAttribute) {
		nameLiveAttribute.stop();
		nameLiveAttribute = undefined;
	}

	if (persistedFullscreenParagraph) {
		nameLiveAttribute = persistedFullscreenParagraph.liveAttribute("name");

		// update name
		nameLiveAttribute.changed((value) => {
			if (value) {
				indicator.setAttribute("name", value);
			}
			else {
				indicator.removeAttribute("name");
			}
		});
	}

	if (persistedFullscreenParagraph && transientFullscreenParagraph) {
		indicator.classList.remove("hidden");
	}
	else {
		indicator.classList.add("hidden");
	}
};

/******************************************************************************/

// Update state for fullscreen indicator
const liveSelector = document.liveQuerySelectorAll(".paragraph.fullscreen");
liveSelector.added(updateFullscreenIndicator);

document.documentElement.liveAttribute("class").changed(updateFullscreenIndicator);
document.documentElement.liveAttribute("transient-fullscreen").changed(updateFullscreenIndicator);</pre></div>
<div class="paragraph style-paragraph collapsed" data-id="8deBC5eW" name="Fullscreen Indicator" style __wid="wrSDHdim"><style data-type="content" type="text/css" codemirror="true" contenteditable="true" __wid="bXKJRBPQ">#fullscreen-indicator {
	position: fixed;
	right: 0;
	top: 100px;
	width: 30px;
	height: 400px;
	cursor: pointer;

	color:  rgba(255, 255, 255, 0.2);
	background: rgba(0, 0, 0, 0.2);
	border-radius: 2px;
	z-index: 201;
}

#fullscreen-indicator:hover {
	color: inherit;
	background: rgba(0, 0, 0, 0.3);
}

#fullscreen-indicator:before {
	padding-left: 7px;
	padding-bottom: 7px;
	content: attr(icon);
	position: relative;
	display: inline-block;
	transform: rotate(90deg) translate3d(0, -100%, 0);
	transform-origin: 0 0 0;

	font-family: "Material Icons";
	font-weight: normal;
	font-style: normal;
	/* font-size: 24px; */
	display: inline-block;
	line-height: 1;
	text-transform: none;
	letter-spacing: normal;
	word-wrap: normal;
	white-space: nowrap;
	direction: ltr;
	-webkit-font-smoothing: antialiased;
	text-rendering: optimizeLegibility;
	-moz-osx-font-smoothing: grayscale;
	font-feature-settings: "liga";
}

#fullscreen-indicator:after {
	padding: 5px;
	padding-left: 10px;
	content: attr(name);
	display: inline-block;
	width: 200px;
	position: relative;
	transform: rotate(90deg) translate3d(0, -100%, 0);
	transform-origin: 0 0 0;
}

#fullscreen-indicator:not([name]):after {
	content: "No Name";
}

#fullscreen-indicator.hidden {
	display: none;
}</style></div><div class="paragraph style-paragraph collapsed" data-id="AXwP6QBU" name="Fullscreen Style" draggable="false" __wid="TQhBZdgD"><style data-type="content" type="text/css" codemirror="true" contenteditable="true" class="themable" __wid="Wm3866ay">html body.fullscreen:not([transient-fullscreen="false"]),
html body[transient-fullscreen="true"] {
	overflow: hidden;
}

html body.fullscreen:not([transient-fullscreen="false"]) #snackbar,
html body[transient-fullscreen="true"] #snackbar {
	z-index: 375;
}

html body.fullscreen:not([transient-fullscreen="false"]) .section,
html body[transient-fullscreen="true"] .section {
	width: 0;
	height: 0;
	padding: 0;
	margin: 0;
}

/* Hides section toolbar */
html body.fullscreen:not([transient-fullscreen="false"]) .section .section-header,
html body[transient-fullscreen="true"] .section .section-header {
	opacity: 0;
	pointer-events: none;
}

html .paragraph.fullscreen:not([transient-fullscreen="false"]),
html .paragraph[transient-fullscreen="true"] {
	position: fixed;
	left: 0;
	top: 0;
	bottom: 0;
	right: 0;
	width: 100vw;
	height: 100vh;
	z-index: 300;
	margin: 0;
	background: var(--color-primary-shade-2);
	-webkit-overflow-scrolling: touch; /* enable elastic scroll on touch devices */
}

/* Fixes an issue with Safari where the snackbar and the toolbar were still
visible event though a paragraph was in locked fullscreeen */
html body.fullscreen:not([transient-fullscreen="false"]) #sections,
html body[transient-fullscreen="true"] #sections {
	overflow: unset;
}

/* Move transient-fullscreen above fullscreen */
html .paragraph[transient-fullscreen="true"] {
	z-index: 350;
}

/* Prevent input on paragraphs not in fullscreen view */
html body.fullscreen:not([transient-fullscreen="false"]) .paragraph:not(.fullscreen):not([transient-fullscreen="true"]),
html body[transient-fullscreen="true"] .paragraph:not([transient-fullscreen="true"]) {
	pointer-events: none;
}

html .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header,
html .paragraph[transient-fullscreen="true"] .paragraph-header {
	position: fixed;
	z-index: 1;
	overflow: visible;
}

/* "Hide" paragraph utils when in locked fullscreen view */
html .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header,
html .paragraph.locked[transient-fullscreen="true"] .paragraph-header {
	height: 0;
	padding: 0;
}

html .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header > .toggle-fullscreen:hover,
html .paragraph.locked[transient-fullscreen="true"] .paragraph-header > .toggle-fullscreen:hover {
	opacity: 1.0;
}

/* Position toggle fullscreen button in locked fullscreen view */
html .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header > .toggle-fullscreen,
html .paragraph.locked[transient-fullscreen="true"] .paragraph-header > .toggle-fullscreen {
	position: absolute;
	top: 15px;
	right: 34px;
	opacity: 0;
	transition: opacity 250ms ease-in-out;
}

html .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header > .lock-content:hover,
html .paragraph.locked[transient-fullscreen="true"] .paragraph-header > .lock-content:hover {
	opacity: 1.0;
}

/* Position toggle fullscreen button in locked fullscreen view */
html .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header > .lock-content,
html .paragraph.locked[transient-fullscreen="true"] .paragraph-header > .lock-content {
	position: absolute;
	top: 15px;
	right: 0;
	opacity: 0;
	transition: opacity 250ms ease-in-out;
}

/* !!! Bug: make actions interactive */
html .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .action,
html .paragraph.locked[transient-fullscreen="true"] .paragraph-header .action {
	pointer-events: initial;
}

/* Hide paragraph icon */
html .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header:before,
html .paragraph.locked[transient-fullscreen="true"] .paragraph-header:before {
	display: none;
}

html .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .delete-paragraph,
html .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .drag-handle,
html .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .collapse-expand,
html .paragraph[transient-fullscreen="true"] .paragraph-header .delete-paragraph,
html .paragraph[transient-fullscreen="true"] .paragraph-header .drag-handle,
html .paragraph[transient-fullscreen="true"] .paragraph-header .collapse-expand {
	display: none;
}

/* Hide all paragraph actions excluding lock and toggle fullscreen */
html .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header > *:not(.lock-content):not(.toggle-fullscreen),
html .paragraph.locked[transient-fullscreen="true"] .paragraph-header > *:not(.lock-content):not(.toggle-fullscreen) {
	display: none;
}

html .paragraph.fullscreen:not([transient-fullscreen="false"]) .CodeMirror,
html .paragraph[transient-fullscreen="true"] .CodeMirror {
	width: 100vw;
	height: 100vh;
	overflow: hidden !important;
	overflow-y: auto;
}


html .paragraph.fullscreen:not([transient-fullscreen="false"]):not(.locked) .CodeMirror,
html .paragraph[transient-fullscreen="true"]:not(.locked) .CodeMirror {
	height: calc(100vh - 30px);
	overflow: auto;
}

/* This is a HACK as text paragraph cannot be scrolled in fullscreen otherwise */
html .paragraph.body-paragraph.fullscreen:not([transient-fullscreen="false"]) [data-type="content"],
html .paragraph.body-paragraph[transient-fullscreen="true"] [data-type="content"] {
	margin: 0;
	padding: 0;
	width: 100vw;
	height: 100vh;
	overflow: auto;
}

/* Move CodeMirror down to make space for fixed paragraph utils */
html .paragraph.fullscreen:not([transient-fullscreen="false"]):not(.locked) .CodeMirror,
html .paragraph[transient-fullscreen="true"]:not(.locked) .CodeMirror,
html .paragraph.fullscreen:not([transient-fullscreen="false"]):not(.locked) [data-type="content"],
html .paragraph[transient-fullscreen="true"]:not(.locked) [data-type="content"] {
	margin-top: 30px;
}

/******************************************************************************/

/* Icon Fullscreen */
html .paragraph .paragraph-header .toggle-fullscreen i:after {
	content: "fullscreen";
}

/* Tooltip Fullscreen */
html .paragraph .paragraph-header .toggle-fullscreen:after {
	content: "Fullscreen";
}

/* Icon Exit Fullscreen */
html .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .toggle-fullscreen i:after,
html .paragraph[transient-fullscreen="true"] .paragraph-header .toggle-fullscreen i:after {
	content: "fullscreen_exit";
}

/* Tooltip Exit Fullscreen */
html .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .toggle-fullscreen:after,
html .paragraph[transient-fullscreen="true"] .paragraph-header .toggle-fullscreen:after {
	content: "Exit Fullscreen";
}</style></div></div><div class="section section-hidden" data-type="system" data-group="editing" data-id="q3HngXx6" name="Code Execution UI" __wid="RQWD6GB8"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="qx646KUk" draggable="false" __wid="gmuT2zyb"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="fR5npvns"><h2 __wid="2hLbBN9D">Description</h2><div __wid="mEuBhQAz">TODO</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="RBUbyafL" __wid="Z2AJcnxB"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="R9Z3HBAZ">{
	"version": "1.0",
	"description": "Provides actions on code paragraphs to run code or 'run-on-load'.",
	"changelog":
	{
		"1.0": "Initital Release"
	}
}</pre></div>

<div class="paragraph code-paragraph collapsed" name="Paragraph Code Execution Actions" data-id="4JG7preM" style draggable="false" run-on-load="true" last-execution-state="success" __wid="fqrM4WbP"><pre data-type="content" type="text/javascript" __wid="kffnRFWa">const ParagraphUtils = require("#paragraph-utils");

/******************************************************************************/

const runOnLoadAttributeName = "run-on-load";

const addExecuteAction = (paragraph) => {
	ParagraphUtils.addHeaderAction(paragraph, "execute-paragraph", () => {
		Codestrate.runCode(paragraph);
		toast(`Executing code of paragraph "${paragraph.getAttribute("name") || "No Name"}"`);
	}, {
		tooltip: true
	});
};

const addExecuteOnLoadAction = (paragraph) => {
	ParagraphUtils.addHeaderAction(paragraph, "run-on-load-paragraph", () => {

		if (paragraph.hasAttribute(runOnLoadAttributeName)) {
			paragraph.removeAttribute(runOnLoadAttributeName);
		} else {
			paragraph.setAttribute(runOnLoadAttributeName, "true");
		}
	}, {
		tooltip: true
	});
};

const addToggleConsoleAction = (paragraph) => {
	ParagraphUtils.addHeaderAction(paragraph, "toggle-console-paragraph", () => {
		if (paragraph.console) {
			const console = paragraph.console;
			console.toggle();
		}
	}, {
		tooltip: true
	});
};

/******************************************************************************/

document.liveQuerySelectorAll(".code-paragraph").added(paragraph => {

	// Only apply action to code paragraphs
	if (!paragraph.querySelector("pre[data-type='content']")) return;

	const header = ParagraphUtils.getHeaderElement(paragraph);
	const content = ParagraphUtils.getContentElement(paragraph);
// 	ParagraphUtils.addSelectElement(header, "type", content, []);

	addExecuteOnLoadAction(paragraph);
	addToggleConsoleAction(paragraph);
	addExecuteAction(paragraph);
});</pre></div>
<div class="paragraph code-paragraph collapsed" name="Code Failure Handling" run-on-load="true" last-execution-state="success" style draggable="false" data-id="yd2ZzdY9" __wid="UzVZPC4u"><pre data-type="content" type="text/javascript" __wid="Bce85Ghf">Codestrate.addEventListener("successruncode", event => {
	// window.console.log(event);

	const { paragraph } = event;

	paragraph.setAttribute("last-execution-state", "success");
});

Codestrate.addEventListener("errorruncode", event => {
	// window.console.log(event);

	const { paragraph } = event;

	paragraph.setAttribute("last-execution-state", "error");
});</pre></div><div class="paragraph style-paragraph collapsed" data-id="HHcUjYwH" name="Paragraph Code Execution" __wid="Vbda6k5p" draggable="false"><style data-type="content" type="text/css" codemirror="true" __wid="MZLvBLfg" class="themable">html .paragraph .execute-paragraph,
html .paragraph .run-on-load-paragraph,
html .paragraph .toggle-console-paragraph {
	margin-left: 5px;
}

html .paragraph .run-on-load-paragraph {
	margin-right: 10px;
}

html .paragraph[run-on-load] .run-on-load-paragraph.action {
	opacity: 1.0;
	pointer-events: all;
}

/* Icon Execute Code */
html .paragraph .execute-paragraph i:after {
	content: "play_circle_outline";
}

/* Tooltip Execute Code */
html .paragraph .execute-paragraph:after {
	content: "Execute Code";
}

/* Icon Execute Code on Load */
html .paragraph .run-on-load-paragraph i:after {
	content: "directions_run";
}

/* Tooltip Enable Execute Code on Load */
html .paragraph .run-on-load-paragraph:after {
	content: "Enable Execute Code on Load";
}

/* Icon Console */
html .paragraph .toggle-console-paragraph i:after {
	content: "message";
}

/* Tooltip Console */
html .paragraph .toggle-console-paragraph:after {
	content: "Toggle Console";
}

html .paragraph[run-on-load] .run-on-load-paragraph i:after {
	color: var(--material-color-light-green);
}

/* Tooltip Disable Execute Code on Load */
html .paragraph[run-on-load] .run-on-load-paragraph:after {
	content: "Disable Execute Code on Load";
}

html .paragraph[last-execution-state="error"] .toggle-console-paragraph {
	opacity: 1.0;
}

html .paragraph[last-execution-state="error"] .toggle-console-paragraph i:after {
	color: var(--material-color-red);
}

html .paragraph .paragraph-header .type-input {
	opacity: 0;
}

html .paragraph .paragraph-header:hover .type-input {
	opacity: 1;
}

html .paragraph .paragraph-header .type-input:before {
	content: "type: ";
}</style></div></div><div class="section section-hidden" name="CodeMirror" data-type="system" data-group="editing" data-id="w3Chj5iH" __wid="THPmmyfa"><div class="paragraph body-paragraph locked collapsed" draggable="false" name="Documentation" data-id="WFLXUc55" __wid="wqa6T6dc"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation hide-variable-names" __wid="nttFHqij"><h2 __wid="UcTPEJGY">Description</h2><div __wid="dPnkGDvd">CodeMirror integration, touching the code below should be done with <i __wid="uWM25ZEc">serious </i>care.</div><div __wid="SVkis8nM"><br __wid="MV9ACdSs"/></div><div __wid="XT2mSdMW">Using CodeMirror version <div class="variable" contenteditable="false" data-name="version" __wid="hPdi3Jeb"></div><span style="font-size: 11pt;" __wid="24neTQFJ">.</span></div><h2 __wid="Hq4wY2rH">Modes</h2><div __wid="NSHsrgHV"><span style="font-size: 11pt;" __wid="FjhYteCW"><div class="variable" contenteditable="false" data-name="modes" __wid="tunuakVj"></div></span></div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="Ldb88iyx" __wid="wXv8yQXi"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="x4epRnr9">{
  "version": "1.0.5",
  "description": "CodeMirror integration into Codestrates.",
  "changelog": {
    "1.0": "Initital Release",
    "1.0.1": "Added description.",
    "1.0.2": "Added JSON beautify.",
    "1.0.3": "Changed indentWithTab to false",
    "1.0.4": "Updated monokai theme to also color string literals correctly.",
    "1.0.5": "Added comment shortcut for Windows."
  }
}</pre></div>

<div class="paragraph code-paragraph collapsed" draggable="false" name="Base Editor" data-id="CvXXTasc" __wid="39fkhKpM"><pre data-type="content" type="text/javascript" id="base-editor" class="editors" __wid="g5M25hgH">const ClientManager = require("#client-manager");

/******************************************************************************/

/**
 * Base class for editors.
 */
class Editor {

	constructor(target, editorOptions) {
		this.target = target;

		const contenteditable = target.getAttribute("contenteditable");
		let readOnly = contenteditable && contenteditable === "false" ? true : false;

		// Allow custom editor options.
		this.editorOptions = Object.assign({
			autoCloseBrackets: true,
			autoCloseTags: true,
			matchBrackets: true,
			matchTags: true,
			styleActiveLine: true,
			/*highlightSelectionMatches: {
				showToken: /\w/
			},*/
			theme: "monokai",
			indentUnit: 2,
			tabSize: 2,
			indentWithTabs: false,
			lineWrapping: true,
			lineNumbers: true,
			extraKeys: {},
			readOnly: readOnly,
			foldGutter: true,
			gutters: ["CodeMirror-lint-markers", "CodeMirror-linenumbers", "CodeMirror-foldgutter"],
			lint: {
				esversion: 6
			},
			rulers: [{column: 80}, {column: 100}]
		}, editorOptions);

		target.liveAttribute("contenteditable").changed(value => {
			let readOnly = value && value === "false" ? true : false;
			//         window.console.log(value, this.editor);
			this.readOnly = readOnly;
		});

		target.liveAttribute("type").changed(mode => {
			// Live attribute is also triggered for inital value when editor has not been instantiated
			if (mode && this.editor) {
				this.editor.setOption("mode", mode);
			}
		});

		// Wait to set mode on codestrateloaded because additional CodeMirror modes
		// can be loaded after CodeMirror integration
		const updateModeOnLoaded = () => {
			let mode = target.getAttribute("type");
			this.editor.setOption("mode", mode);
			window.removeEventListener("codestrateloaded", updateModeOnLoaded);
		};
		window.addEventListener("codestrateloaded", updateModeOnLoaded);

		// This is a hack because the this.editor is available after subclass initialized the CodeMirror editor
		setTimeout(() => {
			let keyMap = this.buildKeyMap();

			// Normalize key map
			let normalizedKeyMap = CodeMirror.normalizeKeyMap(keyMap);

			// A convenient shortcut to format content
			this.editor.addKeyMap(normalizedKeyMap);
		}, 0);

		// Add cursor activity only if target is not in a transient subtree
		if (!target.closest("transient")) {

			// This is a hack because the this.editor is available after subclass initialized the CodeMirror editor
			setTimeout(() => {
				// Shared cursors / markers
				this.editor.on("cursorActivity", () => {
					var range = this.editor.doc.sel.ranges[0];
					target.webstrate.signal(range);
				});

					//	This results in CodeMirror getting focus after blur
// 				// remove selection on blur, CodeMirror otherwise keeps selection active
// 				this.editor.on("blur", () => {
// 					this.editor.setSelection({ line: 0, ch: 0 }, { line: 0, ch: 0});
// 				});

				const markers = {};
				target.webstrate.on("signal", (sel, clientId) => {
					if (clientId === webstrate.clientId) return;

					if (markers[clientId]) markers[clientId].clear();

					const color = ClientManager.getClientColor(clientId);
					const backgroundColor = ClientManager.getClientColorInRGBA(clientId, 0.3);

					if (sel.anchor.line > sel.head.line ||
							(sel.anchor.line == sel.head.line && sel.anchor.ch > sel.head.ch)) { // Backwards selection
						let temp = sel.anchor;
						sel.anchor = sel.head;
						sel.head = temp;
					}

					if (sel.anchor.line == sel.head.line && sel.anchor.ch == sel.head.ch) {
						var widget = document.createElement("span");
						widget.classList.add("remoteCursor");
						widget.setAttribute("style", `outline: 1px solid ${color}`);
						markers[clientId] = this.editor.doc.setBookmark(sel.anchor, {
							widget: widget
						});
					} else {
						markers[clientId] = this.editor.doc.markText(sel.anchor, sel.head, {
							className: "remoteSelection",
							css: `background-color: ${backgroundColor};`
						});
					}
				});

				webstrate.on("clientPart", (clientId) => {
					if (!markers[clientId]) return;
					markers[clientId].clear();
					delete markers[clientId];
				});
			}, 0);
		}
	}

	/**
	 * Returns formatted content.
	 *
	 * @param {string} content Content to format.
	 *
	 * @return {string} Formatted content.
	*/
	formatContent(content) {
		return content;
	}

	buildKeyMap() {

		let keyMap = {
			// Code formatting within paragraph that has focus
			"Shift-Alt-F": (cm) => {
				let content = cm.getValue();
				content = this.formatContent(content);
				cm.setValue(content);
				return true;
			}
		};

		if (Codestrate.OS.isMac()) {
			keyMap = Object.assign({}, keyMap, {
				// Avoid browser save website dialog
				"Cmd-S": (cm) => {
					return true;
				}
			});
		} else {
			keyMap = Object.assign({}, keyMap, {
				// Avoid browser save website dialog
				"Ctrl-S": (cm) => {
					return true;
				}
			});
		}

		return keyMap;
	}

	set readOnly(readOnly) {
		if (this.editor) {
			this.editor.setOption("readOnly", readOnly);
		}
	}

	get readOnly() {
		if (this.editor) {
			return this.editor.getOption("readOnly");
		}
		throw new Error("editor not initialized");
	}
}

exports.Editor = Editor;</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Code Editor" data-id="Gy9JEzBe" __wid="tkEXFiRs"><pre data-type="content" type="text/javascript" id="code-editor" class="editors" __wid="kHEmnkDd">const {
  Editor
} = require("#base-editor");

/**
 * Code editor
 */
class CodeEditor extends Editor {

  constructor(target, parent, editorOptions) {

    super(target, editorOptions);

    // window.console.log("default editor");

    this.suppress = false;
    this.timer = null;

    if (parent === undefined) parent = target;

    this.textNode = target.firstChild;

		// the descriptor is necessary to override the textContent property on the text node and to make
		// the editor update when textContent is set through JavaScript
		const textContentDescriptor = Object.getOwnPropertyDescriptor(Node.prototype, "textContent");

    // window.console.log(this.textNode, target);

    if (!this.textNode || this.textNode.nodeType !== 3) {
      console.error("First child node of target is not a text node", target);
      throw Error("First child node of target is not a text node");
    }
    const transient = document.createElement("transient");
    transient.setAttribute("class", "default-editor");

    const textArea = document.createElement("textarea");
    transient.appendChild(textArea);

    // Insert code editor before console
    if (parent.console && parent.console.container) {
      const consoleContainer = parent.console.container;
      parent.insertBefore(transient, consoleContainer);
    } else {
      parent.appendChild(transient);
    }

    this.editor = CodeMirror.fromTextArea(textArea, this.editorOptions);

    this.editor.setValue(this.textNode.textContent);
    setTimeout(() => {
      this.editor.refresh();
    }, 0);

    // Add text events only if target (and text node) is not in a transient subtree
    if (!target.closest("transient")) {

      const insertTextCallback = (pos, val) => {
        this.editor.off("change", editorChangeCallback);
        this.editor.replaceRange(val, this.editor.posFromIndex(pos));
        this.editor.on("change", editorChangeCallback);
      };

      const deleteTextCallback = (pos, val) => {
        var from = this.editor.posFromIndex(pos);
        var to = this.editor.posFromIndex(pos + val.length);
        this.editor.off("change", editorChangeCallback);
        this.editor.replaceRange("", from, to);
        this.editor.on("change", editorChangeCallback);
      };

      this.textNode.webstrate.on("insertText", insertTextCallback);
      this.textNode.webstrate.on("deleteText", deleteTextCallback);

			// overriding the textContent property of the textNode to update the editor whenever content
			// on the text node is set locally through JavaScript
      Object.defineProperty(this.textNode, "textContent", {
        set: (value) => {
// 					window.console.log('textContent is called');
          this.editor.off("change", editorChangeCallback);
          let returnValue = textContentDescriptor.set.call(this.textNode, value);
					this.editor.setValue(this.textNode.textContent);
					setTimeout(() => {
// 						window.console.log('update editor is called');
						this.editor.refresh();
					}, 0);
          this.editor.on("change", editorChangeCallback);
					return returnValue;
        },
				get: () => {
					return textContentDescriptor.get.call(this.textNode);
				}
      });
    }

    const editorChangeCallback = () => {
      var newVal = this.editor.getValue();
      newVal = newVal.length === 0 ? " " : newVal;
			textContentDescriptor.set.call(this.textNode, newVal);
    };

    this.editor.on("change", editorChangeCallback);

    // Update the editor on paste. This fixes a bug that occurs sometimes
    // when pasting large portions of code into the editor.
    this.editor.on("paste", () => {
      setTimeout(() => {
        this.editor.refresh();
      }, 0);
    });
  }

  /**
   * Returns formatted content.
   *
   * @param {string} content Content to format.
   *
   * @return {string} Formatted content.
   */
  formatContent(content) {
    const type = this.editorOptions.mode;

    const beautifyOptions = {
      indent_size: 2,
      indent_char: " ",
      indent_with_tabs: false,
      eol: "\n",
      end_with_newline: false,
      indent_level: 0,
      preserve_newlines: true,
      max_preserve_newlines: 5,
      space_in_paren: false,
      space_in_empty_paren: false,
      jslint_happy: true,
      space_after_anon_function: false,
      brace_style: "collapse",
      break_chained_methods: false,
      keep_array_indentation: false,
      unescape_strings: false,
      wrap_line_length: 0,
      e4x: false,
      comma_first: false,
      operator_position: "before-newline"
    };

    switch (type) {
    case "text/javascript":
      return js_beautify(content, beautifyOptions);
    case "text/css":
      return css_beautify(content, beautifyOptions);
    case "application/json":
      return JSON.stringify(JSON.parse(content), null, 2);
    default:
      console.log(`no beautifier for ${type} installed`);
      break;
    }
    return content;
  }
}
exports.CodeEditor = CodeEditor;</pre></div><div class="paragraph code-paragraph collapsed" name="HTML Editor" draggable="false" data-id="5HXrC3wK" __wid="SGcNje58"><pre data-type="content" type="text/javascript" id="html-editor" class="editors" __wid="vgPQDCev">const {
	Editor
} = require("#base-editor");

/**
 * HTML editor synchronizing content between contenteditable element and
 * a CodeMirror instance.
 */
class HTMLEditor extends Editor {

	constructor(target, editorOptions) {

		super(target, Object.assign({
			mode: "htmlmixed",
			rulers: false
		}, editorOptions));

		// window.console.log("html editor");

		const parent = target.parentElement;

		const transient = document.createElement("transient");
		transient.setAttribute("class", "html-editor hidden");

		const textArea = document.createElement("textarea");
		transient.appendChild(textArea);

		// Insert code editor before console
		if (parent.console && parent.console.container) {
			const consoleContainer = parent.console.container;
			parent.insertBefore(transient, consoleContainer);
		} else {
			parent.appendChild(transient);
		}

		this.editor = CodeMirror.fromTextArea(textArea, this.editorOptions);

		this.updateEditor = () => {
			let html = target.innerHTML;
			this.editor.setValue(html);
			setTimeout(() => {
				this.editor.refresh();
			}, 0);
		};

		let observer;
		this.enableMutationObserver = () => {

			// Only allow one observer
			if (observer) return;

			// Listen to any updates that happen inside of the target element and update
			// the CodeMirror instance accordingly. For now, any update will override
			// contents of the CodeMirror and transient changes get lost.
			observer = new MutationObserver(mutations => {
				this.updateEditor();
			});
			observer.observe(target, {
				childList: true,
				characterData: true,
				subtree: true,
				attributes: true
			});
		};

		this.disableMutationObserver = () => {
			if (observer) {
				observer.disconnect();
				observer = null;
			}
		};

		// Update the editor on paste. This fixes a bug that occurs sometimes
		// when pasting large portions of code into the editor.
		this.editor.on("paste", () => {
			setTimeout(() => {
				this.editor.refresh();
			}, 0);
		});
	}

	/**
   * Returns formatted content.
   *
   * @param {string} content Content to format.
   *
   * @return {string} Formatted content.
   */
	formatContent(content) {
		return html_beautify(content, {
			indent_size: 2,
			indent_char: " ",
			indent_with_tabs: false,
			eol: "\n",
			end_with_newline: false,
			indent_level: 0,
			preserve_newlines: true,
			max_preserve_newlines: 5,
			space_in_paren: false,
			space_in_empty_paren: false,
			jslint_happy: false,
			space_after_anon_function: false,
			brace_style: "collapse",
			break_chained_methods: false,
			keep_array_indentation: false,
			unescape_strings: false,
			wrap_line_length: 0,
			e4x: false,
			comma_first: false,
			operator_position: "before-newline"
		});
	}

	buildKeyMap() {
		let keyMap = super.buildKeyMap();

		if (Codestrate.OS.isMac()) {
			keyMap = Object.assign({}, keyMap, {
				// A convenient save option to save html instead of showing the open file dialog.
				"Cmd-S": (cm) => {
					this.saveHtml();
				}
			});
		} else {
			keyMap = Object.assign({}, keyMap, {
				// A convenient save option to save html instead of showing the open file dialog.
				"Ctrl-S": (cm) => {
					this.saveHtml();
				}
			});
		}

		return keyMap;
	}

	// Save html and persist it with Webstrates
	saveHtml() {
		const cursor = this.editor.getCursor();

		let html = this.editor.getValue();
		this.target.innerHTML = html;

		setTimeout(() => {
			this.editor.setCursor(cursor);
		}, 0);
	}
}

exports.HTMLEditor = HTMLEditor;</pre></div><div class="paragraph code-paragraph collapsed" name="CodeMirror Integration Code" data-id="yvE9WeT6" draggable="false" run-on-load="true" last-execution-state="success" style __wid="CQCRvYUb"><pre data-type="content" type="text/javascript" __wid="tdXJ2yQv">// Import CodeMirror basics style
importStyle([
	"codemirror.css",

	"codemirror-addon-simplescrollbars.css",
	"codemirror-addon-dialog.css", // Remove when using custom dialog implementation
	"codemirror-addon-show-hint.css",
	"codemirror-addon-foldgutter.css",
	"codemirror-addon-matchesonscrollbar.css",
	"codemirror-addon-lint.css",
	"codemirror-addon-merge.css"
]);

importLib([
	"codemirror.js",

	//"codemirror-addon-dialog.js", // use custom dialog implementation

	"codemirror-addon-annotatescrollbar.js",
	"codemirror-addon-simplescrollbars.js",
	"codemirror-addon-scrollpastend.js",

	"codemirror-addon-show-hint.js",
	"codemirror-addon-javascript-hint.js",
	"codemirror-addon-xml-hint.js",
	"codemirror-addon-html-hint.js",
	"codemirror-addon-css-hint.js",
	"codemirror-addon-anyword-hint.js",

	"codemirror-addon-comment.js",
	"codemirror-addon-continuecomment.js",

	"codemirror-addon-foldcode.js",
	"codemirror-addon-foldgutter.js",
	"codemirror-addon-brace-fold.js",
	"codemirror-addon-xml-fold.js",
	"codemirror-addon-markdown-fold.js",
	"codemirror-addon-comment-fold.js",
	"codemirror-addon-indent-fold.js",
	"codemirror-addon-rulers.js",
	"codemirror-addon-merge.js",

	"codemirror-addon-matchbrackets.js",
	"codemirror-addon-matchtags.js",
	"codemirror-addon-closebrackets.js",
	"codemirror-addon-closetag.js",

	"codemirror-addon-searchcursor.js",
	"codemirror-addon-match-highlighter.js",
	"codemirror-addon-matchesonscrollbar.js",
	"codemirror-addon-jump-to-line.js",
	"codemirror-addon-search.js",
	"codemirror-addon-active-line.js",

	"codemirror-linter-jshint.js",
	"codemirror-linter-htmlhint.js",
	"codemirror-linter-csslint.js",
	"codemirror-linter-jsonlint.js",

	//"codemirror-addon-lint.js", // Use transient version instead
	"codemirror-addon-javascript-lint.js",
	"codemirror-addon-html-lint.js",
	"codemirror-addon-css-lint.js",
	"codemirror-addon-json-lint.js",

	"codemirror-mode-xml.js",
	"codemirror-mode-htmlmixed.js",
	"codemirror-mode-javascript.js",
	"codemirror-mode-css.js",
	"codemirror-mode-go.js",
	"codemirror-mode-markdown.js",
	"codemirror-mode-gfm.js",

	"beautify.js",
	"beautify-css.js",
	"beautify-html.js"
]).then(() => {

	// Customized linter that uses transient overlays when hovering over a linter error or linter info
	require("#codemirror-addon-lint-transient");

	// Print CodeMirror version.
	Variable("version").set(`&lt;transient>${CodeMirror.version}&lt;/transient>`);

	// Print installed CodeMirror modes.
	let modes = Object.keys(CodeMirror.modes).filter((m) => m !== "null");
	modes = modes.map(m => { return `&lt;li>${m}&lt;/li>`; }).join("\r\n");
	Variable("modes").set(`&lt;transient>&lt;ul>${modes}&lt;/ul>&lt;/transient>`);

	const { CodeEditor } = require("#code-editor");
	const { HTMLEditor } = require("#html-editor");

	const extraKeys = {
		"Ctrl-Space": "autocomplete",
		"Cmd-/": "toggleComment",
		"Ctrl-/": "toggleComment"
	};

	//////////
	// magic
	//////////

	const sectionSelector = ".section";
	const sectionHiddenClass = "section-hidden";

	const codeSelectors = [
		"pre[type]",
		"*[codemirror='true']"
	];

	const createEditor = function (element) {

		// debugger;

		// window.console.log("create editor for element %o", element);

		if (!element.__editor) {
			const codeType = element.getAttribute("type");

			let editor;
			if ((!codeType || codeType === "text/html") && element.hasAttribute("contenteditable")) {
				editor = new HTMLEditor(element, { extraKeys });
			} else {
				editor = new CodeEditor(element, element.parentElement, {
					mode: codeType,
					extraKeys
				});
			}

			element.__editor = editor;
		}
	};

	const hasCodeType = (node) => {
		return node.matches(codeSelectors.join(","));
	};

	const isSectionVisible = (node) => {
		// Only create editor if section is visible
		const section = node.closest(sectionSelector);
		// console.log("isSectionVisible", section, section.classList.contains(sectionHiddenClass));
		return section && !section.classList.contains(sectionHiddenClass);
	};

	const isCodeEditor = (node) => {
		return hasCodeType(node) && node.__editor;
	};

	const destroyEditor = (node) => {
		node.__editor.editor.toTextArea();
	};

	const magic = (node) => {
		// Continue if section is not visible
		if (!isSectionVisible(node)) return;

		if (!isCodeEditor(node) && hasCodeType(node)) {
			createEditor(node);
		} else {
			const subNodes = node.querySelectorAll(codeSelectors.join(","));
			Array.prototype.forEach.call(subNodes, (subNode) => {

				// Continue if section is not visible
				if (!isSectionVisible(subNode)) return;

				// Ignore sub nodes if any of the ancestor nodes have a class template
				if (subNode.closest(".template")) return;

				if (!isCodeEditor(subNode) && hasCodeType(subNode)) {
					createEditor(subNode);
				}
			});
		}
	};

	document.liveQuerySelectorAll(codeSelectors.join(",")).added(code => {
		// console.log("code", code);
		magic(code);
	});

	document.liveQuerySelectorAll(sectionSelector).added(section => {
		// console.log("section", section);

		section.liveAttribute("class").changed(() => {
			// console.log("section hidden? ", section.classList.contains(sectionHiddenClass));

			if (!section.classList.contains(sectionHiddenClass)) {
				magic(section);
			}
		});
	});
});</pre></div><div class="paragraph code-paragraph locked collapsed" draggable="false" name="CodeMirror OpenDialog" run-on-load="true" last-execution-state="success" data-id="Ki28VD7x" __wid="K6ccYqft"><pre data-type="content" type="text/javascript" contenteditable="false" __wid="7ArS6gNw">// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// Open simple dialogs on top of an editor. Relies on dialog.css.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  function dialogDiv(cm, template, bottom) {
    var wrap = cm.getWrapperElement();
    var dialog;
    dialog = wrap.appendChild(document.createElement("div"));
    if (bottom)
      dialog.className = "CodeMirror-dialog CodeMirror-dialog-bottom";
    else
      dialog.className = "CodeMirror-dialog CodeMirror-dialog-top";

    if (typeof template == "string") {
      dialog.innerHTML = template;
    } else { // Assuming it's a detached DOM element.
      dialog.appendChild(template);
    }
    return dialog;
  }

  function closeNotification(cm, newVal) {
    if (cm.state.currentNotificationClose)
      cm.state.currentNotificationClose();
    cm.state.currentNotificationClose = newVal;
  }

  CodeMirror.defineExtension("openDialog", function(template, callback, options) {
    if (!options) options = {};

    closeNotification(this, null);

    var dialog = dialogDiv(this, template, options.bottom);
    var closed = false, me = this;
    function close(newVal) {
      if (typeof newVal == 'string') {
        inp.value = newVal;
      } else {
        if (closed) return;
        closed = true;
        dialog.parentNode.removeChild(dialog);
        me.focus();

        if (options.onClose) options.onClose(dialog);
      }
    }

    var inp = dialog.getElementsByTagName("input")[0], button;
    if (inp) {
      inp.focus();

      if (options.value) {
        inp.value = options.value;
        if (options.selectValueOnOpen !== false) {
          inp.select();
        }
      }

      if (options.onInput)
        CodeMirror.on(inp, "input", function(e) { options.onInput(e, inp.value, close);});
      if (options.onKeyUp)
        CodeMirror.on(inp, "keyup", function(e) {options.onKeyUp(e, inp.value, close);});

      CodeMirror.on(inp, "keydown", function(e) {
        if (options && options.onKeyDown && options.onKeyDown(e, inp.value, close)) { return; }
        if (e.keyCode == 27 || (options.closeOnEnter !== false && e.keyCode == 13)) {
          inp.blur();
          CodeMirror.e_stop(e);
          close();
        }
        if (e.keyCode == 13) callback(inp.value, e);
      });

      if (options.closeOnBlur !== false) CodeMirror.on(inp, "blur", close);
    } else if (button = dialog.getElementsByTagName("button")[0]) {
      CodeMirror.on(button, "click", function() {
        close();
        me.focus();
      });

      if (options.closeOnBlur !== false) CodeMirror.on(button, "blur", close);

      button.focus();
    }
    return close;
  });

  CodeMirror.defineExtension("openConfirm", function(template, callbacks, options) {
    closeNotification(this, null);
    var dialog = dialogDiv(this, template, options && options.bottom);
    var buttons = dialog.getElementsByTagName("button");
    var closed = false, me = this, blurring = 1;
    function close() {
      if (closed) return;
      closed = true;
      dialog.parentNode.removeChild(dialog);
      me.focus();
    }
    buttons[0].focus();
    for (var i = 0; i &lt; buttons.length; ++i) {
      var b = buttons[i];
      (function(callback) {
        CodeMirror.on(b, "click", function(e) {
          CodeMirror.e_preventDefault(e);
          close();
          if (callback) callback(me);
        });
      })(callbacks[i]);
      CodeMirror.on(b, "blur", function() {
        --blurring;
        setTimeout(function() { if (blurring &lt;= 0) close(); }, 200);
      });
      CodeMirror.on(b, "focus", function() { ++blurring; });
    }
  });

  /*
   * openNotification
   * Opens a notification, that can be closed with an optional timer
   * (default 5000ms timer) and always closes on click.
   *
   * If a notification is opened while another is opened, it will close the
   * currently opened one and open the new one immediately.
   */
  CodeMirror.defineExtension("openNotification", function(template, options) {
    closeNotification(this, close);
    var dialog = dialogDiv(this, template, options && options.bottom);
    var closed = false, doneTimer;
    var duration = options && typeof options.duration !== "undefined" ? options.duration : 5000;

    function close() {
      if (closed) return;
      closed = true;
      clearTimeout(doneTimer);
      dialog.parentNode.removeChild(dialog);
    }

    CodeMirror.on(dialog, 'click', function(e) {
      CodeMirror.e_preventDefault(e);
      close();
    });

    if (duration)
      doneTimer = setTimeout(close, duration);

    return close;
  });
});</pre></div><div class="paragraph code-paragraph collapsed" name="Editor Utils" data-id="Sc5xz6BJ" __wid="t6HveGdy"><pre data-type="content" type="text/javascript" id="editor-utils" __wid="pBjqLw6f">exports.editorDragDrop = (bool) => {
	const contents = document.querySelectorAll("[data-type='content']");
	Array.prototype.forEach.call(contents, (content) => {
		if (content.__editor) {
			content.__editor.editor.setOption("dragDrop", bool);
		}
	});
};</pre></div><div class="paragraph code-paragraph locked collapsed" name="Codemirror Addon Lint Transient" data-id="tLZkwit3" __wid="NkySYWps"><pre data-type="content" type="text/javascript" id="codemirror-addon-lint-transient" contenteditable="false" __wid="6auWYK4w">// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";
  var GUTTER_ID = "CodeMirror-lint-markers";

  function showTooltip(e, content) {
    var tt = document.createElement("div");
    tt.className = "CodeMirror-lint-tooltip";
    tt.appendChild(content.cloneNode(true));
    //document.body.appendChild(tt);
		var transient = document.createElement("transient");
		transient.appendChild(tt);
		document.body.appendChild(transient);

    function position(e) {
      if (!tt.parentNode) return CodeMirror.off(document, "mousemove", position);
      tt.style.top = Math.max(0, e.clientY - tt.offsetHeight - 5) + "px";
      tt.style.left = (e.clientX + 5) + "px";
    }
    CodeMirror.on(document, "mousemove", position);
    position(e);
    if (tt.style.opacity != null) tt.style.opacity = 1;
    return tt;
  }
  function rm(elt) {
    //if (elt.parentNode) elt.parentNode.removeChild(elt);
		var pelt = elt.parentNode;
		if (pelt) {
			if (pelt.parentNode) pelt.parentNode.removeChild(pelt);
		}
  }
  function hideTooltip(tt) {
    if (!tt.parentNode) return;
    if (tt.style.opacity == null) rm(tt);
    tt.style.opacity = 0;
    setTimeout(function() { rm(tt); }, 600);
  }

  function showTooltipFor(e, content, node) {
    var tooltip = showTooltip(e, content);
    function hide() {
      CodeMirror.off(node, "mouseout", hide);
      if (tooltip) { hideTooltip(tooltip); tooltip = null; }
    }
    var poll = setInterval(function() {
      if (tooltip) for (var n = node;; n = n.parentNode) {
        if (n && n.nodeType == 11) n = n.host;
        if (n == document.body) return;
        if (!n) { hide(); break; }
      }
      if (!tooltip) return clearInterval(poll);
    }, 400);
    CodeMirror.on(node, "mouseout", hide);
  }

  function LintState(cm, options, hasGutter) {
    this.marked = [];
    this.options = options;
    this.timeout = null;
    this.hasGutter = hasGutter;
    this.onMouseOver = function(e) { onMouseOver(cm, e); };
    this.waitingFor = 0
  }

  function parseOptions(_cm, options) {
    if (options instanceof Function) return {getAnnotations: options};
    if (!options || options === true) options = {};
    return options;
  }

  function clearMarks(cm) {
    var state = cm.state.lint;
    if (state.hasGutter) cm.clearGutter(GUTTER_ID);
    for (var i = 0; i &lt; state.marked.length; ++i)
      state.marked[i].clear();
    state.marked.length = 0;
  }

  function makeMarker(labels, severity, multiple, tooltips) {
    var marker = document.createElement("div"), inner = marker;
    marker.className = "CodeMirror-lint-marker-" + severity;
    if (multiple) {
      inner = marker.appendChild(document.createElement("div"));
      inner.className = "CodeMirror-lint-marker-multiple";
    }

    if (tooltips != false) CodeMirror.on(inner, "mouseover", function(e) {
      showTooltipFor(e, labels, inner);
    });

    return marker;
  }

  function getMaxSeverity(a, b) {
    if (a == "error") return a;
    else return b;
  }

  function groupByLine(annotations) {
    var lines = [];
    for (var i = 0; i &lt; annotations.length; ++i) {
      var ann = annotations[i], line = ann.from.line;
      (lines[line] || (lines[line] = [])).push(ann);
    }
    return lines;
  }

  function annotationTooltip(ann) {
    var severity = ann.severity;
    if (!severity) severity = "error";
    var tip = document.createElement("div");
    tip.className = "CodeMirror-lint-message-" + severity;
    if (typeof ann.messageHTML != 'undefined') {
        tip.innerHTML = ann.messageHTML;
    } else {
        tip.appendChild(document.createTextNode(ann.message));
    }
    return tip;
  }

  function lintAsync(cm, getAnnotations, passOptions) {
    var state = cm.state.lint
    var id = ++state.waitingFor
    function abort() {
      id = -1
      cm.off("change", abort)
    }
    cm.on("change", abort)
    getAnnotations(cm.getValue(), function(annotations, arg2) {
      cm.off("change", abort)
      if (state.waitingFor != id) return
      if (arg2 && annotations instanceof CodeMirror) annotations = arg2
      updateLinting(cm, annotations)
    }, passOptions, cm);
  }

  function startLinting(cm) {
    var state = cm.state.lint, options = state.options;
    /*
     * Passing rules in `options` property prevents JSHint (and other linters) from complaining
     * about unrecognized rules like `onUpdateLinting`, `delay`, `lintOnChange`, etc.
     */
    var passOptions = options.options || options;
    var getAnnotations = options.getAnnotations || cm.getHelper(CodeMirror.Pos(0, 0), "lint");
    if (!getAnnotations) return;
    if (options.async || getAnnotations.async) {
      lintAsync(cm, getAnnotations, passOptions)
    } else {
      var annotations = getAnnotations(cm.getValue(), passOptions, cm);
      if (!annotations) return;
      if (annotations.then) annotations.then(function(issues) {
        updateLinting(cm, issues);
      });
      else updateLinting(cm, annotations);
    }
  }

  function updateLinting(cm, annotationsNotSorted) {
    clearMarks(cm);
    var state = cm.state.lint, options = state.options;

    var annotations = groupByLine(annotationsNotSorted);

    for (var line = 0; line &lt; annotations.length; ++line) {
      var anns = annotations[line];
      if (!anns) continue;

      var maxSeverity = null;
      var tipLabel = state.hasGutter && document.createDocumentFragment();

      for (var i = 0; i &lt; anns.length; ++i) {
        var ann = anns[i];
        var severity = ann.severity;
        if (!severity) severity = "error";
        maxSeverity = getMaxSeverity(maxSeverity, severity);

        if (options.formatAnnotation) ann = options.formatAnnotation(ann);
        if (state.hasGutter) tipLabel.appendChild(annotationTooltip(ann));

        if (ann.to) state.marked.push(cm.markText(ann.from, ann.to, {
          className: "CodeMirror-lint-mark-" + severity,
          __annotation: ann
        }));
      }

      if (state.hasGutter)
        cm.setGutterMarker(line, GUTTER_ID, makeMarker(tipLabel, maxSeverity, anns.length > 1,
                                                       state.options.tooltips));
    }
    if (options.onUpdateLinting) options.onUpdateLinting(annotationsNotSorted, annotations, cm);
  }

  function onChange(cm) {
    var state = cm.state.lint;
    if (!state) return;
    clearTimeout(state.timeout);
    state.timeout = setTimeout(function(){startLinting(cm);}, state.options.delay || 500);
  }

  function popupTooltips(annotations, e) {
    var target = e.target || e.srcElement;
    var tooltip = document.createDocumentFragment();
    for (var i = 0; i &lt; annotations.length; i++) {
      var ann = annotations[i];
      tooltip.appendChild(annotationTooltip(ann));
    }
    showTooltipFor(e, tooltip, target);
  }

  function onMouseOver(cm, e) {
    var target = e.target || e.srcElement;
    if (!/\bCodeMirror-lint-mark-/.test(target.className)) return;
    var box = target.getBoundingClientRect(), x = (box.left + box.right) / 2, y = (box.top + box.bottom) / 2;
    var spans = cm.findMarksAt(cm.coordsChar({left: x, top: y}, "client"));

    var annotations = [];
    for (var i = 0; i &lt; spans.length; ++i) {
      var ann = spans[i].__annotation;
      if (ann) annotations.push(ann);
    }
    if (annotations.length) popupTooltips(annotations, e);
  }

  CodeMirror.defineOption("lint", false, function(cm, val, old) {
    if (old && old != CodeMirror.Init) {
      clearMarks(cm);
      if (cm.state.lint.options.lintOnChange !== false)
        cm.off("change", onChange);
      CodeMirror.off(cm.getWrapperElement(), "mouseover", cm.state.lint.onMouseOver);
      clearTimeout(cm.state.lint.timeout);
      delete cm.state.lint;
    }

    if (val) {
      var gutters = cm.getOption("gutters"), hasLintGutter = false;
      for (var i = 0; i &lt; gutters.length; ++i) if (gutters[i] == GUTTER_ID) hasLintGutter = true;
      var state = cm.state.lint = new LintState(cm, parseOptions(cm, val), hasLintGutter);
      if (state.options.lintOnChange !== false)
        cm.on("change", onChange);
      if (state.options.tooltips != false && state.options.tooltips != "gutter")
        CodeMirror.on(cm.getWrapperElement(), "mouseover", state.onMouseOver);

      startLinting(cm);
    }
  });

  CodeMirror.defineExtension("performLint", function() {
    if (this.state.lint) startLinting(this);
  });
});</pre></div>
<div class="paragraph style-paragraph collapsed" name="CodeMirror Integration CSS" draggable="false" data-id="xjJqeVWB" __wid="HxQexXwp"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="QFcHLtb8">html .CodeMirror {
	isolation: isolate;
	height: auto;
	font-family: var(--font-monospace);
	font-size: 0.875rem;
	line-height: 1.25;
	height: auto;
	-webkit-font-smoothing: antialiased;
	clear: both;
}

html .paragraph.body-paragraph > transient.hidden {
	display: none;
}

html .paragraph.body-paragraph transient.html-editor:before {
	content: "HTML of the above body paragraph";
	display: block;
	margin-top: 20px;
	background-color: var(--color-primary-shade-1);
	padding: 4px;
	border-radius: 2px;
	pointer-events: none;
	clear: both;
}

/******************************************************************************/

/* Icon Save HTML */
html .paragraph .paragraph-header .save-html i:after {
	content: "save";
}

/* Tooltip Save HTML */
html .paragraph .paragraph-header .save-html:after {
	content: "Save HTML";
}

html .paragraph .paragraph-header .toggle-html i:after {
	content: "visibility";
}

html .paragraph .paragraph-header .toggle-html:after {
	content: "Toggle HTML Editor";
}</style></div>
<div class="paragraph style-paragraph collapsed" name="CodeMirror Monokai Theme" draggable="false" data-id="63U8sryX" __wid="hi2FvZ2b"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="UbBx3pAK">/* Based on Sublime Text's Monokai theme */

html .cm-s-monokai.CodeMirror {
	background: none;
	color: var(--color-primary-text);
}

html .cm-s-monokai .CodeMirror-dialog {
	background: var(--color-primary-shade-1);
}

html .cm-s-monokai.CodeMirror div {

}

html .cm-s-monokai div.CodeMirror-selected {
	background: rgba(var(--color-accent-rgb), 0.1);
}
html .cm-s-monokai .CodeMirror-line::selection,
html .cm-s-monokai .CodeMirror-line > span::selection,
html .cm-s-monokai .CodeMirror-line > span > span::selection {
	background: rgba(73, 72, 62, .99);

}
html .cm-s-monokai .CodeMirror-line::-moz-selection,
html .cm-s-monokai .CodeMirror-line > span::-moz-selection,
html .cm-s-monokai .CodeMirror-line > span > span::-moz-selection {
	background: rgba(73, 72, 62, .99);

}
html .cm-s-monokai .CodeMirror-gutters {
	background: none;
	border-right: 0px;
}

html .cm-s-monokai .CodeMirror-guttermarker {
	color: var(--color-primary-text);
}

html .cm-s-monokai .CodeMirror-guttermarker-subtle {
	color: #d0d0d0;
}

html .cm-s-monokai .CodeMirror-linenumber {
	color:rgb(135, 135, 129);
}

html .cm-s-monokai .CodeMirror-cursor {
	border-left: 1px solid #f8f8f0;
}

html .cm-s-monokai span.cm-comment {
	color: rgb(135, 135, 129);
}

html .cm-s-monokai span.cm-atom {
	color: #ae81ff;
}

html .cm-s-monokai span.cm-number {
	color: #ae81ff;
}


html .cm-s-monokai span.cm-property,
html .cm-s-monokai span.cm-attribute {
	color: #a6e22e;
}

html .cm-s-monokai span.cm-keyword {
	color: rgb(234, 53, 134);
}

html .cm-s-monokai span.cm-builtin {
	color: #66d9ef;
}

html .cm-s-monokai span.cm-string,
html .cm-s-monokai span.cm-string-2 {
	color: #e6db74;
}


html .cm-s-monokai span.cm-variable {
	color: #f8f8f2;
}

html .cm-s-monokai span.cm-variable-2 {
	color: #9effff;
}

html .cm-s-monokai span.cm-variable-3 {
	color: #66d9ef;
}

html .cm-s-monokai span.cm-def {
	color: #fd971f;
}

html .cm-s-monokai span.cm-bracket {
	color: #f8f8f2;
}

html .cm-s-monokai span.cm-tag {
	color: rgb(234, 53, 134);
}

html .cm-s-monokai span.cm-header {
	color: #ae81ff;
}

html .cm-s-monokai span.cm-link {
	color: #ae81ff;
}

html .cm-s-monokai span.cm-error {
	background: rgb(234, 53, 134);
	color: #f8f8f0;
}

html .cm-s-monokai .CodeMirror-activeline-background {
	background: rgba(var(--color-accent-rgb), 0.05);
}

html .paragraph.locked .cm-s-monokai .CodeMirror-activeline-background {
	display: none;
}

html .cm-s-monokai .CodeMirror-matchingbracket {
	text-decoration: underline;
	color: var(--color-primary-text) !important;
}

html .cm-s-monokai span.cm-matchhighlight {
	background: #353;
}</style></div>
<div class="paragraph style-paragraph collapsed" data-id="Mf3uBNUQ" name="Tabs, Linebreaks and Rulers" __wid="M7YbuFKT"><style data-type="content" type="text/css" codemirror="true" class="themable" contenteditable="true" __wid="QX8stSPD">html .CodeMirror-rulers {
	color: var(--color-primary-text);
	opacity: 0.1;
	z-index: 2;
	max-height: calc(100% - 8px) !important;
	min-height: calc(100% - 8px) !important;
	top: 0;
	margin: 4px 0;
}

html .cm-tab {
	background: linear-gradient(to right, rgba(0, 0, 0, 0) 5%, var(--color-primary-text) 6%, var(--color-primary-text) 95%, rgba(0, 0, 0, 0) 96%);
	height: 0.05em;
	vertical-align: middle;
	opacity: 0.2;
}

/*html .CodeMirror-code > div > pre > span::after, .CodeMirror-line > span::after {
	content: "¬";
	color: var(--color-primary-text);
	opacity: 0.2;
}*/</style></div></div><div class="section section-hidden" name="Assets" data-type="system" data-id="yfRLVs2U" __wid="sE8N3xmU"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="uyJ3rDdC" style __wid="re6kAfGj"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="AJeXMf8r"><h2 __wid="NGKh9DT7">Description</h2><div __wid="hysZFPaW">TODO</div></div></div><div class="paragraph data-paragraph locked collapsed" name="Properties" data-id="xCRkA7iz" __wid="TzR74ybL"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="EaNLCQsf">{
  "version": "1.1.5",
  "description": "Adds utils to upload and drop files as Webstrates assets.",
  "changelog": {
    "1.0": "Initital Release",
    "1.1": "Moved 'add file' action to text tools package.",
    "1.1.1": "Set type if not available in file and added toast.",
    "1.1.2": "Creating elements for uploaded files based on mimeType prefix, and now works with gif and other image, audio, video files.",
    "1.1.3": "Changed getElementFromAsset function.",
    "1.1.4": "Reworked uploadFiles function to show a dialog if asset fileName already exists, and provides a reload dialog if so.",
    "1.1.5": "Using webstrate.config.serverConfig.maxAssetSize to check asset file size before uploading."
  }
}</pre></div><div class="paragraph code-paragraph collapsed" name="Asset Utils" draggable="false" style data-id="ZEUFBDeK" __wid="xqhbAxvU"><pre data-type="content" type="text/javascript" id="asset-utils" __wid="pVE3kBYH">const AssetMimeType = require('#asset-mime-type');

/******************************************************************************/

// 1024 bytes * 1024 kB * 100 => 100 MB
const BYTE_TO_MEGABYTE_FACTOR = 1024 * 1024;
const MAX_FILE_SIZE = webstrate.config.serverConfig.maxAssetSize;
const MAX_PREVIEW_FILE_SIZE = 5;

const MAX_FILE_SIZE_BYTE = MAX_FILE_SIZE * BYTE_TO_MEGABYTE_FACTOR;
const MAX_PREVIEW_FILE_SIZE_BYTE = MAX_PREVIEW_FILE_SIZE * BYTE_TO_MEGABYTE_FACTOR;

const acceptFileOrThrowError = (file) => {
  if (file.size > MAX_FILE_SIZE_BYTE) {
    throw new Error(`File size of ${file.name} is too large. Maximum file size is ${MAX_FILE_SIZE}MB.`);
  }
  return true;
};

// exports.uploadAsset = async(files, options = {}) => {

//   // return if no file to upload
//   if (files.length === 0) {
//     return;
//   }

//   const formData = new FormData();

//   // append options to form data if any
//   Object.entries(options).forEach(([key, value]) => formData.append(key, value));

//   // assign file type if not set by the browser
//   files.forEach((file) => {
//     if (file.type === "") {
//       file = new File([file.slice()], file.name, {
//         type: AssetMimeType.getMimeType(file.name)
//       });
//     }
//   });

//   // append file to form data for upload
//   files.forEach((file) => {
//     formData.append('file[]', file);
//   });

//   try {
//     let response = await fetch('', {
//       method: 'post',
//       credentials: 'include',
//       body: formData
//     });

//     return await response.json();
//   } catch (error) {
//     throw error;
//   }
// };

/******************************************************************************/

const uploadFile = (file, options = {}) => {

  const mergedOptions = Object.assign({
    fileName: file.name,
    onUploaded: undefined,
    onBeforeUpload: undefined,
    onError: undefined
  }, options);

  try {
    acceptFileOrThrowError(file);

    const reader = new FileReader();
    reader.onload = function (e) {

      if (file.size &lt;= MAX_PREVIEW_FILE_SIZE_BYTE) {
        if (typeof mergedOptions.onBeforeUpload === 'function') {
          const tmpAsset = {
            fileName: mergedOptions.fileName,
            mimeType: file.type,
            source: e.target.result
          };
          mergedOptions.onBeforeUpload(tmpAsset);
        }
      }

      (async() => {
        const formData = new FormData();
        formData.append("file", file, mergedOptions.fileName);

        let response = await fetch('', {
          method: 'post',
          credentials: 'include',
          body: formData
        });

        const asset = await response.json();

        if (typeof mergedOptions.onUploaded === 'function') {
          mergedOptions.onUploaded(asset);
        }
      })();
    };
    reader.readAsDataURL(file);
  } catch (error) {
    if (typeof mergedOptions.onError === 'function') {
      mergedOptions.onError(error);
    }
    else {
      throw error;
    }
  }
};

exports.uploadFiles = (files, onUploaded, onBeforeUpload, onError) => {

  if (files.length === 0) {
    return;
  }

  (async() => {
    for (let i = 0; i &lt; files.length; i++) {
      const file = files[i];
      let fileName = file.name;

      // assign file type if not set by the browser
      if (file.type === "") {
        file = new File([file.slice()], fileName, {
          type: AssetMimeType.getMimeType(fileName)
        });
      }

      // asset with filename already exists
      // check until filename is unused
      if (webstrate.assets.some((asset) => asset.fileName === fileName)) {

        fileName = await prompt(`Asset with filename "${fileName}" exists. Rename and upload or upload to overwrite`, fileName, "Asset Filename Exists");

        // cancel pressed
        if (!fileName) {
          return;
        }
      }

      uploadFile(file, {
        fileName,
        onUploaded,
        onBeforeUpload,
        onError
      });
    }
  })();
};

/******************************************************************************/

exports.uploadBlob = (assetName, blob, onBeforeUpload, uploadPath = window.location.pathname) => {

  return new Promise((resolve, reject) => {
    try {
      acceptFileOrThrowError(blob);

      const uuid = Codestrate.util.randomString();

      const asset = {
        uuid: uuid,
        fileName: assetName,
        mimeType: blob.type,
        source: blob
      };

      if (typeof onBeforeUpload === "function") {
        onBeforeUpload(asset);
      }

      const formData = new FormData();
      formData.append("file", blob, assetName);

      const request = new XMLHttpRequest();
      request.open("POST", uploadPath);
      request.send(formData);
      request.addEventListener("load", (e) => {
        const asset = JSON.parse(request.responseText);
        asset.uuid = uuid;
        resolve(asset);
      });
    } catch (error) {
      reject(error);
    }
  });
};

/******************************************************************************/

exports.getElementFromAsset = (asset) => {

  const mimeType = asset.mimeType;

  let element;
  if (mimeType.startsWith("image/")) {
    element = document.createElement("img");
    element.setAttribute("src", asset.source || asset.fileName);
  } else if (mimeType.startsWith("audio/")) {
    element = document.createElement("audio");
    element.setAttribute("src", asset.source || asset.fileName);
    element.setAttribute("controls", "true");
  } else if (mimeType.startsWith("video/")) {
    element = document.createElement("video");
    element.setAttribute("src", asset.source || asset.fileName);
    element.setAttribute("controls", "true");
  } else {
    element = document.createElement("a");
    element.setAttribute("href", asset.fileName);
    element.setAttribute("target", "_blank");
    element.innerHTML = asset.fileName;
  }

  // Disable (text) selection. It is, for example, necessary to make links clickeable.
  // node.setAttribute("contenteditable", "false");
  return element;
};</pre></div><div class="paragraph code-paragraph collapsed" data-id="pcmfPS8B" name="Asset MIME-Type" draggable="false" style __wid="Gzfckgk4"><pre data-type="content" type="text/javascript" id="asset-mime-type" __wid="GcyhTuBc">/*
 Copyright (c) 2013 Gildas Lormeau. All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice,
 this list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright
 notice, this list of conditions and the following disclaimer in
 the documentation and/or other materials provided with the distribution.

 3. The names of the authors may not be used to endorse or promote products
 derived from this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,
 INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,
 INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,
 INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
 OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

(function() {
	"use strict";
	var table = {
		"application" : {
			"andrew-inset" : "ez",
			"annodex" : "anx",
			"atom+xml" : "atom",
			"atomcat+xml" : "atomcat",
			"atomserv+xml" : "atomsrv",
			"bbolin" : "lin",
			"cap" : [ "cap", "pcap" ],
			"cu-seeme" : "cu",
			"davmount+xml" : "davmount",
			"dsptype" : "tsp",
			"ecmascript" : [ "es", "ecma" ],
			"futuresplash" : "spl",
			"hta" : "hta",
			"java-archive" : "jar",
			"java-serialized-object" : "ser",
			"java-vm" : "class",
			"javascript" : "js",
			"m3g" : "m3g",
			"mac-binhex40" : "hqx",
			"mathematica" : [ "nb", "ma", "mb" ],
			"msaccess" : "mdb",
			"msword" : [ "doc", "dot" ],
			"mxf" : "mxf",
			"oda" : "oda",
			"ogg" : "ogx",
			"pdf" : "pdf",
			"pgp-keys" : "key",
			"pgp-signature" : [ "asc", "sig" ],
			"pics-rules" : "prf",
			"postscript" : [ "ps", "ai", "eps", "epsi", "epsf", "eps2", "eps3" ],
			"rar" : "rar",
			"rdf+xml" : "rdf",
			"rss+xml" : "rss",
			"rtf" : "rtf",
			"smil" : [ "smi", "smil" ],
			"xhtml+xml" : [ "xhtml", "xht" ],
			"xml" : [ "xml", "xsl", "xsd" ],
			"xspf+xml" : "xspf",
			"zip" : "zip",
			"vnd.android.package-archive" : "apk",
			"vnd.cinderella" : "cdy",
			"vnd.google-earth.kml+xml" : "kml",
			"vnd.google-earth.kmz" : "kmz",
			"vnd.mozilla.xul+xml" : "xul",
			"vnd.ms-excel" : [ "xls", "xlb", "xlt", "xlm", "xla", "xlc", "xlw" ],
			"vnd.ms-pki.seccat" : "cat",
			"vnd.ms-pki.stl" : "stl",
			"vnd.ms-powerpoint" : [ "ppt", "pps", "pot" ],
			"vnd.oasis.opendocument.chart" : "odc",
			"vnd.oasis.opendocument.database" : "odb",
			"vnd.oasis.opendocument.formula" : "odf",
			"vnd.oasis.opendocument.graphics" : "odg",
			"vnd.oasis.opendocument.graphics-template" : "otg",
			"vnd.oasis.opendocument.image" : "odi",
			"vnd.oasis.opendocument.presentation" : "odp",
			"vnd.oasis.opendocument.presentation-template" : "otp",
			"vnd.oasis.opendocument.spreadsheet" : "ods",
			"vnd.oasis.opendocument.spreadsheet-template" : "ots",
			"vnd.oasis.opendocument.text" : "odt",
			"vnd.oasis.opendocument.text-master" : "odm",
			"vnd.oasis.opendocument.text-template" : "ott",
			"vnd.oasis.opendocument.text-web" : "oth",
			"vnd.openxmlformats-officedocument.spreadsheetml.sheet" : "xlsx",
			"vnd.openxmlformats-officedocument.spreadsheetml.template" : "xltx",
			"vnd.openxmlformats-officedocument.presentationml.presentation" : "pptx",
			"vnd.openxmlformats-officedocument.presentationml.slideshow" : "ppsx",
			"vnd.openxmlformats-officedocument.presentationml.template" : "potx",
			"vnd.openxmlformats-officedocument.wordprocessingml.document" : "docx",
			"vnd.openxmlformats-officedocument.wordprocessingml.template" : "dotx",
			"vnd.smaf" : "mmf",
			"vnd.stardivision.calc" : "sdc",
			"vnd.stardivision.chart" : "sds",
			"vnd.stardivision.draw" : "sda",
			"vnd.stardivision.impress" : "sdd",
			"vnd.stardivision.math" : [ "sdf", "smf" ],
			"vnd.stardivision.writer" : [ "sdw", "vor" ],
			"vnd.stardivision.writer-global" : "sgl",
			"vnd.sun.xml.calc" : "sxc",
			"vnd.sun.xml.calc.template" : "stc",
			"vnd.sun.xml.draw" : "sxd",
			"vnd.sun.xml.draw.template" : "std",
			"vnd.sun.xml.impress" : "sxi",
			"vnd.sun.xml.impress.template" : "sti",
			"vnd.sun.xml.math" : "sxm",
			"vnd.sun.xml.writer" : "sxw",
			"vnd.sun.xml.writer.global" : "sxg",
			"vnd.sun.xml.writer.template" : "stw",
			"vnd.symbian.install" : [ "sis", "sisx" ],
			"vnd.visio" : [ "vsd", "vst", "vss", "vsw" ],
			"vnd.wap.wbxml" : "wbxml",
			"vnd.wap.wmlc" : "wmlc",
			"vnd.wap.wmlscriptc" : "wmlsc",
			"vnd.wordperfect" : "wpd",
			"vnd.wordperfect5.1" : "wp5",
			"x-123" : "wk",
			"x-7z-compressed" : "7z",
			"x-abiword" : "abw",
			"x-apple-diskimage" : "dmg",
			"x-bcpio" : "bcpio",
			"x-bittorrent" : "torrent",
			"x-cbr" : [ "cbr", "cba", "cbt", "cb7" ],
			"x-cbz" : "cbz",
			"x-cdf" : [ "cdf", "cda" ],
			"x-cdlink" : "vcd",
			"x-chess-pgn" : "pgn",
			"x-cpio" : "cpio",
			"x-csh" : "csh",
			"x-debian-package" : [ "deb", "udeb" ],
			"x-director" : [ "dcr", "dir", "dxr", "cst", "cct", "cxt", "w3d", "fgd", "swa" ],
			"x-dms" : "dms",
			"x-doom" : "wad",
			"x-dvi" : "dvi",
			"x-httpd-eruby" : "rhtml",
			"x-font" : "pcf.Z",
			"x-freemind" : "mm",
			"x-gnumeric" : "gnumeric",
			"x-go-sgf" : "sgf",
			"x-graphing-calculator" : "gcf",
			"x-gtar" : [ "gtar", "taz" ],
			"x-hdf" : "hdf",
			"x-httpd-php" : [ "phtml", "pht", "php" ],
			"x-httpd-php-source" : "phps",
			"x-httpd-php3" : "php3",
			"x-httpd-php3-preprocessed" : "php3p",
			"x-httpd-php4" : "php4",
			"x-httpd-php5" : "php5",
			"x-ica" : "ica",
			"x-info" : "info",
			"x-internet-signup" : [ "ins", "isp" ],
			"x-iphone" : "iii",
			"x-iso9660-image" : "iso",
			"x-java-jnlp-file" : "jnlp",
			"x-jmol" : "jmz",
			"x-killustrator" : "kil",
			"x-koan" : [ "skp", "skd", "skt", "skm" ],
			"x-kpresenter" : [ "kpr", "kpt" ],
			"x-kword" : [ "kwd", "kwt" ],
			"x-latex" : "latex",
			"x-lha" : "lha",
			"x-lyx" : "lyx",
			"x-lzh" : "lzh",
			"x-lzx" : "lzx",
			"x-maker" : [ "frm", "maker", "frame", "fm", "fb", "book", "fbdoc" ],
			"x-ms-wmd" : "wmd",
			"x-ms-wmz" : "wmz",
			"x-msdos-program" : [ "com", "exe", "bat", "dll" ],
			"x-msi" : "msi",
			"x-netcdf" : [ "nc", "cdf" ],
			"x-ns-proxy-autoconfig" : [ "pac", "dat" ],
			"x-nwc" : "nwc",
			"x-object" : "o",
			"x-oz-application" : "oza",
			"x-pkcs7-certreqresp" : "p7r",
			"x-python-code" : [ "pyc", "pyo" ],
			"x-qgis" : [ "qgs", "shp", "shx" ],
			"x-quicktimeplayer" : "qtl",
			"x-redhat-package-manager" : "rpm",
			"x-ruby" : "rb",
			"x-sh" : "sh",
			"x-shar" : "shar",
			"x-shockwave-flash" : [ "swf", "swfl" ],
			"x-silverlight" : "scr",
			"x-stuffit" : "sit",
			"x-sv4cpio" : "sv4cpio",
			"x-sv4crc" : "sv4crc",
			"x-tar" : "tar",
			"x-tcl" : "tcl",
			"x-tex-gf" : "gf",
			"x-tex-pk" : "pk",
			"x-texinfo" : [ "texinfo", "texi" ],
			"x-trash" : [ "~", "%", "bak", "old", "sik" ],
			"x-troff" : [ "t", "tr", "roff" ],
			"x-troff-man" : "man",
			"x-troff-me" : "me",
			"x-troff-ms" : "ms",
			"x-ustar" : "ustar",
			"x-wais-source" : "src",
			"x-wingz" : "wz",
			"x-x509-ca-cert" : [ "crt", "der", "cer" ],
			"x-xcf" : "xcf",
			"x-xfig" : "fig",
			"x-xpinstall" : "xpi",
			"applixware" : "aw",
			"atomsvc+xml" : "atomsvc",
			"ccxml+xml" : "ccxml",
			"cdmi-capability" : "cdmia",
			"cdmi-container" : "cdmic",
			"cdmi-domain" : "cdmid",
			"cdmi-object" : "cdmio",
			"cdmi-queue" : "cdmiq",
			"docbook+xml" : "dbk",
			"dssc+der" : "dssc",
			"dssc+xml" : "xdssc",
			"emma+xml" : "emma",
			"epub+zip" : "epub",
			"exi" : "exi",
			"font-tdpfr" : "pfr",
			"gml+xml" : "gml",
			"gpx+xml" : "gpx",
			"gxf" : "gxf",
			"hyperstudio" : "stk",
			"inkml+xml" : [ "ink", "inkml" ],
			"ipfix" : "ipfix",
			"json" : "json",
			"jsonml+json" : "jsonml",
			"lost+xml" : "lostxml",
			"mads+xml" : "mads",
			"marc" : "mrc",
			"marcxml+xml" : "mrcx",
			"mathml+xml" : "mathml",
			"mbox" : "mbox",
			"mediaservercontrol+xml" : "mscml",
			"metalink+xml" : "metalink",
			"metalink4+xml" : "meta4",
			"mets+xml" : "mets",
			"mods+xml" : "mods",
			"mp21" : [ "m21", "mp21" ],
			"mp4" : "mp4s",
			"oebps-package+xml" : "opf",
			"omdoc+xml" : "omdoc",
			"onenote" : [ "onetoc", "onetoc2", "onetmp", "onepkg" ],
			"oxps" : "oxps",
			"patch-ops-error+xml" : "xer",
			"pgp-encrypted" : "pgp",
			"pkcs10" : "p10",
			"pkcs7-mime" : [ "p7m", "p7c" ],
			"pkcs7-signature" : "p7s",
			"pkcs8" : "p8",
			"pkix-attr-cert" : "ac",
			"pkix-crl" : "crl",
			"pkix-pkipath" : "pkipath",
			"pkixcmp" : "pki",
			"pls+xml" : "pls",
			"prs.cww" : "cww",
			"pskc+xml" : "pskcxml",
			"reginfo+xml" : "rif",
			"relax-ng-compact-syntax" : "rnc",
			"resource-lists+xml" : "rl",
			"resource-lists-diff+xml" : "rld",
			"rls-services+xml" : "rs",
			"rpki-ghostbusters" : "gbr",
			"rpki-manifest" : "mft",
			"rpki-roa" : "roa",
			"rsd+xml" : "rsd",
			"sbml+xml" : "sbml",
			"scvp-cv-request" : "scq",
			"scvp-cv-response" : "scs",
			"scvp-vp-request" : "spq",
			"scvp-vp-response" : "spp",
			"sdp" : "sdp",
			"set-payment-initiation" : "setpay",
			"set-registration-initiation" : "setreg",
			"shf+xml" : "shf",
			"sparql-query" : "rq",
			"sparql-results+xml" : "srx",
			"srgs" : "gram",
			"srgs+xml" : "grxml",
			"sru+xml" : "sru",
			"ssdl+xml" : "ssdl",
			"ssml+xml" : "ssml",
			"tei+xml" : [ "tei", "teicorpus" ],
			"thraud+xml" : "tfi",
			"timestamped-data" : "tsd",
			"vnd.3gpp.pic-bw-large" : "plb",
			"vnd.3gpp.pic-bw-small" : "psb",
			"vnd.3gpp.pic-bw-var" : "pvb",
			"vnd.3gpp2.tcap" : "tcap",
			"vnd.3m.post-it-notes" : "pwn",
			"vnd.accpac.simply.aso" : "aso",
			"vnd.accpac.simply.imp" : "imp",
			"vnd.acucobol" : "acu",
			"vnd.acucorp" : [ "atc", "acutc" ],
			"vnd.adobe.air-application-installer-package+zip" : "air",
			"vnd.adobe.formscentral.fcdt" : "fcdt",
			"vnd.adobe.fxp" : [ "fxp", "fxpl" ],
			"vnd.adobe.xdp+xml" : "xdp",
			"vnd.adobe.xfdf" : "xfdf",
			"vnd.ahead.space" : "ahead",
			"vnd.airzip.filesecure.azf" : "azf",
			"vnd.airzip.filesecure.azs" : "azs",
			"vnd.amazon.ebook" : "azw",
			"vnd.americandynamics.acc" : "acc",
			"vnd.amiga.ami" : "ami",
			"vnd.anser-web-certificate-issue-initiation" : "cii",
			"vnd.anser-web-funds-transfer-initiation" : "fti",
			"vnd.antix.game-component" : "atx",
			"vnd.apple.installer+xml" : "mpkg",
			"vnd.apple.mpegurl" : "m3u8",
			"vnd.aristanetworks.swi" : "swi",
			"vnd.astraea-software.iota" : "iota",
			"vnd.audiograph" : "aep",
			"vnd.blueice.multipass" : "mpm",
			"vnd.bmi" : "bmi",
			"vnd.businessobjects" : "rep",
			"vnd.chemdraw+xml" : "cdxml",
			"vnd.chipnuts.karaoke-mmd" : "mmd",
			"vnd.claymore" : "cla",
			"vnd.cloanto.rp9" : "rp9",
			"vnd.clonk.c4group" : [ "c4g", "c4d", "c4f", "c4p", "c4u" ],
			"vnd.cluetrust.cartomobile-config" : "c11amc",
			"vnd.cluetrust.cartomobile-config-pkg" : "c11amz",
			"vnd.commonspace" : "csp",
			"vnd.contact.cmsg" : "cdbcmsg",
			"vnd.cosmocaller" : "cmc",
			"vnd.crick.clicker" : "clkx",
			"vnd.crick.clicker.keyboard" : "clkk",
			"vnd.crick.clicker.palette" : "clkp",
			"vnd.crick.clicker.template" : "clkt",
			"vnd.crick.clicker.wordbank" : "clkw",
			"vnd.criticaltools.wbs+xml" : "wbs",
			"vnd.ctc-posml" : "pml",
			"vnd.cups-ppd" : "ppd",
			"vnd.curl.car" : "car",
			"vnd.curl.pcurl" : "pcurl",
			"vnd.dart" : "dart",
			"vnd.data-vision.rdz" : "rdz",
			"vnd.dece.data" : [ "uvf", "uvvf", "uvd", "uvvd" ],
			"vnd.dece.ttml+xml" : [ "uvt", "uvvt" ],
			"vnd.dece.unspecified" : [ "uvx", "uvvx" ],
			"vnd.dece.zip" : [ "uvz", "uvvz" ],
			"vnd.denovo.fcselayout-link" : "fe_launch",
			"vnd.dna" : "dna",
			"vnd.dolby.mlp" : "mlp",
			"vnd.dpgraph" : "dpg",
			"vnd.dreamfactory" : "dfac",
			"vnd.ds-keypoint" : "kpxx",
			"vnd.dvb.ait" : "ait",
			"vnd.dvb.service" : "svc",
			"vnd.dynageo" : "geo",
			"vnd.ecowin.chart" : "mag",
			"vnd.enliven" : "nml",
			"vnd.epson.esf" : "esf",
			"vnd.epson.msf" : "msf",
			"vnd.epson.quickanime" : "qam",
			"vnd.epson.salt" : "slt",
			"vnd.epson.ssf" : "ssf",
			"vnd.eszigno3+xml" : [ "es3", "et3" ],
			"vnd.ezpix-album" : "ez2",
			"vnd.ezpix-package" : "ez3",
			"vnd.fdf" : "fdf",
			"vnd.fdsn.mseed" : "mseed",
			"vnd.fdsn.seed" : [ "seed", "dataless" ],
			"vnd.flographit" : "gph",
			"vnd.fluxtime.clip" : "ftc",
			"vnd.framemaker" : [ "fm", "frame", "maker", "book" ],
			"vnd.frogans.fnc" : "fnc",
			"vnd.frogans.ltf" : "ltf",
			"vnd.fsc.weblaunch" : "fsc",
			"vnd.fujitsu.oasys" : "oas",
			"vnd.fujitsu.oasys2" : "oa2",
			"vnd.fujitsu.oasys3" : "oa3",
			"vnd.fujitsu.oasysgp" : "fg5",
			"vnd.fujitsu.oasysprs" : "bh2",
			"vnd.fujixerox.ddd" : "ddd",
			"vnd.fujixerox.docuworks" : "xdw",
			"vnd.fujixerox.docuworks.binder" : "xbd",
			"vnd.fuzzysheet" : "fzs",
			"vnd.genomatix.tuxedo" : "txd",
			"vnd.geogebra.file" : "ggb",
			"vnd.geogebra.tool" : "ggt",
			"vnd.geometry-explorer" : [ "gex", "gre" ],
			"vnd.geonext" : "gxt",
			"vnd.geoplan" : "g2w",
			"vnd.geospace" : "g3w",
			"vnd.gmx" : "gmx",
			"vnd.grafeq" : [ "gqf", "gqs" ],
			"vnd.groove-account" : "gac",
			"vnd.groove-help" : "ghf",
			"vnd.groove-identity-message" : "gim",
			"vnd.groove-injector" : "grv",
			"vnd.groove-tool-message" : "gtm",
			"vnd.groove-tool-template" : "tpl",
			"vnd.groove-vcard" : "vcg",
			"vnd.hal+xml" : "hal",
			"vnd.handheld-entertainment+xml" : "zmm",
			"vnd.hbci" : "hbci",
			"vnd.hhe.lesson-player" : "les",
			"vnd.hp-hpgl" : "hpgl",
			"vnd.hp-hpid" : "hpid",
			"vnd.hp-hps" : "hps",
			"vnd.hp-jlyt" : "jlt",
			"vnd.hp-pcl" : "pcl",
			"vnd.hp-pclxl" : "pclxl",
			"vnd.hydrostatix.sof-data" : "sfd-hdstx",
			"vnd.ibm.minipay" : "mpy",
			"vnd.ibm.modcap" : [ "afp", "listafp", "list3820" ],
			"vnd.ibm.rights-management" : "irm",
			"vnd.ibm.secure-container" : "sc",
			"vnd.iccprofile" : [ "icc", "icm" ],
			"vnd.igloader" : "igl",
			"vnd.immervision-ivp" : "ivp",
			"vnd.immervision-ivu" : "ivu",
			"vnd.insors.igm" : "igm",
			"vnd.intercon.formnet" : [ "xpw", "xpx" ],
			"vnd.intergeo" : "i2g",
			"vnd.intu.qbo" : "qbo",
			"vnd.intu.qfx" : "qfx",
			"vnd.ipunplugged.rcprofile" : "rcprofile",
			"vnd.irepository.package+xml" : "irp",
			"vnd.is-xpr" : "xpr",
			"vnd.isac.fcs" : "fcs",
			"vnd.jam" : "jam",
			"vnd.jcp.javame.midlet-rms" : "rms",
			"vnd.jisp" : "jisp",
			"vnd.joost.joda-archive" : "joda",
			"vnd.kahootz" : [ "ktz", "ktr" ],
			"vnd.kde.karbon" : "karbon",
			"vnd.kde.kchart" : "chrt",
			"vnd.kde.kformula" : "kfo",
			"vnd.kde.kivio" : "flw",
			"vnd.kde.kontour" : "kon",
			"vnd.kde.kpresenter" : [ "kpr", "kpt" ],
			"vnd.kde.kspread" : "ksp",
			"vnd.kde.kword" : [ "kwd", "kwt" ],
			"vnd.kenameaapp" : "htke",
			"vnd.kidspiration" : "kia",
			"vnd.kinar" : [ "kne", "knp" ],
			"vnd.koan" : [ "skp", "skd", "skt", "skm" ],
			"vnd.kodak-descriptor" : "sse",
			"vnd.las.las+xml" : "lasxml",
			"vnd.llamagraphics.life-balance.desktop" : "lbd",
			"vnd.llamagraphics.life-balance.exchange+xml" : "lbe",
			"vnd.lotus-1-2-3" : "123",
			"vnd.lotus-approach" : "apr",
			"vnd.lotus-freelance" : "pre",
			"vnd.lotus-notes" : "nsf",
			"vnd.lotus-organizer" : "org",
			"vnd.lotus-screencam" : "scm",
			"vnd.lotus-wordpro" : "lwp",
			"vnd.macports.portpkg" : "portpkg",
			"vnd.mcd" : "mcd",
			"vnd.medcalcdata" : "mc1",
			"vnd.mediastation.cdkey" : "cdkey",
			"vnd.mfer" : "mwf",
			"vnd.mfmp" : "mfm",
			"vnd.micrografx.flo" : "flo",
			"vnd.micrografx.igx" : "igx",
			"vnd.mif" : "mif",
			"vnd.mobius.daf" : "daf",
			"vnd.mobius.dis" : "dis",
			"vnd.mobius.mbk" : "mbk",
			"vnd.mobius.mqy" : "mqy",
			"vnd.mobius.msl" : "msl",
			"vnd.mobius.plc" : "plc",
			"vnd.mobius.txf" : "txf",
			"vnd.mophun.application" : "mpn",
			"vnd.mophun.certificate" : "mpc",
			"vnd.ms-artgalry" : "cil",
			"vnd.ms-cab-compressed" : "cab",
			"vnd.ms-excel.addin.macroenabled.12" : "xlam",
			"vnd.ms-excel.sheet.binary.macroenabled.12" : "xlsb",
			"vnd.ms-excel.sheet.macroenabled.12" : "xlsm",
			"vnd.ms-excel.template.macroenabled.12" : "xltm",
			"vnd.ms-fontobject" : "eot",
			"vnd.ms-htmlhelp" : "chm",
			"vnd.ms-ims" : "ims",
			"vnd.ms-lrm" : "lrm",
			"vnd.ms-officetheme" : "thmx",
			"vnd.ms-powerpoint.addin.macroenabled.12" : "ppam",
			"vnd.ms-powerpoint.presentation.macroenabled.12" : "pptm",
			"vnd.ms-powerpoint.slide.macroenabled.12" : "sldm",
			"vnd.ms-powerpoint.slideshow.macroenabled.12" : "ppsm",
			"vnd.ms-powerpoint.template.macroenabled.12" : "potm",
			"vnd.ms-project" : [ "mpp", "mpt" ],
			"vnd.ms-word.document.macroenabled.12" : "docm",
			"vnd.ms-word.template.macroenabled.12" : "dotm",
			"vnd.ms-works" : [ "wps", "wks", "wcm", "wdb" ],
			"vnd.ms-wpl" : "wpl",
			"vnd.ms-xpsdocument" : "xps",
			"vnd.mseq" : "mseq",
			"vnd.musician" : "mus",
			"vnd.muvee.style" : "msty",
			"vnd.mynfc" : "taglet",
			"vnd.neurolanguage.nlu" : "nlu",
			"vnd.nitf" : [ "ntf", "nitf" ],
			"vnd.noblenet-directory" : "nnd",
			"vnd.noblenet-sealer" : "nns",
			"vnd.noblenet-web" : "nnw",
			"vnd.nokia.n-gage.data" : "ngdat",
			"vnd.nokia.n-gage.symbian.install" : "n-gage",
			"vnd.nokia.radio-preset" : "rpst",
			"vnd.nokia.radio-presets" : "rpss",
			"vnd.novadigm.edm" : "edm",
			"vnd.novadigm.edx" : "edx",
			"vnd.novadigm.ext" : "ext",
			"vnd.oasis.opendocument.chart-template" : "otc",
			"vnd.oasis.opendocument.formula-template" : "odft",
			"vnd.oasis.opendocument.image-template" : "oti",
			"vnd.olpc-sugar" : "xo",
			"vnd.oma.dd2+xml" : "dd2",
			"vnd.openofficeorg.extension" : "oxt",
			"vnd.openxmlformats-officedocument.presentationml.slide" : "sldx",
			"vnd.osgeo.mapguide.package" : "mgp",
			"vnd.osgi.dp" : "dp",
			"vnd.osgi.subsystem" : "esa",
			"vnd.palm" : [ "pdb", "pqa", "oprc" ],
			"vnd.pawaafile" : "paw",
			"vnd.pg.format" : "str",
			"vnd.pg.osasli" : "ei6",
			"vnd.picsel" : "efif",
			"vnd.pmi.widget" : "wg",
			"vnd.pocketlearn" : "plf",
			"vnd.powerbuilder6" : "pbd",
			"vnd.previewsystems.box" : "box",
			"vnd.proteus.magazine" : "mgz",
			"vnd.publishare-delta-tree" : "qps",
			"vnd.pvi.ptid1" : "ptid",
			"vnd.quark.quarkxpress" : [ "qxd", "qxt", "qwd", "qwt", "qxl", "qxb" ],
			"vnd.realvnc.bed" : "bed",
			"vnd.recordare.musicxml" : "mxl",
			"vnd.recordare.musicxml+xml" : "musicxml",
			"vnd.rig.cryptonote" : "cryptonote",
			"vnd.rn-realmedia" : "rm",
			"vnd.rn-realmedia-vbr" : "rmvb",
			"vnd.route66.link66+xml" : "link66",
			"vnd.sailingtracker.track" : "st",
			"vnd.seemail" : "see",
			"vnd.sema" : "sema",
			"vnd.semd" : "semd",
			"vnd.semf" : "semf",
			"vnd.shana.informed.formdata" : "ifm",
			"vnd.shana.informed.formtemplate" : "itp",
			"vnd.shana.informed.interchange" : "iif",
			"vnd.shana.informed.package" : "ipk",
			"vnd.simtech-mindmapper" : [ "twd", "twds" ],
			"vnd.smart.teacher" : "teacher",
			"vnd.solent.sdkm+xml" : [ "sdkm", "sdkd" ],
			"vnd.spotfire.dxp" : "dxp",
			"vnd.spotfire.sfs" : "sfs",
			"vnd.stepmania.package" : "smzip",
			"vnd.stepmania.stepchart" : "sm",
			"vnd.sus-calendar" : [ "sus", "susp" ],
			"vnd.svd" : "svd",
			"vnd.syncml+xml" : "xsm",
			"vnd.syncml.dm+wbxml" : "bdm",
			"vnd.syncml.dm+xml" : "xdm",
			"vnd.tao.intent-module-archive" : "tao",
			"vnd.tcpdump.pcap" : [ "pcap", "cap", "dmp" ],
			"vnd.tmobile-livetv" : "tmo",
			"vnd.trid.tpt" : "tpt",
			"vnd.triscape.mxs" : "mxs",
			"vnd.trueapp" : "tra",
			"vnd.ufdl" : [ "ufd", "ufdl" ],
			"vnd.uiq.theme" : "utz",
			"vnd.umajin" : "umj",
			"vnd.unity" : "unityweb",
			"vnd.uoml+xml" : "uoml",
			"vnd.vcx" : "vcx",
			"vnd.visionary" : "vis",
			"vnd.vsf" : "vsf",
			"vnd.webturbo" : "wtb",
			"vnd.wolfram.player" : "nbp",
			"vnd.wqd" : "wqd",
			"vnd.wt.stf" : "stf",
			"vnd.xara" : "xar",
			"vnd.xfdl" : "xfdl",
			"vnd.yamaha.hv-dic" : "hvd",
			"vnd.yamaha.hv-script" : "hvs",
			"vnd.yamaha.hv-voice" : "hvp",
			"vnd.yamaha.openscoreformat" : "osf",
			"vnd.yamaha.openscoreformat.osfpvg+xml" : "osfpvg",
			"vnd.yamaha.smaf-audio" : "saf",
			"vnd.yamaha.smaf-phrase" : "spf",
			"vnd.yellowriver-custom-menu" : "cmp",
			"vnd.zul" : [ "zir", "zirz" ],
			"vnd.zzazz.deck+xml" : "zaz",
			"voicexml+xml" : "vxml",
			"widget" : "wgt",
			"winhlp" : "hlp",
			"wsdl+xml" : "wsdl",
			"wspolicy+xml" : "wspolicy",
			"x-ace-compressed" : "ace",
			"x-authorware-bin" : [ "aab", "x32", "u32", "vox" ],
			"x-authorware-map" : "aam",
			"x-authorware-seg" : "aas",
			"x-blorb" : [ "blb", "blorb" ],
			"x-bzip" : "bz",
			"x-bzip2" : [ "bz2", "boz" ],
			"x-cfs-compressed" : "cfs",
			"x-chat" : "chat",
			"x-conference" : "nsc",
			"x-dgc-compressed" : "dgc",
			"x-dtbncx+xml" : "ncx",
			"x-dtbook+xml" : "dtb",
			"x-dtbresource+xml" : "res",
			"x-eva" : "eva",
			"x-font-bdf" : "bdf",
			"x-font-ghostscript" : "gsf",
			"x-font-linux-psf" : "psf",
			"x-font-otf" : "otf",
			"x-font-pcf" : "pcf",
			"x-font-snf" : "snf",
			"x-font-ttf" : [ "ttf", "ttc" ],
			"x-font-type1" : [ "pfa", "pfb", "pfm", "afm" ],
			"x-font-woff" : "woff",
			"x-freearc" : "arc",
			"x-gca-compressed" : "gca",
			"x-glulx" : "ulx",
			"x-gramps-xml" : "gramps",
			"x-install-instructions" : "install",
			"x-lzh-compressed" : [ "lzh", "lha" ],
			"x-mie" : "mie",
			"x-mobipocket-ebook" : [ "prc", "mobi" ],
			"x-ms-application" : "application",
			"x-ms-shortcut" : "lnk",
			"x-ms-xbap" : "xbap",
			"x-msbinder" : "obd",
			"x-mscardfile" : "crd",
			"x-msclip" : "clp",
			"x-msdownload" : [ "exe", "dll", "com", "bat", "msi" ],
			"x-msmediaview" : [ "mvb", "m13", "m14" ],
			"x-msmetafile" : [ "wmf", "wmz", "emf", "emz" ],
			"x-msmoney" : "mny",
			"x-mspublisher" : "pub",
			"x-msschedule" : "scd",
			"x-msterminal" : "trm",
			"x-mswrite" : "wri",
			"x-nzb" : "nzb",
			"x-pkcs12" : [ "p12", "pfx" ],
			"x-pkcs7-certificates" : [ "p7b", "spc" ],
			"x-research-info-systems" : "ris",
			"x-silverlight-app" : "xap",
			"x-sql" : "sql",
			"x-stuffitx" : "sitx",
			"x-subrip" : "srt",
			"x-t3vm-image" : "t3",
			"x-tads" : "gam",
			"x-tex" : "tex",
			"x-tex-tfm" : "tfm",
			"x-tgif" : "obj",
			"x-xliff+xml" : "xlf",
			"x-xz" : "xz",
			"x-zmachine" : [ "z1", "z2", "z3", "z4", "z5", "z6", "z7", "z8" ],
			"xaml+xml" : "xaml",
			"xcap-diff+xml" : "xdf",
			"xenc+xml" : "xenc",
			"xml-dtd" : "dtd",
			"xop+xml" : "xop",
			"xproc+xml" : "xpl",
			"xslt+xml" : "xslt",
			"xv+xml" : [ "mxml", "xhvml", "xvml", "xvm" ],
			"yang" : "yang",
			"yin+xml" : "yin",
			"envoy" : "evy",
			"fractals" : "fif",
			"internet-property-stream" : "acx",
			"olescript" : "axs",
			"vnd.ms-outlook" : "msg",
			"vnd.ms-pkicertstore" : "sst",
			"x-compress" : "z",
			"x-compressed" : "tgz",
			"x-gzip" : "gz",
			"x-perfmon" : [ "pma", "pmc", "pml", "pmr", "pmw" ],
			"x-pkcs7-mime" : [ "p7c", "p7m" ],
			"ynd.ms-pkipko" : "pko"
		},
		"audio" : {
			"amr" : "amr",
			"amr-wb" : "awb",
			"annodex" : "axa",
			"basic" : [ "au", "snd" ],
			"flac" : "flac",
			"midi" : [ "mid", "midi", "kar", "rmi" ],
			"mpeg" : [ "mpga", "mpega", "mp2", "mp3", "m4a", "mp2a", "m2a", "m3a" ],
			"mpegurl" : "m3u",
			"ogg" : [ "oga", "ogg", "spx" ],
			"prs.sid" : "sid",
			"x-aiff" : [ "aif", "aiff", "aifc" ],
			"x-gsm" : "gsm",
			"x-ms-wma" : "wma",
			"x-ms-wax" : "wax",
			"x-pn-realaudio" : "ram",
			"x-realaudio" : "ra",
			"x-sd2" : "sd2",
			"x-wav" : "wav",
			"adpcm" : "adp",
			"mp4" : "mp4a",
			"s3m" : "s3m",
			"silk" : "sil",
			"vnd.dece.audio" : [ "uva", "uvva" ],
			"vnd.digital-winds" : "eol",
			"vnd.dra" : "dra",
			"vnd.dts" : "dts",
			"vnd.dts.hd" : "dtshd",
			"vnd.lucent.voice" : "lvp",
			"vnd.ms-playready.media.pya" : "pya",
			"vnd.nuera.ecelp4800" : "ecelp4800",
			"vnd.nuera.ecelp7470" : "ecelp7470",
			"vnd.nuera.ecelp9600" : "ecelp9600",
			"vnd.rip" : "rip",
			"webm" : "weba",
			"x-aac" : "aac",
			"x-caf" : "caf",
			"x-matroska" : "mka",
			"x-pn-realaudio-plugin" : "rmp",
			"xm" : "xm",
			"mid" : [ "mid", "rmi" ]
		},
		"chemical" : {
			"x-alchemy" : "alc",
			"x-cache" : [ "cac", "cache" ],
			"x-cache-csf" : "csf",
			"x-cactvs-binary" : [ "cbin", "cascii", "ctab" ],
			"x-cdx" : "cdx",
			"x-chem3d" : "c3d",
			"x-cif" : "cif",
			"x-cmdf" : "cmdf",
			"x-cml" : "cml",
			"x-compass" : "cpa",
			"x-crossfire" : "bsd",
			"x-csml" : [ "csml", "csm" ],
			"x-ctx" : "ctx",
			"x-cxf" : [ "cxf", "cef" ],
			"x-embl-dl-nucleotide" : [ "emb", "embl" ],
			"x-gamess-input" : [ "inp", "gam", "gamin" ],
			"x-gaussian-checkpoint" : [ "fch", "fchk" ],
			"x-gaussian-cube" : "cub",
			"x-gaussian-input" : [ "gau", "gjc", "gjf" ],
			"x-gaussian-log" : "gal",
			"x-gcg8-sequence" : "gcg",
			"x-genbank" : "gen",
			"x-hin" : "hin",
			"x-isostar" : [ "istr", "ist" ],
			"x-jcamp-dx" : [ "jdx", "dx" ],
			"x-kinemage" : "kin",
			"x-macmolecule" : "mcm",
			"x-macromodel-input" : [ "mmd", "mmod" ],
			"x-mdl-molfile" : "mol",
			"x-mdl-rdfile" : "rd",
			"x-mdl-rxnfile" : "rxn",
			"x-mdl-sdfile" : [ "sd", "sdf" ],
			"x-mdl-tgf" : "tgf",
			"x-mmcif" : "mcif",
			"x-mol2" : "mol2",
			"x-molconn-Z" : "b",
			"x-mopac-graph" : "gpt",
			"x-mopac-input" : [ "mop", "mopcrt", "mpc", "zmt" ],
			"x-mopac-out" : "moo",
			"x-ncbi-asn1" : "asn",
			"x-ncbi-asn1-ascii" : [ "prt", "ent" ],
			"x-ncbi-asn1-binary" : [ "val", "aso" ],
			"x-pdb" : [ "pdb", "ent" ],
			"x-rosdal" : "ros",
			"x-swissprot" : "sw",
			"x-vamas-iso14976" : "vms",
			"x-vmd" : "vmd",
			"x-xtel" : "xtel",
			"x-xyz" : "xyz"
		},
		"image" : {
			"gif" : "gif",
			"ief" : "ief",
			"jpeg" : [ "jpeg", "jpg", "jpe" ],
			"pcx" : "pcx",
			"png" : "png",
			"svg+xml" : [ "svg", "svgz" ],
			"tiff" : [ "tiff", "tif" ],
			"vnd.djvu" : [ "djvu", "djv" ],
			"vnd.wap.wbmp" : "wbmp",
			"x-canon-cr2" : "cr2",
			"x-canon-crw" : "crw",
			"x-cmu-raster" : "ras",
			"x-coreldraw" : "cdr",
			"x-coreldrawpattern" : "pat",
			"x-coreldrawtemplate" : "cdt",
			"x-corelphotopaint" : "cpt",
			"x-epson-erf" : "erf",
			"x-icon" : "ico",
			"x-jg" : "art",
			"x-jng" : "jng",
			"x-nikon-nef" : "nef",
			"x-olympus-orf" : "orf",
			"x-photoshop" : "psd",
			"x-portable-anymap" : "pnm",
			"x-portable-bitmap" : "pbm",
			"x-portable-graymap" : "pgm",
			"x-portable-pixmap" : "ppm",
			"x-rgb" : "rgb",
			"x-xbitmap" : "xbm",
			"x-xpixmap" : "xpm",
			"x-xwindowdump" : "xwd",
			"bmp" : "bmp",
			"cgm" : "cgm",
			"g3fax" : "g3",
			"ktx" : "ktx",
			"prs.btif" : "btif",
			"sgi" : "sgi",
			"vnd.dece.graphic" : [ "uvi", "uvvi", "uvg", "uvvg" ],
			"vnd.dwg" : "dwg",
			"vnd.dxf" : "dxf",
			"vnd.fastbidsheet" : "fbs",
			"vnd.fpx" : "fpx",
			"vnd.fst" : "fst",
			"vnd.fujixerox.edmics-mmr" : "mmr",
			"vnd.fujixerox.edmics-rlc" : "rlc",
			"vnd.ms-modi" : "mdi",
			"vnd.ms-photo" : "wdp",
			"vnd.net-fpx" : "npx",
			"vnd.xiff" : "xif",
			"webp" : "webp",
			"x-3ds" : "3ds",
			"x-cmx" : "cmx",
			"x-freehand" : [ "fh", "fhc", "fh4", "fh5", "fh7" ],
			"x-pict" : [ "pic", "pct" ],
			"x-tga" : "tga",
			"cis-cod" : "cod",
			"pipeg" : "jfif"
		},
		"message" : {
			"rfc822" : [ "eml", "mime", "mht", "mhtml", "nws" ]
		},
		"model" : {
			"iges" : [ "igs", "iges" ],
			"mesh" : [ "msh", "mesh", "silo" ],
			"vrml" : [ "wrl", "vrml" ],
			"x3d+vrml" : [ "x3dv", "x3dvz" ],
			"x3d+xml" : [ "x3d", "x3dz" ],
			"x3d+binary" : [ "x3db", "x3dbz" ],
			"vnd.collada+xml" : "dae",
			"vnd.dwf" : "dwf",
			"vnd.gdl" : "gdl",
			"vnd.gtw" : "gtw",
			"vnd.mts" : "mts",
			"vnd.vtu" : "vtu"
		},
		"text" : {
			"cache-manifest" : [ "manifest", "appcache" ],
			"calendar" : [ "ics", "icz", "ifb" ],
			"css" : "css",
			"csv" : "csv",
			"h323" : "323",
			"html" : [ "html", "htm", "shtml", "stm" ],
			"iuls" : "uls",
			"mathml" : "mml",
			"plain" : [ "txt", "text", "brf", "conf", "def", "list", "log", "in", "bas" ],
			"richtext" : "rtx",
			"scriptlet" : [ "sct", "wsc" ],
			"texmacs" : [ "tm", "ts" ],
			"tab-separated-values" : "tsv",
			"vnd.sun.j2me.app-descriptor" : "jad",
			"vnd.wap.wml" : "wml",
			"vnd.wap.wmlscript" : "wmls",
			"x-bibtex" : "bib",
			"x-boo" : "boo",
			"x-c++hdr" : [ "h++", "hpp", "hxx", "hh" ],
			"x-c++src" : [ "c++", "cpp", "cxx", "cc" ],
			"x-component" : "htc",
			"x-dsrc" : "d",
			"x-diff" : [ "diff", "patch" ],
			"x-haskell" : "hs",
			"x-java" : "java",
			"x-literate-haskell" : "lhs",
			"x-moc" : "moc",
			"x-pascal" : [ "p", "pas" ],
			"x-pcs-gcd" : "gcd",
			"x-perl" : [ "pl", "pm" ],
			"x-python" : "py",
			"x-scala" : "scala",
			"x-setext" : "etx",
			"x-tcl" : [ "tcl", "tk" ],
			"x-tex" : [ "tex", "ltx", "sty", "cls" ],
			"x-vcalendar" : "vcs",
			"x-vcard" : "vcf",
			"n3" : "n3",
			"prs.lines.tag" : "dsc",
			"sgml" : [ "sgml", "sgm" ],
			"troff" : [ "t", "tr", "roff", "man", "me", "ms" ],
			"turtle" : "ttl",
			"uri-list" : [ "uri", "uris", "urls" ],
			"vcard" : "vcard",
			"vnd.curl" : "curl",
			"vnd.curl.dcurl" : "dcurl",
			"vnd.curl.scurl" : "scurl",
			"vnd.curl.mcurl" : "mcurl",
			"vnd.dvb.subtitle" : "sub",
			"vnd.fly" : "fly",
			"vnd.fmi.flexstor" : "flx",
			"vnd.graphviz" : "gv",
			"vnd.in3d.3dml" : "3dml",
			"vnd.in3d.spot" : "spot",
			"x-asm" : [ "s", "asm" ],
			"x-c" : [ "c", "cc", "cxx", "cpp", "h", "hh", "dic" ],
			"x-fortran" : [ "f", "for", "f77", "f90" ],
			"x-opml" : "opml",
			"x-nfo" : "nfo",
			"x-sfv" : "sfv",
			"x-uuencode" : "uu",
			"webviewhtml" : "htt"
		},
		"video" : {
			"3gpp" : "3gp",
			"annodex" : "axv",
			"dl" : "dl",
			"dv" : [ "dif", "dv" ],
			"fli" : "fli",
			"gl" : "gl",
			"mpeg" : [ "mpeg", "mpg", "mpe", "m1v", "m2v", "mp2", "mpa", "mpv2" ],
			"mp4" : [ "mp4", "mp4v", "mpg4" ],
			"quicktime" : [ "qt", "mov" ],
			"ogg" : "ogv",
			"vnd.mpegurl" : [ "mxu", "m4u" ],
			"x-flv" : "flv",
			"x-la-asf" : [ "lsf", "lsx" ],
			"x-mng" : "mng",
			"x-ms-asf" : [ "asf", "asx", "asr" ],
			"x-ms-wm" : "wm",
			"x-ms-wmv" : "wmv",
			"x-ms-wmx" : "wmx",
			"x-ms-wvx" : "wvx",
			"x-msvideo" : "avi",
			"x-sgi-movie" : "movie",
			"x-matroska" : [ "mpv", "mkv", "mk3d", "mks" ],
			"3gpp2" : "3g2",
			"h261" : "h261",
			"h263" : "h263",
			"h264" : "h264",
			"jpeg" : "jpgv",
			"jpm" : [ "jpm", "jpgm" ],
			"mj2" : [ "mj2", "mjp2" ],
			"vnd.dece.hd" : [ "uvh", "uvvh" ],
			"vnd.dece.mobile" : [ "uvm", "uvvm" ],
			"vnd.dece.pd" : [ "uvp", "uvvp" ],
			"vnd.dece.sd" : [ "uvs", "uvvs" ],
			"vnd.dece.video" : [ "uvv", "uvvv" ],
			"vnd.dvb.file" : "dvb",
			"vnd.fvt" : "fvt",
			"vnd.ms-playready.media.pyv" : "pyv",
			"vnd.uvvu.mp4" : [ "uvu", "uvvu" ],
			"vnd.vivo" : "viv",
			"webm" : "webm",
			"x-f4v" : "f4v",
			"x-m4v" : "m4v",
			"x-ms-vob" : "vob",
			"x-smv" : "smv"
		},
		"x-conference" : {
			"x-cooltalk" : "ice"
		},
		"x-world" : {
			"x-vrml" : [ "vrm", "vrml", "wrl", "flr", "wrz", "xaf", "xof" ]
		}
	};

	var mimeTypes = (function() {
		var type, subtype, val, index, mimeTypes = {};
		for (type in table) {
			if (table.hasOwnProperty(type)) {
				for (subtype in table[type]) {
					if (table[type].hasOwnProperty(subtype)) {
						val = table[type][subtype];
						if (typeof val == "string") {
							mimeTypes[val] = type + "/" + subtype;
						} else {
							for (index = 0; index &lt; val.length; index++) {
								mimeTypes[val[index]] = type + "/" + subtype;
							}
						}
					}
				}
			}
		}
		return mimeTypes;
	})();

	exports.getMimeType = function(filename) {
		var defaultValue = "application/octet-stream";
		return filename && mimeTypes[filename.split(".").pop().toLowerCase()] || defaultValue;
	};

})();</pre></div><div class="paragraph code-paragraph collapsed" draggable="false" name="Drop Assets Code" data-id="rx3eU4qQ" run-on-load="true" style last-execution-state="success" __wid="fTuNue7w"><pre data-type="content" type="text/javascript" __wid="iCsyNKHk">const AssetUtils = require('#asset-utils');

/******************************************************************************/

/**
 * Returns true if the drop transfer types contain "Files", and returns false otherwise.
 *
 * @param {Object} event A drop event.
 *
 * @return True if the drop transfer types contain "Files" as type.
 */
const isFileDrop = (event) => {
  if (event.dataTransfer.types) {
    return event.dataTransfer.types.some((type) => type === "Files");
  }
  return false;
};

const handleFilesDrop = (event, content, files) => {

  // Get the position where file(s) where dropped
  const range = document.caretRangeFromPoint(event.clientX, event.clientY);

  /**
   * Called when asset uploaded completely
   */
  const onUploaded = (asset) => {
    const node = AssetUtils.getElementFromAsset(asset);

    const uploadInProgress = content.querySelector(`[data-asset-filename="${asset.fileName}"]`);

    if (uploadInProgress) {
      uploadInProgress.parentElement.replaceChild(node, uploadInProgress);
    } else {
      range.insertNode(node);
    }
  };

  /**
   * Called before asset is going to be uploaded
   */
  const onBeforeUpload = (asset) => {

    const node = AssetUtils.getElementFromAsset(asset);

    const uploadInProgress = document.createElement("transient");
    uploadInProgress.setAttribute("data-asset-filename", asset.fileName);
    uploadInProgress.setAttribute("class", "upload-in-progress");
    uploadInProgress.appendChild(node);

    range.insertNode(uploadInProgress);
  };

  /**
   * Called when an error occurs during drop
   */
  const onError = (error) => {
    toast(error);
  };

  AssetUtils.uploadFiles(files, onUploaded, onBeforeUpload, onError);
};

/******************************************************************************/

// prevent default behavior
window.addEventListener("dragover", (event) => {
  // only continue on file drop, which prevents file drop and redirect browser
  // to open dropped file
  if (!isFileDrop(event)) return;
  event.preventDefault();
});

// register drop handler on global document
window.addEventListener("drop", (event) => {

  // Only continue on file drop
  if (!isFileDrop(event)) return;

  // not sure what default behavior is, but safe is safe
  event.preventDefault();

  const target = event.target;
  const content = target.closest('.paragraph.body-paragraph [data-type="content"]');
  if (content) {
    // Handle file drop with uploaded, before upload, and error callbacks
    const files = Array.from(event.dataTransfer.files);
    handleFilesDrop(event, content, files);
  }
});

/******************************************************************************/

webstrate.on("asset", (asset) => {
  toast(`Asset "${asset.fileName}" was added`);
});</pre></div>

<div class="paragraph code-paragraph collapsed" name="Local File System for Upload Assets (unfinished)" draggable="false" data-id="ZbWviw3z" last-execution-state="success" style __wid="p58qXNzH"><pre data-type="content" type="text/javascript" __wid="GmCUkFn4">// https://developer.mozilla.org/en-US/docs/Web/API/File_and_Directory_Entries_API/Introduction

const requestedBytes = 1024 * 1024 * 100; // 100MB

// Taking care of the browser-specific prefix
window.requestFileSystem = window.requestFileSystem || window.webkitRequestFileSystem;

const errorHandler = (error) => {
	var msg = "";

	switch (error.code) {
		case FileError.QUOTA_EXCEEDED_ERR:
			msg = "QUOTA_EXCEEDED_ERR";
			break;
		case FileError.NOT_FOUND_ERR:
			msg = "NOT_FOUND_ERR";
			break;
		case FileError.SECURITY_ERR:
			msg = "SECURITY_ERR";
			break;
		case FileError.INVALID_MODIFICATION_ERR:
			msg = "INVALID_MODIFICATION_ERR";
			break;
		case FileError.INVALID_STATE_ERR:
			msg = "INVALID_STATE_ERR";
			break;
		default:
			msg = "Unknown Error";
			break;
	}

	console.error(`Error: ${msg}`, error);
};

const writeFile = async(fs, name, content, type = "text/plain") => {
	return new Promise((resolve, reject) => {
		fs.root.getFile(name, {
			create: true
		}, function (fileEntry) {

			// Create a FileWriter object for our FileEntry (log.txt).
			fileEntry.createWriter(function (fileWriter) {

				fileWriter.onwriteend = function (e) {
					console.log('Write completed.');
					resolve(e);
				};

				fileWriter.onerror = function (e) {
					console.log('Write failed: ' + e.toString());
					reject(e);
				};

				// Create a new Blob and write it to log.txt.
				var blob = new Blob([content], {
					type
				});

				fileWriter.write(blob);

			}, errorHandler);

		}, errorHandler);
	});
};

// Read file
const readFile = async(fs, name) => {
	return new Promise((resolve, reject) => {
		fs.root.getFile(name, {}, (fileEntry) => {

			// Get a File object representing the file,
			// then use FileReader to read its contents.
			fileEntry.file((file) => {
				var reader = new FileReader();

				reader.onloadend = function (e) {
					// var txtArea = document.createElement('textarea');
					// txtArea.value = this.result;
					// document.body.appendChild(txtArea);
					resolve(this.result);
				};

				// This was not part of the example and might not work
				// reader.onerror = function (e) {
				// 	console.log('Read failed: ' + e.toString());
				// 	reject(e);
				// };

				reader.readAsText(file);
			}, errorHandler);
		}, errorHandler);
	});
};

/**
 * name - the unique name assigned by the browser to the file system.
 * root - the read-only DirectoryEntry object representing the root of the file system.
 */
const onInitFs = (fs) => {
	console.log(fs);

	(async() => {
		let fileName = "foobar.txt";
		let content = "hello world"
		await writeFile(fs, fileName, content);
		let fileContent = await readFile(fs, fileName);

		console.log(`"${content}" === "${fileContent}"`, content === fileContent);
	})();
};

// The first parameter defines the type of storage: persistent or temporary
// Next, set the size of space needed (in bytes)
// initFs is the success callback
// And the last one is the error callback
// for denial of access and other errors.
window.requestFileSystem(window.TEMPORARY, requestedBytes, onInitFs, errorHandler);</pre></div><div class="paragraph style-paragraph collapsed" draggable="false" name="Drop Assets Style" data-id="smjHTJUJ" __wid="2QbLbCub"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="8MtqJBhH">html .paragraph [data-type="content"] .upload-in-progress {
	opacity: 0.25;
}

html .paragraph [data-type="content"] video,
html .paragraph [data-type="content"] img {
	max-width: 100%;
}</style></div></div><div name="Help Dialog" class="section section-hidden" data-type="system" data-id="33LePuGS" __wid="U5dcix5s"><div class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="wcNnbcmy" style draggable="false" __wid="ek7mrEnQ"><div data-type="content" contenteditable="false" class="section-documentation" type="text/html" codemirror="true" __wid="TzcwsnHQ"><h2 __wid="PDSA5qFv">Description</h2><div __wid="KtVX4qDh">Adds a help dialog, which can be opend pressing "F1" or using the "Help" entry in the global menu. The help dialog shows shortcuts and an introductory video about Codestrates.</div></div></div><div class="paragraph data-paragraph collapsed locked" name="Properties" data-id="Ji9ezFPZ" draggable="false" style __wid="exjTvthq"><pre data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="kkTHybWa">{
  "version": "1.3",
  "description": "Shows a help dialog with shortcuts and introductory video.",
  "changelog": {
    "1.0": "Initital Release",
    "1.1": "Adjusted to new dialog Material Design.",
    "1.2": "Commands API used.",
    "1.3": "Key bindings are read from Codestrate.keyBindings."
  }
}</pre></div><div class="paragraph code-paragraph collapsed" name="Help Dialog Code" data-id="wNKv7kCW" run-on-load="true" style last-execution-state="success" __wid="z3syCPjD"><pre data-type="content" type="text/javascript" __wid="xtGS7kGn">const GlobalMenuUtils = require("#global-menu-utils");

/******************************************************************************/

const getOSShortcuts = () => {

  const shortcutsArray = Codestrate.keyBindings.map((b) => {

    let key = b.key;
    if (Codestrate.OS.isMac()) {
      key = key.replace(/mod/gi, 'Cmd');
    }
    else {
      key = key.replace(/mod/gi, 'Ctrl');
    }

    const command = Codestrate.getCommand(b.id);
    const description = command.description && command.description !== "" ?
          command.description : command.name;

    return {
      key: key.toUpperCase(),
      description
    };
  });

  const shortcuts = {};
  shortcutsArray.forEach((s) => {
    shortcuts[s.key] = s.description;
  });

  return shortcuts;

//   if (Codestrate.OS.isMac()) {
//     return require("#shortcuts-mac").shortcuts;
//   }
//   return require("#shortcuts-pc").shortcuts;
};

const videoUrl = "Codestrates.mp4";

/******************************************************************************/

const toggleHelp = () => {
  const helpDialog = document.querySelector(".dialog.help");
  if (helpDialog) {
    const transient = helpDialog.parentElement;
    transient.remove();
  } else {
    showHelpDialog();
  }
};

const showHelpDialog = (packageStati) => {

  let shortcuts = getOSShortcuts();

  return new Promise((resolve, reject) => {

    const transient = document.createElement("transient");

    const elements = require("#dialog-template", {
      title: "Help",
      message: `&lt;div id="explanation">
			Codestrates is a research prototype for developing webstrates in a literate computing inspired fashion. It is still under heavy development, and may features are still experimental and undocumented. Below is a short list of the keyboard shortcuts available and a brief intro screencast to the basic features of Codestrates.&lt;br>&lt;br>
			Visit &lt;a href="https://webstrates.github.io" draggable="false">webtrates.github.io&lt;/a> for the documentation of &lt;a href="http://webstrates.net" draggable="false">Webstrates&lt;/a> and for more information about Codestrates visit &lt;a href="http://codestrates.org" draggable="false">codestrates.org&lt;/a>.
		&lt;/div>
		&lt;div id="shortcuts">
			&lt;div class="help-title">Shortcuts&lt;/div>
			&lt;ul>${Object.keys(shortcuts).map(key => `&lt;li>
&lt;span class="key">${key}&lt;/span>
&lt;span class="action">${shortcuts[key]}&lt;/span>
&lt;/li>`).join("")}&lt;/ul>
		&lt;/div>
		&lt;div id="intro">
			&lt;div class="help-title">Introduction video&lt;/div>
			&lt;div class="video">
				&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/7HedZZoFC-s?rel=0&showinfo=0" frameborder="0" allowfullscreen="">&lt;/iframe>
			&lt;/div>
		&lt;/div>`,
      actions: `&lt;div class="button close">Close&lt;/div>`,
      className: "help"
    });

    elements.forEach(e => transient.appendChild(e));

    const closeBtn = transient.querySelector(".close");

    const onClose = () => {
      transient.remove();
      resolve(true);
    };

    closeBtn.addEventListener("click", onClose);

    document.body.appendChild(transient);
  });
};

/******************************************************************************/

Codestrate.addCommand("codestrates.help", "Help", () => {
  toggleHelp();
});
Codestrate.addKeyBinding("codestrates.help", "f1", true);

GlobalMenuUtils.addButton("Help", "help-button", () => {
  Codestrate.executeCommand("codestrates.help");
});</pre></div><div class="paragraph style-paragraph collapsed" data-id="M5jKghq9" style name="Help Dialog Style" __wid="MYnykFmH"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="vNvnXsVv">html .dialog.help {
	z-index: 450;
}

html .dialog.help .body {
	width: 70rem;
	max-width: calc(100vw - 32px);
	max-height: calc(100vh - 180px);
}

html .dialog.help #explanation {
	margin-bottom: 24px;
}

html .dialog.help #shortcuts {
	width: 33%;
	float: left;
}

html .dialog.help #intro {
	margin-left: 35%;
}

/******************************************************************************/

html .dialog.help a {
	color: var(--color-secondary-text);
}

html .dialog.help .help-title {
	font-size: 24px;
	margin-bottom: 12px;
}

html .dialog.help #intro .video {
	width: 100%;
	text-align: center;
}

html .dialog.help #shortcuts li {
	margin-bottom: 16px;
}

html .dialog.help #shortcuts .key {
	margin: 0 5px 0 0;
	color: #eee;
	border-radius: 3px;
	padding: 3px 7px;
	min-width: 1em;
	box-shadow: inset 0 0 2px #5a5a5a, 0 0.1em 0.11em rgba(0, 0, 0, 0.9);
	cursor: default;
	background: #000;
	text-align: center;
	text-shadow: none;
	background-color: #101010;
	background-repeat: repeat-x;
	font-family: monospace;
	font-size: 14px;
}

html .dialog.help #shortcuts .action {
	line-height: 150%;
}

/******************************************************************************/

html #global-menu .help-button {
	order: 990;
}</style></div></div><div class="section section-hidden" name="Section Browser" data-type="system" data-id="4CsvECcC" data-group="editing" __wid="NZbVLb5i"><div class="paragraph body-paragraph locked collapsed" data-id="eRw5qerB" name="Documentation" style draggable="false" __wid="EwxaKqc3"><div data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="eANTBwmH"><h2 __wid="xmz2BjU4">Description</h2><div __wid="BYMyCbk2">This is a prototype implementation of a section browser in the side menu.</div><h2 __wid="GRVnQWHq">Usage</h2><div __wid="md6G6qBP"><ul __wid="PM42aWYv"><li __wid="6fqbJcwN">Click sections to expand/collapse</li><li __wid="iHjAwQfi">Click paragraph to scroll them into view</li><li __wid="HZcHgtQc">Click section eye to toggle visbility</li></ul><h2 __wid="bmJundwd">Bugs, ideas and ToDo</h2></div><div __wid="aSRkKm9X"><ul __wid="WhRhx2Ds"><li __wid="y7spbdS2"><strike __wid="9jHLQvWM">Refresh CodeMirror instances on visibility change</strike></li><li __wid="WchMTYfK"><strike __wid="WHFMY3Ft">Toggle visibility and expand paragraph when clicking a paragraph</strike></li><li __wid="RYyP6Jar">Integrate properly in Roman's sidebar code<br __wid="TfqK54WJ"/></li><li __wid="KctqKmTE"><strike __wid="27c79EM6">Overflow of sections with many paragraphs. Scrolling?</strike></li><li __wid="6n58hEc9">Disable scrolling of main window when scrolling in section tree. But how?</li></ul></div></div></div><div class="paragraph data-paragraph locked collapsed" data-id="b24ajcq7" name="Properties" __wid="3QYYNFzM"><pre data-type="content" type="application/json" contenteditable="false" class="section-properties" __wid="LjbEyNVw">{
	"version": "1.2.2",
	"description": "This is a prototype implementation of a section browser in the side menu.",
	"changelog":
	{
		"1.0": "Initital Release",
		"1.1": "Adjusted style a bit.",
		"1.2": "Added toggle to hide user, system or package sections.",
		"1.2.1": "Fixed issue with section-visible or section-hidden.",
		"1.2.2": "Fixed issue that would always add sections to the end of the section browser, although a section might be somewhere in-between other sections."
	}
}</pre></div>

<div class="paragraph body-paragraph collapsed" name="Description" style data-id="srnWpw3v" draggable="false" __wid="d2EMruiW"><div data-type="content" type="text/html" codemirror="true" contenteditable="true" __wid="G9cjsXYd"><h1 __wid="fpR8pe6i">Section browser</h1><div __wid="UdqsDXnt">This is a prototype implementation of a section browser in the side menu.</div><div __wid="EWhpriTN"><br __wid="6mW6PKPy"/></div><div __wid="jybL389Z">Usage:</div><div __wid="AsLVwvuU"><ul __wid="WUHsrXqx"><li __wid="UmpKitDE">Click sections to expand/collapse</li><li __wid="HJKbGFfy">Click paragraph to scroll them into view</li><li __wid="aNBARbLZ">Click section eye to toggle visbility</li></ul><div __wid="SHR4Jgjq">Bugs, ideas and ToDo</div></div><div __wid="qecbJVxR"><ul __wid="7c6f8ee4"><li __wid="7sWHmWR7"><strike __wid="kmmQ98R5">Refresh CodeMirror instances on visibility change</strike></li><li __wid="aFkc7tDJ"><strike __wid="ChbvZUh3">Toggle visibility and expand paragraph when clicking a paragraph</strike></li><li __wid="3Yt8HfwN">Integrate properly in Roman's sidebar code<br __wid="z6SX3c7W"/></li><li __wid="3Y2Q2jZg"><strike __wid="Kmnnu9Zx">Overflow of sections with many paragraphs. Scrolling?</strike></li><li __wid="QeQBFkPJ">Disable scrolling of main window when scrolling in section tree. But how?</li></ul></div></div></div><div class="paragraph code-paragraph collapsed" data-id="VyGHLw6Z" style name="Global Menu Section Tree" run-on-load="true" last-execution-state="success" draggable="false" __wid="HzvxzGMd"><pre data-type="content" type="text/javascript" __wid="tasxzCim">const GlobalMenuUtils = require("#global-menu-utils");

/******************************************************************************/

const sectionTree = document.createElement("ul");
sectionTree.id = "section-tree";

GlobalMenuUtils.addMenuItem(sectionTree);
GlobalMenuUtils.addDivider("section-tree");</pre></div>
<div class="paragraph code-paragraph collapsed" last-execution-state="success" name="Section Browser" run-on-load="true" style data-id="FDSSymJu" __wid="F2T2v2eN"><pre data-type="content" type="text/javascript" __wid="c6Q8gWmv">const SectionItem = function (section) {
  section.__sectionItem = this;
  this.section = section;
  // Create a list item for the section
  this.li = document.createElement("li");
  // Per default this is closed
  this.li.classList.add("closed");

  // Create an element indicating if a section is expanded or not
  this.expander = document.createElement("span");
  this.expander.classList.add("expander");
  this.expander.innerHTML = '&lt;i class="material-icons">keyboard_arrow_right&lt;/i>';
  this.li.appendChild(this.expander);

  // Create an element used for showing and toggling visibility
  this.visibility = document.createElement("span");
  this.visibility.classList.add("visibility");
  this.visibility.innerHTML = '&lt;i class="material-icons">&lt;/i>';
  this.li.appendChild(this.visibility);
  if (this.section.classList.contains("section-hidden")) {
    this.li.classList.add("hidden");
    this.visibility.firstChild.innerText = "visibility_off";
  } else {
    this.li.classList.add("visible");
    this.visibility.firstChild.innerText = "visibility";
  }

  // Create an element used for showing if a section is a system section
  this.type = document.createElement("span");
  this.type.classList.add("type");
  this.type.innerHTML = '&lt;i class="material-icons">&lt;/i>';
  this.li.appendChild(this.type);
  if (this.section.getAttribute("data-type")) {
    if (this.section.getAttribute("data-type") === "system") {
      this.li.setAttribute("data-type", "system");
    } else if (this.section.getAttribute("data-type") === "package") {
      this.li.setAttribute("data-type", "package");
    }
  }

  // Create the title of a section
  this.title = document.createElement("span");
  this.title.classList.add("title");
  var sectionName = this.section.getAttribute("name");
  this.title.innerText = sectionName && sectionName.length > 0 ? sectionName : "No Name";
  this.li.appendChild(this.title);

  // Create the list of paragraphs
  this.ul = document.createElement("ul");
  this.li.appendChild(this.ul);

  // Create all the paragraph objects
  this.createParagraphItems();

  // When clicking the list item it toggles open/clised
  this.li.addEventListener("click", (e) => {
    this.li.classList.toggle("closed");
    if (this.li.classList.contains("closed")) {
      this.expander.innerHTML = '&lt;i class="material-icons">keyboard_arrow_right&lt;/i>';
    } else {
      this.expander.innerHTML = '&lt;i class="material-icons">keyboard_arrow_down&lt;/i>';
    }
  });

  // If the visibility icon is clicked, visibility of the section is toggled
  this.visibility.addEventListener("click", (e) => {
    e.stopPropagation();

		// do not use this.section.classList.toggle("section-hidden"), otherwise it may break the style
		// under certain circumstances, e.g., when both classes are set or no class is set then the
		// section will remove or add both at the same time
    if (this.section.classList.contains("section-hidden")) {
      this.section.classList.remove("section-hidden");
      this.section.classList.add("section-visible");
    }
		else {
      this.section.classList.remove("section-visible");
      this.section.classList.add("section-hidden");
    }
  });

  // A mutation observer is used to observe changes to attributes and children
  this.mo = new MutationObserver(() => {
    this.ul.innerHTML = "";
    var sectionName = this.section.getAttribute("name");
    this.title.innerText = sectionName && sectionName.length > 0 ? sectionName : "No Name";
    if (this.section.classList.contains("section-hidden")) {
      this.li.classList.add("hidden");
      this.visibility.firstChild.innerText = "visibility_off";
    } else {
      this.li.classList.remove("hidden");
      this.visibility.firstChild.innerText = "visibility";

      // CodeMirror requires a refresh on the editor if any of the parent or container styles changed.
      var contents = Array.from(this.section.querySelectorAll('.paragraph:not(.collapsed) [data-type="content"]'));

      contents.forEach(content => {
        if (content && content.__editor && content.__editor.editor) {
          content.__editor.editor.refresh();
        }
      });
    }
    if (this.section.getAttribute("data-type")) {
      if (this.section.getAttribute("data-type") === "system") {
        this.li.setAttribute("data-type", "system");
      } else if (this.section.getAttribute("data-type") === "package") {
        this.li.setAttribute("data-type", "package");
      }
    } else {
      this.li.removeAttribute("data-type");
    }
    this.createParagraphItems();
  });

  this.mo.observe(this.section, {
    attributes: true,
    childList: true
  });
};

SectionItem.prototype.createParagraphItems = function () {
  Array.from(this.section.querySelectorAll(".paragraph")).forEach((paragraph) => {
    var paragraphItem = new ParagraphItem(paragraph);
    this.ul.appendChild(paragraphItem.li);
  });
};

var ParagraphItem = function (paragraph) {
  paragraph.__paragraphItem = this;
  this.paragraph = paragraph;

  // Create a list item for the paragraph
  this.li = document.createElement("li");

  // Create an element for showing and toggling collapse
  this.collapse = document.createElement("span");
  this.collapse.innerHTML = '&lt;i class="material-icons">&lt;/i>';
  this.collapse.classList.add("collapse");
  this.li.appendChild(this.collapse);
  if (this.paragraph.classList.contains("collapsed")) {
    this.collapse.firstChild.innerText = "radio_button_unchecked";
  } else {
    this.collapse.firstChild.innerText = "radio_button_checked";
  }

  // Create an element for the title of the paragraph
  this.title = document.createElement("span");
  this.title.classList.add("title");
  this.title.innerText = paragraph.getAttribute("name");
  this.li.appendChild(this.title);

  // Observe changes to the attributes of the paragraph
  this.mo = new MutationObserver(() => {
    this.title.innerText = paragraph.getAttribute("name");
    if (this.paragraph.classList.contains("collapsed")) {
      this.collapse.firstChild.innerText = "radio_button_unchecked";
    } else {
      this.collapse.firstChild.innerText = "radio_button_checked";
    }
  });

  this.mo.observe(this.paragraph, {
    attributes: true
  });

  // If the paragraph is clicked, scroll it into view
  this.li.addEventListener("click", (e) => {
    e.stopPropagation();
    this.paragraph.classList.remove("collapsed");
    this.paragraph.closest(".section").classList.remove("section-hidden");
    this.paragraph.scrollIntoView();
  });

  // If the visibility icon is clicked, visibility of the section is toggled
  this.collapse.addEventListener("click", (e) => {
    e.stopPropagation();
    this.paragraph.classList.toggle("collapsed");
  });
};

/******************************************************************************/

const tree = document.querySelector("#global-menu #section-tree");
tree.innerHTML = "";

var controls = document.createElement("div");
controls.classList.add("section-tree-controls");

var toggleUserSections = document.createElement("span");
toggleUserSections.title = "Toggle User Sections";
toggleUserSections.classList.add("toggle-user-sections");
toggleUserSections.innerHTML = '&lt;i class="material-icons">&lt;/i>';
toggleUserSections.addEventListener("click", () => {
  tree.classList.toggle("hide-user-sections");
});
controls.appendChild(toggleUserSections);

var togglePackageSections = document.createElement("span");
togglePackageSections.title = "Toggle Package Sections";
togglePackageSections.classList.add("toggle-package-sections");
togglePackageSections.innerHTML = '&lt;i class="material-icons">&lt;/i>';
togglePackageSections.addEventListener("click", () => {
  tree.classList.toggle("hide-package-sections");
});
controls.appendChild(togglePackageSections);
tree.classList.toggle("hide-package-sections");

var toggleSystemSections = document.createElement("span");
toggleSystemSections.title = "Toggle System Sections";
toggleSystemSections.classList.add("toggle-system-sections");
toggleSystemSections.innerHTML = '&lt;i class="material-icons">&lt;/i>';
toggleSystemSections.addEventListener("click", () => {
  tree.classList.toggle("hide-system-sections");
});
controls.appendChild(toggleSystemSections);
tree.classList.toggle("hide-system-sections");

tree.appendChild(controls);

/******************************************************************************/

const getSectionItem = (section) => {
	const sectionId = section.getAttribute("data-id");
  return tree.querySelector(`li[section-id="${sectionId}"]`);
};

/******************************************************************************/

const liveSectionSelector = document.liveQuerySelectorAll('.section');

liveSectionSelector.added((section) => {

	const sectionId = section.getAttribute("data-id");
  const sectionItem = new SectionItem(section);
  sectionItem.li.setAttribute("section-id", sectionId);

	// insert list item before next sibling or append it if there is no next
	// sibling
	const siblingSection = section.nextElementSibling;
	if (siblingSection) {
		const siblingSectionItem = getSectionItem(siblingSection);
		tree.insertBefore(sectionItem.li, siblingSectionItem);
	}
	else {
		tree.appendChild(sectionItem.li);
	}
});

liveSectionSelector.removed((section) => {
	const sectionItem = getSectionItem(section);
  if (sectionItem) {
		tree.removeChild(sectionItem);
	}
});</pre></div><div class="paragraph style-paragraph collapsed" name="Section Browser Style" draggable="false" data-id="6tj93nGL" __wid="XBPxzvJ9"><style data-type="content" type="text/css" codemirror="true" class="themable" __wid="PAU5bT3K">html #section-tree {
	margin: 0px;
	padding-left: 8px;
	padding-right: 16px;
	user-select: none;
	overflow: auto;
	list-style: none;
	order: 980;
	display: flex;
	flex-direction: column;
}

html hr.section-tree {
	order: 980;
}

/******************************************************************************/

html #section-tree li {
	color: var(--color-text-primary);
	vertical-align: middle;
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
	cursor: pointer;
	display: flex;
	align-items: center;
	flex-shrink: 0;
}

html #section-tree > li {
	flex-wrap: wrap;
}

html #section-tree .closed ul {
	display: none;
}

html #section-tree li.hidden {
	opacity: 0.5;
}

html #section-tree li .title {
	margin-left: 0.5em;
	vertical-align: middle;
	overflow: hidden;
	text-overflow: ellipsis;
}

html #section-tree > li > .title {
	max-width: 174px;
}

/* Fix for disappearing icons bug */
html #section-tree li i {
	display: flex;
}

html #section-tree li .type {
	margin-left: 5px;
}

html #section-tree li ul {
	width: 100%;
	display: flex;
	flex-direction: column;
	flex-wrap: nowrap;
}

/******************************************************************************/

html #section-tree li .type i:after,
html #section-tree .section-tree-controls .toggle-user-sections i:after {
	content: "person";
}

html #section-tree li[data-type="system"] .type i:after,
html #section-tree .section-tree-controls .toggle-system-sections i:after {
	content: var(--settings);
	font-family: "Material Design Icons";
}

html #section-tree li[data-type="package"] .type i:after,
html #section-tree .section-tree-controls .toggle-package-sections i:after {
	content: var(--cube-outline);
	font-family: "Material Design Icons";
}

/******************************************************************************/

html #section-tree .section-tree-controls {
	display: flex;
	justify-content: space-evenly;
	margin: 4px;
	flex-shrink: 0;
}

html #section-tree .section-tree-controls span {
	cursor: pointer;
}

html #section-tree.hide-user-sections .toggle-user-sections,
html #section-tree.hide-system-sections .toggle-system-sections,
html #section-tree.hide-package-sections .toggle-package-sections {
	opacity: 0.5;
}

html #section-tree.hide-user-sections li.hidden:not([data-type]),
html #section-tree.hide-system-sections li.hidden[data-type="system"],
html #section-tree.hide-package-sections li.hidden[data-type="package"] {
	display: none;
}</style></div></div><DIV class="section section-hidden" name="Permissions" data-type="package" data-group="basic" data-id="2acKLAiX" __wid="7UJkMF6n"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="V97VARVD" draggable="false" __wid="taBjFqnu"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="d42vD558"><H2 __wid="hch3vSfH">Description</H2>The permissions section adds a user interface to change permissions of the codestrate. The section adds a menu item to the global menu to access the permissions user interface through a dialog.</DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="6W7YshS2" style __wid="QcCbKuZE"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="Q7apCDpR">{
	"version": "1.2.1",
	"icon": "vpn_key",
	"description": "Adds an menu entry to change the permissions of the codestrate.",
	"tags": [
		"devtools"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.2.1": "Used Commands API.",
		"1.2": "Fixed conflict of permissions object on webstrate object by adding it to the Codestrate object instead.",
		"1.1.1": "Fixed submenu name of menu entry.",
		"1.1": "Added menu entry (was in Global Menu section before).",
		"1.0": "Initital Release"
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/2acKLAiX-Permissions"
	}
}</PRE></DIV>

<DIV class="paragraph code-paragraph collapsed" run-on-load="true" name="Permission Code" draggable="false" last-execution-state="success" data-id="Z643HnjW" style __wid="zwyb3N4K"><PRE data-type="content" type="text/javascript" __wid="wT7hfEf8">var Permissions = (function () {

	this.version = "0.0.3";

	/**
   * Clear all document permissions aka. removes data-auth attribute.
   */
	const clearPermissions = function () {
		const htmlElement = document.documentElement;
		delete htmlElement.dataset.auth;
	};

	/**
   * Get permissions object of current document.
   */
	this.get = function () {
		const htmlElement = document.documentElement;
		const auth = htmlElement.dataset.auth;
		return auth ? JSON.parse(auth) : [];
	};

	/**
   * Applies permissions to current document.
   * 
   * @param [] auth Array containing document permissions (e.g., [{username:"raedle",
   * provider:"github",permissions:"rw"}.{username:"anonymous",provider:"",
   * permissions:"r"}])
   */
	this.set = function (auth) {
		const htmlElement = document.documentElement;

		if (auth && auth.length) {
			htmlElement.dataset.auth = JSON.stringify(auth);
		}
		else {
			clearPermissions();
		}
	};

	/**
   * Grant permissions to username using the given authentication provider.
   * 
   * @param String username Username of user that is granted specific permissions to
   * the current document.
   * @param String permissions Document permissions for username (e.g., "r" or "rw").
   * @param String provider="" Authentication provider, e.g., "github" for GitHub.
   */
	this.grant = function (username, permissions, provider = "") {
		const auth = getPermissions();
		const userPermission = auth.find(item => item.username === username && item.provider === provider);
		if (userPermission) {
			userPermission.permissions = permissions;
		}
		else {
			auth.push({
				username,
				provider,
				permissions
			});
		}

		set(auth);
	};

	/**
   * @param String username Revoke permissions for username.
   * @param String provider="" Revoke permissions given the particular authentication provider.
   */
	this.revoke = function (username, provider = "") {
		const auth = getPermissions();
		const permissionIndex = auth.findIndex(item => item.username === username && item.provider === provider);
		if (permissionIndex > -1) {
			auth.splice(permissionIndex, 1);
		}

		set(auth);
	};

	/**
   * List permissions of current document.
   */
	this.list = function () {
		const auth = getPermissions();
		console.log("Document permissions");
		auth.forEach(({username, permissions, provider}) => {
			console.log("Username %s has %s permissions using %s provider.", username, permissions, provider);
		});
	};

	return this;
}).call({});

window.Codestrate.permissions = Permissions;</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Permissions Dialog" run-on-load="true" last-execution-state="success" data-id="NDi9y4Pu" style __wid="PfDUex95"><PRE data-type="content" type="text/javascript" __wid="w6KX9yuX">Codestrate.addCommand("permissions.showPermissions", "Show Permissions", () => {
	const transient = document.createElement("transient");
	transient.classList.add("permissions-dialog");

	const permissions = Codestrate.permissions.get();

	let content = `
	&lt;table>
		&lt;thead>
			&lt;th>Username&lt;/th>
			&lt;th>Provider&lt;/th>
			&lt;th>Permissions&lt;/th>
			&lt;th>Delete&lt;/th>
		&lt;/thead>
		&lt;tbody id="permissions-list">
			${permissions.map((p) => {
				return `&lt;tr class="permission">
									&lt;td class="username" contenteditable="true">${p.username}&lt;/td>
									&lt;td class="provider" contenteditable="true">${p.provider}&lt;/td>
									&lt;td class="permissions" contenteditable="true">${p.permissions}&lt;/td>
									&lt;td class="delete">
										&lt;i class="material-icons">delete&lt;/i>
									&lt;/td>
								&lt;/tr>`;
			}).join("")}
		&lt;/tbody>
	&lt;/table>`;

	const elements = require('#dialog-template', {
		title: "Codestrate permissions",
		message: content,
		actions: `
			&lt;div class="button add">Add&lt;/div>
			&lt;div class="button apply">Apply&lt;/div>
			&lt;div class="button close">Close&lt;/div>
		`,
		className: ""
	});

	elements.forEach(e => transient.appendChild(e));

	const addBtn = transient.querySelector('.add');
	const applyBtn = transient.querySelector('.apply');
	const closeBtn = transient.querySelector('.close');
	const list = transient.querySelector('#permissions-list');

	list.addEventListener("click", (event) => {
		const target = event.target;
		if (target.closest('.delete')) {
			let permission = target.closest('.permission');
			permission.remove();
		}
	});

	const add = () => {
		const newPermission = document.createElement("tr");
		newPermission.classList.add("permission");
		newPermission.innerHTML = `
			&lt;td class="username" contenteditable="true">&lt;/td>
			&lt;td class="provider" contenteditable="true">&lt;/td>
			&lt;td class="permissions" contenteditable="true">&lt;/td>
			&lt;td class="delete">
				&lt;i class="material-icons">delete&lt;/i>
			&lt;/td>
		`;
		list.appendChild(newPermission);
	};

	const apply = () => {
		let elementPermissions = Array.from(list.querySelectorAll('.permission'));
		let permissions = elementPermissions.map((p) => {
			return {
				username: p.querySelector('.username').textContent,
				provider: p.querySelector('.provider').textContent,
				permissions: p.querySelector('.permissions').textContent,
			};
		});

		const oldPermissions = Codestrate.permissions.get();
		Codestrate.permissions.set(permissions);
		toast("Applied new permissions", 5000, () => Codestrate.permissions.set(oldPermissions), "Undo");
	};

	const close = () => {
		transient.remove();
	};

	addBtn.addEventListener("click", add);
	applyBtn.addEventListener("click", apply);
	closeBtn.addEventListener("click", close);

	document.body.appendChild(transient);
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="yr7rUXQf" name="Global Menu Entry" draggable="false" style run-on-load="true" last-execution-state="success" __wid="GuPnYHA3"><PRE data-type="content" type="text/javascript" __wid="4pf8piBS">const GlobalMenuUtils = require('#global-menu-utils');

////////////////////////////////////////////////////////////////////////////////////////////////////

const showPermissions = GlobalMenuUtils.createButton("Show Permissions", null, () => {
	Codestrate.executeCommand("permissions.showPermissions");
});

////////////////////////////////////////////////////////////////////////////////////////////////////

GlobalMenuUtils.addMenuItemToSubMenu(showPermissions, "Codestrate");</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="n86qmxNM" name="Permissions Dialog Style" style __wid="Fgq4eaTy"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="CZ3kpwke">html .permissions-dialog .dialog table {
	width: 100%;
	border-collapse: collapse;
}

html .permissions-dialog .dialog td,
html .permissions-dialog .dialog th {
	padding: 8px;
	text-align: left;
	outline: none;
}

html .permissions-dialog .dialog tr:nth-child(even) {
	background: var(--color-primary-shade-2);
}

html .permissions-dialog .dialog tr:hover {
	background-color: var(--color-primary-shade-3);
}

html .permissions-dialog .delete {
	cursor: pointer;
}

html .permissions-dialog .delete:hover i {
	color: var(--material-color-red);
}</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="73QaAetS" name="Goto Paragraph" data-type="package" __wid="tBUHTeEC"><DIV class="paragraph body-paragraph locked collapsed" data-id="LVsc7BNx" name="Documentation" __wid="jcd5JxV3"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="9azp5DpF"><H2 __wid="g36EWTjU">Description</H2><DIV __wid="fri9F2vM">Adds a paragraph palette to the codestrate, which enables to search and scroll to paragraphs by their ID or name.</DIV><H3 __wid="hJCRvFE2">Search Options</H3><DIV __wid="HqhWvfcm">There are three search modes:</DIV><DIV __wid="NrV3S5vg"><UL __wid="STfEEGYh"><LI __wid="JJTjKfnC"><B __wid="gBcVAfkN">Name</B>: Searches for a name of a paragraph.</LI><LI __wid="2YNvPaHq"><B __wid="DHBf6WVX">ID</B>: Use the prefix <CODE __wid="vg6pSwBg">id:</CODE> to search for the ID of a paragraph.</LI><LI __wid="5NmpeBp3"><B __wid="4w3mifkx">Paragraph-ID</B>: Use the prefix <CODE __wid="yJYiDFYT">data-id:</CODE> to search for the <CODE __wid="TJzJaUjX">data-id</CODE> attribute of a paragraph.</LI></UL></DIV><H3 __wid="4dHQyCVh">Shortcut</H3><DIV __wid="cscTwwZe">The shortcut to focus the search is <KBD __wid="KvGeq5w7">Ctrl</KBD>+<KBD __wid="wfLbm4VE">P</KBD> on Windows and <KBD __wid="DEn3iJJw">Cmd</KBD>+<KBD __wid="yZPbd75R">P</KBD> on macOS.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" data-id="xtYuvXdc" name="Properties" __wid="LMJmWrSv"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="VEijcYX3">{
	"version": "2.0.1",
	"icon": "search",
	"description": "Adds a paragraph palette to the codestrate.",
	"tags": [
		"devtools"
	],
	"dependencies": [],
	"assets": [],
	"changelog":
	{
		"2.0.1": "Small fix for empty searches.",
		"2.0": "Converted to palette and used Commands API.",
		"1.0.3": "Updated to use cmd key on macOS.",
		"1.0.2": "Tag added.",
		"1.0.1": "Style only on toolbar active.",
		"1.0": "Initital Release"
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/73QaAetS-Goto_Paragraph"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="gRzxdfcE" name="Goto Paragraph Code" last-execution-state="success" run-on-load="true" __wid="WFFnaHaA"><PRE data-type="content" type="text/javascript" __wid="Tce7PKfZ">const PaletteUtils = require("#palette-utils");

/******************************************************************************/

const getLabel = (sec, par) => `${sec} > ${par}`;

const getListElement = (section, paragraph) => {
	return {
		label: getLabel(section.getAttribute("name"), paragraph.getAttribute("name")),
		value: `data-id:${paragraph.getAttribute("data-id")}`
	};
};

const action = (text) => {
	let paragraph;
	let content;

	if (text === "") {
		return;
	} else if (text.startsWith("data-id:")) {
		const dataId = text.substring(8);
		paragraph = document.querySelector(`.paragraph[data-id="${dataId}"]`);
		if (paragraph) content = paragraph.querySelector("[data-type='content']");

	} else if (text.startsWith("id:")) {
		const id = text.substring(3);
		content = document.querySelector(`#${id}[data-type="content"]`);
		if (content) paragraph = content.closest(".paragraph");

	} else {
		paragraph = document.querySelector(`.paragraph[name="${text}"]`);
		if (paragraph) content = paragraph.querySelector("[data-type='content']");
	}

	if (!paragraph || !content) {
		alert(`The paragraph "${text}" wasn't found.`, "Paragraph Not Found");
	} else {
		const section = paragraph.closest(".section");

		if (section) {
			section.classList.remove("section-hidden");
			section.classList.remove("collapsed");
			section.classList.add("section-visible");
		}

		paragraph.classList.remove("collapsed");

		Codestrate.simulateClick(paragraph);

		setTimeout(false, 0);
		paragraph.scrollIntoView({block: "start", behavior: "instant"});
		window.scrollBy(0, -74);
	}
};

/******************************************************************************/

const gotoParagraphPalette = PaletteUtils.addPalette(
	"goto-paragraph-palette", "label", "Paragraph",
	action, [],
	"gotoParagraph.togglePalette", "Goto Paragraph", "Opens the goto paragraph palette.",
	"mod+p", true);

/******************************************************************************/

document.liveQuerySelectorAll(".paragraph").added((paragraph) => {
	const section = paragraph.closest(".section");

	const listElement = getListElement(section, paragraph);

	gotoParagraphPalette.__addListElement(listElement);

	section.liveAttribute("name").changed((value, oldValue) => {
		listElement.label = getLabel(value, paragraph.getAttribute("name"));
	});

	paragraph.liveAttribute("name").changed((value, oldValue) => {
		listElement.label = getLabel(section.getAttribute("name"), value);
	});
});

document.liveQuerySelectorAll(".paragraph").removed((paragraph) => {
	const listElement = gotoParagraphPalette.__getList().find(el => el.value === `data-id:${paragraph.getAttribute("data-id")}`);
	gotoParagraphPalette.__removeListElement(listElement);
});</PRE></DIV></DIV><DIV class="section section-hidden" data-id="3ZTfwCvn" name="Command Palette" data-type="package" __wid="bXwjD3es"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="C4EcLr4a" __wid="5gxdKdcc"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="dE4Hunwb"><H2 __wid="h4Lcyav6">Description</H2><DIV __wid="H9yJ2pAA">Adds a command palette as a shortcut to the codestrate. The package relies on the Commands API of Codestrates.</DIV>
<UL __wid="6vTCxvpA">
	<LI __wid="UmphdUdZ">Windows: <KBD __wid="mrBPxKUK">Ctrl</KBD>+<KBD __wid="h7v3RVEy">Shift</KBD>+<KBD __wid="CdRmHicz">P</KBD></LI>
	<LI __wid="SLMm3Mxd">macOS: <KBD __wid="PRe74WX3">Cmd</KBD>+<KBD __wid="eV9QKAMD">Shift</KBD>+<KBD __wid="5M49f7YN">P</KBD></LI>
</UL></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="pmyY6GGq" __wid="BAZjZMjB"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="crsKJCZg">{
	"version": "1.1",
	"icon": "assistant",
	"description": "Adds a command palette as a shortcut to the codestrate.",
	"tags": [
		"devtools"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.1": "Incorporated new command map API.",
		"1.0.2": "Material ripple.",
		"1.0.1": "Shortcut on Windows ctrl and on macOS Cmd.",
		"1.0": "Initial version."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/3ZTfwCvn-Command_Palette"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="V4Wej5Cu" name="Command Palette Code" last-execution-state="success" run-on-load="true" __wid="czuGBjvA"><PRE data-type="content" type="text/javascript" __wid="WP52pz3W">const PaletteUtils = require("#palette-utils");

/******************************************************************************/

const getListElement = (command) => {
	return {
		label: command.name,
		value: command.id
	};
};

const action = (value) => Codestrate.executeCommand(value);

const list = Codestrate.commands.map(command => getListElement(command));

/******************************************************************************/

const commandPalatte = PaletteUtils.addPalette(
	"command-palette", "keyboard_arrow_right", "Command",
	action, list,
	"commandPalette.togglePalette", "Command Palette", "Opens the command palette.",
	"mod+shift+p", true);

/******************************************************************************/

window.addEventListener("CommandAdded", (event) => {
	if (event.detail) {
		commandPalatte.__addListElement(getListElement(event.detail));
	}
});

window.addEventListener("CommandRemoved", (event) => {
	if (event.detail) {
		commandPalatte.__removeListElement(getListElement(event.detail));
	}
});</PRE></DIV></DIV><DIV class="section section-hidden" data-id="3ZRvf4XW" name="Package Icons" data-type="package" __wid="UFNKicKp"><DIV class="paragraph body-paragraph collapsed locked" data-id="HBwJWPc8" name="Documentation" style __wid="Y5uULUUn"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="b3v9wzet"><H2 __wid="zG6GHpQy">Description</H2>
<DIV __wid="gPgWdpyN">Sidebar for managing of packages and package repositories.</DIV><H2 __wid="rije5p2a">Two Views</H2><DIV __wid="fkNVsDmz">The sidebar has two views: Packages and Repositories. In the packages view, which is the default view, one can see all packages of the selected repository as well as just locally installed packages. The user can switch between the views by pressing the indigo menu button on the top of the sidebar.</DIV><H2 __wid="dDJ6DGLw">Packages</H2><DIV __wid="FarFdS7i">Packages are displayed as a list of package icons. The color of the package icons indicate the current state (see list below). When hovering over an package a tooltip shows the name of the package. Three buttons allow for basic package routines: installing/updating, removing, pushing. The icon of each package can be set in the section-properties of each package.</DIV><DIV __wid="QQ3bxpTx">The "Refresh Packages List" makes it possible to update the package icons without having to reload the page (e.g. when there were updates on a repository). Local changes as adding packages or removing them is directly updated inside the package view.</DIV><H3 __wid="nkDg8NNp">Package Colors</H3><DIV __wid="DEjSvR8t">The color of the icon indicate the state of the package:</DIV><DIV __wid="hnGHwbLN"><UL __wid="vqF3KTyk"><LI __wid="hYZVGCQJ"><B style="color: rgb(238, 238, 238);" __wid="SVSs3PP7">Lightgrey</B>: Package is available on the prototype for download.</LI><LI __wid="8yQErFma"><B style="color: rgb(76, 175, 80);" __wid="ZYXpMtLf">Green</B>: The package is installed and up to date.</LI><LI __wid="P2ViyvZK"><B style="color: rgb(255, 152, 0);" __wid="7UkXindx">Orange</B>: The package is installed but has a changed version.</LI><LI __wid="2Qf4UGFz"><B style="color: rgb(0, 150, 136);" __wid="5MhaqFTp">Teal</B>: The package is installed but versions couldn't be compared with repository.</LI><LI __wid="xDWg3M6D"><B style="color: rgb(3, 169, 244);" __wid="FwveRnMU">Cyan</B>: The package is installed but not available in the repository.</LI><LI __wid="8jjBXnEK"><B style="color: rgb(66, 66, 66);" __wid="Wd96rFRi">Darkgrey</B>: Only persistent parts of the package are installed.</LI></UL><H2 __wid="hMe5bgyY">Repositories</H2></DIV><DIV __wid="2pk8nqYb">In the repositories view users can add, remove and select package repositories. The list of repositories is stored in a webstrate anywhere cookie. So currently one has to be logged in to add new repositories to your own list.</DIV><DIV __wid="4yeERvBa">Like package icons the repository icons allow to select them and thus update the package view or remove repositories from the list. The default package at the moment is "mb-packages".</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" data-id="sf8c5xPE" name="Properties" __wid="LpYJM6K6"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="mZKTqnWm">{
	"version": "1.2.1",
	"icon": "developer_board",
	"description": "Sidebar for packages.",
	"tags": [
		"devtools",
		"packages"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.2.1": "Fixed z-index to let the icons stay under the snackbar.",
		"1.2": "Renaming from stores to repositories.",
		"1.1": "Style fixes and global package store manager.",
		"1.0": "Initial Release"
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/3ZRvf4XW-Package_Icons"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="SfPkA4eF" draggable="false" style name="Package Icons Init" run-on-load="true" last-execution-state="success" __wid="N9XC9u9c"><PRE data-type="content" type="text/javascript" contenteditable="null" __wid="vyrAzyYN">const PackageIconsCode = require("#package-icons-code");

PackageIconsCode.initPackageIcons();</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="xnKWtfn4" draggable="false" style name="Package Icons Update" last-execution-state="success" run-on-load="true" __wid="2bFtbz3N"><PRE data-type="content" type="text/javascript" contenteditable="null" __wid="UfC3HLPg">const PackageIconsCode = require("#package-icons-code");

/******************************************************************************/

document.liveQuerySelectorAll(".section").added(element => {
	element.liveAttribute("data-type").changed((value, oldValue) => {
		if (oldValue === undefined) return;
		
		if (value === "package") {
			PackageIconsCode.showPackageIcon(element.getAttribute("data-id"));
		} else if (oldValue === "package") {
			PackageIconsCode.hidePackageIcon(element.getAttribute("data-id"));
		}
	});
});

document.liveQuerySelectorAll(".section[data-type='package']").removed(element => {
	PackageIconsCode.removePackageIcon(element.getAttribute("data-id"));
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="jEWEZ7ZT" name="Package Icons Code" style __wid="aaVjMiRX"><PRE data-type="content" type="text/javascript" id="package-icons-code" contenteditable="null" __wid="7R9kKTyN">const SectionPullingUtils = require("#section-pulling-utils");
const PackageManagementHelper = require("#package-management-helper");
const PackageRepositoryManager = require("#package-repository-manager");

/******************************************************************************/

const packageSectionQuerySelector = ".section[data-type='package']";

let currentPackages = [];

/******************************************************************************/

exports.initPackageIcons = async() => {
	let transient = document.querySelector("#package-icons");
	
	if (transient) return;
	
	transient = document.createElement("transient");
	transient.id = "package-icons";

	const packages = document.createElement("div");
	packages.id = "package-icons-packages";

	const repositories = document.createElement("div");
	repositories.id = "package-icons-repositories";
	repositories.classList.add("hidden");

	// Add Packages Menu
	const packagesMenu = createElement(["package-icon", "package-icon-menu"], false);
	
	const packagesSwap = createElement(["package-button", "package-button-swap"], () => {
		exports.togglePackagesRepositories();
	});

	const packagesRefresh = createElement(["package-button", "package-button-second", "package-button-refresh-packages"], () => {
		exports.refreshPackageIcons();
	});
	packagesRefresh.setAttribute("title", "Refresh Packages List");

	packagesMenu.appendChild(packagesRefresh);
	packagesMenu.appendChild(packagesSwap);
	packages.appendChild(packagesMenu);
	
	// Add Packages All Utility
	const packagesAll = createElement(["package-icon", "package-icon-all"], false);

	const packagesInstallAll = createElement(["package-button", "package-button-install-all"], async() => {
		const url = SectionPullingUtils.generatePullUrl(PackageRepositoryManager.currentPackageRepositoryName,
																										PackageRepositoryManager.currentPackageRepositoryTag);
		const iframe = await SectionPullingUtils.loadPrototype(url + "?exec=no");
		if (!iframe) return;

		// Extract packages from pulled Codestrate and remove it
		const prototypePackageSections = Array.from(
			iframe.contentWindow.document.querySelectorAll(packageSectionQuerySelector));
		const transient = iframe.parentNode;
		transient.remove();

		const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

		PackageManagementHelper.installAndUpdateSelectedPackages(prototypePackageSections, localPackageSections, currentPackages, url);
	});
	packagesInstallAll.setAttribute("title", "Install All Packages");

	const packagesRemoveAll = createElement(["package-button", "package-button-second", "package-button-remove-all"], () => {
		const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));
		PackageManagementHelper.removePackages(localPackageSections, currentPackages, true);
	});
	packagesRemoveAll.setAttribute("title", "Remove All Packages");

	packagesAll.appendChild(packagesInstallAll);
	packagesAll.appendChild(packagesRemoveAll);
	packages.appendChild(packagesAll);
	
	// Add repository Menu
	const repositoriesMenu = createElement(["package-icon", "package-icon-menu"], false);

	const repositoriesSwap = createElement(["package-button", "package-button-swap"], () => {
		exports.togglePackagesRepositories();
	});

	const repositoriesAdd = createElement(["package-button", "package-button-second", "package-button-add-repository"], async() => {
		// Open dialog for repository selection
		const pullData = await SectionPullingUtils.showPullSectionsDialog("", "HEAD", "Add Package Repository");
		if (!pullData) return;
		
		PackageRepositoryManager.addPackageRepository(pullData.pullFrom, pullData.pullVersion);
		exports.refreshRepositoryIcons();
	});
	repositoriesAdd.setAttribute("title", "Add Package Repository");

	repositoriesMenu.appendChild(repositoriesAdd);
	repositoriesMenu.appendChild(repositoriesSwap);
	repositories.appendChild(repositoriesMenu);

	transient.appendChild(packages);
	transient.appendChild(repositories);

	document.body.appendChild(transient);

	exports.refreshPackageIcons();
	exports.refreshRepositoryIcons();
};

/******************************************************************************/

exports.refreshPackageIcons = async() => {
	const packages = document.querySelector("#package-icons-packages");

	if (!packages) return;

	const refresh = document.querySelector(".package-button-refresh-packages");
	refresh.classList.add("refreshing");

	const oldPackageIconPackages = packages.querySelectorAll(".package-icon-package:not(.package-icon-menu)");
	oldPackageIconPackages.forEach(packageIconPackage => packages.removeChild(packageIconPackage));

	const newPackageIconPackages = await exports.getPackageIconPackages();
	if (Array.isArray(newPackageIconPackages)) {
		newPackageIconPackages.forEach(packageIconPackage => packages.appendChild(packageIconPackage));
	}

	refresh.classList.remove("refreshing");
};

/******************************************************************************/

exports.refreshRepositoryIcons = async() => {
	const repositories = document.querySelector("#package-icons-repositories");

	if (!repositories) return;

	const oldPackageIconRepositories = repositories.querySelectorAll(".package-icon-repository:not(.package-icon-menu)");
	oldPackageIconRepositories.forEach(packageIconRepository => repositories.removeChild(packageIconRepository));

	const newPackageIconRepositories = exports.getPackageIconRepositories();
	if (Array.isArray(newPackageIconRepositories)) {
		newPackageIconRepositories.forEach(packageIconRepository => repositories.appendChild(packageIconRepository));
	}
};

/******************************************************************************/

exports.getPackageIconPackages = () => {
	
	return new Promise((resolve, reject) => {
	
		(async() => {

			// Pull Codestrate in iFrame
			const url = SectionPullingUtils.generatePullUrl(PackageRepositoryManager.currentPackageRepositoryName,
																											PackageRepositoryManager.currentPackageRepositoryTag);
			const iframe = await SectionPullingUtils.loadPrototype(url + "?exec=no");
			if (!iframe) return;

			// Extract packages from pulled Codestrate and remove it
			const prototypePackageSections = Array.from(
					iframe.contentWindow.document.querySelectorAll(packageSectionQuerySelector));
			const transient = iframe.parentNode;
			transient.remove();

			const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

			currentPackages = prototypePackageSections.map(packageSection => packageSection.getAttribute("data-id"));

			// Get stati of packages
			const packageStati = SectionPullingUtils.getSectionStati(
				SectionPullingUtils.getMultipleSectionProperties(prototypePackageSections),
				SectionPullingUtils.getMultipleSectionProperties(localPackageSections));

			const packageIconPackages = [];

			packageStati.forEach(packageStatus => {
				const packageIconPackage = exports.getPackageIconPackage(packageStatus, url);
				packageIconPackages.push(packageIconPackage);
			});

			resolve(packageIconPackages);
		})();
	});
};

/******************************************************************************/

exports.getPackageIconPackage = (packageStatus, url = false) => {

	url = url || SectionPullingUtils.generatePullUrl(PackageRepositoryManager.currentPackageRepositoryName,
																									 PackageRepositoryManager.currentPackageRepositoryTag);

	// Create element
	const packageIconPackage = document.createElement("div");
	packageIconPackage.classList.add("package-icon", "package-icon-package");

	// Set attributes
	packageIconPackage.setAttribute("data-id", packageStatus.id);
	packageIconPackage.setAttribute("name", packageStatus.name);
	packageIconPackage.setAttribute("prototype", packageStatus.prototype);
	packageIconPackage.setAttribute("local", packageStatus.local);
	if (packageStatus.local) {
		packageIconPackage.setAttribute("uninstalled", packageStatus.localProperties.uninstalled);
	}
	packageIconPackage.setAttribute("version-changed", packageStatus.versionChanged);

	// Add label
	const label = document.createElement("div");
	label.classList.add("package-label");
	label.innerHTML = packageStatus.name;
	packageIconPackage.appendChild(label);

	// Add icon
	const icon = document.createElement("i");
	icon.classList.add("material-icons");
	if (packageStatus.icon) icon.innerHTML = packageStatus.icon;
	packageIconPackage.appendChild(icon);

	// Add uninstall and push buttons
	if (packageStatus.local) {
		if (!packageStatus.localProperties.uninstalled &&
				PackageRepositoryManager.currentPackageRepositoryTag === "HEAD") {
			const pushButton = createElement(["package-button", "push-package-button", "package-button-third"], async() => {
				const iframe = await SectionPullingUtils.loadPrototype(url + "?exec=no");
				if (!iframe) return;

				const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

				PackageManagementHelper.pushPackages(localPackageSections, [packageStatus.id], iframe, url);
			});
			packageIconPackage.appendChild(pushButton);
		}
		
		const removeButton = createElement(["package-button", "remove-package-button", "package-button-second"], () => {
			const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

			PackageManagementHelper.removePackages(localPackageSections, [packageStatus.id]);
		});
		packageIconPackage.appendChild(removeButton);
	}
	
	// Add install button
	if (packageStatus.prototype) {
		const installButton = createElement(["package-button", "install-package-button"], async() => {
			const iframe = await SectionPullingUtils.loadPrototype(url + "?exec=no");
			if (!iframe) return;

			// Extract packages from pulled Codestrate and remove it
			const prototypePackageSections = Array.from(
				iframe.contentWindow.document.querySelectorAll(packageSectionQuerySelector));
			const transient = iframe.parentNode;
			transient.remove();

			const localPackageSections = Array.from(document.querySelectorAll(packageSectionQuerySelector));

			PackageManagementHelper.installAndUpdateSelectedPackages(
				prototypePackageSections, localPackageSections, [packageStatus.id], url);
		});
		packageIconPackage.appendChild(installButton);
	} else {
		const installButton = createElement(["package-button", "install-package-button", "disabled"], false);
		packageIconPackage.appendChild(installButton);
	}
	
	return packageIconPackage;
};

/******************************************************************************/

exports.getPackageIconRepositories = () => {
	const packageRepositories = PackageRepositoryManager.packageRepositories;

	const packageIconRepositorys = [];

	if (Array.isArray(packageRepositories)) {
		packageRepositories.forEach(repository => {
			const packageIconRepository = exports.getPackageIconRepository(repository.packageRepositoryName, repository.packageRepositoryTag);
			packageIconRepositorys.push(packageIconRepository);
		});
	}

	return packageIconRepositorys;
};

/******************************************************************************/

exports.getPackageIconRepository = (packageRepositoryName, packageRepositoryTag) => {

	// Create element
	const packageIconRepository = document.createElement("div");
	packageIconRepository.classList.add("package-icon", "package-icon-repository");

	// Set attributes
	packageIconRepository.setAttribute("packageRepositoryName", packageRepositoryName);
	packageIconRepository.setAttribute("packageRepositoryTag", packageRepositoryTag);
	if ((packageRepositoryName === PackageRepositoryManager.currentPackageRepositoryName) &&
			(packageRepositoryTag === PackageRepositoryManager.currentPackageRepositoryTag)) {
		packageIconRepository.setAttribute("active",
				(packageRepositoryName === PackageRepositoryManager.currentPackageRepositoryName) &&
				(packageRepositoryTag === PackageRepositoryManager.currentPackageRepositoryTag));
	}

	const icon = document.createElement("i");
	icon.classList.add("material-icons");
	packageIconRepository.appendChild(icon);

	const label = document.createElement("div");
	label.classList.add("package-label");
	label.innerHTML = packageRepositoryName + " " + packageRepositoryTag;
	packageIconRepository.appendChild(label);

	const removeButton = createElement(["package-button", "remove-repository-button", "package-button-second"], () => {
		PackageRepositoryManager.removePackageRepository(packageRepositoryName, packageRepositoryTag);
		exports.refreshRepositoryIcons();
	});
	packageIconRepository.appendChild(removeButton);

	const selectButton = createElement(["package-button", "select-repository-button"], () => {
		PackageRepositoryManager.selectPackageRepository(packageRepositoryName, packageRepositoryTag);
		exports.refreshPackageIcons();
		exports.refreshRepositoryIcons();
	});
	packageIconRepository.appendChild(selectButton);

	return packageIconRepository;
};

/******************************************************************************/

exports.togglePackagesRepositories = () => {
	const packageIconsPackages = document.querySelector("#package-icons-packages");
	const packageIconsRepositories = document.querySelector("#package-icons-repositories");

	packageIconsPackages.classList.toggle("hidden");
	packageIconsRepositories.classList.toggle("hidden");
};

/******************************************************************************/

exports.removePackageIcon = (packageId) => {
	const packageIcon = document.querySelector(`.package-icon[data-id="${packageId}"]`);
	if (!packageIcon) return false;

	const parent = packageIcon.parentNode;
	parent.removeChild(packageIcon);
	return true;
};

/******************************************************************************/

exports.hidePackageIcon = (packageId) => {
	const packageIcon = document.querySelector(`.package-icon[data-id="${packageId}"]`);
	if (!packageIcon) return false;

	packageIcon.style.display = "none";
	return true;
};

exports.showPackageIcon = (packageId) => {
	const packageIcon = document.querySelector(`.package-icon[data-id="${packageId}"]`);
	if (!packageIcon) exports.refreshPackageIcons();

	packageIcon.style.display = "block";
	return true;
};

/******************************************************************************/

const createElement = (cssClasses, action) => {
	const element = document.createElement("div");
	element.classList.add(...cssClasses);
	if (typeof action === "function") element.addEventListener("click", action);

	const icon = document.createElement("i");
	icon.classList.add("material-icons");

	element.appendChild(icon);

	return element;
};

/******************************************************************************/

const getRandomColor = () => {
  var letters = '0123456789ABCDEF';
  var color = '#';
  for (var i = 0; i &lt; 6; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
};</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="4BGSHqL7" name="Package Icons Style" style __wid="LnuaTt2y"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" contenteditable="null" __wid="txtupG9k">html #package-icons {
	position: fixed;
	right: 0;
	top: 0;
	height: 100vh;
	width: 240px;
	transition: transform 250ms ease-in-out 0s;
	z-index: 25;
	transform: translate(200px, 0);
	overflow: auto;
}

html #package-icons::-webkit-scrollbar,
html #package-icons #package-icons-packages::-webkit-scrollbar,
html #package-icons #package-icons-repositories::-webkit-scrollbar {
  display: none;
}

html #package-icons:hover {
	transform: translate(0, 0);
}

/******************************************************************************/

html #package-icons #package-icons-packages,
html #package-icons #package-icons-repositories {
	position: fixed;
	top: 0;
	right: 0;
	overflow: auto;
	height: 100%;
	width: 100%;
	transition: transform 250ms ease-in-out 0s,
							opacity 250ms ease-in-out 0s,
							padding-top var(--navigation-transition);
	padding-top: 64px;
}

html body[transient-toolbar-hidden="true"] #package-icons #package-icons-packages,
html body[transient-toolbar-hidden="true"] #package-icons #package-icons-repositories {
	padding-top: 0;
}

html #package-icons #package-icons-packages.hidden,
html #package-icons #package-icons-repositories.hidden {
	transform: translate(240px, 0);
	opacity: 0;
}

/******************************************************************************/

html #package-icons .package-icon,
html #package-icons .package-button {
	border-radius: 50%;
	height: 64px;
	width: 64px;
	text-align: center;
	line-height: 64px;
	overflow: hidden;
	display: flex;
	justify-content: center;
	align-items: center;
}

/******************************************************************************/

html #package-icons .package-icon {
	position: relative;
	margin: 16px 8px 16px 160px;
	overflow: visible;
	background: var(--material-color-grey-200);
	color: var(--material-color-grey-900);
	animation: show 150ms ease-in-out;
	animation-fill-mode: forwards;
	box-shadow: var(--material-shadow-z2);
}
@keyframes show {
	0% {
		transform: translate(128px, 0);
	}
	100% {
		transform: translate(0, 0);
	}
}

/******************************************************************************/

html #package-icons .package-button-refresh-packages i {
	animation: spin 1000ms linear infinite;
	animation-play-state: paused;
}

html #package-icons .package-button-refresh-packages.refreshing i {
	animation-play-state: running;
}
@keyframes spin {
	100% {
		transform: rotate(-360deg);
	}
}

/******************************************************************************/

html #package-icons .package-icon .package-label {
	position: absolute;
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	display: none;
	height: 28px;
	line-height: 24px;
	padding: 2px 6px;
	font-size: 14px;
	background: #000000;
	color: #FFFFFF;
	max-width: 192px;
	transform: translate(-45%, -60px) rotate(4deg);
}

html #package-icons .package-icon:hover .package-label {
	display: inline-block;
}

/******************************************************************************/

html #package-icons .package-icon .package-button {
	position: absolute;
	top: 0;
	left: 0;
	color: var(--material-color-white);
	cursor: pointer;
	opacity: 0;
	transform: translate(0, 0);
	box-shadow: inset 0 0 100px 100px rgba(255, 255, 255, 0),
		var(--material-shadow-z2);
	transition: opacity 150ms ease-in-out 250ms,
		transform 150ms ease-in-out 250ms,
		box-shadow var(--navigation-transition);
}

html #package-icons .package-icon:hover .package-button {
	opacity: 1;
}

html #package-icons .package-icon .package-button:hover {
	box-shadow: inset 0 0 100px 100px rgba(255, 255, 255, 0.25),
		var(--material-shadow-z8);
}

html #package-icons .package-icon:hover .package-button-second {
	transform: translate(-72px, 0);
}
	
html #package-icons .package-icon:hover .package-button-third {
	transform: translate(-144px, 0);
}

/******************************************************************************/

html #package-icons .material-icons {
	font-size: 32px;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="2Chhy49u" name="Package Icons State Colors" __wid="dN5LCw9Y"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" contenteditable="null" __wid="aiteLCEW">html #package-icons .package-icon-package[local="true"][version-changed="false"] {
	background: var(--material-color-green);
	color: var(--material-color-white);
}

html #package-icons .package-icon-package[local="true"][version-changed="true"] {
	background: var(--material-color-orange);
	color: var(--material-color-white);
}

html #package-icons .package-icon-package[local="true"][version-changed="undefined"] {
	background: var(--material-color-teal);
	color: var(--material-color-white);
}

html #package-icons .package-icon-package[local="true"][uninstalled="true"] {
	background: var(--material-color-grey-800) !important;
	color: var(--material-color-white);
}

html #package-icons .package-icon-package[local="true"][prototype="false"] {
	background: var(--material-color-light-blue);
	color: var(--material-color-white);
}

html #package-icons .package-icon-repository[active="true"] {
	background: var(--material-color-green);
	color: var(--material-color-white);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="4YhsGV4U" name="Package Icons Button Colors" style __wid="ixuQTufp"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" contenteditable="null" __wid="h7GpG4rX">html #package-icons .package-icon-menu,
html #package-icons .package-icon-all {
	background: var(--material-color-indigo);
	color: var(--material-color-white);
}

html #package-icons .package-button-refresh-packages {
	background: var(--material-color-indigo);
}

html #package-icons .package-button-add-repository {
	background: var(--material-color-indigo);
}

html #package-icons .package-button-swap {
	background: var(--material-color-indigo);
}

/**************************************************************************************************/

html #package-icons .package-icon .package-button.disabled {
	background: var(--material-color-grey-800) !important;
	cursor: default;
}

html #package-icons .package-icon .package-button.disabled:hover {
	box-shadow: var(--material-shadow-z2);
}

/**************************************************************************************************/

html #package-icons .package-icon .install-package-button,
html #package-icons .package-icon[local="true"][uninstalled="true"] .install-package-button,
html #package-icons .package-icon .select-repository-button,
html #package-icons .package-icon .package-button-install-all {
	background: var(--material-color-green);
}

html #package-icons .package-icon[local="true"][uninstalled="false"][version-changed="true"] .install-package-button {
	background: var(--material-color-orange);
}

html #package-icons .package-icon[local="true"][uninstalled="false"][version-changed="undefined"] .install-package-button {
	background: var(--material-color-teal);
}

html #package-icons .package-icon .remove-package-button,
html #package-icons .package-icon .remove-repository-button,
html #package-icons .package-icon .package-button-remove-all {
	background: var(--material-color-red);
}

html #package-icons .package-icon .push-package-button {
	background: var(--material-color-light-blue);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="eW5ajidK" name="Package Icons Material Icons" draggable="false" style __wid="wmHCpnzy"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" contenteditable="null" __wid="2pXFJUkf">html #package-icons .package-icon-menu i:after {
	content: "menu";
}

html #package-icons .package-icon-all > i:after {
	content: var(--database);
	font-family: "Material Design Icons";
}

html #package-icons .package-button-refresh-packages i:after {
	content: "cached";
}

html #package-icons .package-button-add-repository i:after {
	content: "add";
}

html #package-icons .package-button-swap i:after {
	content: "swap_horiz";
}

html #package-icons .package-icon .package-button-install-all i:after  {
	content: "done_all";
}

html #package-icons .package-icon .package-button-remove-all i:after {
	content: "clear_all";
}

/**************************************************************************************************/

html #package-icons .package-icon.package-icon-package > i:empty:after {
	content: var(--cube-outline);
	font-family: "Material Design Icons";
}

html #package-icons .package-icon.package-icon-repository > i:after {
	content: var(--database);
	font-family: "Material Design Icons";
}

html #package-icons .package-icon .install-package-button i:after,
html #package-icons .package-icon[local="true"][uninstalled="true"] .install-package-button i:after{
	content: "file_download";
}

html #package-icons .package-icon .select-repository-button i:after {
	content: "check";
}

html #package-icons .package-icon[local="true"] .install-package-button i:after {
	content: "update";
}

html #package-icons .package-icon .remove-package-button i:after,
html #package-icons .package-icon .remove-repository-button i:after {
	content: "delete";
}

html #package-icons .package-icon .push-package-button i:after {
	content: "file_upload";
}</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="eZRsryZi" name="Duplicate Section or Paragraph" data-type="package" __wid="WPh8fKUe"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="bGHX5t5C" __wid="uLizNPXu"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="BrdLTmBB"><H2 __wid="S5SMRS7F">Description</H2><DIV __wid="9YrWyu2P">A small utility to duplicate sections or paragraphs.</DIV><H3 __wid="mf8gx3fr">Usage</H3><DIV __wid="ybxMR7xA">Select a section or paragraph and press the "Duplicate" button in the snackbar or the <KBD __wid="VR4AnE2Q">Mod</KBD> + <KBD __wid="qa8fUg7V">J</KBD> shortcut.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="M4Nth7zW" __wid="j8qidfwN"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="apGpApkU">{
  "version": "1.0",
  "icon": "content_copy",
  "description": "A small utility to duplicate sections or paragraphs.",
  "tags": [
    "utility"
  ],
  "assets": [],
  "dependencies": [],
  "changelog": {
    "1.0": "Initial version."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/eZRsryZi-Duplicate_Section_or_Paragraph"
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="R8yEyfwg" name="Duplicate Code" run-on-load="true" last-execution-state="success" __wid="ASLE5XGB"><PRE data-type="content" type="text/javascript" __wid="c6uPKULK">const SnackbarUtils = require("#snackbar-utils");

/******************************************************************************/

const duplicateElement = () => {
  let section = false;

  // Find section or paragraph
  let element = Codestrate.focussedParagraph;
  if (!element) {
    element = Codestrate.focussedSection;
    section = true;
  }

  if (!element) {
    alert("No section or paragraph selected.", "Duplicate Section or Paragraph");
    return;
  }

  // Clone element and remove selection attribute and data-ids
  const clone = element.cloneNode(true);

  clone.querySelectorAll("transient").forEach((transient) => transient.remove());
  clone.querySelectorAll(".paragraph[data-id]").forEach((dataId) => dataId.removeAttribute("data-id"));
  clone.removeAttribute("data-id");
  clone.removeAttribute("transient-focussed");

  // Insert clone after element
  element.parentNode.insertBefore(clone, element.nextSibling);

  // Display toast with undo action
  const name = element.getAttribute("name");
  toast(`Duplicated ${section ? "section" : "paragraph"} "${name ? name : "No Name"}"`, 5000, () => {
    clone.remove();
  }, "Undo");
};

Codestrate.addCommand("duplicate.duplicate", "Duplicate Section or Paragraph", () => duplicateElement());
Codestrate.addKeyBinding("duplicate.duplicate", "mod+j", true);

SnackbarUtils.addButton("Duplicate", "content_copy", "section-tools", 1, () => duplicateElement());</PRE></DIV></DIV><DIV class="section section-hidden" data-id="TPGAKXVN" name="User KeyBindings" data-type="package" __wid="MfqBA7tP"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="ym3gJGjR" __wid="LBjsdnR5"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="7dmfydtv"><H2 __wid="T4P23D77">Description</H2><DIV class="info" __wid="97Uj4MNM"><B __wid="VLGKzNsx">Note</B>: This package requires users to be logged into the Webstrates server using for example GitHub.</DIV><DIV __wid="Nh8sAQgE">This package allows to define user specific keybindings. It is possible to bind new keybindings and unbind existing bindings. The bindings are stored within the Webstrates Anywhere Cookies (<A href="https://webstrates.github.io/userguide/api/cookies.html" target="_blank" __wid="DCFJLUDS">more information</A>). There it is <B __wid="xjW6F6mp">required </B>to be logged in using for example GitHub.</DIV><H3 __wid="tRiPDHRH">Editing User Keybindings</H3><DIV __wid="y3StrPsJ">In order to modify user keybindings, one has to create a data paragraph and content in the structure as seen in the example. When finished the keybindings can be saved into the Webstrates cookie using the "Save from Paragraph" menu entry. The "Load into Paragraph" in return loads existing user keybindings from the Webstrates cookie into a data paragraph.</DIV><DIV __wid="AsnEqma6">After saving keybindings the codestrate needs to be reloaded in order to apply them.</DIV><H3 __wid="YjNWA6Md">Examples</H3><DIV __wid="pa9zk8La">The following code shows an example of user keybindings in a data paragraph:</DIV><PRE __wid="jVqgAaSh"><CODE __wid="gXhcAz6Z">{
  "bind": [
    {
      "id": "codestrates.toggleMenu",
      "key": "mod+m",
      "preventDefault": true
    }
  ],
  "unbind": [
    {
      "id": "codestrates.fullscreen",
      "key": "ctrl+shift+f"
    }
  ]
}</CODE></PRE>
<DIV __wid="JweFsCC9">The above code performs the following changes:</DIV>
<UL __wid="RgzFcBRz">
	<LI __wid="78hMfTSJ">It binds <KBD __wid="cQDnw5B9">mod</KBD>+<KBD __wid="MynGz75L">m</KBD> to toggle the menu.</LI>
	<LI __wid="ZPiE44LR">It unbinds <KBD __wid="58amWX53">ctrl</KBD>+<KBD __wid="jTLchV8z">shift</KBD>+<KBD __wid="KFKqaUsK">f</KBD> to no longer toggle fullscreen.</LI>
</UL></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="XPSn79ye" __wid="kcReVRYm"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="8DkZGVvW">{
	"version": "1.0.3",
	"icon": "keyboard",
	"description": "Utility to overwrite keybindings with user defined bindings.",
	"tags": [
		"devtools"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initial version.",
		"1.0.1": "Added check if codestrate has already loaded to trigger initialize user key bindings, which is important if the package is installed after the window.addEventListener(\"codestrateloaded\", () => {}) event was triggered.",
		"1.0.2": "Using the new codestrate event loaded to initialize user key binding functionality.",
    "1.0.3": "Fixed a bug causing the undo of toasts not working."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/TPGAKXVN-User_KeyBindings"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="czB3DRtw" name="User KeyBindings Code" run-on-load="true" last-execution-state="success" __wid="YSNijhZ7"><PRE data-type="content" type="text/javascript" __wid="d6hvXJVY">const GlobalMenuUtils = require("#global-menu-utils");

/******************************************************************************/

const userKeyBindingsKey = "user-keybindings";
const dialogTitle = "User KeyBindings";

/******************************************************************************/

const getUserKeyBindings = () => {
  if (!webstrate.user.cookies) {
    alert("No user cookies available!", dialogTitle);
    return false;
  } else {
    return webstrate.user.cookies.anywhere.get(userKeyBindingsKey);
  }
};

const setUserKeyBindings = (userKeyBindings) => {
  if (!webstrate.user.cookies) {
    alert("No user cookies available!", dialogTitle);
    return false;
  } else {
    return webstrate.user.cookies.anywhere.set(userKeyBindingsKey, userKeyBindings);
  }
};

/******************************************************************************/

const initializeUserKeyBindings = () => {
  const userKeyBindings = getUserKeyBindings();
  if (userKeyBindings) {
    if (userKeyBindings.bind) {
      userKeyBindings.bind.forEach(binding => {
        Codestrate.addKeyBinding(binding.id, binding.key, binding.preventDefault);
      });
    }
    if (userKeyBindings.unbind) {
      userKeyBindings.unbind.forEach(binding => {
        Codestrate.removeKeyBinding(binding.id, binding.key);
      });
    }
  } else {
    console.log("Couldn't load user keybindings.");
  }
};

Codestrate.addEventListener("loaded", initializeUserKeyBindings);

/******************************************************************************/

Codestrate.addCommand("userKeyBindings.saveFromParagraph", "Save User KeyBindings from Paragraph", () => {
  if (Codestrate.focussedParagraph && Codestrate.focussedParagraph.classList.contains("data-paragraph")) {
    const oldKeyBindings = getUserKeyBindings();

    setUserKeyBindings(JSON.parse(Codestrate.focussedParagraph.querySelector("[data-type='content']").innerHTML));

    toast("Saved User Keybindings", 5000, () => {
      setUserKeyBindings(oldKeyBindings);
    }, "Undo");
  } else {
    alert("Select a data paragraph to save user keybindings from.", dialogTitle);
    return false;
  }
});

Codestrate.addCommand("userKeyBindings.loadIntoParagraph", "Load User KeyBindings into Paragraph", () => {
  if (Codestrate.focussedParagraph && Codestrate.focussedParagraph.classList.contains("data-paragraph")) {
    const content = Codestrate.focussedParagraph.querySelector("[data-type='content']");
    const textNode = content.firstChild;
    const oldContent = textNode.cloneNode().textContent;

    textNode.textContent = JSON.stringify(getUserKeyBindings(), null, 2);
    content.__editor.editor.refresh();

    toast("Loaded User Keybindings", 5000, () => {
      textNode.textContent = oldContent;
    }, "Undo");
  } else {
    alert("Select a data paragraph to load user keybindings into.", dialogTitle);
    return false;
  }
});

/******************************************************************************/

GlobalMenuUtils.addButtonToSubMenu("Save from Paragraph", false, () => Codestrate.executeCommand("userKeyBindings.saveFromParagraph"), dialogTitle);
GlobalMenuUtils.addButtonToSubMenu("Load into Paragraph", false, () => Codestrate.executeCommand("userKeyBindings.loadIntoParagraph"), dialogTitle);</PRE></DIV></DIV><DIV class="section section-hidden" data-id="WN87HJGR" name="Publish" data-type="package" __wid="eGhRKFGK"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="VHrysbyw" __wid="aUpsBB4Z"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="e83JHppq"><H2 __wid="s3V4fmgK">Description</H2><DIV __wid="fzGQP2FQ">Publish contents of multiple paragraphs in one.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="NUTZuegE" __wid="EH6qnPa2"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="vMmEWk5Y">{
	"version": "1.1",
	"icon": "call_merge",
	"description": "Publish contents of multiple paragraphs in one.",
	"tags": [
		"utility",
		"body paragraphs"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.1": "Updated icon.",
		"1.0": "Initial version."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/WN87HJGR-Publish"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="Vqy8sRNV" name="Publish Code" run-on-load="true" last-execution-state="success" __wid="TrMk3aHc"><PRE data-type="content" type="text/javascript" __wid="5Ttnbxbt">const GlobalToolbarUtils = require("#global-toolbar-utils");
const ParagraphUtils = require("#paragraph-utils");

/******************************************************************************/

GlobalToolbarUtils.addDivider();
GlobalToolbarUtils.addButton("Publish", "", "publish-button", 1, () => {
	const section = document.createElement("div");
	section.classList.add("section", "section-visible");
	section.setAttribute("name", "Publish Section");

	const paragraph = ParagraphUtils.createBodyParagraph();
	paragraph.setAttribute("name", "Publish Paragraph");

	const content = paragraph.querySelector("[data-type='content']");
	content.classList.add("publish", "writing");
	content.setAttribute("contenteditable", "false");

	const contents = Array.from(document.querySelectorAll(".section.section-visible:not(.collapsed) > .body-paragraph:not(.collapsed) > [data-type='content']:not(.publish)"));

	if (!contents || contents.length === 0) {
		alert("No visible body-paragraphs available!", "Publish");
		return false;
	}

	for (let i = 0; i &lt; contents.length; i++) {
		const currentContent = contents[i];
		const currentParagraph = currentContent.parentNode;

		const div = document.createElement("div");
		div.setAttribute("publish-name", currentParagraph.getAttribute("name"));
		div.setAttribute("publish-data-id", currentParagraph.getAttribute("data-id"));

		if (currentContent.getAttribute("class")) div.setAttribute("class", currentContent.getAttribute("class"));
		div.innerHTML = currentContent.innerHTML;

		content.appendChild(div);
	}

	const sections = document.querySelector("#sections");
	section.appendChild(paragraph);
	sections.appendChild(section);

	toast("Published paragraphs", 5000, () => {
		section.remove();
	}, "Undo");
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="xbGqyCRE" name="Publish Style" __wid="MVAmuJRc"><STYLE data-type="content" type="text/css" codemirror="true" __wid="vPw4wkdT">html #global-toolbar .publish-button i:after {
	content: var(--call-merge);
	font-family: "Material Design Icons";
}

html .fullscreen:not([transient-fullscreen="true"]) .publish[data-type="content"] > div,
html [transient-fullscreen="true"]:not(.fullscreen) .publish[data-type="content"] > div {
	max-width: 960px;
	margin: 0 auto;
}</STYLE></DIV></DIV><DIV class="section section-hidden" name="Text Tools" data-type="package" data-id="jFx9fAE8" __wid="SDt9bi9G"><DIV class="paragraph body-paragraph locked collapsed" data-id="xTzmxJRa" name="Documentation" __wid="ihEn8GgA"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="G7wPu2bX"><H2 __wid="ZeLssSM2">Description</H2><P __wid="5UYeDBsd">Adds rich-text editing capabilities for body-paragraphs.</P></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" data-id="n3EQSCGL" name="Properties" __wid="EShDGM6S"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="J4wxigA9">{
	"version": "1.1",
	"icon": "text_fields",
	"description": "Adds rich-text editing capabilities for body-paragraphs.",
	"tags": [
		"text editing",
		"body paragraphs"
	],
	"assets": [],
	"dependecies": [],
	"changelog":
	{
		"1.1": "Moved Text Tools to the snackbar.",
		"1.0": "Initital Release"
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/jFx9fAE8-Text_Tools"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="kD6z77Dn" name="Text Tools Code" run-on-load="true" last-execution-state="success" draggable="false" style __wid="stx2YnAN"><PRE data-type="content" type="text/javascript" __wid="aJ28XBeK">const SnackbarUtils = require("#snackbar-utils");
const SnackbarTools = require("#snackbar-tools");
const AssetUtils = require("#asset-utils");

/******************************************************************************/

const toolsName = "body-content-tools";

/******************************************************************************/

const addBodyActionButton = (title, icon, className, action, formatBlock = false) => {
	let button;

	if (typeof action === "string") {
		button = SnackbarUtils.createButton(title, icon, toolsName + " " + className, () => document.execCommand(action, null, formatBlock));
	} else if (typeof action === "function") {
		button = SnackbarUtils.createButton(title, icon, toolsName + " " + className, action);
	} else {
		return;
	}

	// Need to prevent mousedown and touchstart or otherwise the event does not work
	button.addEventListener("mousedown", (event) => event.preventDefault());
	button.addEventListener("touchstart", (event) => event.preventDefault());

	SnackbarUtils.addSnackbarItem(button, -1);
};

/******************************************************************************/

SnackbarTools.addTools((target) => {
	const content = target.closest("[data-type='content']");
	return (content &&
					content.getAttribute("type") === "text/html" &&
					content.getAttribute("contenteditable") === "true");
}, toolsName);

/******************************************************************************/

addBodyActionButton("Bold", "format_bold", "", "bold");
addBodyActionButton("Italic", "format_italic", "", "italic");
addBodyActionButton("Underline", "format_underline", "", "underline");
addBodyActionButton("Strikethrough", "format_strikethrough", "", "strikethrough");

SnackbarUtils.addDivider(-1, "body-content-tools");

addBodyActionButton("Insert Bullet List", "format_list_bulleted", "", "InsertUnorderedList");
addBodyActionButton("Insert Numbered List", "format_list_numbered", "", "InsertOrderedList");
addBodyActionButton("Increase Indent", "format_indent_increase", "", "indent");
addBodyActionButton("Decrease Indent", "format_indent_decrease", "", "outdent");

SnackbarUtils.addDivider(-1, "body-content-tools");

addBodyActionButton("Paragraph", "", "format-p-button", "formatBlock", "&lt;div>");
addBodyActionButton("Header 1", "", "format-h1-button", "formatBlock", "&lt;h1>");
addBodyActionButton("Header 2", "", "format-h2-button", "formatBlock", "&lt;h2>");
addBodyActionButton("Header 3", "", "format-h3-button", "formatBlock", "&lt;h3>");

SnackbarUtils.addDivider(-1, "body-content-tools");

addBodyActionButton("Clear Formatting", "format_clear", "", (event) => {
	if (window.getSelection && window.getSelection().getRangeAt) {

		// Get selected text
		const selection = window.getSelection();
		const range = selection.getRangeAt(0);
		const selectedText = range.toString();

		// Delete current selection
		range.deleteContents();

		// Create temporary container
		const div = document.createElement("div");
		div.innerHTML = selectedText;

		// Append children of temporary container to document fragment
		const fragment = document.createDocumentFragment();
		let child;
		while ((child = div.firstChild)) {
			fragment.appendChild(child);
		}

		// Insert document fragment with clear text at selection
		range.insertNode(fragment);
	} else if (document.selection && document.selection.createRange) {
		throw new Error(`clear formatting is not supported with this browser`);
	}
});

/******************************************************************************/

SnackbarUtils.addDivider(-1, "body-content-tools");

addBodyActionButton("Add Variable", "", "add-variable-button", (event) => {
	const paragraph = Codestrate.focussedParagraph;
	const content = paragraph ? paragraph.querySelector("[data-type='content']") : false;
	if (!content) return;

	const addVariable = (name) => {
		const variable = document.createElement("div");
		variable.setAttribute("class", "variable");
		variable.setAttribute("tabindex", "-1");
		variable.setAttribute("contenteditable", "false");
		variable.setAttribute("data-name", name);

		// 			variable.addEventListener("keyup", event => {
		// 				const newVariableName = variable.innerText.trim();

		// 				// Ignore if variable name did not change, e.g., key events
		// 				const oldVariableName = variable.getAttribute("data-name");
		// 				if (newVariableName === oldVariableName) return;

		// 				// Delete variable when variable name is empty
		// 				if (!newVariableName || newVariableName === "") {
		// 					variable.remove();
		// 					return;
		// 				}

		// 				// Set new variable name
		// 				variable.setAttribute("data-name", newVariableName);
		// 			});

		content.appendChildAtCaret(variable);
	};

	const result = prompt("Set variable name", "", "Add Variable");

	if (result instanceof Promise) {
		result.then(r => {
			if (r) {
				addVariable(r);
			}
		});
	} else if (result) {
		addVariable(result);
	}
});

addBodyActionButton("Hide Variable Names", "", "hide-variables-button", (event) => {
	const paragraph = Codestrate.focussedParagraph;
	const content = paragraph ? paragraph.querySelector("[data-type='content']") : false;
	if (content) content.classList.toggle("hide-variable-names");
});

addBodyActionButton("Convert to HTML", "", "convert-html-button", (event) => {
	if (window.getSelection) {
		const text = window.getSelection().toString();
		HTMLUtils.pasteHtmlAtCaret(text);
	}
});

/******************************************************************************/

SnackbarUtils.addDivider(-1, "body-content-tools");

const addFileButton = document.createElement("span");
addFileButton.setAttribute("title", "Add File");
addFileButton.classList.add("body-content-tools", "snackbar-button", "add-file-button");

const label = document.createElement("label");
label.classList.add("material-icons");
label.innerHTML = "file_upload";

const input = document.createElement("input");
input.setAttribute("type", "file");
// input.setAttribute("accept", "image/*");

input.addEventListener("change", event => {
	const files = Array.from(input.files);

	AssetUtils.uploadFiles(files, (asset) => {
		const paragraph = Codestrate.focussedParagraph;
		const content = paragraph ? paragraph.querySelector("[data-type='content']") : false;
		if (!content) return;

		const element = AssetUtils.getElementFromAsset(asset);
		if (element) {
			if (!HTMLUtils.appendChildAtCaret(element, (range) => {
				return content.contains(range.commonAncestorContainer);
			})) {
				content.appendChild(element);
			}
		}
	}, null, error => {
		console.error(error);
	});

	input.value = "";
});

label.appendChild(input);
addFileButton.appendChild(label);
SnackbarUtils.addSnackbarItem(addFileButton, -1);</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="List Indent / Outdent" run-on-load="true" draggable="false" last-execution-state="success" style data-id="aCh6hNdg" __wid="gqxmEciz"><PRE data-type="content" type="text/javascript" __wid="vL5aEKSG">// Add tab and shift+tab support to indent and outdent lists
importLib([
	"mousetrap.min.js",
	"mousetrap-global-bind.min.js"
]).then(() => {

	Mousetrap.bindGlobal("tab", (event) => {
		// console.log("1", event, event.target, event.target.closest('ul,ol'));
		// if (event.target.closest('ul,ol')) {
		event.preventDefault();
		event.stopPropagation();
		event.stopImmediatePropagation();
		document.execCommand("indent", null, false);
		// }
	});

	Mousetrap.bindGlobal("shift+tab", (event) => {
		// console.log("2", event, event.target, event.target.closest('ul,ol'));
		// if (event.target.closest('ul,ol')) {
		event.preventDefault();
		event.stopPropagation();
		event.stopImmediatePropagation();
		document.execCommand("outdent", null, false);
		// }
	});
});</PRE></DIV>
<DIV class="paragraph code-paragraph collapsed" name="Paste Plain Text to Body Paragraphs" run-on-load="true" last-execution-state="success" style draggable="false" data-id="Tc6JR26S" __wid="5vAjwxeW"><PRE data-type="content" type="text/javascript" __wid="3V4VeZWV">let shiftKeyDown = false;

window.addEventListener("keydown", (event) => {
	if (event.keyCode === 16) {
		shiftKeyDown = true;
	}
}, true);

window.addEventListener("keyup", (event) => {
	if (event.keyCode === 16) {
		shiftKeyDown = false;
	}
}, true);

document.body.addEventListener("paste", (event) => {

	// Ignore paste handler on shift key up
	if (!shiftKeyDown) return;

	const target = event.target;

	// Apply paste plain HTML to body paragraphs only
	if (!target.closest('[data-type="content"][contenteditable="true"]')) return;

	// Prevent default paste
	event.preventDefault();

	// Get plain text
	const text = event.clipboardData.getData("text/plain");

	// Insert plain text without any formatting
	document.execCommand("insertHTML", false, text);
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="UArqpeRC" name="Text Tools Style" draggable="false" style __wid="Vmia74NY"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="d2wtfvBY">html #snackbar:not([body-content-tools="true"]) .body-content-tools {
	display: none;
}

/******************************************************************************/

html #snackbar .format-p-button i:after {
	content: var(--format-paragraph);
	font-family: "Material Design Icons";
}

html #snackbar .format-h1-button i:after {
	content: var(--format-header-1);
	font-family: "Material Design Icons";
}

html #snackbar .format-h2-button i:after {
	content: var(--format-header-2);
	font-family: "Material Design Icons";
}

html #snackbar .format-h3-button i:after {
	content: var(--format-header-3);
	font-family: "Material Design Icons";
}

/******************************************************************************/

html #snackbar .add-variable-button i:after {
	content: var(--tag-plus);
	font-family: "Material Design Icons";
}

html #snackbar .hide-variables-button i:after {
	content: var(--tag-outline);
	font-family: "Material Design Icons";
}

html #snackbar .convert-html-button i:after {
	content: var(--language-html5);
	font-family: "Material Design Icons";
}

/******************************************************************************/

html #snackbar .add-file-button label {
	cursor: pointer;
}

html #snackbar .add-file-button input {
	display: none;
}</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="w2AXGDAm" name="Theme Creator" data-type="package" __wid="NrpBqiZV"><DIV class="paragraph body-paragraph locked collapsed" data-id="MNx74Vf4" name="Documentation" __wid="vDGkquDG"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="xe7vmuzX"><H2 __wid="cRjRF9NJ">Description</H2><DIV __wid="W6rx9qqT">Makes it possible to create new theme sections.</DIV><H2 __wid="D28aTSdn">Themable Style Paragraphs</H2><DIV __wid="Rc4AbtsZ">When creating packages or sections, style paragraphs, which should be available in themes, i.e. which describe properties a user should be able to modify in a theme, can be declared "themable" by adding the "themable" class to them. This indicates the Theme Creator, that these should be available in a theme.</DIV><DIV __wid="QfUd4gL7">When declaring a stye paragraph as themable, every style selector should begin with "html ". This is because this "html" will be replaced when creating a new theme (see Usage -> Creation of a theme).</DIV><H2 __wid="amUdtPtz">Usage</H2><H3 __wid="i76JX7sk">Creation of a theme</H3><DIV __wid="hHWv4TWh">In order to create a new theme, one just has to use the button "Create New Theme" inside the "Themes" submenu of the global menu. This will create a new package with the selected name of the theme. All template paragraphs as well as themable paragraphs will be copied into the new theme. These can then be modified to alter the theme.</DIV><DIV __wid="9QuFQjBF">The copied style paragraphs with the "themable" class will be modified in the following way:</DIV><DIV __wid="2Z2GVRQS"><UL __wid="Z8cwbuiC"><LI __wid="pPmwiaZi">The old <CODE __wid="CNu2AaWU">data-id</CODE> will be written in a <CODE __wid="i5MXirUZ">orig-data-id</CODE> attribute to support later updating of the theme.</LI><LI __wid="ESDFVLp5">The paragrah will receive a newly generated <CODE __wid="xGwBjRGi">data-id</CODE>.</LI><LI __wid="JKVgWTAz">The <CODE __wid="DfL6KCzw">themable</CODE> class will be removed.</LI><LI __wid="v5dYXvAk">The word <CODE __wid="pLiZpiQb">html</CODE> inside the styles will be replaced by <CODE __wid="shgsbZKQ">html[transient-theme="THEME_NAME"]</CODE>. So changes to the theme will only be applied when activating the theme.</LI></UL></DIV><H3 __wid="9YDNhxkb">Updating a theme</H3><DIV __wid="8T8knNYR">If new packages, i.e. new themable paragraphs are added to the Codestrate, it is possible to update a theme by running the "Update Theme" code paragraph within a theme. Updating a theme will perform the following steps:</DIV><DIV __wid="UNQy2SwY"><UL __wid="P3er6KgQ"><LI __wid="6SGfauZh">Add new themable style paragraphs to the theme</LI><LI __wid="FvThqufH">Sort all style paragraphs of the theme</LI><LI __wid="VM8SNfS7">Update the name of existing style paragraphs</LI><LI __wid="aJrpwrNk">If the content of a style paragraph of the theme has the attribute "media='none'" it's content will become updated with the current style of the themable style paragraph</LI></UL></DIV><DIV __wid="xUN63wJH">Updating works by comparing the <CODE __wid="vcyYxRUN">orig-data-id</CODE> of the theme paragraphs with the <CODE __wid="aUrSyWrs">data-id</CODE> of the paragraphs with the <CODE __wid="SSi7pqpC">themable</CODE> class.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" data-id="ZLUWA8QH" name="Properties" __wid="ZZi2JTbY"><PRE data-type="content" type="application/json" contenteditable="false" class="section-properties" __wid="wdm7c9gu">{
  "version": "1.0.8",
  "icon": "palette",
  "description": "Utility to create new themes.",
  "tags": [
    "themes",
    "devtools",
    "utility"
  ],
  "assets": [],
  "dependencies": [],
  "changelog": {
    "1.0": "Initial version.",
    "1.0.1": "Better properties template.",
    "1.0.2": "Remove 'persistent' class from style paragraphs.",
    "1.0.3": "Updated the template to make the dependency on this package optional.",
    "1.0.4": "Used Commands API and added tags to the properties template.",
    "1.0.5": "Fixed 'Update Theme' template.",
    "1.0.6": "Fix typo in menu entry.",
    "1.0.7": "Adjusted theme creator to match new theme API.",
    "1.0.8": "Removed optional dependency on theme creator from template."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/w2AXGDAm-Theme_Creator"
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="quyf8T2R" draggable="false" style name="Add Global Menu Entry" run-on-load="true" last-execution-state="success" __wid="ne6TZUg3"><PRE data-type="content" type="text/javascript" contenteditable="null" __wid="YLNKFY6M">const GlobalMenuUtils = require("#global-menu-utils");
const ThemeCreatorCode = require("#theme-creator-code");

/******************************************************************************/

Codestrate.addCommand("themes.createNewTheme", "Create New Theme", () => {
	ThemeCreatorCode.createTheme();
});
const createThemeButton = GlobalMenuUtils.createButton("Create New Theme", null, event => {
	Codestrate.executeCommand("themes.createNewTheme");
});

Codestrate.addCommand("themes.activateDefaultTheme", "Activate Default Theme", () => {
	ThemeCreatorCode.toggleDefaultTheme();
});
const toggleDefaultThemeButton = GlobalMenuUtils.createButton("Activate Default Theme", null, event => {
	Codestrate.executeCommand("themes.activateDefaultTheme");
});

/******************************************************************************/

const subMenuName = "Themes";

GlobalMenuUtils.addMenuItemToSubMenu(createThemeButton, subMenuName);
GlobalMenuUtils.addMenuItemToSubMenu(toggleDefaultThemeButton, subMenuName);</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="y28PtS6c" draggable="false" style name="Theme Creator Code" __wid="GfAweibZ"><PRE data-type="content" type="text/javascript" id="theme-creator-code" contenteditable="null" __wid="Guyv7Prw">const ThemeCreatorLogger = require("#theme-creator-logger");

/******************************************************************************/

exports.createTheme = () => {
	const dialogTitle = "Create New Theme";
	prompt("Enter a name for the new theme:", "", dialogTitle).then(name => {
		if (!name) return false;

		const id = Codestrate.util.randomString();

		ThemeCreatorLogger.actionStarted(`${dialogTitle} "${name}" with id "${id}"`);

		// Create section
		const section = document.createElement("div");
		section.classList.add("section");
		section.classList.add("section-visible");
		section.setAttribute("name", name + " Theme");
		section.setAttribute("data-id", id);
		section.setAttribute("data-type", "package");

		// Copy template paragraphs
		const templateContents = document.querySelectorAll(".theme-template[data-type='content']");

		templateContents.forEach(content => {
			const paragraph = content.parentNode;
			const newParagraph = paragraph.cloneNode(true);
			const newContent = newParagraph.querySelector("[data-type='content']");

			if (newContent.classList.contains("run-on-load")) {
				newContent.classList.remove("run-on-load");
				newParagraph.setAttribute("run-on-load", "true");
			}

			newContent.classList.remove("theme-template");
			const classes = newContent.getAttribute("class").replace(/(-template)/g, "");
			newContent.setAttribute("class", classes);

			newParagraph.setAttribute("data-id", Codestrate.util.randomString());

			let innerHTML = newContent.innerHTML;
			innerHTML = innerHTML.replace(/(THEME_NAME)/g, name);
			newContent.innerHTML = innerHTML.replace(/(THEME_ID)/g, id);

			section.appendChild(newParagraph);
		});

		// Copy themable paragraphs
		const themableContents = document.querySelectorAll(".style-paragraph .themable[data-type='content']");

		themableContents.forEach(content => {
			const paragraph = content.parentNode;
			const newParagraph = paragraph.cloneNode(true);
			const newContent = newParagraph.querySelector("[data-type='content']");

			newContent.classList.remove("themable");
			newContent.classList.remove("persistent");

			newParagraph.setAttribute("orig-data-id", newParagraph.getAttribute("data-id"));
			newParagraph.setAttribute("data-id", Codestrate.util.randomString());

			const innerHTML = newContent.innerHTML;
			newContent.innerHTML = innerHTML.replace(/(^html)/gm, `html[transient-theme="${name}"]`);

			section.appendChild(newParagraph);
			ThemeCreatorLogger.addedThemable(newParagraph.getAttribute("data-id"),
																			 newParagraph.getAttribute("name"));
		});

		// Add section
		const sections = document.querySelector("#sections");
		sections.appendChild(section);

		ThemeCreatorLogger.actionFinished(`${dialogTitle} "${name}" with id "${id}"`);
	});
};

/******************************************************************************/

exports.toggleDefaultTheme = () => {
	if (document.documentElement.hasAttribute("transient-theme")) {
		document.documentElement.removeAttribute("transient-theme");
	}
};

/******************************************************************************/

exports.updateTheme = (id, name) => {
	const dialogTitle = "Update Theme";

	ThemeCreatorLogger.actionStarted(`${dialogTitle} "${name}" with id "${id}"`);

	const section = document.querySelector(`.section[data-id="${id}"]`);
	const currentParagraphs = Array.from(section.querySelectorAll(".paragraph[orig-data-id]"));
	const themableContents = Array.from(document.querySelectorAll(".style-paragraph .themable[data-type='content']"));
	let lastParagraph;

	themableContents.reverse().forEach(content => {
		const paragraph = content.parentNode;
		const currentParagraph = currentParagraphs.find(currentParagraph => currentParagraph.getAttribute("orig-data-id") === paragraph.getAttribute("data-id"));

		if (currentParagraph != null) {
			let updated = false;

			if (currentParagraph.getAttribute("name") !== paragraph.getAttribute("name")) {
				currentParagraph.setAttribute("name", paragraph.getAttribute("name"));
				updated = true;
			}

			const currentContent = currentParagraph.querySelector("[data-type='content']");
			if (currentContent.getAttribute("media") === "none") {
				currentContent.innerHTML = content.innerHTML.replace(/(^html)/gm, `html[transient-theme="${name}"]`);
				updated = true;
			}

			section.insertBefore(currentParagraph, lastParagraph);
			lastParagraph = currentParagraph;

			if (updated) {
				ThemeCreatorLogger.updatedThemable(currentParagraph.getAttribute("data-id"),
																					 currentParagraph.getAttribute("name"));
			}
		} else {
			const newParagraph = paragraph.cloneNode(true);
			const newContent = newParagraph.querySelector("[data-type='content']");

			newContent.classList.remove("themable");
			newContent.classList.remove("persistent");

			newParagraph.setAttribute("orig-data-id", newParagraph.getAttribute("data-id"));
			newParagraph.setAttribute("data-id", Codestrate.util.randomString());

			const innerHTML = newContent.innerHTML;
			newContent.innerHTML = innerHTML.replace(/(^html)/gm, `html[transient-theme="${name}"]`);

			section.insertBefore(newParagraph, lastParagraph);
			lastParagraph = newParagraph;
			ThemeCreatorLogger.addedThemable(newParagraph.getAttribute("data-id"),
																			 newParagraph.getAttribute("name"));
		}
	});

	ThemeCreatorLogger.actionFinished(`${dialogTitle} "${name}" with id "${id}"`);
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="aqjCMXYH" draggable="false" style name="Theme Creator Logger" __wid="L4a28yxW"><PRE data-type="content" type="text/javascript" id="theme-creator-logger" contenteditable="null" __wid="qjc8mJAj">exports.logName = "Theme Creator";

/******************************************************************************/

exports.actionStarted = (action) => {
	Codestrate.persistentLog.info(`${action} started.`, exports.logName);	
};

exports.actionFinished = (action) => {
	Codestrate.persistentLog.info(`${action} finished.`, exports.logName);	
};

/******************************************************************************/

exports.addedThemable = (id, name) => {
	Codestrate.persistentLog.log(`Added themable paragraph "${name}" with id "${id}".`, exports.logName);
};

exports.updatedThemable = (id, name) => {
	Codestrate.persistentLog.log(`Updated themable paragraph "${name}" with id "${id}".`, exports.logName);
};</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="YDBXCZyM" name="Theme Creator Style" __wid="VaSpgVkC"><STYLE data-type="content" type="text/css" codemirror="true" __wid="JZZYHNvc">#global-menu .sub-menu[name="Themes"] {
	order: 970;
}</STYLE></DIV><DIV class="paragraph body-paragraph locked collapsed" data-id="sA9qY8WD" draggable="false" style name="Documentation" __wid="We2suqK3"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation-template theme-template" __wid="etsZUB2u"><H2 __wid="ZVZQ9qGC">Description</H2><DIV __wid="JwiZDNjd">A theme created by the theme creator.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" data-id="2s4evHXb" draggable="false" style name="Properties" __wid="LQc6GnwW"><PRE data-type="content" type="application/json" class="section-properties-template theme-template" contenteditable="false" __wid="KgenQqgn">{
	"version": "1.0",
	"icon": "palette",
	"description": "A theme created by the theme creator.",
	"tags": [
		"themes"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initial version."
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed locked" data-id="xMWSNbnz" name="Add Global Menu Entry" style last-execution-state="success" __wid="tUaw7jqE"><PRE data-type="content" type="text/javascript" class="theme-template run-on-load" contenteditable="false" __wid="rfisSxhY">const GlobalMenuUtils = require("#global-menu-utils");

/******************************************************************************/

Codestrate.addCommand("themes.toggleTHEME_NAMETheme", "Toggle THEME_NAME Theme", () => {
	if (Codestrate.theme === "THEME_NAME") {
    Codestrate.theme = undefined;
	} else {
    Codestrate.theme = "THEME_NAME";
	}
});
const toggleThemeButton = GlobalMenuUtils.createButton("Toggle THEME_NAME Theme", null, event => {
	Codestrate.executeCommand("themes.toggleTHEME_NAMETheme");
});

/******************************************************************************/

const subMenuName = "Themes";

GlobalMenuUtils.addMenuItemToSubMenu(toggleThemeButton, subMenuName);</PRE></DIV><DIV class="paragraph code-paragraph locked collapsed" data-id="Cr7BxPYL" name="Update Theme" style __wid="kQkK6TKr"><PRE data-type="content" type="text/javascript" class="theme-template" contenteditable="false" __wid="WKBnRTj9">try {
  const ThemeCreatorCode = require("#theme-creator-code");
  ThemeCreatorCode.updateTheme("THEME_ID", "THEME_NAME");
} catch (e) {
  alert(`You need to install the optional dependency "Theme Creator" (w2AXGDAm) to update themes!`, "Missing Theme Creator");
  return;
}</PRE></DIV></DIV><DIV class="section section-hidden" name="Light Theme" data-id="cHBwRFfk" data-type="package" __wid="BjA4TZg6"><DIV class="paragraph body-paragraph locked collapsed" data-id="65H4Ysj6" draggable="false" style name="Documentation" __wid="MqL5gRuU"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="kJsnawQb"><H2 __wid="TtCDjXc7">Description</H2><DIV __wid="v8aRMfP5">A theme with an inverted color scheme for a brighter Codestrate.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" data-id="Q6KFBYkY" draggable="false" style name="Properties" __wid="v9StehxF"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="GjD99FfR">{
  "version": "1.0.5",
  "icon": "palette",
  "description": "A theme with an inverted color scheme for a brighter Codestrate.",
  "tags": [
    "themes"
  ],
  "assets": [],
  "dependencies": [],
  "changelog": {
    "1.0": "Initial Version.",
    "1.0.1": "Updated dependency to be optional.",
    "1.0.2": "Used Commands API.",
    "1.0.3": "Fixed 'Update Theme'.",
    "1.0.4": "Adjusted to new theme API.",
    "1.0.5": "Removed dependency on theme creator."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/cHBwRFfk-Light_Theme"
  }
}</PRE></DIV><DIV class="paragraph code-paragraph locked collapsed" data-id="QHQAMayX" name="Add Global Menu Entry" style last-execution-state="success" run-on-load="true" __wid="ngbAij2n"><PRE data-type="content" type="text/javascript" class contenteditable="false" __wid="X5XWETfM">const GlobalMenuUtils = require("#global-menu-utils");

/******************************************************************************/

Codestrate.addCommand("themes.toggleLightTheme", "Toggle Light Theme", () => {
	if (Codestrate.theme === "Light") {
    Codestrate.theme = undefined;
	} else {
    Codestrate.theme = "Light";
	}
});
const toggleThemeButton = GlobalMenuUtils.createButton("Toggle Light Theme", null, event => {
	Codestrate.executeCommand("themes.toggleLightTheme");
});

/******************************************************************************/

const subMenuName = "Themes";

GlobalMenuUtils.addMenuItemToSubMenu(toggleThemeButton, subMenuName);</PRE></DIV><DIV class="paragraph code-paragraph locked collapsed" data-id="rTQ75TU9" name="Update Theme" style last-execution-state="success" __wid="6qr7MFVs"><PRE data-type="content" type="text/javascript" class contenteditable="false" __wid="5FmVpiRh">try {
  const ThemeCreatorCode = require("#theme-creator-code");
  ThemeCreatorCode.updateTheme("cHBwRFfk", "Light");
} catch (e) {
  alert(`You need to install the optional dependency "Theme Creator" (w2AXGDAm) to update themes!`, "Missing Theme Creator");
  return;
}</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="dyLiA5CB" draggable="false" style name="Theme Variables" orig-data-id="Z2h2eCWM" __wid="53WxY38C"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="HniMz3xT">html[transient-theme="Light"]:root {

	/* Fonts */
	--font-primary: "Roboto", "Avenir", sans-serif;
	--font-secondary: "Roboto", "Avenir", sans-serif;
	--font-monospace: "Roboto Mono", "Menlo", monospace;

	/* Colors */
	--color-primary: var(--material-color-white);
	--color-primary-shade-1: var(--material-color-grey-100);
	--color-primary-shade-2: var(--material-color-grey-200);
	--color-primary-shade-3: var(--material-color-grey-300);

	--color-primary-text: var(--material-color-grey-900);
	--color-secondary-text: var(--material-color-grey-700);
	--color-tertiary-text: var(--material-color-grey-500);

	--color-accent: var(--material-color-deep-orange);
	--color-accent-text: var(--material-color-black);

		/* Colors RGB */
	--color-primary-rgb: var(--material-color-white-rgb);
	--color-primary-shade-1-rgb: var(--material-color-grey-100-rgb);
	--color-primary-shade-2-rgb-rgb: var(--material-color-grey-200-rgb);
	--color-primary-shade-3-rgb: var(--material-color-grey-300-rgb);

	--color-primary-text-rgb: var(--material-color-grey-900-rgb);
	--color-secondary-text-rgb: var(--material-color-grey-700-rgb);
	--color-tertiary-text-rgb: var(--material-color-grey-500-rgb);

	--color-accent-rgb: var(--material-color-deep-orange-rgb);
	--color-accent-text-rgb: var(--material-color-black-rgb);

	/* Transitions */
	--navigation-transition: 250ms cubic-bezier(0.4, 0.0, 0.2, 1);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="vdtqQKCs" orig-data-id="63U8sryX" name="CodeMirror Monokai Theme" __wid="RuraMUjV"><STYLE data-type="content" type="text/css" codemirror="true" __wid="NjASbPZZ">/* Based on Sublime Text's Monokai theme */

html[transient-theme="Light"] .cm-s-monokai.CodeMirror {
	background: none;
	color: var(--color-text-primary) !important;
}
html[transient-theme="Light"] .cm-s-monokai .CodeMirror-gutters {
	background: none;
	border-right: 0px;
}
html[transient-theme="Light"] .cm-s-monokai div.CodeMirror-selected {
	background: var(--color-primary);
}
html[transient-theme="Light"] .cm-s-monokai .CodeMirror-cursor {
	border-left: 1px solid var(--color-primary-text);
}

html[transient-theme="Light"] .cm-s-monokai span.cm-number, html[transient-theme="Light"] .cm-s-monokai span.cm-string, html[transient-theme="Light"] .cm-s-monokai span.cm-atom { color: #762; }
html[transient-theme="Light"] .cm-s-monokai span.cm-comment { color: #262; font-style: italic; line-height: 1em; }
html[transient-theme="Light"] .cm-s-monokai span.cm-meta { color: #555; font-style: italic; line-height: 1em; }
html[transient-theme="Light"] .cm-s-monokai span.cm-variable { color: black; }
html[transient-theme="Light"] .cm-s-monokai span.cm-variable-2 { color: #b11; }
html[transient-theme="Light"] .cm-s-monokai span.cm-qualifier { color: #555; }
html[transient-theme="Light"] .cm-s-monokai span.cm-keyword { color: #730; }
html[transient-theme="Light"] .cm-s-monokai span.cm-builtin { color: #30a; }
html[transient-theme="Light"] .cm-s-monokai span.cm-link { color: #762; }
html[transient-theme="Light"] .cm-s-monokai span.cm-error { background-color: #ffb8b8; }

html[transient-theme="Light"] .cm-s-monokai .CodeMirror-activeline-background { background: rgba(var(--color-accent-rgb), 0.1); }
html[transient-theme="Light"] .cm-s-monokai .CodeMirror-matchingbracket { outline:1px solid grey; color:black !important; }


html[transient-theme="Light"] .cm-s-monokai span.cm-matchhighlight {
	background: #353;
}
html[transient-theme="Light"] .cm-s-monokai span.cm-tag {
	color: rgb(234, 53, 134);
}

html[transient-theme="Light"] .cm-s-monokai span.cm-property,
html[transient-theme="Light"] .cm-s-monokai span.cm-attribute {
	color: #12AF16;
}</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="aVPGHwCe" name="Notebook Theme" data-type="package" __wid="PpyJkQgd"><DIV class="paragraph body-paragraph locked collapsed" data-id="uKHYE63W" name="Documentation" draggable="false" style __wid="cUxHk7pR"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="XW5PcNa2"><H2 __wid="uPykk2BN">Description</H2><DIV __wid="DJXVFBTH">A simple and light theme for writing and reading of contents.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" data-id="MVLy6nYM" name="Properties" draggable="false" style __wid="bBSPGyvw"><PRE data-type="content" type="application/json" contenteditable="false" class="section-properties" __wid="yFKR3DjT">{
  "version": "1.3.2",
  "icon": "palette",
  "description": "A simple and light theme for writing and reading of contents.",
  "tags": [
    "themes"
  ],
  "assets": [],
  "dependencies": [],
  "changelog": {
    "1.0": "Initial Version.",
    "1.1": "Various fixes for new packages and Codestrate updates.",
    "1.2": "Changed name from 'Simplicity' to 'Notebook' and updated several things (still under construction).",
    "1.2.1": "Updated many more things and switched to Alegreya as body font.",
    "1.2.2": "Updated dependency to be optional.",
    "1.2.3": "Updated to new non jumping headers.",
    "1.2.4": "Updated output and code paragraph style.",
    "1.2.5": "Adjusted to new div structure.",
    "1.2.6": "Used Commands API.",
    "1.2.7": "Updated for Notifications package.",
    "1.3": "Fixed flex section and paragraph headers.",
    "1.3.1": "Adjusted theme to match new theme API.",
    "1.3.2": "Removed dependency on theme creator."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/aVPGHwCe-Notebook_Theme"
  }
}</PRE></DIV><DIV class="paragraph code-paragraph locked collapsed" data-id="xwMtEJSr" style name="Add Global Menu Entry" run-on-load="true" last-execution-state="success" draggable="false" __wid="yr7FLpkZ"><PRE data-type="content" type="text/javascript" contenteditable="false" class __wid="dt7vhAgP">const GlobalMenuUtils = require("#global-menu-utils");

/******************************************************************************/

Codestrate.addCommand("themes.toggleNotebookTheme", "Toggle Notebook Theme", () => {
	if (Codestrate.theme === "Notebook") {
    Codestrate.theme = undefined;
	} else {
    Codestrate.theme = "Notebook";
	}
});
const toggleThemeButton = GlobalMenuUtils.createButton("Toggle Notebook Theme", null, event => {
	Codestrate.executeCommand("themes.toggleNotebookTheme");
});

/******************************************************************************/

const subMenuName = "Themes";

GlobalMenuUtils.addMenuItemToSubMenu(toggleThemeButton, subMenuName);</PRE></DIV><DIV class="paragraph code-paragraph locked collapsed" data-id="NNecppGD" style name="Update Theme" last-execution-state="success" draggable="false" __wid="yMpQvztA"><PRE data-type="content" type="text/javascript" contenteditable="false" class __wid="TGgFWEJt">try {
	const ThemeCreatorCode = require("#theme-creator-code");
	ThemeCreatorCode.updateTheme("aVPGHwCe", "Notebook");
} catch (e) {
	alert(`You need to install the optional dependency "Theme Creator" (w2AXGDAm) to update themes!`, "Missing Theme Creator");
	return;
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="qhxbxufp" name="Add Class and ID to Snackbar" run-on-load="true" last-execution-state="success" __wid="Auih8Grq"><PRE data-type="content" type="text/javascript" __wid="Ki8y6y6i">const SnackbarUtils = require("#snackbar-utils");
const SnackbarTools = require("#snackbar-tools");

/******************************************************************************/

const toolsName = "paragraph-header-tools";
let lastParagraph = null;

/******************************************************************************/

const idInput = SnackbarUtils.createInput("Paragraph ID", "id-input " + toolsName, "", (inputElement) => {
	if (Codestrate.focussedParagraph) {
		const content = Codestrate.focussedParagraph.querySelector("[data-type='content']");
		if (content) {
			if (inputElement.innerText === "") {
				content.removeAttribute("id");
			} else {
				content.id = inputElement.innerText;
			}
		}
	}
});
SnackbarUtils.addSnackbarItem(idInput, -1);

const classInput = SnackbarUtils.createInput("Paragraph Class", "class-input " + toolsName, "", (inputElement) => {
	if (Codestrate.focussedParagraph) {
		const content = Codestrate.focussedParagraph.querySelector("[data-type='content']");
		if (content) {
			if (inputElement.innerText === "") {
				content.removeAttribute("class");
			} else {
				content.className = inputElement.innerText;
			}
		}
	}
});
SnackbarUtils.addSnackbarItem(classInput, -1);

/******************************************************************************/

SnackbarTools.addTools((target) => {
	const result = target.closest(".paragraph-header");

	if (Codestrate.focussedParagraph &&
		 (Codestrate.focussedParagraph != lastParagraph)) {
		const content = Codestrate.focussedParagraph.querySelector("[data-type='content']");
		if (content) {
			idInput.innerText = content.id;
			classInput.innerText = content.className;
		}
	}

	lastParagraph = Codestrate.focussedParagraph;
	return result;
}, toolsName);</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="QXf3eKp3" name="Alegreya Font" __wid="B7EQE7LB"><STYLE data-type="content" type="text/css" codemirror="true" __wid="ZWhrq3df">/* cyrillic-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 400;
	src: local('Alegreya Italic'), local('Alegreya-Italic'), url(https://fonts.gstatic.com/s/alegreya/v10/2-0rAhdO4T5hMLVYWXPl6yEAvth_LlrfE80CYdSH47w.woff2) format('woff2');
	unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
/* cyrillic */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 400;
	src: local('Alegreya Italic'), local('Alegreya-Italic'), url(https://fonts.gstatic.com/s/alegreya/v10/G_Uzz0l2AD37fwazYIVqRCEAvth_LlrfE80CYdSH47w.woff2) format('woff2');
	unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
/* greek-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 400;
	src: local('Alegreya Italic'), local('Alegreya-Italic'), url(https://fonts.gstatic.com/s/alegreya/v10/KqrXb9ZAKqVtzt7EgGbdIiEAvth_LlrfE80CYdSH47w.woff2) format('woff2');
	unicode-range: U+1F00-1FFF;
}
/* greek */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 400;
	src: local('Alegreya Italic'), local('Alegreya-Italic'), url(https://fonts.gstatic.com/s/alegreya/v10/V907Vsm1WDtzQVBmHEUaayEAvth_LlrfE80CYdSH47w.woff2) format('woff2');
	unicode-range: U+0370-03FF;
}
/* vietnamese */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 400;
	src: local('Alegreya Italic'), local('Alegreya-Italic'), url(https://fonts.gstatic.com/s/alegreya/v10/5EszMMLpK7CAwF487xC-ciEAvth_LlrfE80CYdSH47w.woff2) format('woff2');
	unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
/* latin-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 400;
	src: local('Alegreya Italic'), local('Alegreya-Italic'), url(https://fonts.gstatic.com/s/alegreya/v10/6_pOq2_yZBqNy9oVYzitaiEAvth_LlrfE80CYdSH47w.woff2) format('woff2');
	unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 400;
	src: local('Alegreya Italic'), local('Alegreya-Italic'), url(https://fonts.gstatic.com/s/alegreya/v10/Q-XbT1m22Fi9BEKb7y59O_k_vArhqVIZ0nv9q090hN8.woff2) format('woff2');
	unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}
/* cyrillic-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 700;
	src: local('Alegreya Bold Italic'), local('Alegreya-BoldItalic'), url(https://fonts.gstatic.com/s/alegreya/v10/IWi8e5bpnqhMRsZKTcTUWude9INZm0R8ZMJUtfOsxrw.woff2) format('woff2');
	unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
/* cyrillic */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 700;
	src: local('Alegreya Bold Italic'), local('Alegreya-BoldItalic'), url(https://fonts.gstatic.com/s/alegreya/v10/IWi8e5bpnqhMRsZKTcTUWrpHcMS0zZe4mIYvDKG2oeM.woff2) format('woff2');
	unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
/* greek-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 700;
	src: local('Alegreya Bold Italic'), local('Alegreya-BoldItalic'), url(https://fonts.gstatic.com/s/alegreya/v10/IWi8e5bpnqhMRsZKTcTUWhquHyap-BLkxbFhcQRhghg.woff2) format('woff2');
	unicode-range: U+1F00-1FFF;
}
/* greek */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 700;
	src: local('Alegreya Bold Italic'), local('Alegreya-BoldItalic'), url(https://fonts.gstatic.com/s/alegreya/v10/IWi8e5bpnqhMRsZKTcTUWjyJJ3dJfU6-XWVNf-DPRbs.woff2) format('woff2');
	unicode-range: U+0370-03FF;
}
/* vietnamese */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 700;
	src: local('Alegreya Bold Italic'), local('Alegreya-BoldItalic'), url(https://fonts.gstatic.com/s/alegreya/v10/IWi8e5bpnqhMRsZKTcTUWjh33M2A-6X0bdu871ruAGs.woff2) format('woff2');
	unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
/* latin-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 700;
	src: local('Alegreya Bold Italic'), local('Alegreya-BoldItalic'), url(https://fonts.gstatic.com/s/alegreya/v10/IWi8e5bpnqhMRsZKTcTUWhHJTnCUrjaAm2S9z52xC3Y.woff2) format('woff2');
	unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
	font-family: 'Alegreya';
	font-style: italic;
	font-weight: 700;
	src: local('Alegreya Bold Italic'), local('Alegreya-BoldItalic'), url(https://fonts.gstatic.com/s/alegreya/v10/IWi8e5bpnqhMRsZKTcTUWoWiMMZ7xLd792ULpGE4W_Y.woff2) format('woff2');
	unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}
/* cyrillic-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 400;
	src: local('Alegreya Regular'), local('Alegreya-Regular'), url(https://fonts.gstatic.com/s/alegreya/v10/CyUchkLLwC_Sk3Ot8VbrmBTbgVql8nDJpwnrE27mub0.woff2) format('woff2');
	unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
/* cyrillic */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 400;
	src: local('Alegreya Regular'), local('Alegreya-Regular'), url(https://fonts.gstatic.com/s/alegreya/v10/ajjr5syd8npzA2oMO3e2tBTbgVql8nDJpwnrE27mub0.woff2) format('woff2');
	unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
/* greek-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 400;
	src: local('Alegreya Regular'), local('Alegreya-Regular'), url(https://fonts.gstatic.com/s/alegreya/v10/lC0rmMY7jeEwAi0q4NEiaxTbgVql8nDJpwnrE27mub0.woff2) format('woff2');
	unicode-range: U+1F00-1FFF;
}
/* greek */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 400;
	src: local('Alegreya Regular'), local('Alegreya-Regular'), url(https://fonts.gstatic.com/s/alegreya/v10/hTEGF50xIZGXmUgSEbt1cBTbgVql8nDJpwnrE27mub0.woff2) format('woff2');
	unicode-range: U+0370-03FF;
}
/* vietnamese */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 400;
	src: local('Alegreya Regular'), local('Alegreya-Regular'), url(https://fonts.gstatic.com/s/alegreya/v10/Agq2djrNRZK5qadVTHOtlRTbgVql8nDJpwnrE27mub0.woff2) format('woff2');
	unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
/* latin-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 400;
	src: local('Alegreya Regular'), local('Alegreya-Regular'), url(https://fonts.gstatic.com/s/alegreya/v10/9u9YGRxvkN-Oe2bJiJD80RTbgVql8nDJpwnrE27mub0.woff2) format('woff2');
	unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 400;
	src: local('Alegreya Regular'), local('Alegreya-Regular'), url(https://fonts.gstatic.com/s/alegreya/v10/4vRXIs1BEbKX6mQ7lGu1I_esZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
	unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}
/* cyrillic-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 700;
	src: local('Alegreya Bold'), local('Alegreya-Bold'), url(https://fonts.gstatic.com/s/alegreya/v10/F5BSMOSf_T8GT2wiqqpj3TTOQ_MqJVwkKsUn0wKzc2I.woff2) format('woff2');
	unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
/* cyrillic */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 700;
	src: local('Alegreya Bold'), local('Alegreya-Bold'), url(https://fonts.gstatic.com/s/alegreya/v10/F5BSMOSf_T8GT2wiqqpj3TUj_cnvWIuuBMVgbX098Mw.woff2) format('woff2');
	unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
/* greek-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 700;
	src: local('Alegreya Bold'), local('Alegreya-Bold'), url(https://fonts.gstatic.com/s/alegreya/v10/F5BSMOSf_T8GT2wiqqpj3UbcKLIaa1LC45dFaAfauRA.woff2) format('woff2');
	unicode-range: U+1F00-1FFF;
}
/* greek */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 700;
	src: local('Alegreya Bold'), local('Alegreya-Bold'), url(https://fonts.gstatic.com/s/alegreya/v10/F5BSMOSf_T8GT2wiqqpj3Wo_sUJ8uO4YLWRInS22T3Y.woff2) format('woff2');
	unicode-range: U+0370-03FF;
}
/* vietnamese */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 700;
	src: local('Alegreya Bold'), local('Alegreya-Bold'), url(https://fonts.gstatic.com/s/alegreya/v10/F5BSMOSf_T8GT2wiqqpj3b6up8jxqWt8HVA3mDhkV_0.woff2) format('woff2');
	unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
/* latin-ext */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 700;
	src: local('Alegreya Bold'), local('Alegreya-Bold'), url(https://fonts.gstatic.com/s/alegreya/v10/F5BSMOSf_T8GT2wiqqpj3SYE0-AqJ3nfInTTiDXDjU4.woff2) format('woff2');
	unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
	font-family: 'Alegreya';
	font-style: normal;
	font-weight: 700;
	src: local('Alegreya Bold'), local('Alegreya-Bold'), url(https://fonts.gstatic.com/s/alegreya/v10/F5BSMOSf_T8GT2wiqqpj3Y4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
	unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="5JAmcw7K" name="Class and ID Input Style" __wid="VQiwFtGM"><STYLE data-type="content" type="text/css" codemirror="true" __wid="LnzvTLKG">html[transient-theme="Notebook"] #snackbar:not([paragraph-header-tools="true"]) .paragraph-header-tools {
	display: none;
}

html:not([transient-theme="Notebook"]) #snackbar .id-input,
html:not([transient-theme="Notebook"]) #snackbar .class-input {
	display: none !important;
}

html[transient-theme="Notebook"] #snackbar .snackbar-input.id-input:before{
	content: "#";
}

html[transient-theme="Notebook"] #snackbar .snackbar-input.id-input:empty:before {
	content: "#id";
}

html[transient-theme="Notebook"] #snackbar .snackbar-input.class-input:before {
	content: ".";
}

html[transient-theme="Notebook"] #snackbar .snackbar-input.class-input:empty:before {
	content: ".class";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="wg7VK8PS" draggable="false" style name="Hide Header Stuff" __wid="qJ8vet98"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="true" __wid="cWkP2KE6">html[transient-theme="Notebook"] .paragraph-header .action,
html[transient-theme="Notebook"] .paragraph-header:before,
html[transient-theme="Notebook"] .section-header .action,
html[transient-theme="Notebook"] .section-header:before,
html[transient-theme="Notebook"] .paragraph-header .id-input,
html[transient-theme="Notebook"] .section-header .id-input,
html[transient-theme="Notebook"] .paragraph-header .class-input,
html[transient-theme="Notebook"] .paragraph-header .type-input,
html[transient-theme="Notebook"] .section .section-header .data-id-label,
html[transient-theme="Notebook"] .section .section-header .export-package,
html[transient-theme="Notebook"] .section .section-header .export-github-package {
	display: none !important;
}


html[transient-theme="Notebook"] .paragraph:hover .paragraph-header:before,
html[transient-theme="Notebook"] .paragraph[transient-focussed] .paragraph-header:before,
html[transient-theme="Notebook"] .section:hover .section-header:before,
html[transient-theme="Notebook"] .section[transient-focussed] .section-header:before,
html[transient-theme="Notebook"] .paragraph:hover .paragraph-header .action,
html[transient-theme="Notebook"] .paragraph[transient-focussed] .paragraph-header .action,
html[transient-theme="Notebook"] .section-header:hover .action:not(.export-package):not(.export-github-package) {
	opacity: 1 !important;
	display: initial !important;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" name="Add File Style" draggable="false" data-id="PkGviRKY" orig-data-id="2SkdQVQA" style __wid="jtixEqWb"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="uFmmu5Fc">/* Hide native upload file UI element */
html[transient-theme="Notebook"] .add-file input[type="file"] {
	display: none;
}

/* Icon Upload File */
html[transient-theme="Notebook"] .add-file label.material-icons:after {
	content: "file_upload";
}

/* Tooltip Upload File */
html[transient-theme="Notebook"] .add-file:after {
	content: "Upload File";
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" name="Text Tools Style" draggable="false" data-id="pD77NWRd" orig-data-id="ETX4s9QH" __wid="6JuMv9sL"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="true" class media="none" __wid="76BUHFz7">html[transient-theme="Notebook"] .text-tools {
	/* position: relative; */
	display: block;
	width: 100%;
	background-color: rgba(0, 0, 0, .3);
	padding: 5px;
	padding-top: 10px;
	margin-top: 1px;
	border-radius: 2px;

	/* border-top: 1px solid rgba(255, 255, 255, .1);*/

	-webkit-user-select: none;  /* Chrome all / Safari all */
	-moz-user-select: none;     /* Firefox all */
	-ms-user-select: none;      /* IE 10+ */
	user-select: none;          /* Likely future */   
}

html[transient-theme="Notebook"] .paragraph.collapsed .text-tools {
	display: none;
}

html[transient-theme="Notebook"] .text-tools .action {
	position: relative;
	cursor: pointer;
	display: inline-block;
	margin-left: 5px;
}

html[transient-theme="Notebook"] .text-tools .action:hover {
	color: orange;
}

/* Icon Bold */
html[transient-theme="Notebook"] .text-tools .text-bold i:after {
	content: "format_bold";
}

/* Tooltip Bold */
html[transient-theme="Notebook"] .text-tools .text-bold:after {
	content: "Bold";
}

/* Icon Italic */
html[transient-theme="Notebook"] .text-tools .text-italic i:after {
	content: "format_italic";
}

/* Tooltip Italic */
html[transient-theme="Notebook"] .text-tools .text-italic:after {
	content: "Italic";
}

/* Icon Underline */
html[transient-theme="Notebook"] .text-tools .text-underline i:after {
	content: "format_underline";
}

/* Tooltip Underline */
html[transient-theme="Notebook"] .text-tools .text-underline:after {
	content: "Underline";
}

/* Icon Strikethrough */
html[transient-theme="Notebook"] .text-tools .text-strikethrough i:after {
	content: "format_strikethrough";
}

/* Tooltip Strikethrough */
html[transient-theme="Notebook"] .text-tools .text-strikethrough:after {
	content: "Strikethrough";
}

/* Icon Bullets */
html[transient-theme="Notebook"] .text-tools .text-list-bulleted i:after {
	content: "format_list_bulleted";
}

/* Tooltip Bullets */
html[transient-theme="Notebook"] .text-tools .text-list-bulleted:after {
	content: "Bullets";
}

/* Icon Numbering */
html[transient-theme="Notebook"] .text-tools .text-list-numbered i:after {
	content: "format_list_numbered";
}

/* Tooltip Numbering */
html[transient-theme="Notebook"] .text-tools .text-list-numbered:after {
	content: "Numbering";
}

/* Icon Increase Indent */
html[transient-theme="Notebook"] .text-tools .text-list-indent i:after {
	content: "format_indent_increase";
}

/* Tooltip Increase Indent */
html[transient-theme="Notebook"] .text-tools .text-list-indent:after {
	content: "Increase Indent";
}

/* Icon Decrease Indent */
html[transient-theme="Notebook"] .text-tools .text-list-outdent i:after {
	content: "format_indent_decrease";
}

/* Tooltip Decrease Indent */
html[transient-theme="Notebook"] .text-tools .text-list-outdent:after {
	content: "Decrease Indent";
}

/* Icon Clear Formatting */
html[transient-theme="Notebook"] .text-tools .clear-format i:after {
	content: "format_clear";
}

/* Tooltip Clear Formatting */
html[transient-theme="Notebook"] .text-tools .clear-format:after {
	content: "Clear Formatting";
}

html[transient-theme="Notebook"] .text-tools .text-h1,
html[transient-theme="Notebook"] .text-tools .text-h2,
html[transient-theme="Notebook"] .text-tools .text-h3,
html[transient-theme="Notebook"] .text-tools .text-set-variable,
html[transient-theme="Notebook"] .text-tools .text-hide-variable-names, 
html[transient-theme="Notebook"] .text-tools .text-convert-to-html {
	margin-left: 10px;
	margin-top: 2px;
	vertical-align: top;
}

/* Tooltip Section */
html[transient-theme="Notebook"] .text-tools .text-h1:after {
	content: "Format Heading 1"
}

/* Tooltip Subsection */
html[transient-theme="Notebook"] .text-tools .text-h2:after {
	content: "Format Heading 2"
}

/* Tooltip Subsection */
html[transient-theme="Notebook"] .text-tools .text-h3:after {
	content: "Format Heading 3"
}

/* Tooltip Add Variable */
html[transient-theme="Notebook"] .text-tools .text-set-variable:after {
	content: "Add Variable"
}

/* Tooltip Hide Variable Names */
html[transient-theme="Notebook"] .text-tools .text-hide-variable-names:after {
	content: "Hide Variable Names"
}

/* Tooltip Convert HTML */
html[transient-theme="Notebook"] .text-tools .text-convert-to-html:after {
	content: "Convert HTML"
}

/* Hide native upload file UI element */
html[transient-theme="Notebook"] .text-tools .add-file input[type="file"] {
	display: none;
}

/* Icon Upload File */
html[transient-theme="Notebook"] .text-tools .add-file label.material-icons:after {
	content: "file_upload";
}

/* Tooltip Upload File */
html[transient-theme="Notebook"] .text-tools .add-file:after {
	content: "Upload File";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="jnGMUWCr" name="Package Icons Main" style orig-data-id="4BGSHqL7" __wid="RNtNgUPS"><STYLE data-type="content" type="text/css" codemirror="true" class contenteditable="null" media="none" __wid="WmKBwS2F">html[transient-theme="Notebook"] #package-icons {
	position: fixed;
	right: 0;
	top: 0;
	height: 100vh;
	width: 240px;
	transition: transform 250ms ease-in-out 0s;
	z-index: 100;
	transform: translate(200px, 0);
	overflow: auto;
}

html[transient-theme="Notebook"] #package-icons::-webkit-scrollbar,
html[transient-theme="Notebook"] #package-icons #package-icons-packages::-webkit-scrollbar,
html[transient-theme="Notebook"] #package-icons #package-icons-repositories::-webkit-scrollbar {
  display: none;
}

html[transient-theme="Notebook"] #package-icons:hover {
	transform: translate(0, 0);
}

/******************************************************************************/

html[transient-theme="Notebook"] #package-icons #package-icons-packages,
html[transient-theme="Notebook"] #package-icons #package-icons-repositories {
	position: fixed;
	top: 0;
	right: 0;
	overflow: auto;
	height: 100%;
	width: 100%;
	transition: transform 250ms ease-in-out 0s,
							opacity 250ms ease-in-out 0s,
							padding-top var(--navigation-transition);
	padding-top: 64px;
}

html[transient-theme="Notebook"] body[transient-toolbar-hidden="true"] #package-icons #package-icons-packages,
html[transient-theme="Notebook"] body[transient-toolbar-hidden="true"] #package-icons #package-icons-repositories {
	padding-top: 0;
}

html[transient-theme="Notebook"] #package-icons #package-icons-packages.hidden,
html[transient-theme="Notebook"] #package-icons #package-icons-repositories.hidden {
	transform: translate(240px, 0);
	opacity: 0;
}

/******************************************************************************/

html[transient-theme="Notebook"] #package-icons .package-icon,
html[transient-theme="Notebook"] #package-icons .package-button {
	border-radius: 50%;
	height: 64px;
	width: 64px;
	text-align: center;
	line-height: 64px;
	overflow: hidden;
	display: flex;
	justify-content: center;
	align-items: center;
}

/******************************************************************************/

html[transient-theme="Notebook"] #package-icons .package-icon {
	position: relative;
	margin: 16px 8px 16px 160px;
	overflow: visible;
	background: var(--material-color-grey-200);
	color: var(--material-color-grey-900);
	animation: show 150ms ease-in-out;
	animation-fill-mode: forwards;
	box-shadow: var(--material-shadow-z2);
}
@keyframes show {
	0% {
		transform: translate(128px, 0);
	}
	100% {
		transform: translate(0, 0);
	}
}

/******************************************************************************/

html[transient-theme="Notebook"] #package-icons .package-button-refresh-packages i {
	animation: spin 1000ms linear infinite;
	animation-play-state: paused;
}

html[transient-theme="Notebook"] #package-icons .package-button-refresh-packages.refreshing i {
	animation-play-state: running;
}
@keyframes spin {
	100% {
		transform: rotate(-360deg);
	}
}

/******************************************************************************/

html[transient-theme="Notebook"] #package-icons .package-icon .package-label {
	position: absolute;
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	display: none;
	height: 28px;
	line-height: 24px;
	padding: 2px 6px;
	font-size: 14px;
	background: #000000;
	color: #FFFFFF;
	max-width: 192px;
	transform: translate(-45%, -60px) rotate(4deg);
}

html[transient-theme="Notebook"] #package-icons .package-icon:hover .package-label {
	display: inline-block;
}

/******************************************************************************/

html[transient-theme="Notebook"] #package-icons .package-icon .package-button {
	position: absolute;
	top: 0;
	left: 0;
	color: var(--material-color-white);
	cursor: pointer;
	opacity: 0;
	transform: translate(0, 0);
	box-shadow: inset 0 0 100px 100px rgba(255, 255, 255, 0),
		var(--material-shadow-z2);
	transition: opacity 150ms ease-in-out 250ms,
		transform 150ms ease-in-out 250ms,
		box-shadow var(--navigation-transition);
}

html[transient-theme="Notebook"] #package-icons .package-icon:hover .package-button {
	opacity: 1;
}

html[transient-theme="Notebook"] #package-icons .package-icon .package-button:hover {
	box-shadow: inset 0 0 100px 100px rgba(255, 255, 255, 0.25),
		var(--material-shadow-z8);
}

html[transient-theme="Notebook"] #package-icons .package-icon:hover .package-button-second {
	transform: translate(-72px, 0);
}
	
html[transient-theme="Notebook"] #package-icons .package-icon:hover .package-button-third {
	transform: translate(-144px, 0);
}

/******************************************************************************/

html[transient-theme="Notebook"] #package-icons .material-icons {
	font-size: 32px;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="DMkThcYM" name="Package Icons State Colors" orig-data-id="2Chhy49u" style __wid="6S4LencG"><STYLE data-type="content" type="text/css" codemirror="true" class contenteditable="true" media="none" __wid="narkHp7Y">html[transient-theme="Notebook"] #package-icons .package-icon-package[local="true"][version-changed="false"] {
	background: var(--material-color-green);
	color: var(--material-color-white);
}

html[transient-theme="Notebook"] #package-icons .package-icon-package[local="true"][version-changed="true"] {
	background: var(--material-color-orange);
	color: var(--material-color-white);
}

html[transient-theme="Notebook"] #package-icons .package-icon-package[local="true"][version-changed="undefined"] {
	background: var(--material-color-teal);
	color: var(--material-color-white);
}

html[transient-theme="Notebook"] #package-icons .package-icon-package[local="true"][uninstalled="true"] {
	background: var(--material-color-grey-800) !important;
	color: var(--material-color-white);
}

html[transient-theme="Notebook"] #package-icons .package-icon-package[local="true"][prototype="false"] {
	background: var(--material-color-light-blue);
	color: var(--material-color-white);
}

html[transient-theme="Notebook"] #package-icons .package-icon-repository[active="true"] {
	background: var(--material-color-green);
	color: var(--material-color-white);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="ckyATpY9" name="Package Icons Button Colors" style orig-data-id="4YhsGV4U" __wid="6m4SsVUZ"><STYLE data-type="content" type="text/css" codemirror="true" class contenteditable="null" media="none" __wid="W2sLpfcP">html[transient-theme="Notebook"] #package-icons .package-icon-menu,
html[transient-theme="Notebook"] #package-icons .package-icon-all {
	background: var(--material-color-indigo);
	color: var(--material-color-white);
}

html[transient-theme="Notebook"] #package-icons .package-button-refresh-packages {
	background: var(--material-color-indigo);
}

html[transient-theme="Notebook"] #package-icons .package-button-add-repository {
	background: var(--material-color-indigo);
}

html[transient-theme="Notebook"] #package-icons .package-button-swap {
	background: var(--material-color-indigo);
}

/**************************************************************************************************/

html[transient-theme="Notebook"] #package-icons .package-icon .package-button.disabled {
	background: var(--material-color-grey-800) !important;
	cursor: default;
}

html[transient-theme="Notebook"] #package-icons .package-icon .package-button.disabled:hover {
	box-shadow: var(--material-shadow-z2);
}

/**************************************************************************************************/

html[transient-theme="Notebook"] #package-icons .package-icon .install-package-button,
html[transient-theme="Notebook"] #package-icons .package-icon[local="true"][uninstalled="true"] .install-package-button,
html[transient-theme="Notebook"] #package-icons .package-icon .select-repository-button,
html[transient-theme="Notebook"] #package-icons .package-icon .package-button-install-all {
	background: var(--material-color-green);
}

html[transient-theme="Notebook"] #package-icons .package-icon[local="true"][uninstalled="false"][version-changed="true"] .install-package-button {
	background: var(--material-color-orange);
}

html[transient-theme="Notebook"] #package-icons .package-icon[local="true"][uninstalled="false"][version-changed="undefined"] .install-package-button {
	background: var(--material-color-teal);
}

html[transient-theme="Notebook"] #package-icons .package-icon .remove-package-button,
html[transient-theme="Notebook"] #package-icons .package-icon .remove-repository-button,
html[transient-theme="Notebook"] #package-icons .package-icon .package-button-remove-all {
	background: var(--material-color-red);
}

html[transient-theme="Notebook"] #package-icons .package-icon .push-package-button {
	background: var(--material-color-light-blue);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="2Y5MLyYD" name="Package Icons Material Icons" draggable="false" style orig-data-id="eW5ajidK" __wid="BwSzdzFL"><STYLE data-type="content" type="text/css" codemirror="true" class contenteditable="null" media="none" __wid="H2J3bqvR">html[transient-theme="Notebook"] #package-icons .package-icon-menu i:after {
	content: "menu";
}

html[transient-theme="Notebook"] #package-icons .package-icon-all > i:after {
	content: var(--database);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #package-icons .package-button-refresh-packages i:after {
	content: "cached";
}

html[transient-theme="Notebook"] #package-icons .package-button-add-repository i:after {
	content: "add";
}

html[transient-theme="Notebook"] #package-icons .package-button-swap i:after {
	content: "swap_horiz";
}

html[transient-theme="Notebook"] #package-icons .package-icon .package-button-install-all i:after  {
	content: "done_all";
}

html[transient-theme="Notebook"] #package-icons .package-icon .package-button-remove-all i:after {
	content: "clear_all";
}

/**************************************************************************************************/

html[transient-theme="Notebook"] #package-icons .package-icon.package-icon-package > i:empty:after {
	content: var(--cube-outline);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #package-icons .package-icon.package-icon-repository > i:after {
	content: var(--database);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #package-icons .package-icon .install-package-button i:after,
html[transient-theme="Notebook"] #package-icons .package-icon[local="true"][uninstalled="true"] .install-package-button i:after{
	content: "file_download";
}

html[transient-theme="Notebook"] #package-icons .package-icon .select-repository-button i:after {
	content: "check";
}

html[transient-theme="Notebook"] #package-icons .package-icon[local="true"] .install-package-button i:after {
	content: "update";
}

html[transient-theme="Notebook"] #package-icons .package-icon .remove-package-button i:after,
html[transient-theme="Notebook"] #package-icons .package-icon .remove-repository-button i:after {
	content: "delete";
}

html[transient-theme="Notebook"] #package-icons .package-icon .push-package-button i:after {
	content: "file_upload";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="LnYxQjNC" name="Permissions Dialog Style" style orig-data-id="n86qmxNM" __wid="HtQNUquD"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="j9phf66h">html[transient-theme="Notebook"] .permissions-dialog .dialog table {
	width: 100%;
	border-collapse: collapse;
}

html[transient-theme="Notebook"] .permissions-dialog .dialog td,
html[transient-theme="Notebook"] .permissions-dialog .dialog th {
	padding: 8px;
	text-align: left;
	outline: none;
}

html[transient-theme="Notebook"] .permissions-dialog .dialog tr:nth-child(even) {
	background: var(--color-primary-shade-2);
}

html[transient-theme="Notebook"] .permissions-dialog .dialog tr:hover {
	background-color: var(--color-primary-shade-3);
}

html[transient-theme="Notebook"] .permissions-dialog .delete {
	cursor: pointer;
}

html[transient-theme="Notebook"] .permissions-dialog .delete:hover i {
	color: var(--material-color-red);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Avatars Style" data-id="mxbDMy32" orig-data-id="ZDQNSSqu" __wid="GSSQNsrD"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="GLbd3xnq">html[transient-theme="Notebook"] .avatars {
	position: fixed;
	bottom: 5px;
	right: 5px;
}

/* Make the .avatars-test only occupy minimal space */
html[transient-theme="Notebook"] .avatars-test {
	float: left;
	position: relative;
	bottom: 10px;
	left: 10px;
}

html[transient-theme="Notebook"] .avatars .avatar,
html[transient-theme="Notebook"] .avatars-test .avatar {
	box-sizing: content-box;
	position: relative;
	width: 45px;
	height: 45px;
	margin-top: 10px;
	background-size: contain;
	border-radius: 50%;
	border: 2px solid white;
	box-shadow: 0px 0px 5px #000;
}

html[transient-theme="Notebook"] .avatars .avatar:not(.self) {
	cursor: pointer;
}

html[transient-theme="Notebook"] .avatars:hover .avatar:after,
html[transient-theme="Notebook"] .avatars-test:hover .avatar:after {
	content: attr(username);
	display: inline-block;
	background: #000;
	padding: 2px 6px;
	font-size: .8em;
	transform: translate3d(-100%, 10px, 0) translate3d(-10px, 0, 0) rotate(-4deg);
}

html[transient-theme="Notebook"] .avatars .avatar > div.star {
	color: rgba(255,255,255,.3);
	position: absolute;
	margin-left: 47px;
	margin-top: 47px;
}

html[transient-theme="Notebook"] .avatars .avatar > div.snooze {
	color: #fff;
	font-size: 65%;
	font-weight: bold;
	text-shadow: 1px 1px #000;
	position: absolute;
	margin-left: 53px;
	margin-top: -3px;
}

html[transient-theme="Notebook"] .avatars .avatar.snoozed {
	opacity: .25;
}

@media only screen and (max-width: 950px) {
	html .avatars {
		display: none;
	}
	/* 	.avatars {
	top: 5px;
	left: 5px;
}
	.avatars .avatar {
	width: 30px;
	height: 30px;
	margin-bottom: 5px;
	border-width: 1px;
}
	.avatars:hover .avatar:after {
	font-size: 60%;
}
	.avatar > div.star {
	font-size: 40%;
	margin-left: 23px;
	margin-top: 23px;
}
	.avatar > div.snooze {
	display: none;
} */
}
@media only screen and (max-width: 875px) {
	html .avatars {
		display: none;
	}
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Shared Pointers Style" data-id="hLP3y2xb" orig-data-id="GfyCc8Cd" __wid="kSTvZpt3"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="WjfMiBqS">html[transient-theme="Notebook"] .remote-cursor {
	position: absolute;

	/* Set the cursor offscreen initially. If top is not set then cursor
	will be appended like regular position: initial */
	top: -100px;

	z-index: 999;
	width: 12px;
	height: 12px;
	background-color: transparent;
	border-left: 4px solid;
	border-top: 4px solid;
	box-sizing: border-box;
	pointer-events: none;
	/* transition: top 1ms, left 1ms; */
	/* transform: translate3d(20px, -0px, 0); */
	transition: all 0.05s ease 0s;
	opacity: 1;
	transition: opacity 150ms ease-in;
}

html[transient-theme="Notebook"] .remote-cursor:after {
	content: attr(username);
	position: absolute;
	transform: translate3d(5px, 0px, 0);
	font-size: .6em;
}

html[transient-theme="Notebook"] .remote-cursor.hidden {
	opacity: 0;	
}

html[transient-theme="Notebook"] .remote-click {
	position: absolute;
	z-index: 998;
	width: 50px;
	height: 50px;
	/* background-color: orange; */
	transform: translate3d(-25px, -25px, 0) scale(0);
	transition: transform 150ms ease-in-out, opacity 150ms ease-in;
	border-radius: 50%;
	border: 4px solid orange;
	pointer-events: none;
	filter: blur(2px);
	opacity: 1.0;
}

html[transient-theme="Notebook"] .remote-click.animate {
	/* width: 50px;
	height: 50px; */
	transform: translate3d(-25px, -25px, 0) scale(1.0);
	opacity: 0;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" draggable="false" name="Remote Cursors" data-id="rkJsYYY3" orig-data-id="q78PZsdu" __wid="P3W2hwwL"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="NaUzfR3a">html[transient-theme="Notebook"] .client {
	width: 100px;
	height: 1em;
	margin: 1px;
	padding: 1px;
	display: inline-block;
}

html[transient-theme="Notebook"] .cursor {
	position: absolute;
	user-select: none;
	pointer-events: none;
}

html[transient-theme="Notebook"] .cursor .rect {
	/* lighten when white color font */
	mix-blend-mode: lighten;
}

html[transient-theme="Notebook"] .cursor .end {
	opacity: 1.0;
	width: 2px;
}

html[transient-theme="Notebook"] .cursor .end .displayName {
	position: absolute;
	padding: 2px;
	white-space: pre;
	top: -100%;
	font-size: 9pt;
	animation: hide 4s ease 1 normal;
	opacity: 0;
	font-weight: bold;
}

@-webkit-keyframes hide {
	0% { opacity: 1; }
	80% { opacity: 1; }
	100% { opacity: 0; }
}

html[transient-theme="Notebook"] .cursor .rect {
	border-left: none;
}

html[transient-theme="Notebook"] .cursor .rect ~ .rect {
	border: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" draggable="false" name="Carousel" data-id="zYUvDesd" orig-data-id="5RyWnSLX" __wid="PBptkxxB"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="kRfgetmf">html[transient-theme="Notebook"] #paragraph-carousel {
	position: fixed;
	right: 0;
	top: 0;
	max-height: 100vh;
	z-index: 100;
	opacity: 0;
	
	overflow: hidden;
	overflow-y: auto;
	
	transform: translate3d(calc(100% - 20px), 0, 0);
	transition: transform 250ms ease-in-out, opacity 250ms ease-in-out;
}

/* Hide scrollbar */
html[transient-theme="Notebook"] #paragraph-carousel::-webkit-scrollbar {
	width: 0px;  /* remove scrollbar space */
	background: transparent;  /* optional: just make scrollbar invisible */
}

html[transient-theme="Notebook"] #paragraph-carousel:hover {
	transform: translate3d(-5px, 0, 0);
	opacity: 1.0;
}

html[transient-theme="Notebook"] .paragraph-prototype {
	width: 180px;
	height: 65px;
	border-radius: 2px;
	color: black;
	background-color: white;
	padding: 10px;
	margin: 5px 0;
	transform: translate3d(20px, 0, 0);
	transition: transform 250ms ease-in-out;
	cursor: pointer;
	
	box-shadow: 0px 0px 5px black;
	
	user-select: none;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
}

html[transient-theme="Notebook"] .paragraph-prototype:hover {
	transform: translate3d(10px, 0, 0);
}

html[transient-theme="Notebook"] .paragraph-prototype i {
	font-size: 1.2em;
}

html[transient-theme="Notebook"] .paragraph-prototype .template {
	display: none;
}

html[transient-theme="Notebook"] .drop-indicator {
	display: block;
/* 	position: absolute; */
	width: calc(100% + 10px);
	margin-left: -5px;
	
	height: 5px;
	background-color: rgba(255, 255, 255, .9);
}

/* html[transient-dragging="true"],
html[transient-theme="Notebook"][transient-dragging="true"] body {
	background-color: orange;
} */

html[transient-theme="Notebook"][transient-dragging="true"] .paragraph > *:not(#carousel-definitions) {
	pointer-events: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="L5LugzCS" name="Drawing Toolbar/Snackbar Style" orig-data-id="sBa3Chfb" style __wid="gB3DtEjW"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="Juq3Ns6j">html[transient-theme="Notebook"] #snackbar[canvas-tools="true"] .body-content-tools {
	display: none;
}

html[transient-theme="Notebook"] #snackbar[canvas-tools="true"]:not([content-tools]) .drawing {
	display: flex;
}

html[transient-theme="Notebook"] #global-toolbar .drawing i:after,
html[transient-theme="Notebook"] #snackbar .drawing i:after {
	content: "filter_frames";
}

/*html #snackbar[canvas-tools="true"] .drawing {
	background: radial-gradient(rgba(var(--color-accent-text-rgb), 0.8) 0%, rgba(var(--color-accent-text-rgb), 1) 52%, rgba(0, 0, 0, 0) 55%);
}

html[transient-theme="Notebook"] #snackbar[canvas-tools="true"] .drawing {
	color: var(--color-accent);
}*/</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="EZkYtwzh" name="Search Paragraph Style" draggable="false" style orig-data-id="bcCnFNzQ" __wid="spnXcg5R"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="true" class media="none" __wid="fdsGfv8i">html[transient-theme="Notebook"] .awesomplete [hidden] {
	display: none;
}

html[transient-theme="Notebook"] .awesomplete .visually-hidden {
	position: absolute;
	clip: rect(0, 0, 0, 0);
}

html[transient-theme="Notebook"] .awesomplete {
	display: inline-block;
	position: relative;
	display: flex;
	flex: 0 1 100%;
}

html[transient-theme="Notebook"] .awesomplete > input {
	display: block;
}

html[transient-theme="Notebook"] .awesomplete > ul {
	position: absolute;
	left: 0;
	top: 44px;
	color: var(--material-color-black);
	z-index: 1;
	min-width: 100%;
	box-sizing: border-box;
	list-style: none;
	padding: 0;
	margin: 0;
	background: var(--material-color-white);
	max-height: 33vh;
	overflow-y: auto;
}

html[transient-theme="Notebook"] .awesomplete > ul:empty {
	display: none;
}

html[transient-theme="Notebook"] .awesomplete > ul {
	border-radius: 2px;
	background: var(--material-color-white);
	box-shadow: var(--material-shadow-z4);
}

html[transient-theme="Notebook"] .awesomplete > ul {
	transition: 0.3s cubic-bezier(0.4, 0.2, 0.5, 1.4);
	transform-origin: 1.43em -.43em;
}

html[transient-theme="Notebook"] .awesomplete > ul[hidden],
html[transient-theme="Notebook"] .awesomplete > ul:empty {
	opacity: 0;
	transform: scale(0);
	display: block;
	transition-timing-function: ease;
}

html[transient-theme="Notebook"] .awesomplete > ul > li {
	position: relative;
	padding: 8px;
	cursor: pointer;
}

html[transient-theme="Notebook"] .awesomplete > ul > li:hover {
	background: rgba(var(--color-accent-rgb), 0.25);
}

html[transient-theme="Notebook"] .awesomplete mark {
	background: rgba(var(--color-accent-rgb), 0.5);
}

html[transient-theme="Notebook"] .awesomplete > ul > li[aria-selected="true"] {
	background: rgba(var(--color-accent-rgb), 0.5);
}

html[transient-theme="Notebook"] .awesomplete li[aria-selected="true"] mark {
	background: rgba(var(--color-accent-rgb), 1);
	color: var(--color-accent-text);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="4qZ6QQwC" name="Presentation Style" style orig-data-id="khjUmJzS" __wid="7YGs4cLX"><STYLE data-type="content" type="text/css" codemirror="true" __wid="wHW54tUA">html[transient-theme="Notebook"] body.presentation:not([transient-presentation="true"]),
html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) {
	overflow: hidden;
}

html[transient-theme="Notebook"] body.presentation:not([transient-presentation="true"]) .paragraph.presentation,
html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] {
	display: block;
	position: fixed;
	padding: 0;
	margin: 0;
	top: 0;
	left: 0;
	width: 100vw;
	height: 100vh;
	z-index: 250;
	user-select: none;
	cursor: url(presentation_pointer.png), default;
	background: var(--material-color-black);
}

html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"],
html[transient-theme="Notebook"] body.presentation[transient-presentation="true"] {
	border: 0.5rem solid var(--material-color-orange);
}

/******************************************************************************/

html[transient-theme="Notebook"] body.presentation:not([transient-presentation="true"]) .paragraph.presentation .html-editor,
html[transient-theme="Notebook"] body.presentation:not([transient-presentation="true"]) .paragraph.presentation .paragraph-header,
html[transient-theme="Notebook"] body.presentation:not([transient-presentation="true"]) .paragraph.presentation .text-tools,
html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .html-editor,
html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .paragraph-header,
html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .text-tools {
	display: none;
}

html[transient-theme="Notebook"] body.presentation:not([transient-presentation="true"]) .paragraph.presentation .CodeMirror,
html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .CodeMirror {
	overflow: auto;
	height: 100vh;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph .slide[data-type="content"],
html[transient-theme="Notebook"] .paragraph .slide .slide-content{
	margin: 0;
	padding: 0;
	overflow: hidden;
	font-family: "Roboto", "Avenir", sans-serif;
	font-weight: 400;
}

html[transient-theme="Notebook"] .paragraph .slide.slide-hidden {
	outline: 0.25rem solid var(--material-color-orange);
}

/******************************************************************************/

html[transient-theme="Notebook"] .slide .slide-content {
	background: var(--material-color-white);
	color: var(--material-color-black);
	font-size: 48px;
	display: flex;
}

html[transient-theme="Notebook"] body.presentation:not([transient-presentation="true"]) .paragraph.presentation .slide .slide-content,
html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .slide .slide-content {
	position: fixed;
	top: 50%;
	left: 50%;
}

html[transient-theme="Notebook"] body.presentation:not([transient-presentation="true"]) .paragraph.presentation .slide .slide-content[slide-number]:after,
html[transient-theme="Notebook"] body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .slide .slide-content[slide-number]:after{
    content: attr(slide-number);
    position: absolute;
    top: 16px;
    right: 16px;
    padding: 8px 16px;
    background-color: rgba(var(--material-color-white-rgb), 0.5);
    border-radius: 2px;
    font-size: 24px;
    z-index: 299;
    pointer-events: none;
}

/******************************************************************************/

html[transient-theme="Notebook"] .slide .slide-content {
	width: 1920px;
	height: 1080px;
}

html[transient-theme="Notebook"] .slide.aspect-4-3 .slide-content {
	width: 1920px;
	height: 1440px;
}

html[transient-theme="Notebook"] .slide.aspect-16-10 .slide-content {
	width: 1920px;
	height: 1200px;
}

html[transient-theme="Notebook"] .slide.aspect-1-1 .slide-content {
	width: 1920px;
	height: 1920px;
}

/******************************************************************************/

/* Fallback scaling if only persistent parts are left */

html[transient-theme="Notebook"] .slide-container {
	width: 736px;
	height: 414px;
}

html[transient-theme="Notebook"] .slide.aspect-4-3 .slide-container {
	width: 736px;
	height: 552px;
}

html[transient-theme="Notebook"] .slide.aspect-16-10 .slide-container {
	width: 736px;
	height: 460px;
}

html[transient-theme="Notebook"] .slide.aspect-1-1 .slide-container {
	width: 736px;
	height: 736px;
}

html[transient-theme="Notebook"] .slide-content {
	transform: scale(0.5);
	transform-origin: 0 0 0;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="HevdeFh6" name="Output Style" orig-data-id="ftrWXYaM" __wid="Yrjdw8jB"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="ag7vWpSp">html[transient-theme="Notebook"] .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) {
	background: var(--color-primary-shade-3);
	border-radius: 2px;
	border: 4px solid;
	border-color: var(--color-primary);
	box-shadow: none;
	margin-bottom: 24px;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .paragraph-header {
	z-index: 2;
	position: absolute;
	top: -46px;
	box-shadow: var(--material-shadow-z4);
	background: var(--color-primary-shade-1);
}

html[transient-theme="Notebook"] .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):not([transient-focussed]):not(:hover) .paragraph-header {
	display: none;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):before,
html[transient-theme="Notebook"] .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):after {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: 50%;
	width: 0;
	height: 0;
	border-left: 120px solid transparent;
	border-right: 120px solid transparent;
}

html[transient-theme="Notebook"] .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):before {
	transform: translate3d(-50%, -28px, 0);
	border-top: 30px solid var(--color-accent);
	z-index: 2;
}

html[transient-theme="Notebook"] .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):after {
    transform: translate3d(-50%, 0, 0);
    border-top: 30px solid var(--color-primary);
    z-index: 1;
}

/******************************************************************************/


html[transient-theme="Notebook"] .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror,
html[transient-theme="Notebook"] .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) [data-type="content"] {
	padding: 24px;
	border: none !important;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror {
	background: none !important;
}

html[transient-theme="Notebook"] .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-activeline-background,
html[transient-theme="Notebook"] .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-rulers,
html[transient-theme="Notebook"] .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-gutters,
html[transient-theme="Notebook"] .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-gutter-wrapper {
	display: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="Hide Headers Style" data-id="FLbpQXqh" orig-data-id="hhQ5bTAE" __wid="jL4ruXur"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="kCxLwvMc">html[transient-theme="Notebook"] .paragraph.hide-header:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .paragraph-header,
html[transient-theme="Notebook"] .paragraph:not(.body-paragraph):not(.collapsed) .paragraph-header {
	z-index: 3;
	position: absolute;
	top: -40px;
	box-shadow: var(--material-shadow-z4);
	background: var(--color-primary-shade-1);
}

html[transient-theme="Notebook"] .paragraph.hide-header:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):not([transient-focussed]):not(:hover) .paragraph-header,
html[transient-theme="Notebook"] .paragraph:not(.body-paragraph):not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):not([transient-focussed]):not(:hover) .paragraph-header {
	display: none;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph:not(.body-paragraph):not(.collapsed) :not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror {
	padding: 15px;
	margin: 0;
	background: var(--color-primary-shade-3);
	border: 4px solid var(--color-accent);
	border-radius: 2px;
}

html[transient-theme="Notebook"] .paragraph:not(.body-paragraph):not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-activeline-background,
html[transient-theme="Notebook"] .paragraph:not(.body-paragraph):not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-rulers,
html[transient-theme="Notebook"] .paragraph:not(.body-paragraph):not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-gutters,
html[transient-theme="Notebook"] .paragraph:not(.body-paragraph):not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-gutter-wrapper {
	display: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Console Style" draggable="false" data-id="HN4Q2bPQ" orig-data-id="Xi64tc6E" __wid="vkyaCvwf"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="9PdE35Ms">html[transient-theme="Notebook"] .console {
	margin-top: 8px;
	width: 100%;
	height: 0;
	opacity: 0;
	pointer-events: none;
	z-index: 9;
	border-radius: 2px;
	display: none;
	background: var(--color-primary-shade-1);
	padding: 8px;
	/* -webkit-transition: height 500ms ease-in-out 0s, opacity 500ms ease-in-out 0s;
	-moz-transition: height 500ms ease-in-out 0s, opacity 500ms ease-in-out 0s;
	transition: height 500ms ease-in-out 0s, opacity 500ms ease-in-out 0s; */
}

html[transient-theme="Notebook"] .console.open {
	display: flex;
	/* flex: 1; */
	/* flex-direction: column; */
	flex-flow: column;
	min-height: 192px;
	opacity: 1.0;
	pointer-events: all;
	overflow: hidden;
	overflow-y: hidden;
	resize: vertical;
}

html[transient-theme="Notebook"] .console.close {
	border: 0;
	padding: 0;
	margin: 0;
}

html[transient-theme="Notebook"] .console .header {
	padding: 4px;
	border-bottom: 1px solid var(--color-tertiary-text);
}

html[transient-theme="Notebook"] .console .header:before {
	content: "Console";
}

html[transient-theme="Notebook"] .console .close-console {
	position: absolute;
	top: 0;
	right: 0;
	height: 100%;
	z-index: 1;
	cursor: pointer;
	/* font-size: .6em; */
}

/******************************************************************************/

/* html .console .close-console i:after {
content: "close";
position: absolute;
top: 50%;
right: 0;
font-size: .8em;
transform: translate3d(0, -50%, 0);
} */

html[transient-theme="Notebook"] .console .output,
html[transient-theme="Notebook"] .console .input {
	font-family: var(--font-monospace);
	font-size: 0.8125rem;
}

html[transient-theme="Notebook"] .console .output {
	flex: 1;
	/* background-color: orange; */
	overflow: hidden;
	overflow-y: auto;
	/* padding: 5px; */
	/* border-top: 1px solid rgba(255, 255, 255, .05);
	border-bottom: 1px solid rgba(255, 255, 255, .05); */
}

html[transient-theme="Notebook"] .console > .output > .log-output {
	display: flex;
	flex-direction: row;
	/* word-break: break-all; */
	/* word-wrap: break-word; */
	/* float: right; */
	/* white-space: pre-wrap; */
	padding: 0 4px;
	border-top: 1px solid rgba(255, 255, 255, .05);
	border-bottom: 1px solid rgba(255, 255, 255, .05);
	/* margin-bottom: -1px; */
}

html[transient-theme="Notebook"] .console > .output > .log-output > * {
	/* display: inline; */
	padding: 3px;
}

html[transient-theme="Notebook"] .console > .output > .log-output > .message {
	flex: 1;
}

/* html .console > .output > div:not(:last-child) {
padding: 3px 0 3px 0;
border-bottom: 1px solid rgba(255, 255, 255, .1);
}

html[transient-theme="Notebook"] .console > .output > div:last-child {
padding: 3px 0 0 0;
}

html[transient-theme="Notebook"] .console > .output > div > .time {
color: rgb(135, 135, 129);
} */

/******************************************************************************/

html[transient-theme="Notebook"] .console > .output > .log-output.error {
	color: var(--material-color-red);
	background-color: rgba(var(--material-color-red-rgb), 0.1);
}

html[transient-theme="Notebook"] .console > .output > .log-output .time,
html[transient-theme="Notebook"] .console > .output > .log-output .location {
	color: var(--color-tertiary-text);
}

html[transient-theme="Notebook"] .console > .output > .log-output .location {
	text-decoration: underline;
	cursor: pointer;
}

html[transient-theme="Notebook"] .console > .output > .log-output.warn {
	color: var(--material-color-yellow);
	background-color: rgba(var(--material-color-yellow-rgb), 0.1);
}

html[transient-theme="Notebook"] .console > .output > .log-output.info {
	color: var(--material-color-light-blue);
	background-color: rgba(var(--material-color-light-blue-rgb), 0.1);
}

html[transient-theme="Notebook"] .console > .output > .log-output.debug {
	color: var(--color-tertiary-text);
}

html[transient-theme="Notebook"] .console > .output > .log-output > .message .number,
html[transient-theme="Notebook"] .console > .output > .log-output > .message .boolean {
	color: #9179ff;
}

html[transient-theme="Notebook"] .console > .output > .log-output > .message .object {

}

html[transient-theme="Notebook"] .console > .output > .log-output > .message .null,
html[transient-theme="Notebook"] .console > .output > .log-output > .message .undefined {
	color: rgb(135, 135, 129);
}

html[transient-theme="Notebook"] .console > .output > .log-output > .message.info:before {
	content: "INFO: ";
	display: inline-block;
}

/******************************************************************************/

html[transient-theme="Notebook"] .console .input {
	padding: 4px;
	border-top: 1px solid var(--color-tertiary-text);
}

html[transient-theme="Notebook"] .console .input:before {
	content: ">";
	margin-right: 5px;
	font-weight: bold;
	width: 10px;
	display: inline-block;
}

html[transient-theme="Notebook"] .console .input input[type="text"] {
	font-family: inherit;
	border: 0;
	outline: 0;
	color: var(--color-primary-text);
	width: calc(100% - 15px);
	background-color: transparent;
}

/******************************************************************************/

html[transient-theme="Notebook"] .console [error-id] {
	text-decoration: underline;
	cursor: pointer;
}

html[transient-theme="Notebook"] .CodeMirror .line-error {
	background-color: var(--material-color-red);
	animation-name: highlight;
	animation-duration: 1250ms;
	opacity: .15;
	margin-right: 5px;
}

/* html .CodeMirror .line-error-text {
text-decoration: underline;
text-decoration-color: red;
text-decoration-style: wavy;
} */

/* html .CodeMirror .line-error-gutter {
text-decoration: underline;
text-decoration-color: red;
text-decoration-style: wavy;
} */

/* html .CodeMirror .line-error-wrap {
text-decoration: underline;
text-decoration-color: red;
text-decoration-style: wavy;
} */

/******************************************************************************/

@keyframes highlight {
	from {
		opacity: .5;
	}
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="56xLprWL" draggable="false" style name="Dialog Style" orig-data-id="L4rzUGdH" __wid="fjgXkERH"><STYLE data-type="content" type="text/css" class codemirror="true" __wid="jTTd9vM3">@keyframes dialogAnimation {
	from {
		transform: translate(-50%, -50%) translate(0, 96px) scale(0.75);
		opacity: 0;
	}
}

@keyframes modalAnimation {
	from {
		opacity: 0;
	}
}

html[transient-theme="Notebook"] .dialog {
	display: flex;
	flex-direction: column;
	position: fixed;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	min-width: 384px;
	max-width: calc(100vw - 32px);
	z-index: 400;
	box-shadow: var(--material-shadow-z24);
	border-radius: 2px;
	background: var(--color-primary-shade-3);
	animation: dialogAnimation var(--navigation-transition);
}

html[transient-theme="Notebook"] .modal {
	position: fixed;
	left: 0;
	top: 0;
	width: 100vw;
	height: 100vh;
	background: var(--color-primary-text);
	opacity: 0.25;
	pointer-events: none;
	z-index: 399;
	animation: modalAnimation var(--navigation-transition);
}

/******************************************************************************/

html[transient-theme="Notebook"] .dialog .title {
	color: var(--color-primary-text);
	display: flex;
	align-items: center;
	font-size: 1.425rem;
	font-weight: 500;
	letter-spacing: 0.02em;
	line-height: 2rem;
	flex: 1;
	margin: 0;
	padding: 24px 24px 0;
}

html[transient-theme="Notebook"] .dialog .body {
	color: var(--color-secondary-text);
	font-size: 1rem;
	font-weight: 400;
	letter-spacing: 0.02em;
	line-height: 1.25rem;
	margin-top: 20px;
	padding: 0 24px 24px;
	max-height: 80vh;
	overflow-y: auto;
	max-width: 512px;
}

html[transient-theme="Notebook"] .dialog .actions {
	display: flex;
	flex-wrap: wrap;
	align-items: center;
	justify-content: flex-end;
	padding: 8px;
}

/******************************************************************************/

html[transient-theme="Notebook"] .dialog .button {
	color: var(--color-primary-text);
	background: none;
	font-size: 1rem;
	font-weight: 500;
	letter-spacing: 0.04em;
	line-height: 2.25rem;
	text-decoration: none;
	text-transform: uppercase;
	display: inline-block;
	box-sizing: border-box;
	min-width: 64px;
	height: 36px;
	padding: 0 16px;
	border: none;
	outline: none;
	text-align: center;
	overflow: hidden;
	vertical-align: middle;
	border-radius: 2px;
	cursor: pointer;
	margin-right: 8px;
	user-select: none;
}

html[transient-theme="Notebook"] .dialog .button:last-child {
	margin-right: 0;
}

html[transient-theme="Notebook"] .dialog .button:hover {
	background-color: var(--color-primary-shade-2);
}

/******************************************************************************/

html[transient-theme="Notebook"] .dialog .body input {
	font-size: 1rem;
	width: 100%;
	padding: 4px;
	outline: 0;
	color: var(--color-primary-text);
	background-color: transparent;
	border: 0;
	border-bottom: 1px solid var(--color-tertiary-text);
	margin-top: 8px;
	margin-bottom: 16px;
}

html[transient-theme="Notebook"] .dialog .body input:focus {
	border-bottom-color: var(--color-secondary-text);
}

html[transient-theme="Notebook"] .dialog .body input:invalid {
	border-bottom-color: var(--material-color-red);
}

html[transient-theme="Notebook"] .dialog .body input::-webkit-calendar-picker-indicator {
	opacity: 1.0;
}

html[transient-theme="Notebook"] .dialog .body input::-webkit-calendar-picker-indicator:hover {
	background: var(--color-primary-shade-2);
}

/******************************************************************************/

html[transient-theme="Notebook"] .dialog .body select {
	background: var(--material-color-grey-100);
	color: var(--material-color-grey-900);
	font-size: 1rem;
	font-family: var(--font-primary);
	border: none;
	border-radius: 2px;
	outline: none;
	padding: 4px;
	margin-top: 8px;
	margin-bottom: 16px;
	width: 100%;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" name="Show Tags Dialog Style" data-id="dFtHdKJw" style orig-data-id="2yNTLyMH" __wid="M2dLhmhr"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="z8pVk2jk">html[transient-theme="Notebook"] .dialog ul.tags {
	list-style-type: none;
	margin: 0;
	padding: 0;
}

html[transient-theme="Notebook"] .dialog ul li.tag {
	padding: 6px 8px;
	cursor: pointer;
	border-radius: 2px;
}

html[transient-theme="Notebook"] .dialog ul li.tag:hover {
	background-color: var(--color-primary-shade-2);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="PDiGnYdE" name="Toast Style" orig-data-id="es3FhyeZ" __wid="dzfcnEJT"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="QEmBmFuw">@keyframes toastAnimation {
	from {
		opacity: 0;
		transform: translate(0, 72px);
	}
}

html[transient-theme="Notebook"] .toast {
	position: fixed;
	right: 24px;
	bottom: 24px;
	display: flex;
	align-items: center;
	justify-content: space-between;
	min-height: 48px;
	max-width: calc(100% - 48px);
	background: var(--color-primary-shade-1);
	box-shadow: var(--material-shadow-z6);
	border-radius: 2px;
	padding: 16px;
	z-index: 500;
	font-size: 0.875rem;
	word-wrap: break-word;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	animation: toastAnimation var(--navigation-transition);
	transition: opacity var(--navigation-transition),
							transform var(--navigation-transition);
}

html[transient-theme="Notebook"] .toast.hidden {
	opacity: 0;
	transform: translate(0, 72px);
}

/******************************************************************************/

html[transient-theme="Notebook"] .toast .action {
	display: flex;
	align-items: center;
}

html[transient-theme="Notebook"] .toast .button {
	border-radius: 2px;
	cursor: pointer;
}

html[transient-theme="Notebook"] .toast .button.custom-action {
	font-weight: 500;
	letter-spacing: 0.04em;
	text-transform: uppercase;
	color: var(--color-accent);
	margin-left: 48px;
}

html[transient-theme="Notebook"] .toast .button.close {
	display: flex;
	margin-left: 16px;
	user-select: none;
}

html[transient-theme="Notebook"] .toast .button.close i:after {
	display: flex;
	content: "close";
	font-size: 1rem;
}

/******************************************************************************/

@media only screen and (max-device-width: 480px) {
	html .toast {
		right: 0;
		bottom: 0;
		width: 100%;
		max-width: 100%;
		border-radius: 0;
	}
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="YKTMeJCf" name="Context Menu Style" orig-data-id="XNdJDpED" __wid="MYpSzAyP"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="D8wnD9D3">.context-menu {
	position: absolute;
	z-index: 301;
}

.context-menu * {
	box-sizing: border-box !important;
}

.z-depth-1 {
	box-shadow: 0 2px 5px 0 rgba(0,0,0,0.16), 0 2px 10px 0 rgba(0,0,0,0.12);
}

.grey-text.text-darken-2 {
	color: #616161 !important;
}

.context-menu ul.menu {
	list-style-type: none;
}

.context-menu .menu,
.context-menu .sub-menu {
  opacity: 0;
  pointer-events: none;
  transition: opacity .5s;
  margin: 0;
  min-width: 200px;
  box-sizing: border-box;
  background: #fff;
  display: inline-block;
  padding: 8px 0;
  border-radius: 2px;
}

.context-menu .menu.open,
.context-menu .sub-menu.open {
  opacity: 1;
  pointer-events: all;
}

.context-menu .menu li:not(.separator),
.context-menu .sub-menu li:not(.separator) {
  position: relative;
  box-sizing: border-box;
  padding: 16px 72px;
  width: 100%;
  transition: .3s;
  text-align: left !important;
  white-space: nowrap;
  display: flex;
	align-items: center;
}

.context-menu .menu li .sub-menu,
.context-menu .sub-menu li .sub-menu {
	align-self: flex-start;
}

.context-menu .menu li:not(.separator):hover,
.context-menu .sub-menu li:not(.separator):hover {
  background: #eee;
}

.context-menu .menu li:not(.separator) .material-icons,
.context-menu .sub-menu li:not(.separator) .material-icons {
  position: absolute;
  left: 24px;
}

.context-menu .menu li:not(.separator) .right,
.context-menu .sub-menu li:not(.separator) .right {
  left: auto;
  right: 24px;
}

.context-menu .menu .disabled,
.context-menu .sub-menu .disabled {
  opacity: .7;
  cursor: default;
}

.context-menu .menu .disabled:hover,
.context-menu .sub-menu .disabled:hover {
  background: transparent !important;
}

.context-menu .menu .separator,
.context-menu .sub-menu .separator {
  margin: 8px 0;
  border-bottom: 1px solid #ddd;
}

.context-menu .menu .waves,
.context-menu .sub-menu .waves {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  z-index: 10;
}

.context-menu .menu .sub-menu-item,
.context-menu .sub-menu .sub-menu-item {
  overflow: visible;
}

.context-menu .menu .sub-menu-item .sub-menu,
.context-menu .sub-menu .sub-menu-item .sub-menu {
  opacity: 0;
  pointer-events: none;
  transition: .3s;
  position: absolute;
  z-index: 11;
  width: auto;
  margin: 0;
  left: calc(100% - 4px);
}

.menu .sub-menu-item .right,
.sub-menu .sub-menu-item .right {
  transition: .5s;
}

.menu .sub-menu-item.open>.sub-menu,
.sub-menu .sub-menu-item.open>.sub-menu {
  opacity: 1;
  pointer-events: all;
}

.menu .sub-menu-item.open>.right,
.sub-menu .sub-menu-item.open>.right {
	transform: rotate(-180deg);
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="yxHzQjis" draggable="false" style name="Global Toolbar Style" orig-data-id="y7Q3AHEx" __wid="bgR3Mhdv"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="vv66zyRP">html[transient-theme="Notebook"] #global-toolbar {
	background: var(--color-primary);
	color: var(--color-primary-text);
	display: block;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 64px;
	overflow-x: scroll;
	overflow-y: hidden;
	z-index: 200;
	box-shadow: var(--material-shadow-z4);
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	transition: transform var(--navigation-transition),
							box-shadow var(--navigation-transition);
}

html[transient-theme="Notebook"] #global-toolbar::-webkit-scrollbar {
	display: none;
}

html[transient-theme="Notebook"] body[transient-toolbar-hidden="true"] #global-toolbar {
	box-shadow: none;
	transform: translate(0, -100%);
}

/******************************************************************************/

html[transient-theme="Notebook"] #global-toolbar .toolbar-row {
	display: flex;
	justify-content: space-between;
	position: relative;
	align-items: center;
	width: 100%;
	height: 100%;
	padding: 8px;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-container {
	display: flex;
	box-sizing: border-box;
	height: 48px;
	vertical-align: middle;
	z-index: 1;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-left {
	flex: 1 0 auto;
	justify-content: flex-start;
	order: -1;
	padding-right: 32px;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-center {
	flex: 1 1 100%;
	justify-content: center;
	order: 0;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-right {
	flex: 0 0 auto;
	justify-content: flex-end;
	order: 1;
	padding-left: 32px;
}

/******************************************************************************/

html[transient-theme="Notebook"] #global-toolbar .toolbar-button {
	display: flex;
	padding: 4px;
	width: 48px;
	height: 48px;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	border-radius: 50%;
	flex-shrink: 0;
	user-select: none;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-title {
	font-size: 1.25rem;
	font-weight: 500;
	letter-spacing: 0.02rem;
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
	align-self: center;
	padding: 0 16px;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-title+.toolbar-title {
	padding-left: 0;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-input {
	cursor: text;
	outline: none;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-input:empty:before {
	content: "Empty";
	opacity: 0.5;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-search {
	background: var(--color-primary-shade-1);
	border-radius: 4px;
	display: flex;
	flex: 0 1 512px;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-search-input {
	flex: 0 1 100%;
	outline: none;
	background: none;
	border: none;
	color: var(--color-primary-text);
	text-overflow: ellipsis;
	font-size: 1em;
	letter-spacing: 0.02rem;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-search-input::placeholder {
	color: var(--color-tertiary-text);
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-search-button-search,
html[transient-theme="Notebook"] #global-toolbar .toolbar-search-button-clear {
	width: 40px;
	height: 40px;
	margin: 4px;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-search-button-search i:after {
	content: "search";
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-search-input:placeholder-shown ~ .toolbar-search-button-clear {
	visibility: hidden;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-search-button-clear i:after {
	content: "clear";
}

/******************************************************************************/

html[transient-theme="Notebook"] #global-toolbar .toolbar-input-title:empty:before {
	content: "No Title";
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-button-menu {
	padding-right: 24px;
	padding-left: 24px;
}

html[transient-theme="Notebook"] #global-toolbar .toolbar-button-menu i:after {
	content: "menu";
}

/******************************************************************************/

html[transient-theme="Notebook"] #global-toolbar hr {
	border: none;
	border-left: 1px solid var(--color-primary-text);
	margin: 8px 4px;
	opacity: 0.8;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="hhZWaSU7" name="Global Menu Style" style draggable="false" orig-data-id="wckGBv9N" __wid="5XRAFwTr"><STYLE data-type="content" type="text/css" class codemirror="true" __wid="rM8qx2zY">html[transient-theme="Notebook"] #global-menu {
	background-color: var(--color-primary-shade-1);
	color: var(--color-primary-text);
	position: fixed;
	top: 0;
	left: 0;
	width: 288px;
	height: 100vh;
	z-index: 100;
	padding-top: 80px;
	padding-bottom: 8px;
	box-shadow: var(--material-shadow-z6);
	transition: transform var(--navigation-transition),
							box-shadow var(--navigation-transition),
							padding-top var(--navigation-transition);
}

html[transient-theme="Notebook"] body[transient-toolbar-hidden="true"] #global-menu {
	padding-top: 16px;
}

html[transient-theme="Notebook"] body:not([transient-menu-pinned="true"]) #global-menu {
	transform: translate(-100%, 0);
	box-shadow: none;
}

/**************************************************************************************************/

html[transient-theme="Notebook"] body:not([transient-menu-pinned="true"])  #global-menu:hover {
	transform: none;
	box-shadow: var(--material-shadow-z6);
}

html[transient-theme="Notebook"] #global-menu .handle {
	position: absolute;
	right: 0;
	top: 50%;
	transform: translate(100%, -50%);
	transition: opacity var(--navigation-transition);
}

html[transient-theme="Notebook"] #global-menu .handle:after {
	content: "keyboard_arrow_right";
	background: var(--color-primary);
	border-top-right-radius: 50%;
	border-bottom-right-radius: 50%;
}

html[transient-theme="Notebook"] #global-menu:hover .handle,
html[transient-theme="Notebook"] body[transient-menu-pinned="true"] #global-menu .handle {
	opacity: 0;
}

/**************************************************************************************************/

html[transient-theme="Notebook"] #global-menu .menu-container {
	display: flex;
	flex-direction: column;
	width: 100%;
	height: 100%;
	overflow: hidden;
	overflow-y: auto;
	flex-wrap: nowrap;
}

/**************************************************************************************************/

html[transient-theme="Notebook"] #global-menu .menu-container hr {
	border: 0;
	border-bottom: 1px solid var(--color-primary);
	width: 100%;
}

html[transient-theme="Notebook"] #global-menu .menu-container .menu-button,
html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu > .label {
	height: 40px;
	font-weight: 500;
	cursor: pointer;
	font-size: 0.9rem;
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: flex-start;
	border: none;
	background: none;
	padding-left: 16px;
	padding-right: 16px;
	flex-shrink: 0;
}


html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu {
	display: flex;
	flex-direction: column;
	flex-wrap: nowrap;
	flex-shrink: 0;
	border: 0;
	padding-bottom: 8px;
	border-bottom: 1px solid var(--color-primary);
	margin-bottom: 8px;
}

html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu > .label .expander {
	margin-right: 8px;
}

html[transient-theme="Notebook"] #global-menu .menu-container .menu-button:hover,
html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu > .label:hover,
html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu:not(.hidden) > .label {
	background: var(--color-primary);
}

html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu > .label i {
	font-size: 1.4rem;
	display: flex
}

html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu > .label i:after {
	content: "keyboard_arrow_down";
}

html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu.hidden > .label i:after {
	content: "keyboard_arrow_right";
}

html[transient-theme="Notebook"] #global-menu .menu-container .sub-menu.hidden > *:not(.label) {
	display: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="96HKgbmg" name="Snackbar Style" style orig-data-id="D7BPWi9D" draggable="false" __wid="ie6txDmb"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="true" class media="none" __wid="6uhSGWf6">html[transient-theme="Notebook"] #snackbar .snackbar {
	background: var(--color-primary);
	color: var(--color-primary-text);
	display: block;
	position: fixed;
	bottom: 0;
	left: 50%;
	width: 64rem;
	max-width: 100vw;
	margin-right: 16px;
	z-index: 50;
	box-shadow: none;
	opacity: 0;
	transform: translate(-50%, 100%);
	overflow-x: scroll;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	transition: transform var(--navigation-transition),
							box-shadow var(--navigation-transition),
							width var(--navigation-transition),
							opacity var(--navigation-transition),
							left var(--navigation-transition);
}

html[transient-theme="Notebook"] #snackbar .snackbar::-webkit-scrollbar {
	display: none;
}

@keyframes fadeAnimation {
	from {
		opacity: 0;
	}
}

html[transient-theme="Notebook"] #snackbar .snackbar-fade {
	position: fixed;
	left: 0;
	top: 0;
	width: 100vw;
	height: 100vh;
	background: var(--color-primary-text);
	opacity: 0.25;
	pointer-events: none;
	z-index: 249;
	animation: fadeAnimation var(--navigation-transition);
	display: none;
}

html[transient-theme="Notebook"] #snackbar.content-expanded-open .snackbar-fade {
	display: block;
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar.row-open .snackbar {
	box-shadow: var(--material-shadow-z6);
	transform: translate(-50%, 0);
	opacity: 1;
}

html[transient-theme="Notebook"] #snackbar.content-open .snackbar-content {
	height: calc(25vh - 48px);
}

html[transient-theme="Notebook"] #snackbar.content-expanded-open .snackbar-content {
	height: calc(100vh - 48px);
}

html[transient-theme="Notebook"] #snackbar.content-expanded-open .snackbar {
	z-index: 250;
}

html[transient-theme="Notebook"] body[transient-menu-pinned="true"] #snackbar .snackbar {
	left: calc(50% + 144px);
	max-width: calc(100vw - 288px);
}

html[transient-theme="Notebook"] body[transient-notification-pinned="true"] #snackbar .snackbar {
	left: calc(50% - 192px);
	max-width: calc(100vw - 384px);
}

html[transient-theme="Notebook"] body[transient-menu-pinned="true"][transient-notification-pinned="true"] #snackbar .snackbar {
	left: calc(50% - 48px);
	max-width: calc(100vw - 672px);
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar .snackbar-row {
	display: flex;
	justify-content: space-between;
	position: relative;
	align-items: center;
	width: 100%;
	height: 48px;
	padding: 8px;
}

html[transient-theme="Notebook"] #snackbar .snackbar-container {
	display: flex;
	box-sizing: border-box;
	height: 32px;
	vertical-align: middle;
	z-index: 1;
}

html[transient-theme="Notebook"] #snackbar .snackbar-left {
	flex: 1 0 auto;
	justify-content: flex-start;
	order: -1;
	padding-right: 24px;
}

html[transient-theme="Notebook"] #snackbar .snackbar-center {
	flex: 1 1 100%;
	justify-content: center;
	order: 0;
}

html[transient-theme="Notebook"] #snackbar .snackbar-right {
	flex: 0 0 auto;
	justify-content: flex-end;
	order: 1;
	padding-left: 24px;
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar .snackbar-content {
	display: block;
	position: relative;
	background: var(--color-primary-shade-1);
	color: var(--color-primary-text);
	height: 0;
	overflow-y: auto;
	width: 100%;
	padding: 0 24px;
	transition: height var(--navigation-transition),
							padding var(--navigation-transition);
}

html[transient-theme="Notebook"] #snackbar.content-open .snackbar-content {
	padding: 16px;
}

html[transient-theme="Notebook"] #snackbar .content-title {
	order: -999;
}

html[transient-theme="Notebook"] #snackbar .content-expand {
	order: 998;
}

html[transient-theme="Notebook"] #snackbar .content-close {
	order: 999;
}

html[transient-theme="Notebook"] #snackbar .content-expand i:after {
	content: "fullscreen";
}

html[transient-theme="Notebook"] #snackbar.content-expanded-open .content-expand i:after {
	content: "fullscreen_exit";
}

html[transient-theme="Notebook"] #snackbar .content-close i:after {
	content: "close";
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar .snackbar-button {
	display: flex;
	padding: 4px;
	width: 32px;
	height: 32px;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	border-radius: 50%;
	margin: 0 4px;
	user-select: none;
}

html[transient-theme="Notebook"] #snackbar .snackbar-title {
	font-size: 1.25rem;
	font-weight: 500;
	letter-spacing: 0.02rem;
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
	align-self: center;
	padding: 0 8px;
}

html[transient-theme="Notebook"] #snackbar .snackbar-title+.snackbar-title {
	padding-left: 0;
}

html[transient-theme="Notebook"] #snackbar .snackbar-input {
	cursor: text;
	outline: none;
}

html[transient-theme="Notebook"] #snackbar .snackbar-input:empty:before {
	content: "Empty";
	opacity: 0.5;
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar hr {
	border: none;
	border-left: 1px solid var(--color-primary-text);
	margin: 4px;
	opacity: 0.8;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="y43JekjL" name="Snackbar Tools Style" draggable="false" style orig-data-id="Nj3GC2by" __wid="vYkb5umA"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="6BuW7KXH">html[transient-theme="Notebook"] #snackbar:not([section-tools="true"]) .section-tools {
	display: none;
}

html[transient-theme="Notebook"] #snackbar:not([paragraph-tools="true"]) .paragraph-tools {
	display: none;
}

html[transient-theme="Notebook"] #snackbar:not([body-tools="true"]) .body-tools {
	display: none;
}

html[transient-theme="Notebook"] #snackbar:not([style-tools="true"]) .style-tools {
	display: none;
}

html[transient-theme="Notebook"] #snackbar:not([code-tools="true"]) .code-tools {
	display: none;
}

html[transient-theme="Notebook"] #snackbar:not([data-tools="true"]) .data-tools {
	display: none;
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar:not([content-tools="true"]) .content-tools {
	display: none;
}

html[transient-theme="Notebook"] #snackbar .snackbar-title.content-tools+.snackbar-title {
	padding-left: 8px;
}

html[transient-theme="Notebook"] #snackbar[content-tools="true"] .snackbar-button:not(.content-tools),
html[transient-theme="Notebook"] #snackbar[content-tools="true"] .snackbar-title:not(.content-tools),
html[transient-theme="Notebook"] #snackbar[content-tools="true"] hr:not(.content-tools) {
	display: none;
}

html[transient-theme="Notebook"] .paragraph-header {
	transition: border-left var(--navigation-transition);
}

html[transient-theme="Notebook"] .paragraph[transient-content-paragraph] .paragraph-header {
	border-left: 4px solid var(--color-accent);
	border-radius: 4px 2px 2px 4px;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="2PtX36Qp" name="Snackbar Tools HTML Editor Style" orig-data-id="CYYui4Xj" draggable="false" style __wid="xiGjAJ3L"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="UuBt6gRB">html[transient-theme="Notebook"] #snackbar:not([html-editor-tools="true"]) .html-editor-tools {
	display: none;
}

html[transient-theme="Notebook"] #snackbar[html-editor-tools="true"][content-tools="true"] .html-editor-tools {
	display: flex;
}

html[transient-theme="Notebook"] #snackbar .snackbar-content .html-editor .CodeMirror,
html[transient-theme="Notebook"] #snackbar .snackbar-content .html-editor .CodeMirror-gutters  {
	background: none;
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar .html-editor-button i:after {
	content: var(--xml);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #snackbar .html-save-button i:after {
	content: "save";
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="umYM968T" name="Snackbar Tools Code Execution Style" orig-data-id="SfU3DezA" style draggable="false" __wid="KZ6knxML"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="ZYKBPgxm">html[transient-theme="Notebook"] #snackbar .snackbar-content .console {
	height: 100%;
	margin: 0;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" style name="Palette Style" data-id="3CAtUisN" draggable="false" orig-data-id="NWmXiMi9" __wid="ragwVsYP"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="Fw9MWubH">html[transient-theme="Notebook"] .palette .palette-modal {
	position: fixed;
	left: 0;
	top: 0;
	width: 100vw;
	height: 100vh;
	background: var(--color-primary-text);
	opacity: 0.25;
	z-index: 397;
	transition: opacity var(--navigation-transition);
	opacity: 0;
	pointer-events: none;
}

html[transient-theme="Notebook"] .palette.visible .palette-modal {
	opacity: 0.35;
	pointer-events: all;
}

html[transient-theme="Notebook"] .palette .palette-search {
	display: flex;
	flex-direction: row;
	position: fixed;
	top: 160px;
	left: 50%;
	min-width: 400px;
	z-index: 398;
	box-shadow: var(--material-shadow-z24);
	border-radius: 2px;
	background: var(--color-primary-shade-3);
	transition: opacity var(--navigation-transition),
							transform var(--navigation-transition);
	opacity: 0;
	transform: translate(-50%, -50%) translate(0, 96px) scale(0.75);
	pointer-events: none;
}

html[transient-theme="Notebook"] .palette.visible .palette-search {
	opacity: 1;
	transform: translate(-50%, -50%);
	pointer-events: all;
}

/******************************************************************************/

html[transient-theme="Notebook"] .palette .palette-button {
	display: flex;
	padding: 4px;
	width: 48px;
	height: 48px;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	border-radius: 50%;
	flex-shrink: 0;
	user-select: none;
}

html[transient-theme="Notebook"] .palette .palette-search {
	background: var(--color-primary-shade-3);
	border-radius: 4px;
	display: flex;
	flex: 0 1 512px;
}

html[transient-theme="Notebook"] .palette .palette-input {
	flex: 0 1 100%;
	outline: none;
	background: none;
	border: none;
	color: var(--color-primary-text);
	text-overflow: ellipsis;
	font-size: 1em;
	letter-spacing: 0.02rem;
}

html[transient-theme="Notebook"] .palette .palette-input::placeholder {
	color: var(--color-tertiary-text);
}

html[transient-theme="Notebook"] .palette .palette-button-search,
html[transient-theme="Notebook"] .palette .palette-button-close {
	width: 40px;
	height: 40px;
	margin: 4px;
}

html[transient-theme="Notebook"] .palette .palette-icon {
	cursor: default;
}

/******************************************************************************/

html[transient-theme="Notebook"] .palette .awesomplete [hidden] {
	display: none;
}

html[transient-theme="Notebook"] .palette .awesomplete .visually-hidden {
	position: absolute;
	clip: rect(0, 0, 0, 0);
}

html[transient-theme="Notebook"] .palette .awesomplete {
	display: inline-block;
	position: relative;
	display: flex;
	flex: 0 1 100%;
}

html[transient-theme="Notebook"] .palette .awesomplete > input {
	display: block;
}

html[transient-theme="Notebook"] .palette .awesomplete > ul {
	position: absolute;
	left: 0;
	top: 48px;
	color: var(--color-primary-text);
	z-index: 398;
	min-width: 100%;
	box-sizing: border-box;
	list-style: none;
	padding: 0;
	margin: 0;
	max-height: 320px;
	overflow-y: auto;
	border-radius: 0 0 4px 4px;
	background: var(--color-primary-shade-3);
	box-shadow: var(--material-shadow-z24);
	transition: 0.3s cubic-bezier(0.4, 0.2, 0.5, 1.4);
	transform-origin: 1.43em -.43em;
}

html[transient-theme="Notebook"] .palette .awesomplete > ul::-webkit-scrollbar-thumb {
	border-radius: 0px;
	background-color: var(--color-primary-shade-1);
}

html[transient-theme="Notebook"] .palette .awesomplete > ul:empty {
	display: none;
}

html[transient-theme="Notebook"] .palette .awesomplete > ul[hidden],
html[transient-theme="Notebook"] .palette .awesomplete > ul:empty {
	opacity: 0;
	transform: scale(0);
	display: block;
	transition-timing-function: ease;
}

html[transient-theme="Notebook"] .palette .awesomplete > ul > li {
	position: relative;
	padding: 8px;
	cursor: pointer;
}

html[transient-theme="Notebook"] .palette .awesomplete > ul > li:hover {
	background: rgba(var(--color-primary-shade-1-rgb), 0.25);
	color: var(--color-primary-text);
}

html[transient-theme="Notebook"] .palette .awesomplete mark {
	background: rgba(var(--color-primary-shade-1-rgb), 0.5);
	color: var(--color-primary-text);
}

html[transient-theme="Notebook"] .palette .awesomplete > ul > li[aria-selected="true"] {
	background: rgba(var(--color-primary-shade-1-rgb), 0.5);
	color: var(--color-primary-text);
}

html[transient-theme="Notebook"] .palette .awesomplete li[aria-selected="true"] mark {
	background: rgba(var(--color-primary-shade-1-rgb), 1);
	color: var(--color-primary-text);
	border-radius: 1px;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="738udRGE" draggable="false" style name="Theme Variables" orig-data-id="Z2h2eCWM" __wid="G8JcHpr5"><STYLE data-type="content" type="text/css" codemirror="true" __wid="WrRpyiAh">html[transient-theme="Notebook"]:root {

	/* Fonts */
	--font-primary: "Roboto", "Avenir", sans-serif;
	--font-secondary: "Alegreya", serif;
	--font-monospace: "Roboto Mono", "Menlo", monospace;

	/* Colors Neutral Grey */
	--color-primary: var(--material-color-grey-300);
	--color-primary-shade-1: var(--material-color-grey-100);
	--color-primary-shade-2: var(--material-color-grey-50);
	--color-primary-shade-3: var(--material-color-white);

	--color-primary-text: var(--material-color-grey-900);
	--color-secondary-text: var(--material-color-grey-800);
	--color-tertiary-text: var(--material-color-grey-500);

	--color-accent: var(--material-color-deep-orange);
	--color-accent-text: var(--material-color-white);

	/* Colors RGB */
	--color-primary-rgb: var(--material-color-grey-300-rgb);
	--color-primary-shade-1-rgb: var(--material-color-grey-100-rgb);
	--color-primary-shade-2-rgb: var(--material-color-grey-50-rgb);
	--color-primary-shade-3-rgb: var(--material-color-white-rgb);

	--color-primary-text-rgb: var(--material-color-grey-900-rgb);
	--color-secondary-text-rgb: var(--material-color-grey-800-rgb);
	--color-tertiary-text-rgb: var(--material-color-grey-500-rgb);

	--color-accent-rgb: var(--material-color-deep-orange-rgb);
	--color-accent-text-rgb: var(--material-color-white-rgb);

	/* Warm Gray */
	--color-primary: #f1ede4;
	--color-primary-shade-1: #f8f6f2;
	--color-primary-shade-2: #fbfaf8;
	--color-primary-shade-3: var(--material-color-white);

	/*--color-primary-text: #1f1b14;
	--color-secondary-text: #3d3729;
	--color-tertiary-text: #a39c8f;*/

	--color-accent: #8f743d;
	--color-accent-text: #f7f4ed;

	/* Warm Gray RGB */
	--color-primary-rgb: 241, 237, 228;
	--color-primary-shade-1-rgb: 248, 246, 242;
	--color-primary-shade-2-rgb: 251, 250, 248;
	--color-primary-shade-3-rgb: var(--material-color-white-rgb);

	/*--color-primary-text-rgb: 31, 27, 2;
	--color-secondary-text-rgb: 92, 82, 61;
	--color-tertiary-text-rgb: 163, 156, 143;*/

	--color-accent-rgb: 143, 116, 61;
	--color-accent-text-rgb: 247, 244, 237;

	/* Transitions */
	--navigation-transition: 250ms cubic-bezier(0.4, 0.0, 0.2, 1);
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="F6FURmuL" name="Material Ripple" draggable="false" style orig-data-id="s3RFq8qg" __wid="bvwfxUpS"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="2fJ6JfzB">html[transient-theme="Notebook"] .material-ripple-primary-text,
html[transient-theme="Notebook"] .material-ripple-accen-text,
html[transient-theme="Notebook"] .dialog .actions .button,
html[transient-theme="Notebook"] #global-toolbar .toolbar-button,
html[transient-theme="Notebook"] #snackbar .snackbar-button,
html[transient-theme="Notebook"] #snackbar .action,
html[transient-theme="Notebook"] #global-menu .menu-button,
html[transient-theme="Notebook"] #global-menu .sub-menu > .label {
	position: relative;
	overflow: hidden;
	transform: translate3d(0, 0, 0);
}

html[transient-theme="Notebook"] .material-ripple-primary-text:after,
html[transient-theme="Notebook"] .material-ripple-accent-text:after,
html[transient-theme="Notebook"] .dialog .actions .button:after,
html[transient-theme="Notebook"] #global-toolbar .toolbar-button:after,
html[transient-theme="Notebook"] #snackbar .snackbar-button:after,
html[transient-theme="Notebook"] #snackbar .action:after,
html[transient-theme="Notebook"] #global-menu .menu-button:after,
html[transient-theme="Notebook"] #global-menu .sub-menu > .label:after {
	content: "";
	display: block;
	position: absolute;
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
	pointer-events: none;
	background-repeat: no-repeat;
	background-position: 50%;
	transform: scale(10, 10);
	opacity: 0;
	transition: transform 0.5s, opacity 1s;
}

html[transient-theme="Notebook"] .material-ripple-primary-text:after,
html[transient-theme="Notebook"] .dialog .actions .button:after,
html[transient-theme="Notebook"] #global-toolbar .toolbar-button:after,
html[transient-theme="Notebook"] #global-menu .menu-button:after,
html[transient-theme="Notebook"] #global-menu .sub-menu > .label:after {
	background-image: radial-gradient(circle, var(--color-primary-text) 10%, transparent 10.01%);
}

html[transient-theme="Notebook"] .material-ripple-accent-text:after,
html[transient-theme="Notebook"] #snackbar .snackbar-button:after,
html[transient-theme="Notebook"] #snackbar .action:after {
	background-image: radial-gradient(circle, var(--color-accent-text) 10%, transparent 10.01%);
}

html[transient-theme="Notebook"] .material-ripple-primary-text:active:after,
html[transient-theme="Notebook"] .material-ripple-accent-text:active:after,
html[transient-theme="Notebook"] .dialog .actions .button:active:after,
html[transient-theme="Notebook"] #global-toolbar .toolbar-button:active:after,
html[transient-theme="Notebook"] #snackbar .snackbar-button:active:after,
html[transient-theme="Notebook"] #snackbar .action:active:after,
html[transient-theme="Notebook"] #global-menu .menu-button:active:after,
html[transient-theme="Notebook"] #global-menu .sub-menu > .label:active:after {
	transform: scale(0, 0);
	opacity: 0.2;
	transition: 0s;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="Main" draggable="false" style data-id="NNhQVFUR" orig-data-id="5uBKHKzL" __wid="M8yyTQCG"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="iFUKpsHj">html[transient-theme="Notebook"],
html[transient-theme="Notebook"] * {
	box-sizing: border-box;
}

html[transient-theme="Notebook"],
html[transient-theme="Notebook"] input,
html[transient-theme="Notebook"] button {
	font-family: var(--font-primary);
}

html[transient-theme="Notebook"],
html[transient-theme="Notebook"] body {
	width: 100%;
	height: 100%;
	margin: 0;
	overflow-x: hidden;
	overflow-y: hidden;
}

html[transient-theme="Notebook"] {
	background-color: var(--color-primary-shade-2);
	color: var(--color-primary-text);
}

html[transient-theme="Notebook"] #sections {
	width: 100%;
	height: calc(100% - 64px);
	margin: 0;
	margin-top: 64px;
	padding: 16px;
	padding-bottom: calc(25vh + 16px); /* For Snackbar */
	overflow: hidden;
	overflow-y: auto;
	transition: margin-left var(--navigation-transition),
							width var(--navigation-transition);
}

html[transient-theme="Notebook"] #sections .section {
	width: 48em;
	margin: 0 auto;
	margin-bottom: 10px;
	max-width: 100%;
}

html[transient-theme="Notebook"] body[transient-menu-pinned="true"] #sections {
	width: calc(100% - 288px);
	margin-left: 288px;
}

html[transient-theme="Notebook"] body[transient-notification-pinned="true"] #sections {
	width: calc(100% - 384px);
	margin-right: 384px;
}

html[transient-theme="Notebook"] body[transient-menu-pinned="true"][transient-notification-pinned="true"] #sections {
	width: calc(100% - 672px);
}

/* Fix Chrome setting h1 font-size to 1.17em in paragraphs within sections */
html[transient-theme="Notebook"] h1 {
	font-size: 2em;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" draggable="false" name="Loading / Disconnected" style data-id="cDnM8XdK" orig-data-id="c8dz5get" __wid="Cc6BASwY"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="TpJaj5p3">@-webkit-keyframes rotateplane {
	0% {
		-webkit-transform: perspective(120px);
	}
	50% {
		-webkit-transform: perspective(120px) rotateY(180deg);
	}
	100% {
		-webkit-transform: perspective(120px) rotateY(180deg) rotateX(180deg);
	}
}

@-moz-keyframes rotateplane {
	0% {
		-moz-transform: perspective(120px);
	}
	50% {
		-moz-transform: perspective(120px) rotateY(180deg);
	}
	100% {
		-moz-transform: perspective(120px) rotateY(180deg) rotateX(180deg);
	}
}

@-o-keyframes rotateplane {
	0% {
		-o-transform: perspective(120px);
	}
	50% {
		-o-transform: perspective(120px) rotateY(180deg);
	}
	100% {
		-o-transform: perspective(120px) rotateY(180deg) rotateX(180deg);
	}
}

@keyframes rotateplane {
	0% {
		-webkit-transform: perspective(120px) rotateX(0deg) rotateY(0deg);
		-moz-transform: perspective(120px) rotateX(0deg) rotateY(0deg);
		-o-transform: perspective(120px) rotateX(0deg) rotateY(0deg);
		transform: perspective(120px) rotateX(0deg) rotateY(0deg);
	}
	50% {
		-webkit-transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
		-moz-transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
		-o-transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
		transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
	}
	100% {
		-webkit-transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
		-moz-transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
		-o-transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
		transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
	}
}

html[transient-theme="Notebook"] .overlay {
	position: fixed;
	display: block;
	top: 0;
	left: 0;
	bottom: 0;
	right: 0;
	background-color: var(--color-primary-shade-2);
	width: 100vw;
	height: 100vh;
	z-index: 395;
}

html[transient-theme="Notebook"] .overlay > div.center-piece {
	position: fixed;
	display: inline-block;
	left: 50%;
	top: 50%;
	transform: translate(-50%, -50%);
}

html[transient-theme="Notebook"] .overlay > div.center-piece:after {
	position: absolute;
	top: 100%;
	left: 50%;
	width: 200px;
	transform: translate(-50%, 0);
	text-align: center;
}

html[transient-theme="Notebook"] .overlay > div.center-piece > div.loading-indicator {
	position: relative;
	display: inline-block;
	top: 0;
	left: 0;
	width: 50px;
	height: 50px;
	border-radius: 2px;
	background: rgba(255, 255, 255, .5);
	-webkit-animation: rotateplane 1.2s infinite ease-in-out;
	-moz-animation: rotateplane 1.2s infinite ease-in-out;
	-o-animation: rotateplane 1.2s infinite ease-in-out;
	animation: rotateplane 1.2s infinite ease-in-out;
}

html[transient-theme="Notebook"] .overlay > div.close {
	display: flex;
	position: fixed;
	top: 10px;
	right: 10px;
	cursor: pointer;
	border-radius: 50%;
}

html[transient-theme="Notebook"] .overlay > div.close:hover {
	color: black;
	background-color: white;
}

html[transient-theme="Notebook"] .overlay.loading > div.center-piece:after {
	margin-top: 8px;
	content: "Loading";
}

html[transient-theme="Notebook"] .overlay.disconnected > div.center-piece:after {
	content: "Disconnected";
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" draggable="false" name="Scrollbars" data-id="puDPS2nW" style orig-data-id="aReAMqZa" __wid="eD6cSmfZ"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="qdLrmNt9">html[transient-theme="Notebook"] *::-webkit-scrollbar {
	width: 5px;
	height: 5px;
	background: transparent;
}

html[transient-theme="Notebook"] *::-webkit-scrollbar-track {
	background-color: var(--color-primary-shade-1);
}

html[transient-theme="Notebook"] *::-webkit-scrollbar-thumb {
	border-radius: 1px;
	background-color: var(--color-secondary-text);
}

html[transient-theme="Notebook"] *::-webkit-scrollbar-thumb:hover {
	background-color: var(--color-primary-text);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Tooltip" draggable="false" data-id="9d2zbUkQ" style orig-data-id="ekcWCgH9" __wid="HsTcHqng"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="cCVyvBgM">html[transient-theme="Notebook"] .section-visible *[tooltip]:after {
	font-size: 1rem;
	font-family: var(--font-primary);
	position: absolute;
	bottom: 0px;
	left: 50%;
	z-index: 98;
	padding: 5px 15px;
	color: white;
	background-color: rgba(0, 0, 0, 0.8);
	border-radius: 2px;
	display: inline;
	width: 200px;
	text-align: center;
	transform: translate3d(-50%, -36px, 0);
	opacity: 0;
	pointer-events: none;
	-webkit-font-smoothing: antialiased; /* webkit text rendering fix */
}

/* Match all tooltip headers and move them down 60px */
html[transient-theme="Notebook"] .section-visible .section-header *[tooltip]:after {
	bottom: -63px;
}
/* Match all tooltips except the first and move them back up, effectively making
the selector only match the first tooltip header. */
html[transient-theme="Notebook"] .section-visible ~ .section-visible *[tooltip]:after {
	bottom: 0;
}

html[transient-theme="Notebook"] *[tooltip]:before {
	content: "";
	border: solid;
	bottom: 0;
	border-color: rgba(0, 0, 0, 0.8) transparent;
	border-width: 6px 6px 0px 6px;
	left: 50%;
	transform: translate3d(-50%, -30px, 0);
	position: absolute;
	z-index: 99;
	opacity: 0;
	pointer-events: none;
	-webkit-font-smoothing: antialiased; /* Webkit text rendering fix */
}

/* Same principle as above, except this is for the tooltip triangle which needs
to be reversed. */
html[transient-theme="Notebook"] .section-visible .section-header *[tooltip]:before {
	transform: translate3d(-50%, 0px, 0);
	border-width: 0px 6px 6px 6px;
}
html[transient-theme="Notebook"] .section-visible ~ .section-visible *[tooltip]:before {
	transform: translate3d(-50%, -30px, 0);
	border-width: 6px 6px 0px 6px;
}

html[transient-theme="Notebook"] *[tooltip]:hover:after,
html[transient-theme="Notebook"] *[tooltip]:hover:before {
	opacity: 1.0;
	transition: opacity 200ms ease-in-out 300ms;
}

/******************************************************************************/

html[transient-theme="Notebook"] *[tooltip]:after,
html[transient-theme="Notebook"] *[tooltip]:before,
html[transient-theme="Notebook"] .action:after {
	display: none !important;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="Section Style" draggable="false" data-id="4vbV2Tzn" orig-data-id="Biib7BSP" style __wid="XyLufAx6"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="rx72JmzV">html[transient-theme="Notebook"] .section {
	margin-bottom: 32px;
	position: relative;
}

html[transient-theme="Notebook"] .section.section-hidden,
html[transient-theme="Notebook"] .section.section-hidden * {
	display: none;
}

html[transient-theme="Notebook"] .section[transient-focussed]:before {
	content: "";
	position: absolute;
	height: 100%;
	width: 0;
	left: -10px;
	border-left: 4px solid rgba(var(--color-accent-rgb), 0.3);
	border-radius: 4px;
}

/******************************************************************************/

html[transient-theme="Notebook"] .section .section-header {
  display: flex;
  align-items: center;
	flex-direction: row-reverse;
	flex-wrap: nowrap;
	justify-content: flex-start;
	height: 32px;
	padding: 4px;
	background: var(--color-primary);
	font-size: 1.2em;
	margin-bottom: 10px;
	border-radius: 2px;
	overflow-x: auto;
	overflow-y: hidden;

	height: 40px;
	font-weight: 500;
	margin-bottom: 32px;
	background: none;
}

html[transient-theme="Notebook"] .section .section-header::-webkit-scrollbar {
	display: none;
}

html[transient-theme="Notebook"] .section .section-header:before {
	font-family: "Material Icons";
	font-weight: normal;
	font-style: normal;
	line-height: 1;
	text-transform: none;
	letter-spacing: normal;
	word-wrap: normal;
	white-space: nowrap;
	direction: ltr;
	text-rendering: optimizeLegibility;
	font-feature-settings: "liga";

	flex: 0 0 auto;
	font-size: 28px;
	line-height: 30px;
	height: 30px;
	padding: 1px;
	margin-right: 8px;
	order: 999;
	content: "label";
}

html[transient-theme="Notebook"] .section .section-header .action {
	display: flex;
  align-items: center;
	margin-right: 8px;
	cursor: pointer;
  height: 32px;
	opacity: 0.25;
	pointer-events: none;
	flex: 0 0 24px;
	align-self: flex-end;
	user-select: none;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

html[transient-theme="Notebook"] .section .section-header .action i {
	line-height: 32px;
	height: 32px;
	vertical-align: middle;
}

html[transient-theme="Notebook"] .section .section-header:hover .action {
	opacity: 1.0;
	pointer-events: all;
}

html[transient-theme="Notebook"] .section .section-header .action:hover {
	color: var(--color-accent);
}

/******************************************************************************/

html[transient-theme="Notebook"] .section .section-header .name-input {
	cursor: text;
	flex: 1 0 auto;
	margin-right: 16px;
	order: 998;
	line-height: 32px;
	font-size: 30px;
}

html[transient-theme="Notebook"] .section .section-header .name-input:focus {
	outline: none;
}

html[transient-theme="Notebook"] .section .section-header .name-input:empty:focus {
	padding-left: 1px;
  /*outline: 1px solid var(--color-primary-text);
	opacity: 1.0;
	animation-name: blink-cursor;
	animation-duration: 500ms;
	animation-direction: alternate;
	animation-iteration-count: infinite;
	animation-timing-function: ease-in-out;*/
}

html[transient-theme="Notebook"] .section .section-header .name-input:empty:before {
	content: "No Name";
	opacity: 0.5;
}

html[transient-theme="Notebook"] .section .section-header .name-input:empty:focus:before {
	content: "";
}

/******************************************************************************/

html[transient-theme="Notebook"] .section .section-header .data-id-label {
	flex: 0 0 auto;
	user-select: all;
	background-color: rgba(var(--material-color-light-green-rgb), 0.75);
	font-size: 0.75em;
	font-family: var(--font-monospace);
	line-height: 20px;
	color: var(--color-primary);
	border-radius: 2px;
	padding: 2px 4px;
	font-weight: 700;
	margin-right: 10px;
	cursor: default;
}

html[transient-theme="Notebook"] .section.uninstalled .section-header .data-id-label {
	background-color: rgba(var(--material-color-red-rgb), 0.75);
}

html[transient-theme="Notebook"] .section .section-header .data-id-label:after {
	content: "Package ID";
}

html[transient-theme="Notebook"] .section:not([data-type="package"]) .section-header .data-id-label {
	display: none;
}

/******************************************************************************/

html[transient-theme="Notebook"] .section .section-header .delete-section:hover {
	color: var(--material-color-red);
}

/* Icon Delete */
html[transient-theme="Notebook"] .section .section-header .delete-section i:after {
	content: "delete";
}

/* Tooltip Delete */
html[transient-theme="Notebook"] .section .section-header .delete-section:after {
	content: "Delete";
}

/******************************************************************************/

/* Hide Collapsed Sections */
html[transient-theme="Notebook"] .section.hide-collapsed-paragraphs .paragraph.collapsed {
	display: none;
}

html[transient-theme="Notebook"] .section.hide-collapsed-paragraphs .hide-collapsed-paragraphs2 {
	opacity: 1.0;
}

/* Icon Show Collapsed Paragraphs */
html[transient-theme="Notebook"] .section.hide-collapsed-paragraphs .hide-collapsed-paragraphs2 i:after {
	content: "visibility_off";
}

/* Tooltip Show Collapsed Paragraphs */
html[transient-theme="Notebook"] .section.hide-collapsed-paragraphs .hide-collapsed-paragraphs2:after {
	content: "Show Collapsed Paragraphs";
}

/* Icon Hide Collapsed Paragraphs */
html[transient-theme="Notebook"] .section:not(.hide-collapsed-paragraphs) .hide-collapsed-paragraphs2 i:after {
	content: "visibility";
}

/* Tooltip Hide Collapsed Paragraphs */
html[transient-theme="Notebook"] .section:not(.hide-collapsed-paragraphs) .hide-collapsed-paragraphs2:after {
	content: "Hide Collapsed Paragraphs";
}

/******************************************************************************/

/* Icon Not System Section */
html[transient-theme="Notebook"] .section .toggle-system-section i:after {
	content: var(--settings);
	font-family: "Material Design Icons";
}

/* Tooltip Not System Section */
html[transient-theme="Notebook"] .section .toggle-system-section:after {
	content: "Activate System Section";
}

/* System Section */
html[transient-theme="Notebook"] .section[data-type="system"] .toggle-system-section {
	color: var(--material-color-light-green);
	opacity: 1.0 !important;
}

/* Tooltip Not System Section */
html[transient-theme="Notebook"] .section[data-type="system"] .toggle-system-section:after {
	content: "Deactivate System Section";
}

/******************************************************************************/

/* Icon Not Package Section */
html[transient-theme="Notebook"] .section .toggle-package-section i:after {
	content: var(--cube-outline);
	font-family: "Material Design Icons";
}

/* Tooltip Not Package Section */
html[transient-theme="Notebook"] .section .toggle-package-section:after {
	content: "Activate Package Section";
}

/* Package Section */
html[transient-theme="Notebook"] .section[data-type="package"] .toggle-package-section {
	color: var(--material-color-light-green);
	opacity: 1.0 !important;
}

/* Tooltip Not Package Section */
html[transient-theme="Notebook"] .section[data-type="package"] .toggle-package-section:after {
	content: "Deactivate Package Section";
}

/******************************************************************************/

/* Collapse Section */
html[transient-theme="Notebook"] .section.collapsed .paragraph {
	display: none;
}

html[transient-theme="Notebook"] .section .toggle-collapse i:after {
	content: "expand_less";
}

html[transient-theme="Notebook"] .section .toggle-collapse:after {
	content: "Collapse";
}

html[transient-theme="Notebook"] .section.collapsed .toggle-collapse i:after {
	content: "expand_more";
}

html[transient-theme="Notebook"] .section.collapsed .toggle-collapse:after {
	content: "Expand";
}

/******************************************************************************/

/* Hide Section */
html[transient-theme="Notebook"] .section .toggle-visibility-section i:after {
	content: "clear";
}

html[transient-theme="Notebook"] .section .toggle-visibility-section:after {
	content: "Hide Section";
}

/******************************************************************************/

/* Spacing */
html[transient-theme="Notebook"] .section .hide-collapsed-paragraphs2,
html[transient-theme="Notebook"] .section .toggle-package-section {
	margin-left: 20px;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" draggable="false" data-id="8FyAs3Qa" name="Paragraph Style" style orig-data-id="ZVLeTEZN" __wid="dZtX22Qs"><STYLE data-type="content" type="text/css" codemirror="true" class contenteditable="true" __wid="GxbYakQM">html[transient-theme="Notebook"] .paragraph {
	clear: both;
	position: relative;
	margin-top: 0;
	margin-bottom: 24px;
}

html[transient-theme="Notebook"] .paragraph div:focus {
	outline: none;
}

html[transient-theme="Notebook"] .paragraph pre {
	margin: 0px;
	padding: 0px;
}

html[transient-theme="Notebook"] .paragraph pre[type]  {
	display: none;
}

html[transient-theme="Notebook"] .paragraph[transient-focussed]:before {
	content: "";
	position: absolute;
	height: 100%;
	width: 0;
	left: -18px;
	border-left: 4px solid rgba(var(--color-accent-rgb), 0.45);
	border-radius: 4px;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph .paragraph-header {
	display: flex;
	flex-direction: row-reverse;
	flex-wrap: nowrap;
	justify-content: flex-start;
	position: relative;
	background: var(--color-primary-shade-1);
	width: 100%;
	height: 30px;
	border-radius: 2px;
	overflow-x: auto;
	overflow-y: hidden;

	background: none;
	height: 2.5rem;
	font-size: 1.5rem;
	font-weight: 500;
	margin-top: 0;
	margin-bottom: 24px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph [data-type="content"] {
	overflow: hidden;
}

/* Reset box-sizing of content paragraphs to their initial value */
html[transient-theme="Notebook"] .paragraph.body-paragraph [data-type="content"] * {
	box-sizing: initial;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph .paragraph-header .action {
	display: flex;
	cursor: pointer;
	margin-right: 10px;
	opacity: 0.25;
	pointer-events: none;
	font-size: 22px;
	width: 22px;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .action i {
	font-size: 22px;
	width: 22px;
	height: 22px;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .action:hover {
	color: var(--color-accent);
}

html[transient-theme="Notebook"] .paragraph .paragraph-header:hover .action {
	pointer-events: initial;
	opacity: 1.0;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .action .material-icons {
	position: relative;
	top: 50%;
	transform: translate3d(0, -50%, 0);
}
</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="FqPSRsXV" name="Paragraph Writing Style  " orig-data-id="zRGMQcXU" __wid="haXvk3XP"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="gxPQ92pT">html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"],
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] {
	position: inherit;
	font-family: var(--font-secondary);
	color: var(--color-secondary-text);
	font-size: 1.3rem;
	line-height: 1.6;
	box-sizing: border-box;
	margin: 0;
	z-index: 0;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] > *:first-child,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] > *:first-child {
	margin-top: 0 !important;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] > *:last-child,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] > *:last-child {
	margin-bottom: 0 !important;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h1,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h2,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h3,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h4,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h5,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h6,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] div:not([class]),
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] blockquote,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] pre,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] table,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] ul,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] ol,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h1,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h2,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h3,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h4,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h5,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h6,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] div:not([class]),
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] blockquote,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] pre,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] table,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] ul,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] ol {
	margin-top: 0;
	margin-bottom: 8px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] li,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] li {
	margin-bottom: 4px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] a,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] a {
	color: var(--color-accent);
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h1,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h2,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h3,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h4,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h5,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h6,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h1,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h2,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h3,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h4,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h5,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h6 {
	font-family: var(--font-primary);
	color: var(--color-primary-text);
	font-weight: 500;
	letter-spacing: 0.02rem;
	line-height: 1;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h1,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h1 {
	font-size: 2rem;
	border-bottom: none;
	margin-top: 32px;
	line-height: 48px;
	margin-bottom: 32px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h2,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h2 {
	font-size: 1.5rem;
	border-bottom: none;
	margin-top: 24px;
	line-height: 40px;
	margin-bottom: 24px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h3,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h3 {
	font-size: 1.25rem;
	margin-top: 16px;
	margin-bottom: 16px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h4,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h4 {
	font-size: 1.125rem;
	margin-top: 12px;
	margin-bottom: 12px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h5,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h5 {
	font-size: 1rem;
	margin-top: 12px;
	margin-bottom: 12px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] h6,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] h6 {
	font-size: 0.875rem;
	margin-top: 12px;
	margin-bottom: 12px;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] hr,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] hr {
	height: 1px;
	padding: 0;
	margin: 16px 0;
	background-color: var(--color-tertiary-text);
	border: 0;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] kbd,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] kbd {
	margin: 0 2px;
	color: #eee;
	border-radius: 3px;
	padding: 3px 7px;
	min-width: 1em;
	box-shadow: inset 0 0 2px #5a5a5a, 0 0.1em 0.11em rgba(0, 0, 0, 0.9);
	cursor: default;
	background: #000;
	text-align: center;
	text-shadow: none;
	background-color: #101010;
	background-repeat: repeat-x;
	font-family: monospace;
	font-size: 14px;
}

/******************************************************************************/


html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] blockquote,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] blockquote {
	padding: 0 1em;
	border-left: 0.25em solid var(--color-secondary-text);
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] blockquote>:first-child,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] blockquote>:first-child {
	margin-top: 0;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] blockquote>:last-child,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] blockquote>:last-child {
	margin-bottom: 0;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] table,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] table {
	display: block;
	width: 100%;
	overflow: auto;
	border-collapse: collapse;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] table th,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] table th {
	font-weight: 700;
	background: var(--color-primary-shade-3);
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] table th,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] table td,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] table th,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] table td {
	padding: 8px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] table tr,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] table tr{
	background: var(--color-primary-shade-2);
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] table tr:nth-child(2n),
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] table tr:nth-child(2n) {
	background: var(--color-primary-shade-3);
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] table img,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] table img {
	background-color: transparent;
}

/******************************************************************************/


html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] code,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] tt,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] code,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] tt {
	color: var(--color-primary-text);
	padding: 1px 4px;
	margin: 0;
	font-size: 0.9em;
	background-color: var(--color-primary-shade-3);
	border-radius: 3px;
	font-family: var(--font-monospace);
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] code br,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] tt br,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] code br,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] tt br {
	display: none
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] del code,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] del code {
	text-decoration: inherit
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] pre,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] pre {
	word-wrap: normal
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] pre > code,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] pre > code {
	padding: 0;
	margin: 0;
	font-size: 100%;
	word-break: normal;
	white-space: pre;
	background: transparent;
	border: 0
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] .highlight,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] .highlight {
	margin-bottom: 16px
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] .highlight pre,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] .highlight pre {
	margin-bottom: 0;
	word-break: normal
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] .highlight pre,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] pre,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] .highlight pre,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] pre {
	padding: 16px;
	overflow: auto;
	font-size: 85%;
	line-height: 1.45;
	background-color: var(--color-primary-shade-3);
	border-radius: 3px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] pre code,
html[transient-theme="Notebook"] .paragraph.body-paragraph .writing[data-type="content"] pre tt,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] pre code,
html[transient-theme="Notebook"] .paragraph.body-paragraph .section-documentation[data-type="content"] pre tt {
	display: inline;
	max-width: auto;
	padding: 0;
	margin: 0;
	overflow: visible;
	line-height: inherit;
	word-wrap: normal;
	background-color: transparent;
	border: 0;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="Paragraph Title Style" draggable="false" data-id="wZvGMgYX" orig-data-id="n64A599U" style __wid="ryxzyf7y"><STYLE data-type="content" type="text/css" codemirror="true" class contenteditable="true" __wid="yUNsx6uB">html[transient-theme="Notebook"] .paragraph .paragraph-header:before {
	font-family: 'Material Icons';
	font-weight: normal;
	font-style: normal;
	display: inline-block;
	line-height: 1;
	text-transform: none;
	letter-spacing: normal;
	word-wrap: normal;
	white-space: nowrap;
	direction: ltr;
	text-rendering: optimizeLegibility;
	font-feature-settings: 'liga';

	flex: 0 0 auto;
	height: 28px;
	padding: 4px;
	line-height: 28px;
	vertical-align: middle;
	margin-right: 8px;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph .paragraph-header:before {
	content: "text_fields";
}

html[transient-theme="Notebook"] .paragraph.code-paragraph .paragraph-header:before {
	content: "code";
}

html[transient-theme="Notebook"] .paragraph.style-paragraph .paragraph-header:before {
	content: "brush";
}

html[transient-theme="Notebook"] .paragraph.data-paragraph .paragraph-header:before {
	content: "storage";
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .input {
  font-size: 1em;
	line-height: 32px;
	margin-right: 16px;
	flex: 0 0 auto;
}


html[transient-theme="Notebook"] .paragraph .paragraph-header .input:focus {
	outline: none;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .input:empty:focus {
  padding-left: 1px;
	/*outline: 1px solid var(--color-primary-text);
	opacity: 1.0;
	animation-name: blink-cursor;
	animation-duration: 500ms;
	animation-direction: alternate;
	animation-iteration-count: infinite;
	animation-timing-function: ease-in-out;*/
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .input:empty:before {
	opacity: .5;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .input:empty:focus:before {
	content: "";
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .input:before {
	color: var(--color-accent);
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph .paragraph-header .name-input {
	order: 998;
	flex: 1 0 auto;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .id-input {
	order: 997;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .class-input {
	order: 996;
}

/******************************************************************************/

html[transient-theme="Notebook"] .paragraph .paragraph-header .name-input:empty:before {
	content: "name";
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .id-input:not(:empty):before {
	content: "#";
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .id-input:empty:before {
	content: "#id";
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .class-input:before {
	content: "class: ";
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .input:empty:before {
	opacity: 0;
	pointer-events: none;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header:hover .input:empty:before {
	opacity: 1.0;
	pointer-events: all;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header select {
  border: 0;
  font-family: var(--font-primary);
	text-align-last: right;
  outline: 0;
  opacity: 0;

  color: white;
  background: transparent;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header:hover select {
  opacity: 1;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" name="Paragraph Collapse Style" draggable="false" data-id="F3TCwRxM" orig-data-id="gKnfCRJB" style __wid="JwzS9CJU"><STYLE data-type="content" type="text/css" codemirror="true" class contenteditable="true" media="none" __wid="BEBSqPPE">/* Icon expanded */
html[transient-theme="Notebook"] .collapse-expand i:after {
	content: "expand_less";
}

/* Tooltip expanded */
html[transient-theme="Notebook"] .collapse-expand:after {
	content: "Collapse";
}

/* Icon collapsed */
html[transient-theme="Notebook"] .paragraph.collapsed .collapse-expand i:after {
	content: "expand_more";
}

/* Tooltip collapsed */
html[transient-theme="Notebook"] .paragraph.collapsed .collapse-expand:after {
	content: "Expand";
}

/* Hide all content of a paragraph except the paragraph header */
html[transient-theme="Notebook"] .paragraph.collapsed > *:not(.paragraph-header) {
	display: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Lock Paragraph Style" draggable="false" data-id="qhfTw9vV" style orig-data-id="LM22iaJk" __wid="VXuGWRKD"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="true" class media="none" __wid="GfVGv5PN">html[transient-theme="Notebook"] .paragraph:not(:hover):not(.locked) .paragraph-header .lock-content {
	opacity: 0.25;
	pointer-events: none;
}

html[transient-theme="Notebook"] .paragraph.locked .paragraph-header .lock-content {
	opacity: 1.0;
}

html[transient-theme="Notebook"] .paragraph.locked .text-tools {
	display: none;
}

/* Icon Lock */
html[transient-theme="Notebook"] .paragraph .paragraph-header .lock-content i:after {
	content: "lock_open";
}

/* Tooltip Lock */
html[transient-theme="Notebook"] .paragraph .paragraph-header .lock-content:after {
	content: "Lock";
}

/* Icon Unlock */
html[transient-theme="Notebook"] .paragraph.locked .paragraph-header .lock-content i:after {
	content: "lock_outline";
}

/* Tooltip Unlock */
html[transient-theme="Notebook"] .paragraph.locked .paragraph-header .lock-content:after {
	content: "Unlock";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Paragraph Delete Action Style" draggable="false" data-id="eQYQCS3M" orig-data-id="8vZywFM8" style __wid="m73nfA4z"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="true" class media="none" __wid="b4P5bH9X">html[transient-theme="Notebook"] .paragraph .delete-paragraph {
	margin-right: 10px;
}

/* Icon Delete */
html[transient-theme="Notebook"] .paragraph .delete-paragraph i:after {
	content: "delete";
}

/* Tooltip Delete */
html[transient-theme="Notebook"] .paragraph .delete-paragraph:after {
	content: "Delete";
}

html[transient-theme="Notebook"] .paragraph .delete-paragraph:hover i:after {
	color: var(--material-color-red);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Paragraph Sortable Style" draggable="false" data-id="mNdkGKwR" style orig-data-id="C6eX72vd" __wid="7BuqHCnV"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="kbUAq4Bx">html[transient-theme="Notebook"] .paragraph .drag-handle {
	cursor: -webkit-grabbing;
	cursor: move;
	opacity: 0;
	pointer-events: none;
}

html[transient-theme="Notebook"] .paragraph.dragging > * {
	pointer-events: none;
}

html[transient-theme="Notebook"] .paragraph.dragging {
	opacity: 0.5;
}

/* Icon Drag Handle */
html[transient-theme="Notebook"] .paragraph .drag-handle i:after {
	content: "drag_handle";
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" name="Variable Style" draggable="false" data-id="2bRPX2Ly" style orig-data-id="LWYEJJ2X" __wid="gVk6xgeT"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="GWL5uFTW">html[transient-theme="Notebook"] .variable {
	position: relative;
	display: inline;
	color: var(--material-color-light-blue);
}

html[transient-theme="Notebook"] .variable:empty:before {
	content: attr(data-name) " (unset)";
}

html[transient-theme="Notebook"] .variable:before {
	content: attr(data-name) " = ";
	color: var(--color-accent);
	opacity: .5;
}

html[transient-theme="Notebook"] .hide-variable-names .variable:not(:empty):before {
	display: none;
}

html[transient-theme="Notebook"] .hide-variable-names .variable:not(:empty):hover:before {
	content: attr(data-name);
	position: absolute;
	top: 0;
	left: 0;
	transform: translate3d(0, -100%, 0);
	display: inline-block;
	border-radius: 2px;
	font-size: .8em;
	padding: 2px;
	color: white;
	background: rgb(135, 135, 129);
	opacity: 1.0;
	/* border: 5px solid transparent; */
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="RuRxRueu" name="Persistent Log Style" orig-data-id="eGQSiWkH" __wid="uSGb8nyH"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="RUwSShFT">html[transient-theme="Notebook"] .paragraph .persistent-log[data-type="content"] {
	font-family: var(--font-monospace);
	font-size: 0.875rem;
}

html[transient-theme="Notebook"] .paragraph .persistent-log[data-type="content"] p {
	color: var(--color-primary-text);
	margin-top: 0;
	margin-bottom: 0;
}

html[transient-theme="Notebook"] .paragraph .persistent-log[data-type="content"] p.debug {
	color: var(--color-tertiary-text);
}

html[transient-theme="Notebook"] .paragraph .persistent-log[data-type="content"] p.info {
	color: var(--material-color-light-blue);
}

html[transient-theme="Notebook"] .paragraph .persistent-log[data-type="content"] p.warn {
	color: var(--material-color-orange);
}

html[transient-theme="Notebook"] .paragraph .persistent-log[data-type="content"] p.error {
	color: var(--material-color-red);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="Pull System Sections Dialog Style" data-id="nJbF49Pj" orig-data-id="GNFbi7e6" style __wid="ihdYuCVJ"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="9XEJFjMj">html[transient-theme="Notebook"] .update-system-sections .body {
	max-width: 90vw;
}

html[transient-theme="Notebook"] table.update-system-sections {
	width: 85vw;
	border-collapse: collapse;
	margin-top: 16px;
}

html[transient-theme="Notebook"] table.update-system-sections td,
html[transient-theme="Notebook"] table.update-system-sections th {
	padding: 8px;
}

html[transient-theme="Notebook"] input[name="systemSections"] {
	width: auto !important;
}

/******************************************************************************/

html[transient-theme="Notebook"] .update-system-sections .pullData {
	display: flex;
	margin-bottom: 32px;
	margin-top: 16px;
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	height: 48px;
	background: var(--color-primary-shade-2);
	padding: 8px;
	width: 100%;
}

html[transient-theme="Notebook"] .update-system-sections .pullData > * {
	flex: 0 1 auto;
	height: 32px;
	margin: 0 !important;
}

html[transient-theme="Notebook"] .update-system-sections .pullData > * + * {
	margin-left: 32px !important;
}

html[transient-theme="Notebook"] .update-system-sections .pullData .update-section-list {
	flex: 0 0 auto;
}

html[transient-theme="Notebook"] .update-system-sections .pullData .update-section-list:hover {
	background: var(--color-primary-shade-3);
}

html[transient-theme="Notebook"] .update-system-sections .pullData .update-section-list.update-needed {
	background: rgba(var(--material-color-green-rgb), 0.75);
}

html[transient-theme="Notebook"] .update-system-sections .pullData .update-section-list.update-needed:hover {
	background: var(--material-color-green);
}

html[transient-theme="Notebook"] .update-system-sections .pullData .update-section-list.invalid {
	background: var(--material-color-grey) !important;
	cursor: default;
}

/******************************************************************************/

html[transient-theme="Notebook"] table.update-system-sections tr:nth-child(even) {
	background: var(--color-primary-shade-2);
}

html[transient-theme="Notebook"] table.update-system-sections tr[local="true"][version-changed="true"] {
	background: var(--material-color-orange);
	color: var(--material-color-grey-100);
}

html[transient-theme="Notebook"] table.update-system-sections tr[local="true"][version-changed="false"] {
	background: var(--material-color-green);
	color: var(--material-color-grey-100);
}

html[transient-theme="Notebook"] table.update-system-sections tr[local="true"][version-changed="undefined"] {
	background: var(--material-color-teal);
	color: var(--material-color-grey-100);
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="kVAgkphs" name="Package Export UI Style" style orig-data-id="RsTYGeWK" __wid="ATVCYha6"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="uvH4FWgA">html[transient-theme="Notebook"] .section:not([data-type="package"]) .export-package,
html[transient-theme="Notebook"] .section.uninstalled .export-package,
html[transient-theme="Notebook"] .section:not([data-type="package"]) .export-github-package,
html[transient-theme="Notebook"] .section.uninstalled .export-github-package {
	display: none;
}

html[transient-theme="Notebook"] .section .export-package i:after {
	content: var(--arrow-down-bold-hexagon-outline);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] .section .export-package:after {
	content: "Export Package";
}

html[transient-theme="Notebook"] .section .export-github-package i:after {
	content: var(--github-circle);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] .section .export-github-package:after {
	content: "Export Package to GitHub";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="Package Management Dialogs Style" data-id="X4eFHnxK" style orig-data-id="aaSLkDgy" __wid="wZdL2ARJ"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="4QueCsSk">html[transient-theme="Notebook"] .install-and-update-packages .body,
html[transient-theme="Notebook"] .select-packages .body {
	max-width: 90vw;
}

html[transient-theme="Notebook"] table.packages {
	border-collapse: collapse;
	margin-top: 16px;
}

html[transient-theme="Notebook"] table.install-and-update-packages {
	width: 85vw;
}

html[transient-theme="Notebook"] table.select-packages,
html[transient-theme="Notebook"] table.package-repositories {
	width: 100%;
	max-height: 90vh;
}

html[transient-theme="Notebook"] table.packages td,
html[transient-theme="Notebook"] table.packages th {
	padding: 8px;
}

html[transient-theme="Notebook"] input[name="packages"] {
	width: auto !important;
}

/******************************************************************************/

html[transient-theme="Notebook"] .packages .pullData {
	display: flex;
	margin-bottom: 32px;
	margin-top: 16px;
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	height: 48px;
	background: var(--color-primary-shade-2);
	padding: 8px;
	width: 100%;
}

html[transient-theme="Notebook"] .packages .pullData > * {
	flex: 0 1 auto;
	height: 32px;
	margin: 0 !important;
}

html[transient-theme="Notebook"] .packages .pullData > * + * {
	margin-left: 32px !important;
}

html[transient-theme="Notebook"] .packages .pullData .repositories {
	width: auto;
	margin: 0;
}

html[transient-theme="Notebook"] .packages .pullData .update-package-list {
	flex: 0 0 auto;
}

html[transient-theme="Notebook"] .packages .pullData .update-package-list:hover {
	background: var(--color-primary-shade-3);
}

html[transient-theme="Notebook"] .packages .pullData .update-package-list.update-needed {
	background: rgba(var(--material-color-green-rgb), 0.75);
}

html[transient-theme="Notebook"] .packages .pullData .update-package-list.update-needed:hover {
	background: var(--material-color-green);
}

html[transient-theme="Notebook"] .packages .pullData .update-package-list.invalid {
	background: var(--material-color-grey) !important;
	cursor: default;
}

/******************************************************************************/

html[transient-theme="Notebook"] table.packages tr:nth-child(even),
html[transient-theme="Notebook"] table.packages thead {
	background: var(--color-primary-shade-2);
}

html[transient-theme="Notebook"] table.packages tr[local="true"][version-changed="true"] {
	background: var(--material-color-orange);
	color: var(--material-color-grey-100);
}

html[transient-theme="Notebook"] table.packages tr[local="true"][version-changed="false"] {
	background: var(--material-color-green);
	color: var(--material-color-grey-100);
}

html[transient-theme="Notebook"] table.packages tr[local="true"][version-changed="undefined"] {
	background: var(--material-color-teal);
	color: var(--material-color-grey-100);
}

html[transient-theme="Notebook"] table.packages tr[uninstalled="true"] {
	background: var(--material-color-red) !important;
	color: var(--material-color-grey-100);
}

/******************************************************************************/

html[transient-theme="Notebook"] table.package-repositories .package-repository-name,
html[transient-theme="Notebook"] table.package-repositories .package-repository-tag {
	cursor: text;
	outline: none;
}

html[transient-theme="Notebook"] table.package-repositories .package-repository-name:empty:before {
	content: "name";
	opacity: 0.5;
}

html[transient-theme="Notebook"] table.package-repositories .package-repository-tag:empty:before {
	content: "tag";
	opacity: 0.5;
}

html[transient-theme="Notebook"] table.package-repositories .remove-package-repository {
	cursor: pointer;
}

html[transient-theme="Notebook"] table.package-repositories .remove-package-repository:hover {
	color: var(--material-color-red);
}

html[transient-theme="Notebook"] table.package-repositories .remove-package-repository i:after {
	content: "delete";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="Fullscreen Style" draggable="false" data-id="CYFyvRBQ" orig-data-id="AXwP6QBU" style __wid="VJ4CJzZ9"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="true" class __wid="5kZ4vBXP">html[transient-theme="Notebook"] body.fullscreen:not([transient-fullscreen="false"]),
html[transient-theme="Notebook"] body[transient-fullscreen="true"] {
	overflow: hidden;
}

html[transient-theme="Notebook"] body.fullscreen:not([transient-fullscreen="false"]) #snackbar,
html[transient-theme="Notebook"] body[transient-fullscreen="true"] #snackbar {
	z-index: 375;
}

html[transient-theme="Notebook"] body.fullscreen:not([transient-fullscreen="false"]) .section,
html[transient-theme="Notebook"] body[transient-fullscreen="true"] .section {
	width: 0;
	height: 0;
	padding: 0;
	margin: 0;
}

/* Hides section toolbar */
html[transient-theme="Notebook"] body.fullscreen:not([transient-fullscreen="false"]) .section .section-header,
html[transient-theme="Notebook"] body[transient-fullscreen="true"] .section .section-header {
	opacity: 0;
	pointer-events: none;
}

html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]),
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] {
	position: fixed;
	left: 0;
	top: 0;
	bottom: 0;
	right: 0;
	width: 100vw;
	height: 100vh;
	z-index: 300;
	margin: 0;
	background: var(--color-primary-shade-3);
	-webkit-overflow-scrolling: touch; /* enable elastic scroll on touch devices */
}

/* Mve transient-fullscreen above fullscreen */
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] {
	z-index: 350;
}

/* Prevent input on paragraphs not in fullscreen view */
html[transient-theme="Notebook"] body.fullscreen:not([transient-fullscreen="false"]) .paragraph:not(.fullscreen):not([transient-fullscreen="true"]),
html[transient-theme="Notebook"] body[transient-fullscreen="true"] .paragraph:not([transient-fullscreen="true"]) {
	pointer-events: none;
}

html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] .paragraph-header {
	position: fixed;
	z-index: 1;
}

/* "Hide" paragraph utils when in locked fullscreen view */
html[transient-theme="Notebook"] .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header,
html[transient-theme="Notebook"] .paragraph.locked[transient-fullscreen="true"] .paragraph-header {
	height: 0;
}

/* Position toggle fullscreen button in locked fullscreen view */
html[transient-theme="Notebook"] .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header > .toggle-fullscreen,
html[transient-theme="Notebook"] .paragraph.locked[transient-fullscreen="true"] .paragraph-header > .toggle-fullscreen {
	position: absolute;
	top: 15px;
	right: 34px;
}

/* Position toggle fullscreen button in locked fullscreen view */
html[transient-theme="Notebook"] .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header > .lock-content,
html[transient-theme="Notebook"] .paragraph.locked[transient-fullscreen="true"] .paragraph-header > .lock-content {
	position: absolute;
	top: 15px;
	right: 0;
}

/* !!! Bug: make actions interactive */
html[transient-theme="Notebook"] .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .action,
html[transient-theme="Notebook"] .paragraph.locked[transient-fullscreen="true"] .paragraph-header .action {
	pointer-events: initial;
}

/* Hide paragraph icon */
html[transient-theme="Notebook"] .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header:before,
html[transient-theme="Notebook"] .paragraph.locked[transient-fullscreen="true"] .paragraph-header:before {
	display: none !important;
}

html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .delete-paragraph,
html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .drag-handle,
html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .collapse-expand,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] .paragraph-header .delete-paragraph,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] .paragraph-header .drag-handle,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] .paragraph-header .collapse-expand {
	display: none !important;
}

/* Hide all paragraph actions excluding lock and toggle fullscreen */
html[transient-theme="Notebook"] .paragraph.locked.fullscreen:not([transient-fullscreen="false"]) .paragraph-header > *:not(.lock-content):not(.toggle-fullscreen),
html[transient-theme="Notebook"] .paragraph.locked[transient-fullscreen="true"] .paragraph-header > *:not(.lock-content):not(.toggle-fullscreen) {
	display: none !important;
}

html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]) .CodeMirror,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] .CodeMirror {
	width: 100vw;
	height: 100vh;
	overflow: hidden !important;
	overflow-y: auto;
}


html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]):not(.locked) .CodeMirror,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"]:not(.locked) .CodeMirror {
	height: calc(100vh - 72px);
	overflow: auto;
}

/* This is a HACK as text paragraph cannot be scrolled in fullscreen otherwise */
html[transient-theme="Notebook"] .paragraph.body-paragraph.fullscreen:not([transient-fullscreen="false"]) [data-type="content"],
html[transient-theme="Notebook"] .paragraph.body-paragraph[transient-fullscreen="true"] [data-type="content"] {
	margin: 0;
	padding: 0;
	width: 100vw;
	height: 100vh;
	overflow: auto;
}

/* Move CodeMirror down to make space for fixed paragraph utils */
html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]):not(.locked) .CodeMirror,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"]:not(.locked) .CodeMirror,
html[transient-theme="Notebook"] .paragraph.body-paragraph.fullscreen:not([transient-fullscreen="false"]):not(.locked) [data-type="content"],
html[transient-theme="Notebook"] .paragraph.body-paragraph[transient-fullscreen="true"]:not(.locked) [data-type="content"] {
	margin-top: 40px;
}

/******************************************************************************/

/* Icon Fullscreen */
html[transient-theme="Notebook"] .paragraph .paragraph-header .toggle-fullscreen i:after {
	content: "fullscreen";
}

/* Tooltip Fullscreen */
html[transient-theme="Notebook"] .paragraph .paragraph-header .toggle-fullscreen:after {
	content: "Fullscreen";
}

/* Icon Exit Fullscreen */
html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .toggle-fullscreen i:after,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] .paragraph-header .toggle-fullscreen i:after {
	content: "fullscreen_exit";
}

/* Tooltip Exit Fullscreen */
html[transient-theme="Notebook"] .paragraph.fullscreen:not([transient-fullscreen="false"]) .paragraph-header .toggle-fullscreen:after,
html[transient-theme="Notebook"] .paragraph[transient-fullscreen="true"] .paragraph-header .toggle-fullscreen:after {
	content: "Exit Fullscreen";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Paragraph Code Execution" draggable="false" data-id="vbQLv8xC" orig-data-id="HHcUjYwH" style __wid="CYUDHyKg"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="Yv4tuA4g">html[transient-theme="Notebook"] .paragraph .execute-paragraph,
html[transient-theme="Notebook"] .paragraph .run-on-load-paragraph,
html[transient-theme="Notebook"] .paragraph .toggle-console-paragraph {
	margin-left: 5px;
}

html[transient-theme="Notebook"] .paragraph .run-on-load-paragraph {
	margin-right: 10px;
}

html[transient-theme="Notebook"] .paragraph[run-on-load] .run-on-load-paragraph.action {
	opacity: 1.0;
	pointer-events: all;
}

/* Icon Execute Code */
html[transient-theme="Notebook"] .paragraph .execute-paragraph i:after {
	content: "play_circle_outline";
}

/* Tooltip Execute Code */
html[transient-theme="Notebook"] .paragraph .execute-paragraph:after {
	content: "Execute Code";
}

/* Icon Execute Code on Load */
html[transient-theme="Notebook"] .paragraph .run-on-load-paragraph i:after {
	content: "directions_run";
}

/* Tooltip Enable Execute Code on Load */
html[transient-theme="Notebook"] .paragraph .run-on-load-paragraph:after {
	content: "Enable Execute Code on Load";
}

/* Icon Console */
html[transient-theme="Notebook"] .paragraph .toggle-console-paragraph i:after {
	content: "message";
}

/* Tooltip Console */
html[transient-theme="Notebook"] .paragraph .toggle-console-paragraph:after {
	content: "Toggle Console";
}

html[transient-theme="Notebook"] .paragraph[run-on-load] .run-on-load-paragraph i:after {
	color: var(--material-color-light-green);
}

/* Tooltip Disable Execute Code on Load */
html[transient-theme="Notebook"] .paragraph[run-on-load] .run-on-load-paragraph:after {
	content: "Disable Execute Code on Load";
}

html[transient-theme="Notebook"] .paragraph[last-execution-state="error"] .toggle-console-paragraph {
	opacity: 1.0;
}

html[transient-theme="Notebook"] .paragraph[last-execution-state="error"] .toggle-console-paragraph i:after {
	color: var(--material-color-red);
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .type-input {
	opacity: 0;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header:hover .type-input {
	opacity: 1;
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .type-input:before {
	content: "type: ";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="CodeMirror Integration CSS" draggable="false" data-id="qPN9CZNf" orig-data-id="xjJqeVWB" style __wid="mWZLDAKN"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="4gvdbcnR">html[transient-theme="Notebook"] .CodeMirror {
	isolation: isolate;
	height: auto;
	font-family: var(--font-monospace);
	font-size: 0.875rem;
	line-height: 1.25;
	height: auto;
	-webkit-font-smoothing: antialiased;
	clear: both;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph > transient.hidden {
	display: none;
}

html[transient-theme="Notebook"] .paragraph.body-paragraph transient.html-editor:before {
	content: "HTML of the above body paragraph";
	display: block;
	margin-top: 20px;
	background-color: var(--color-primary-shade-1);
	padding: 4px;
	border-radius: 2px;
	pointer-events: none;
	clear: both;
}

/******************************************************************************/

/* Icon Save HTML */
html[transient-theme="Notebook"] .paragraph .paragraph-header .save-html i:after {
	content: "save";
}

/* Tooltip Save HTML */
html[transient-theme="Notebook"] .paragraph .paragraph-header .save-html:after {
	content: "Save HTML";
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .toggle-html i:after {
	content: "visibility";
}

html[transient-theme="Notebook"] .paragraph .paragraph-header .toggle-html:after {
	content: "Toggle HTML Editor";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="CodeMirror Monokai Theme" draggable="false" data-id="939CPj2a" orig-data-id="63U8sryX" style __wid="MYdEVUMk"><STYLE data-type="content" type="text/css" codemirror="true" class __wid="vWFmr9qe">/* Based on Sublime Text's Monokai theme */

html[transient-theme="Notebook"] .cm-s-monokai.CodeMirror {
	background: none;
	color: var(--color-text-primary) !important;
}
html[transient-theme="Notebook"] .cm-s-monokai .CodeMirror-gutters {
	background: none;
	border-right: 0px;
}
html[transient-theme="Notebook"] .cm-s-monokai div.CodeMirror-selected {
	background: var(--color-primary);
}
html[transient-theme="Notebook"] .cm-s-monokai .CodeMirror-cursor {
	border-left: 1px solid var(--color-primary-text);
}

html[transient-theme="Notebook"] .cm-s-monokai span.cm-number, html[transient-theme="Notebook"] .cm-s-monokai span.cm-string, html[transient-theme="Notebook"] .cm-s-monokai span.cm-atom { color: #762; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-comment { color: #262; font-style: italic; line-height: 1em; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-meta { color: #555; font-style: italic; line-height: 1em; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-variable { color: black; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-variable-2 { color: #b11; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-qualifier { color: #555; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-keyword { color: #730; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-builtin { color: #30a; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-link { color: #762; }
html[transient-theme="Notebook"] .cm-s-monokai span.cm-error { background-color: #ffb8b8; }

html[transient-theme="Notebook"] .cm-s-monokai .CodeMirror-activeline-background { background: rgba(var(--color-accent-rgb), 0.1); }
html[transient-theme="Notebook"] .cm-s-monokai .CodeMirror-matchingbracket { outline:1px solid grey; color:black !important; }


html[transient-theme="Notebook"] .cm-s-monokai span.cm-matchhighlight {
	background: #353;
}
html[transient-theme="Notebook"] .cm-s-monokai span.cm-tag {
	color: rgb(234, 53, 134);
}

html[transient-theme="Notebook"] .cm-s-monokai span.cm-property,
html[transient-theme="Notebook"] .cm-s-monokai span.cm-attribute {
	color: #12AF16;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="KUq4ZUr5" name="Tabs, Linebreaks and Rulers" orig-data-id="Mf3uBNUQ" __wid="5emgyXhu"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="SNC3NjAS">html[transient-theme="Notebook"] .CodeMirror-rulers {
	color: var(--color-primary-text);
	opacity: 0.1;
	z-index: 2;
	max-height: calc(100% - 8px) !important;
	min-height: calc(100% - 8px) !important;
	top: 0;
	margin: 4px 0;
}

html[transient-theme="Notebook"] .cm-tab {
	background: linear-gradient(to right, rgba(0, 0, 0, 0) 5%, var(--color-primary-text) 6%, var(--color-primary-text) 95%, rgba(0, 0, 0, 0) 96%);
	height: 0.05em;
	vertical-align: middle;
	opacity: 0.2;
}

/*html .CodeMirror-code > div > pre > span::after, .CodeMirror-line > span::after {
	content: "";
	color: var(--color-primary-text);
	opacity: 0.2;
}*/</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Drop Assets Style" draggable="false" data-id="etJ8SJvC" orig-data-id="smjHTJUJ" style __wid="TuYrJWEx"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="SjSh7Z2x">html[transient-theme="Notebook"] .paragraph [data-type="content"] .upload-in-progress {
	opacity: 0.25;
}

html[transient-theme="Notebook"] .paragraph [data-type="content"] video,
html[transient-theme="Notebook"] .paragraph [data-type="content"] img {
	max-width: 100%;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" data-id="SYEWAKaC" style name="Help Dialog Style" orig-data-id="M5jKghq9" __wid="jV3UgaLY"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="XRNiDgM3">html[transient-theme="Notebook"] .dialog.help {
	z-index: 450;
}

html[transient-theme="Notebook"] .dialog.help .body {
	width: 70rem;
	max-width: calc(100vw - 32px);
	max-height: calc(100vh - 180px);
}

html[transient-theme="Notebook"] .dialog.help #explanation {
	margin-bottom: 24px;
}

html[transient-theme="Notebook"] .dialog.help #shortcuts {
	width: 33%;
	float: left;
}

html[transient-theme="Notebook"] .dialog.help #intro {
	margin-left: 35%;
}

/******************************************************************************/

html[transient-theme="Notebook"] .dialog.help a {
	color: var(--color-secondary-text);
}

html[transient-theme="Notebook"] .dialog.help .help-title {
	font-size: 24px;
	margin-bottom: 12px;
}

html[transient-theme="Notebook"] .dialog.help #intro .video {
	width: 100%;
	text-align: center;
}

html[transient-theme="Notebook"] .dialog.help #shortcuts li {
	margin-bottom: 16px;
}

html[transient-theme="Notebook"] .dialog.help #shortcuts .key {
	margin: 0 5px 0 0;
	color: #eee;
	border-radius: 3px;
	padding: 3px 7px;
	min-width: 1em;
	box-shadow: inset 0 0 2px #5a5a5a, 0 0.1em 0.11em rgba(0, 0, 0, 0.9);
	cursor: default;
	background: #000;
	text-align: center;
	text-shadow: none;
	background-color: #101010;
	background-repeat: repeat-x;
	font-family: monospace;
	font-size: 14px;
}

html[transient-theme="Notebook"] .dialog.help #shortcuts .action {
	line-height: 150%;
}

/******************************************************************************/

html[transient-theme="Notebook"] #global-menu .help-button {
	order: 990;
}</STYLE></DIV><DIV class="paragraph style-paragraph style-disabled collapsed" name="Section Browser Style" draggable="false" data-id="u5Sw3G7Q" orig-data-id="6tj93nGL" style __wid="D9n6Qw3n"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="bSd5tKnE">html[transient-theme="Notebook"] #section-tree {
	margin: 0px;
	padding-left: 8px;
	padding-right: 16px;
	user-select: none;
	overflow: auto;
	list-style: none;
	order: 980;
	display: flex;
	flex-direction: column;
}

html[transient-theme="Notebook"] hr.section-tree {
	order: 980;
}

/******************************************************************************/

html[transient-theme="Notebook"] #section-tree li {
	color: var(--color-text-primary);
	vertical-align: middle;
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
	cursor: pointer;
	display: flex;
	align-items: center;
	flex-shrink: 0;
}

html[transient-theme="Notebook"] #section-tree > li {
	flex-wrap: wrap;
}

html[transient-theme="Notebook"] #section-tree .closed ul {
	display: none;
}

html[transient-theme="Notebook"] #section-tree li.hidden {
	opacity: 0.5;
}

html[transient-theme="Notebook"] #section-tree li .title {
	margin-left: 0.5em;
	vertical-align: middle;
	overflow: hidden;
	text-overflow: ellipsis;
}

html[transient-theme="Notebook"] #section-tree > li > .title {
	max-width: 174px;
}

/* Fix for disappearing icons bug */
html[transient-theme="Notebook"] #section-tree li i {
	display: flex;
}

html[transient-theme="Notebook"] #section-tree li .type {
	margin-left: 5px;
}

html[transient-theme="Notebook"] #section-tree li ul {
	width: 100%;
	display: flex;
	flex-direction: column;
	flex-wrap: nowrap;
}

/******************************************************************************/

html[transient-theme="Notebook"] #section-tree li .type i:after,
html[transient-theme="Notebook"] #section-tree .section-tree-controls .toggle-user-sections i:after {
	content: "person";
}

html[transient-theme="Notebook"] #section-tree li[data-type="system"] .type i:after,
html[transient-theme="Notebook"] #section-tree .section-tree-controls .toggle-system-sections i:after {
	content: var(--settings);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #section-tree li[data-type="package"] .type i:after,
html[transient-theme="Notebook"] #section-tree .section-tree-controls .toggle-package-sections i:after {
	content: var(--cube-outline);
	font-family: "Material Design Icons";
}

/******************************************************************************/

html[transient-theme="Notebook"] #section-tree .section-tree-controls {
	display: flex;
	justify-content: space-evenly;
	margin: 4px;
	flex-shrink: 0;
}

html[transient-theme="Notebook"] #section-tree .section-tree-controls span {
	cursor: pointer;
}

html[transient-theme="Notebook"] #section-tree.hide-user-sections .toggle-user-sections,
html[transient-theme="Notebook"] #section-tree.hide-system-sections .toggle-system-sections,
html[transient-theme="Notebook"] #section-tree.hide-package-sections .toggle-package-sections {
	opacity: 0.5;
}

html[transient-theme="Notebook"] #section-tree.hide-user-sections li.hidden:not([data-type]),
html[transient-theme="Notebook"] #section-tree.hide-system-sections li.hidden[data-type="system"],
html[transient-theme="Notebook"] #section-tree.hide-package-sections li.hidden[data-type="package"] {
	display: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" data-id="AHcgU5q9" name="Text Tools Style" draggable="false" style orig-data-id="UArqpeRC" __wid="PXfxiiX9"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="4J7K42Mp">html[transient-theme="Notebook"] #snackbar:not([body-content-tools="true"]) .body-content-tools {
	display: none;
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar .format-p-button i:after {
	content: var(--format-paragraph);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #snackbar .format-h1-button i:after {
	content: var(--format-header-1);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #snackbar .format-h2-button i:after {
	content: var(--format-header-2);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #snackbar .format-h3-button i:after {
	content: var(--format-header-3);
	font-family: "Material Design Icons";
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar .add-variable-button i:after {
	content: var(--tag-plus);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #snackbar .hide-variables-button i:after {
	content: var(--tag-outline);
	font-family: "Material Design Icons";
}

html[transient-theme="Notebook"] #snackbar .convert-html-button i:after {
	content: var(--language-html5);
	font-family: "Material Design Icons";
}

/******************************************************************************/

html[transient-theme="Notebook"] #snackbar .add-file-button label {
	cursor: pointer;
}

html[transient-theme="Notebook"] #snackbar .add-file-button input {
	display: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed style-disabled" name="Style Disable Buton Style" data-id="RKuLhTUQ" orig-data-id="AqZAbtDa" style __wid="EDxKrA5t"><STYLE data-type="content" type="text/css" codemirror="true" class media="none" __wid="CvGu289P">html[transient-theme="Notebook"] .paragraph:not(:hover):not(.style-disabled) .paragraph-header .disable-style-content {
	opacity: 0.25;
	pointer-events: none;
}

html[transient-theme="Notebook"] .paragraph.style-disabled .paragraph-header .disable-style-content {
	opacity: 1.0;
}

/******************************************************************************/

/* Icon Disable */
html[transient-theme="Notebook"] .paragraph .paragraph-header .disable-style-content i:after {
	content: "check_box";
}

/* Tooltip Disable */
html[transient-theme="Notebook"] .paragraph .paragraph-header .disable-style-content:after {
	content: "Disable Style";
}

/* Icon Enable */
html[transient-theme="Notebook"] .paragraph.style-disabled .paragraph-header .disable-style-content i:after {
	content: "check_box_outline_blank";
}

/* Tooltip Enable */
html[transient-theme="Notebook"] .paragraph.style-disabled .paragraph-header .disable-style-content:after {
	content: "Enable Style";
}</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="fiQaqgVu" name="Hide Headers" data-type="package" __wid="9xhzLLAN"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="tr6ph2Cr" __wid="tdMa2ccz"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="bedyV9BQ"><H2 __wid="sKDdh4MD">Description</H2><DIV __wid="fDPNY8Mh">A small utility to hide headers of paragraphs using the <CODE __wid="uuiESQVW">minimal</CODE> CSS class.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" data-id="Qan3PUu6" name="Properties" __wid="ZgAAPfrM"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="XSiP4fP4">{
	"version": "1.0.2",
	"icon": "border_clear",
	"description": "Adds the 'minimal' class to hide headers.",
	"tags": [
		"themes",
		"utility"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.0.2": "Updated style to stop content from jumping.",
		"1.0.1": "Show header on hover.",
		"1.0": "Initial version."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/fiQaqgVu-Hide_Headers"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="nRm3TtXs" name="Hide Headers Code" run-on-load="true" last-execution-state="success" __wid="ZKqXwwia"><PRE data-type="content" type="text/javascript" __wid="2NqRUTZC">document.liveQuerySelectorAll("[data-type='content']").added((content) => {
	content.liveAttribute("class").changed((value, oldValue) => {
		if (content.classList.contains("hide-header")) {
			content.closest(".paragraph").classList.add("hide-header");
		} else {
			content.closest(".paragraph").classList.remove("hide-header");
		}
	});
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" name="Hide Headers Style" data-id="hhQ5bTAE" __wid="63d3dLNe"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="zpv2eX5D">html .paragraph.hide-header:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .paragraph-header {
	z-index: 1;
	position: absolute;
	top: -30px;
	box-shadow: var(--material-shadow-z4);
}

html .paragraph.hide-header:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):not([transient-focussed]):not(:hover) .paragraph-header {
	display: none;
}

html .paragraph.hide-header:not(.collapsed) :not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror {
	padding: 15px;
	margin: 5px;
	background: var(--color-primary-shade-3);
	border-radius: 2px;
}

html .paragraph.hide-header:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-activeline-background,
html .paragraph.hide-header:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-rulers,
html .paragraph.hide-header:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-gutters,
html .paragraph.hide-header:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-gutter-wrapper {
	display: none;
}</STYLE></DIV></DIV><DIV class="section section-hidden" name="Style Disable Button" data-type="package" data-group="editing" data-id="dtu5Kyzx" __wid="5wYbuVEz"><DIV class="paragraph body-paragraph locked collapsed" draggable="false" name="Documentation" data-id="LY4pn3kw" __wid="RabY6nWe"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="mKBJ96PF"><H2 __wid="DtuW7WSW">Description</H2>Adds a button to style paragraphs for dis- and enabling.<H2 __wid="yLFLdvt5">How it works</H2><DIV __wid="tKe5CGqH">Disabling works by adding a <CODE __wid="XX5MJLJL">meta="none"</CODE> attribute to the <CODE __wid="K6iY2ESg">&lt;style></CODE> tag of the style paragraph.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="ur4aqAMa" __wid="4kGrSZyV"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="YLiU3VVP">{
	"version": "1.0",
	"icon": "format_color_reset",
	"description": "Adds a button to style paragraphs for dis- and enabling.",
	"tags": [
		"devtools",
		"style paragraphs"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initital Release"
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/dtu5Kyzx-Style_Disable_Button"
	}
}</PRE></DIV>


<DIV class="paragraph code-paragraph collapsed" name="Style Disable Button Action" run-on-load="true" last-execution-state="success" data-id="tkSd3vCM" __wid="PpxqTXMq"><PRE data-type="content" type="text/javascript" __wid="wfdUurmv">const SectionUtils = require("#paragraph-utils");

/******************************************************************************/

const addDisableStyleAction = paragraph => {
	const disableStyleElement = SectionUtils.addHeaderAction(paragraph, "disable-style-content", () => {

		const content = paragraph.querySelector("[data-type='content']");

		if (content) {
			if (paragraph.classList.contains("style-disabled")) {
				paragraph.classList.remove("style-disabled");
				content.removeAttribute("media");
			} else {
				paragraph.classList.add("style-disabled");
				content.setAttribute("media", "none");
			}
		}
	}, {
		tooltip: true
	});

	const content = paragraph.querySelector("[data-type='content']");

	if (content) {
		if (paragraph.classList.contains("style-disabled")) {
			content.setAttribute("media", "none");
		} else {
			content.removeAttribute("media");
		}
	}
};

/******************************************************************************/

document.liveQuerySelectorAll(".style-paragraph").added(addDisableStyleAction);</PRE></DIV><DIV class="paragraph style-paragraph collapsed" name="Style Disable Buton Style" data-id="AqZAbtDa" __wid="kKyates5"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="EGE9KruW">html .paragraph:not(:hover):not(.style-disabled) .paragraph-header .disable-style-content {
	opacity: 0.25;
	pointer-events: none;
}

html .paragraph.style-disabled .paragraph-header .disable-style-content {
	opacity: 1.0;
}

/******************************************************************************/

/* Icon Disable */
html .paragraph .paragraph-header .disable-style-content i:after {
	content: "check_box";
}

/* Tooltip Disable */
html .paragraph .paragraph-header .disable-style-content:after {
	content: "Disable Style";
}

/* Icon Enable */
html .paragraph.style-disabled .paragraph-header .disable-style-content i:after {
	content: "check_box_outline_blank";
}

/* Tooltip Enable */
html .paragraph.style-disabled .paragraph-header .disable-style-content:after {
	content: "Enable Style";
}</STYLE></DIV></DIV><DIV name="Avatars" data-type="package" class="section section-hidden" data-group="basic" data-id="USSKFQPD" __wid="wLym67mL"><DIV class="paragraph body-paragraph locked collapsed" draggable="false" name="Documentation" data-id="rVwMQEUm" __wid="g8Rp8Kyz"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="znDq7DAy"><H2 __wid="TXzeLC3t">Description</H2><DIV __wid="Ph2UQFUE">Displays an avatar in the bottom right corner for every user on a Codestrate. Clicking on the avatar will flash the screen on the other users Codestrate.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="7kcnKK3R" __wid="UuR6fNZ2"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="YJVm5d4N">{
	"version": "1.0.3",
	"icon": "account_circle",
	"description": "Displays an avatar in the bottom right corner for every user on a Codestrate.",
	"tags": [
		"collaboration"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initital Release",
		"1.0.1": "Some styling and description.",
		"1.0.2": "Fixed issue with Codestrate.on event API, which was @deprecated and use Codestrate.addEventListener instead.",
    "1.0.3": "Added style for notification bar."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/USSKFQPD-Avatars"
	}
}</PRE></DIV>

<DIV class="paragraph body-paragraph collapsed" draggable="false" name="Documentation and Example Rendering" data-id="BqxeuLNK" __wid="FZTeaTh2"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" __wid="DDWmGHRe"><H2 __wid="2kU5TErc">Example of user list<BR __wid="6RjfGc8t"/></H2>

<DIV class="avatars-test" __wid="AiX2uXVy">
	<DIV class="avatar" client-id="test3" username="unknown" style="background-image: url(&quot;unknown.jpg&quot;); border-color: rgb(99, 178, 252);" __wid="5DiwRBiz"></DIV>

	<DIV class="avatar" client-id="test2" username="cklokmose" style="background-image: url(&quot;https://avatars.githubusercontent.com/u/1607207?v=3&quot;); border-color: rgb(254, 83, 124);" __wid="NawnSKnt"></DIV>

	<DIV class="avatar self" client-id="test1" username="raedle" style="background-image: url(&quot;https://avatars.githubusercontent.com/u/489051?v=3&quot;); border-color: rgb(226, 178, 252);" __wid="qUd86BmF"></DIV>
</DIV></DIV></DIV><DIV class="paragraph code-paragraph collapsed" name="Avatars Code" run-on-load="true" last-execution-state="success" data-id="QSCmBY4t" __wid="6aJKDcR5"><PRE data-type="content" type="text/javascript" __wid="iVGJxp35">const ClientManager = require('#client-manager');
const FlashScreen = require('#flash-screen');

const anonymousUrl = "unknown.jpg";

// How often the idle time is updated (in milliseconds)
const UPDATE_IDLE_TIME_INTERVAL = 10 * 1000;

// Add avatars element
const avatars = document.createElement("transient");
avatars.classList.add("avatars");
document.body.appendChild(avatars);

/**
 * Get other client ids (all connected client ids except for own client id).
 */
const otherClientIds = () => {
	return webstrate.clients.filter(c => c !== webstrate.clientId);
};

/**
 * Add a client's avatar to the avatars list.
 */
const addAvatar = (client) => {

	if (avatars.querySelector(`.avatar[client-id=${client.id}]`)) return;

	const avatar = document.createElement("div");
	avatar.classList.add("avatar");
	avatar.setAttribute("client-id", client.id);
	avatar.setAttribute("username", client.username || client.id);
	avatar.style.backgroundImage = `url(${client.avatarUrl})`;
	avatar.style.borderColor = ClientManager.getClientColor(client.id);

	// Send flash screen command to sender
	avatar.addEventListener("click", (event) => {
		webstrate.signal({
			cmd: "flashScreen"
		}, client.id);
	});

	if (client.id === webstrate.clientId) {
		avatar.classList.add("self");
		avatars.insertBefore(avatar, avatars.firstElementChild);
	} else {
		avatars.appendChild(avatar);
	}
};

/**
 * Update a client's avatar
 */
const updateAvatar = (client) => {
	const avatar = avatars.querySelector(`.avatar[client-id="${client.id}"]`);
	if (avatar) {
		avatar.setAttribute("username", client.username || client.id);
		avatar.style.backgroundImage = `url(${client.avatarUrl})`;
		avatar.style.borderColor = ClientManager.getClientColor(client.id);
	}
};

/**
 * Removes an avatar from the avatars list.
 *
 * @param {string} clientId The client's id associated with the avatar.
 */
const removeAvatar = (client) => {
	stopUpdateIdleTime(client.id);

	const avatar = avatars.querySelector(`.avatar[client-id="${client.id}"]`);
	if (avatar) {
		avatar.remove();
	}
};

const updateIdleTime = (senderId, idleTime) => {

	// console.log(senderId, idleTime);

	const avatar = avatars.querySelector(`.avatar[client-id="${senderId}"]`);

	if (!avatar) {
		// console.warn(`Client ${senderId} keeps pinging but avatar does not exist anymore... Why?`);
		return;
	}

	var snoozeBox = avatar.querySelector(".snooze");
	if (idleTime > 0) {
		avatar.classList.add("snoozed");
		if (!snoozeBox) {
			snoozeBox = document.createElement("div");
			snoozeBox.classList.add("snooze");
			avatar.appendChild(snoozeBox);
		}
		snoozeBox.innerHTML = `${(idleTime/1000/60)|0}m`;
	} else if (snoozeBox) {
		avatar.classList.remove("snoozed");
		snoozeBox.remove();
	}
};

const idleClients = [];

const stopUpdateIdleTime = (clientId) => {
	
	// Clear update interval
	const clients = idleClients.filter((c) => c.clientId === clientId).forEach((c) => clearInterval(c.interval));
};

/**
 * Clear all update idle timers.
 */
const clearUpdateIdleTimers = () => {
	idleClients.forEach((c) => clearInterval(c.interval));
};

/**
 * Listen for other client to signal their avatar url.
 */
webstrate.on("signal", (message, senderId) => {

	if (message.type === "IdleTimer") {
		// console.log(message, senderId);

		if (message.cmd === "awake") {
			stopUpdateIdleTime(senderId);
			updateIdleTime(senderId, 0);
		} else if (message.cmd === "idle") {

			const lastAction = Date.now() - message.idleTime;

			updateIdleTime(senderId, Date.now() - lastAction);
			const interval = setInterval(() => {
				updateIdleTime(senderId, Date.now() - lastAction);
			}, UPDATE_IDLE_TIME_INTERVAL);

			idleClients.push({
				clientId: senderId,
				interval: interval
			});
		}

		return;
	}

	if (message.cmd === "flashScreen") {

		// Ignore own message -> remove when code is stable
		if (webstrate.clientId === senderId) {
			// throw new Error("This should not happen");
			return;
		}

		// Flash, flash!
		FlashScreen.flash();

		// Show little star next to whoever flashed
		senderAvatar = avatars.querySelector(`.avatar[client-id="${senderId}"]`);
		var div = document.createElement("div");
		div.classList.add("star");
		div.innerHTML = "&#10039;";
		senderAvatar.appendChild(div);
		setTimeout(() => div.remove(), 5000);
	}
});

// Add existing clients
Codestrate.clients.forEach((client) => addAvatar(client));

// Add clients added later on
Codestrate.addEventListener("clientAdd", (client) => addAvatar(client));

// Update avatars
Codestrate.addEventListener("clientUpdate", (client) => updateAvatar(client));

// Update avatars
Codestrate.addEventListener("clientUpdateProperty", ({propertyName, client}) => updateAvatar(client));

// Remove leaving clients
Codestrate.addEventListener("clientRemove", (client) => removeAvatar(client));

// Clear all update idle timers and remove all avatars.
webstrate.on("disconnect", () => {

	// Clear all update idle timers.
	clearUpdateIdleTimers();

	// Clear all avatars
	avatars.innerHTML = "";
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" name="Avatars Style" data-id="ZDQNSSqu" __wid="XcRSgxBq"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="BSvLUTEz">html .avatars {
	position: fixed;
	bottom: 16px;
	right: 16px;
  transition: right var(--navigation-transition);
}

html body[transient-notification-pinned="true"] .avatars {
  right: 400px;
}

/* Make the .avatars-test only occupy minimal space */
html .avatars-test {
	float: left;
	position: relative;
	bottom: 16px;
	left: 16px;
}

html .avatars .avatar,
html .avatars-test .avatar {
	box-sizing: border-box;
	position: relative;
	width: 52px;
	height: 52px;
	margin-top: 12px;
	background-size: contain;
	border-radius: 50%;
	border: 2px solid white;
	box-shadow: var(--material-shadow-z6);
	transition: box-shadow var(--navigation-transition);
}

html .avatars .avatar:not(.self):hover,
html .avatars-test .avatar:not(.self):hover {
	box-shadow: var(--material-shadow-z12);
}

html .avatars .avatar.self {
	border: none;
}

html .avatars .avatar:not(.self) {
	cursor: pointer;
}

html .avatars:hover .avatar:after,
html .avatars-test:hover .avatar:after {
	content: attr(username);
	display: inline-block;
	background: #000;
	padding: 2px 6px;
	font-size: 0.8em;
	transform: translate3d(-100%, 10px, 0) translate3d(-10px, 0, 0) rotate(-4deg);
}

html .avatars .avatar > div.star {
	color: var(--color-primary-text);
	position: absolute;
	margin-left: 40px;
	margin-top: 40px;
}

html .avatars .avatar > div.snooze {
	color: #fff;
	font-size: 65%;
	font-weight: bold;
	text-shadow: 1px 1px #000;
	position: absolute;
	margin-left: 53px;
	margin-top: -3px;
}

html .avatars .avatar.snoozed {
	opacity: 0.25;
}

@media only screen and (max-width: 950px) {
	html .avatars {
		display: none;
	}
	/* 	.avatars {
	top: 5px;
	left: 5px;
}
	.avatars .avatar {
	width: 30px;
	height: 30px;
	margin-bottom: 5px;
	border-width: 1px;
}
	.avatars:hover .avatar:after {
	font-size: 60%;
}
	.avatar > div.star {
	font-size: 40%;
	margin-left: 23px;
	margin-top: 23px;
}
	.avatar > div.snooze {
	display: none;
} */
}
@media only screen and (max-width: 875px) {
	html .avatars {
		display: none;
	}
}</STYLE></DIV><DIV class="paragraph code-paragraph collapsed" name="Flash Screen Code" last-execution-state="success" data-id="CUrR76Lw" __wid="Dcgws8LB"><PRE data-type="content" type="text/javascript" id="flash-screen" __wid="SiDPHgSx">exports.flash = () => {
	const overlay = document.createElement("transient");
	overlay.classList.add("flash-overlay");
	setTimeout(() => overlay.remove(), 200);
	document.body.appendChild(overlay);
};</PRE></DIV><DIV class="paragraph style-paragraph collapsed" name="Flash Screen Style" data-id="PyhaWPuz" __wid="qFvrFMUx"><STYLE data-type="content" type="text/css" codemirror="true" __wid="UruFUMjZ">@keyframes pulse {
	0% {
		background: transparent;
	}
	50% {
		background: rgba(255,255,255,.3);
	}
	100% {
		background: transparent;
	}
}

.flash-overlay {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	max-width: 100vw;
	max-height: 100vh;
	animation: pulse 0.2s ease-in-out;
}</STYLE></DIV><DIV class="paragraph code-paragraph collapsed" name="Idle Time Code" last-execution-state="success" data-id="sx5rdbHz" __wid="X6WWJBQK"><PRE data-type="content" type="text/javascript" id="idle-time" __wid="uLpvkFLM">var lastAction = Date.now();
const updateLastAction = () => lastAction = Date.now();
//document.addEventListener("keydown", updateLastAction);
document.addEventListener("mousemove", updateLastAction);
document.addEventListener("touchstart", updateLastAction);
exports.get = () => ((Date.now() - lastAction) / 1000) | 0;</PRE></DIV></DIV><DIV class="section section-hidden" name="WebRTC Video on Avatars" data-type="package" data-group="basic" data-id="JvywitDB" __wid="88DPTfPm"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="3gpHCaHH" __wid="ete3Mg7J"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="bYS79nhN"><H2 __wid="NSxC4PEx">Description</H2><DIV __wid="36xPy4vA">Adds WebRTC video communication to avatars.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="r79E9WYH" __wid="zBMhtwUG"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="qz3PpvgN">{
	"version": "1.0.2",
	"icon": "video_call",
	"description": "Adds WebRTC video communication to avatars.",
	"tags": [
		"collaboration",
		"communication"
	],
	"assets": [],
	"dependencies": [
		{
			"id": "USSKFQPD",
			"name": "Avatars"
		}
	],
	"changelog":
	{
    "1.0.2": "Added notifications.",
    "1.0.1": "Fixed issue that caused audio echo due to muted attribute not applied on local video element in lastest version of Chrome.",
		"1.0": "Initital Release"
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/JvywitDB-WebRTC_Video_On_Avatars"
	}
}</PRE></DIV>

<DIV class="paragraph code-paragraph collapsed" name="Event Handling" run-on-load="true" last-execution-state="success" data-id="rjKcVvbm" style __wid="Xpne2JAk"><PRE data-type="content" type="text/javascript" __wid="ddvpzcYy">webstrate.on("signal", (message, senderId) => {

  if (message.type === "Call") {

    // Received request for video call.
    if (message.cmd === "video") {
      console.log("Requesting video");

      const result = confirm(`User ${senderId} calls you. Do you want to accept the call?`);

      if (result) {
        VideoManager.start(senderId);

        // Signal accept
        webstrate.signal({ type: "Call", cmd: "accept" }, senderId);
      } else {
        // Signal reject
        webstrate.signal({ type: "Call", cmd: "reject" }, senderId);
      }
    } else if (message.cmd === "accept") {
      // Approved video call request
      console.log("Accepting video");

      VideoManager.start(senderId);
    } else if (message.cmd === "reject") {
      console.log("Rejecting video");
      alert(`User ${senderId} rejected call.`);
    }

    return;
  }
});

const createUserVideo = (clientId) => {
  const avatar = document.querySelector(`.avatars .avatar[client-id="${clientId}"]`);

  var videoWrapper = document.createElement("div");
  videoWrapper.classList.add("video-wrapper");

  var video = document.createElement("video");
  video.classList.add("remote-video");
  videoWrapper.appendChild(video);
  avatar.appendChild(videoWrapper);

  return video;
};

const listenForStreams = (clientId, meta, accept) => {
//   console.log('create user video', clientId);
  const videoElement = createUserVideo(clientId);

  if (videoElement) {
//     console.log('create user element', videoElement);

    const client = Codestrate.clients.find(client => client.id === clientId);
    Codestrate.localNotification({
      color: "var(--material-color-red)",

      header: {
        icon: "videocam",
        appName: "WebRTC Video",
        text: `${client.displayName || client.username}`,
        timestamp: new Date()
      },

      content: {
        title: "New Video Stream",
        text: `${client.displayName || client.username} (${client.userId}) started a video stream on the codestrate "${window.document.title}".`,
        imagePath: client.avatarUrl
      }
    });

    var conn = accept(function(stream) {
      // Add stream to video element and play it
      videoElement.srcObject = stream;
      videoElement.play();

      conn.onclose(function() {
        if (stream) {
          stream.getVideoTracks().forEach(t => t.stop());
          stream.getAudioTracks().forEach(t => t.stop());
        }

        videoElement.closest('.video-wrapper').remove();

        // document.body.webstrate.on("signalStream", listenForStreams);
      });
    });
  }

  // Listen for further streams...
  // document.body.webstrate.on("signalStream", listenForStreams);
};

document.body.webstrate.on("signalStream", listenForStreams);</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Video Manager" data-id="AjDjPGuu" __wid="SZ5VyYUb"><PRE data-type="content" type="text/javascript" id="video-manager" __wid="DHEpsRsv">const createUserVideo = (clientId) => {
	const avatar = document.querySelector(`.avatar[client-id="${clientId}"]`);

	// no avatar for client id found
	if (!avatar) return;

	let video = avatar.querySelector('video');
	if (video) {
		return video;
	}

	const videoWrapper = document.createElement("div");
	videoWrapper.classList.add("video-wrapper");

	video = document.createElement("video");
	video.classList.add("local-video");
	video.setAttribute("muted", "");
  video.muted = true;

	videoWrapper.appendChild(video);
	avatar.appendChild(videoWrapper);

	return video;
};

const signalStream = (clientId, accept) => {
	// Get audio and video feed.

	if (clientId === webstrate.clientId) return;

	try {
		const videoElement = createUserVideo(webstrate.clientId);

		if (!videoElement.__cons) {
			videoElement.__cons = [];
		}

		if (videoElement.__stream) {
			// And send it to the requesting client.
			var meta = { title: "My Video Stream" };
			var conn = accept(videoElement.__stream, meta, function() {
				// Connection has been established.
			});

			videoElement.__cons.push(conn);
		} else {
			const mediaDevices = navigator.mediaDevices;
			mediaDevices.getUserMedia({ audio: true, video: true })
				.then(function(stream) {

				videoElement.__stream = stream;
				videoElement.srcObject = stream;
				videoElement.play();

				// And send it to the requesting client.
				var meta = { title: "My Video Stream" };
				var conn = accept(stream, meta, function() {
					// Connection has been established.
				});

				videoElement.__cons.push(conn);
			});
		}
	} catch (error) {
		console.error(error);
	}
};

exports.hearMe = () => {
	document.body.webstrate.signalStream(signalStream);
};

exports.stopHearMe = () => {
	document.body.webstrate.stopStreamSignal(signalStream);

	const video = createUserVideo(webstrate.clientId);
	if (video.__cons) {
		video.__cons.forEach(c => c.close());
		delete video.__cons;
	}

	if (video.__stream) {
		const stream = video.__stream;
		stream.getVideoTracks().forEach(t => t.stop());
		stream.getAudioTracks().forEach(t => t.stop());
		delete video.__stream;
	}

	video.closest('.video-wrapper').remove();
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Augment Avatar" run-on-load="true" last-execution-state="success" data-id="FpYrQpAQ" style __wid="SUmNj5vz"><PRE data-type="content" type="text/javascript" __wid="xqU2CgbD">const VideoManager = require('#video-manager');

const augmentAvatar = (avatar) => {
	const hearMe = document.createElement("div");
	hearMe.classList.add("hear-me");

	const icon = document.createElement("i");
	icon.classList.add("material-icons");
	hearMe.appendChild(icon);

	hearMe.addEventListener("click", event => {

		if (avatar.classList.contains("talking")) {
			VideoManager.stopHearMe();
			avatar.classList.remove("talking");
		} else {
			VideoManager.hearMe();
			avatar.classList.add("talking");
		}
	});

	avatar.appendChild(hearMe);
};

document.liveQuerySelectorAll('.avatars .avatar.self').added(augmentAvatar);</PRE></DIV><DIV class="paragraph style-paragraph collapsed" name="Augmented Avatar Style" data-id="rVRxSnSj" style __wid="8AkXg82n"><STYLE data-type="content" type="text/css" codemirror="true" __wid="7ubVbfbA">.avatars .avatar .hear-me {
	position: absolute;
	top: 0;
	left: 0;
	z-index: 1;
	width: 45px;
	height: 45px;
	background-color: deepskyblue;
	border-radius: 50%;
	border: 2px solid white;
	box-shadow: 0px 0px 5px #000;
	opacity: 0;
	transition: transform 250ms ease-in-out 250ms, opacity 250ms ease-in-out 250ms;
}

.avatars .avatar .hear-me i:after {
	content: "videocam";
	position: absolute;
	left: 50%;
	top: 50%;
	transform: translate3d(-50%, -50%, 0);
}

.avatars .avatar .hear-me:hover {
	background-color: green;
}

.avatars .avatar.talking .hear-me i:after {
	content: "videocam_off";
}

.avatars .avatar:hover .hear-me {
	opacity: 1.0;
	transform: translate3d(-50px, 0, 0);
	pointer-events: all;
	cursor: pointer;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" draggable="false" name="WebRTC Style" data-id="KQw7yyGg" style __wid="sTNKGczn"><STYLE data-type="content" type="text/css" codemirror="true" __wid="TYznyTAT">.avatars .avatar .video-wrapper {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border-radius: 50%;
	-webkit-mask-image: -webkit-radial-gradient(circle, white 100%, black 100%); 
	-webkit-transform: rotate(0.000001deg); 
	-webkit-border-radius: 50%; 
	-moz-border-radius: 50%;
	transform: translateZ(0);
}

.avatars .avatar .video-wrapper video {
	position: absolute;
	left: 50%;
	top: 50%;
	height: 100%;
	transform: translate3d(-50%, -50%, 0);
}

.avatars .avatar.self .video-wrapper video {
	transform: translate3d(-50%, -50%, 0) scaleX(-1);
}</STYLE></DIV></DIV><DIV class="section section-hidden" name="Invite" data-group="basic" data-type="package" data-id="fTSh2aVG" __wid="73UWk2uF"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="WnFasvew" __wid="MAUTqbgp"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="C8UctFya"><H2 __wid="KWbjiXGF">Description</H2><DIV __wid="LUf8euBg">Adds the functionality to invite other people to a codestrate.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="ac7xbVfV" style __wid="mDTHQFU9"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="rUjcypvu">{
	"version": "2.0.1",
	"icon": "person_add",
	"description": "Adds the functionality to invite other people to a codestrate.",
	"tags": [
		"collaboration"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
    "2.0.1": "Removed dependency as notifications are now part of the system.",
		"2.0": "Used new Notifications package instead of deprecated Toast Messages.",
		"1.1.1": "Used Commands API.",
		"1.1": "Fixed entry in global menu.",
		"1.0": "Initial Release"
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/fTSh2aVG-Invite"
	}
}</PRE></DIV>

<DIV class="paragraph code-paragraph collapsed" style run-on-load="true" last-execution-state="success" name="Add invite to Global Menu" draggable="false" data-id="CkAQMwqs" __wid="4NtuUWvW"><PRE data-type="content" type="text/javascript" __wid="FM5EyKvt">const GlobalMenuUtils = require("#global-menu-utils");

/******************************************************************************/

Codestrate.addCommand("invite.inviteToCodestrate", "Invite to Codestrate", () => {
	(async() => {
		let receiver = await prompt("Send invite to a user or multiple users (comma separated list of user ids):", "", "Invite to Codestrate");

		if (receiver) {
			let receivers = receiver.split(',');

			// Get client color
			let ClientManager = require('#client-manager');
			let client = ClientManager.getClient();

			let username = webstrate.user.displayName || webstrate.user.username;
			let avatarUrl = webstrate.user.avatarUrl;
			let userColor = client.color;
			let webstrateId = webstrate.webstrateId;

			Codestrate.notification({
				className: "notification-invite",
				color: "var(--material-color-green)",

				header: {
					icon: "send",
					appName: "Invite",
					text: username,
					timestamp: new Date()
				},

				content: {
					title: "Invite to " + document.title,
					text: `${username} invites you to a codestrate. Click on "visit" to open the codestrate!`,
					imagePath: `${avatarUrl || 'unknown.jpg'}`
				},

				actions: [
					{
						"name": "Visit",
						"action": `() => { window.open('/${webstrateId}'); }`
					}
				]
			}, receivers);

			toast(`Invited user "${receiver}"`);
		}
	})();
});

/******************************************************************************/

GlobalMenuUtils.addButton("Invite to Codestrate", false, (event) => {
	Codestrate.executeCommand("invite.inviteToCodestrate");
});

GlobalMenuUtils.addDivider();</PRE></DIV></DIV><DIV name="Shared Pointers" class="section section-hidden" data-type="package" data-group="basic" data-id="mhzRF233" __wid="fykdfKgx"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="XUF62tu7" __wid="SjtZXJtR"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="mEsJBLJa"><H2 __wid="saKQwtEy">Description</H2><DIV __wid="PZkyWgMn">Adds the functionality to see mouse pointers of other people on a codestrate.</DIV></DIV></DIV><DIV class="paragraph data-paragraph collapsed locked" name="Properties" data-id="xVmNyYKM" __wid="BzXZBSuP"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="cAh2UruW">{
	"version": "1.1.1",
	"icon": "mouse",
	"description": "Adds the functionality to see mouse pointers of other people on a codestrate.",
	"tags": [
		"collaboration"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initital Release",
		"1.1": "Calculation with new margins fixed.",
    "1.1.1": "Fixed issue with throttling function and Codestrate.on event listener."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/mhzRF233-Shared_Pointers"
	}
}</PRE></DIV>

<DIV class="paragraph code-paragraph collapsed" name="Shared Pointers Code" run-on-load="true" last-execution-state="success" data-id="KaMxKCbr" __wid="2Wmd6kfd"><PRE data-type="content" type="text/javascript" __wid="CzmTJ8G8">const ClientManager = require('#client-manager');
const EventUtils = require('#event-utils');

var clients = {};

const throttledSignal = EventUtils.throttle((msg, clientId) => {
	if (clientId) document.body.webstrate.signal(msg, clientId);
	else document.body.webstrate.signal(msg);
}, 100);

/**
 * Returns an object with the position relative to the body and relative to a given
 * paragraph. If the cursor is not on top of a paragraph the paraId will be null.
 */
const adjustCoords = (x, y) => {
	const rect = document.body.getBoundingClientRect();
	const elemAtPoint = document.elementFromPoint(window.innerWidth / 2, y - document.documentElement.scrollTop);
	const paragraphAtCursor = elemAtPoint ? elemAtPoint.closest(".paragraph") : null;

	let paraX = 0;
	let paraY = 0;
	let paraId = null;

	if (paragraphAtCursor !== null) {
		paraId = paragraphAtCursor.webstrate.id;
		let paraRect = paragraphAtCursor.getBoundingClientRect();
		paraX = x - paraRect.left;
		paraY = y - paraRect.top - document.documentElement.scrollTop;
	}

	return {
		paraId: paraId,
		paraX: paraX,
		paraY: paraY,
		x: x,
		y: y
	};
};

document.addEventListener("mousedown", function (e) {
	const pos = adjustCoords(e.pageX, e.pageY);
	throttledSignal({
		cmd: "click",
		data: pos
	});
});

document.addEventListener("touchstart", function (e) {
	if (e.touches.length > 0) {
		const touch = e.touches[0];
		const pos = adjustCoords(touch.pageX, touch.pageY);
		throttledSignal({
			cmd: "click",
			data: pos
		});
	}
});

document.addEventListener("mousemove", function (e) {
	const pos = adjustCoords(e.pageX, e.pageY);
	throttledSignal({
		cmd: "pos",
		data: pos
	});
});

document.addEventListener("touchmove", function (e) {
	if (e.touches.length > 0) {
		const touch = e.touches[0];
		const pos = adjustCoords(touch.pageX, touch.pageY);
		throttledSignal({
			cmd: "pos",
			data: pos
		});
	}
});

document.body.webstrate.on("signal", function (msg, clientId) {
	if (clientId == window.webstrate.clientId) return;
	if (msg.cmd === undefined) return;
	else if (msg.cmd === "pos") {

		if (clients[clientId] === undefined) return;
		clients[clientId].classList.remove("hidden");

		const remoteCursorPostion = getRemoteCursorPostion(msg);

		clients[clientId].style.left = remoteCursorPostion.x + "px";
		clients[clientId].style.top = remoteCursorPostion.y + "px";

		// Hide cursor after five seconds of inactivity
		if (clients[clientId].__timeout) clearTimeout(clients[clientId].__timeout);
		clients[clientId].__timeout = setTimeout(function () {
			if (!clients[clientId]) return;
			clients[clientId].classList.add("hidden");
		}, 5000);

	} else if (msg.cmd === "click") {
		clicked(msg, clientId);
	}
});

webstrate.on("signal", (message, senderId) => {
	if (message.type === "IdleTimer") {

		if (message.cmd === "awake") {
			clientJoin(senderId);
		} else if (message.cmd === "idle") {
			clientPart(senderId);
		}
	}
});

webstrate.on("clientJoin", function (clientId) {
	clientJoin(clientId);
});

webstrate.on("clientPart", function (clientId) {
	clientPart(clientId);
});

function clientJoin(clientId) {
	// Ignore own cursor
	if (clientId === webstrate.clientId) return;

	clients[clientId] = createCursor(clientId);
}

function clientPart(clientId) {
	if (!clients.hasOwnProperty(clientId)) return;
	clients[clientId].parentElement.removeChild(clients[clientId]);
	delete clients[clientId];
}

function createCursor(clientId) {
	let client = ClientManager.getClient(clientId);

	var cursor = document.createElement("transient");
	cursor.classList.add("remote-cursor");
	cursor.setAttribute("client-id", clientId);
	cursor.setAttribute("username", client.username);
	cursor.style.borderColor = client.color;
	document.body.appendChild(cursor);
	// console.log(cursor);
	return cursor;
}

Codestrate.addEventListener("clientUpdateProperty", ({ property, client }) => {
	let cursor = document.querySelector(`.remote-cursor[client-id="${client.id}"]`);
	if (cursor) {
		cursor.setAttribute("username", client.username);
		cursor.style.borderColor = client.color;
	}
});

function clicked(msg, clientId) {

	//const rect = document.body.getBoundingClientRect();
	//const x = msg.data.x;// + rect.left;
	//const y = msg.data.y; // + rect.top;

	const remoteCursorPostion = getRemoteCursorPostion(msg);

	const click = document.createElement("transient");
	click.classList.add("remote-click");
	click.style.left = remoteCursorPostion.x + "px";
	click.style.top = remoteCursorPostion.y + "px";
	click.style.borderColor = clients[clientId].style.borderColor;
	click.addEventListener("transitionend", function (event) {
		if (event.propertyName === "transform") {
			click.remove();
		}
	});
	document.body.appendChild(click);

	// Add animation with timeout to make it actually animate
	setTimeout(() => {
		click.classList.add("animate");
	}, 10);

	setTimeout(() => {
		click.remove();
	}, 200);
}

function getRemoteCursorPostion(msg) {
	let x = msg.data.x;
	let y = msg.data.y;
	if (msg.paraId !== null) {
		let paragraphs = document.querySelectorAll(".paragraph");
		let paragraph = null;
		for (var i = 0; i &lt; paragraphs.length; i++) {
			if (paragraphs[i].webstrate.id === msg.data.paraId) {
				paragraph = paragraphs[i];
				break;
			}
		}

		if (paragraph !== null) {
			let paraRect = paragraph.getBoundingClientRect();
			let bodyRect = document.body.getBoundingClientRect();
			x = msg.data.paraX + paraRect.left - bodyRect.left + 
				parseInt(document.defaultView.getComputedStyle(document.body).marginLeft);
			y = msg.data.paraY + paraRect.top - bodyRect.top +
				parseInt(document.defaultView.getComputedStyle(document.body).marginTop);
		}
	}

	return {
		x: x,
		y: y
	};
}

/*
for (var i = 0; i&lt;webstrate.clients.length; i++) {
  if (webstrate.clients[i] == webstrate.clientId) continue;
  clientJoin(webstrate.clients[i]); 
}*/
webstrate.clients.forEach(clientJoin);</PRE></DIV><DIV class="paragraph style-paragraph collapsed" name="Shared Pointers Style" data-id="GfyCc8Cd" __wid="gVf9CCQ5"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="q5FAxHND">html .remote-cursor {
	position: absolute;

	/* Set the cursor offscreen initially. If top is not set then cursor
	will be appended like regular position: initial */
	top: -100px;

	z-index: 999;
	width: 12px;
	height: 12px;
	background-color: transparent;
	border-left: 4px solid;
	border-top: 4px solid;
	box-sizing: border-box;
	pointer-events: none;
	/* transition: top 1ms, left 1ms; */
	/* transform: translate3d(20px, -0px, 0); */
	transition: all 0.05s ease 0s;
	opacity: 1;
	transition: opacity 150ms ease-in;
}

html .remote-cursor:after {
	content: attr(username);
	position: absolute;
	transform: translate3d(5px, 0px, 0);
	font-size: .6em;
}

html .remote-cursor.hidden {
	opacity: 0;	
}

html .remote-click {
	position: absolute;
	z-index: 998;
	width: 50px;
	height: 50px;
	/* background-color: orange; */
	transform: translate3d(-25px, -25px, 0) scale(0);
	transition: transform 150ms ease-in-out, opacity 150ms ease-in;
	border-radius: 50%;
	border: 4px solid orange;
	pointer-events: none;
	filter: blur(2px);
	opacity: 1.0;
}

html .remote-click.animate {
	/* width: 50px;
	height: 50px; */
	transform: translate3d(-25px, -25px, 0) scale(1.0);
	opacity: 0;
}</STYLE></DIV></DIV><DIV class="section section-hidden" name="Remote Cursors" data-type="package" data-group="basic" data-id="XmZFpkT7" __wid="WRscJ8Ft"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="R7n9mXrD" __wid="DHEegc5G"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="X5PRzWu9"><H2 __wid="ZhrjHek7">Description</H2><DIV __wid="JrwhJXkG">Adds the functionality to see cursors of other people on a codestrate.</DIV></DIV></DIV><DIV class="paragraph data-paragraph collapsed locked" name="Properties" data-id="auHPMEdC" __wid="5cjxYk3w"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="q6xbRwzv">{
	"version": "1.0.1",
	"icon": "keyboard_return",
	"description": "Adds the functionality to see cursors of other people on a codestrate.",
	"tags": [
		"collaboration"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initital Release",
		"1.0.1": "Fixed issue with Codestrate.on preventing the remote cursor package to work."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/XmZFpkT7-Remote_Cursors"
	}
}</PRE></DIV>

<DIV class="paragraph code-paragraph collapsed" name="Levenshtein" run-on-load="true" last-execution-state="success" draggable="false" data-id="M7kDfXK2" __wid="xm28STRC"><PRE data-type="content" type="text/javascript" __wid="YymgnVGX">String.prototype.levenshtein = function(b) {
	a = this;
	if (a.length === 0) return b.length; 
	if (b.length === 0) return a.length;

	// Swap to save some memory O(min(a,b)) instead of O(a) what do you think of my coding?
	if (a.length > b.length) {
		var tmp = a;
		a = b;
		b = tmp;
	}

	var row = [];

	// Init the row
	for (var i = 0; i &lt;= a.length; i++){
		row[i] = i;
	}

	// fill in the rest
	for (var i = 1; i &lt;= b.length; i++){
		var prev = i;
		for (var j = 1; j &lt;= a.length; j++){
			var val;
			if (b.charAt(i-1) == a.charAt(j-1)){
				val = row[j-1]; // Match
			} else {
				val = Math.min(row[j-1] + 1, // Substitution
											 prev + 1,     // Insertion
											 row[j] + 1);  // Deletion
			}
			row[j - 1] = prev;
			prev = val;
		}
		row[a.length] = prev;
	}

	return row[a.length];
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" draggable="false" last-execution-state="success" name="Remote Cursors Utils" data-id="ZxiHZbSb" __wid="ZXPwJZNk"><PRE data-type="content" type="text/javascript" id="remote-cursor-utils" __wid="rqp4W8Cx">// Function used to find a textnode in the children of a node that's most like the string given
const findClosestTextNode = (parent, str) => {
	// If there's only one textnode return that.
	var textNodes = [];
	for (var i = 0; i&lt;parent.childNodes.length; i++) {
		if (parent.childNodes[i].nodeType !== 3) continue;
		textNodes.push(parent.childNodes[i]);
	}
	if (textNodes.length === 1) return textNodes[0];

	// Lets see if there's one of them that's very close in length
	var closeCount = 0;
	var close;
	for (var i = 0; i&lt;textNodes.length; i++) {
		if (Math.abs(str.length -  textNodes[i].textContent.length) &lt;= 3) {
			closeCount++;
			close = textNodes[i];
		}
	}
	if (closeCount == 1) return close;

	// Else we have to find the one that's closest to the one given
	// (This is pretty slow...)
	var closest;
	var minLev = Infinity;
	for (var i = 0; i&lt;textNodes.length; i++) {
		var lev = textNodes[i].textContent.levenshtein(str);
		if (lev &lt; minLev) {
			closest = textNodes[i];
			minLev = lev;
		}
	}
	return closest;
};

const findNodeFromWID = (wid) => {
	var allElements = document.querySelectorAll("*");
	for (var i = 0; i&lt;allElements.length; i++) {
		if (allElements[i].webstrate && allElements[i].webstrate.id == wid) {
			return(allElements[i]);
		}
	}

};

const findTextNodeFromWIDandString = (wid, str) => {
	var parent = findNodeFromWID(wid);
	if (parent === null || parent === undefined) return null;
	return findClosestTextNode(parent, str);
};

exports.findClosestTextNode = findClosestTextNode;
exports.findNodeFromWID = findNodeFromWID;
exports.findTextNodeFromWIDandString = findTextNodeFromWIDandString;</PRE></DIV>
<DIV class="paragraph code-paragraph collapsed" draggable="false" run-on-load="true" last-execution-state="success" name="Remote Cursors" data-id="dsGvJuyb" __wid="DxTzCULd"><PRE data-type="content" type="text/javascript" __wid="HCFZufJH">const ClientManager = require('#client-manager');

const {
	findClosestTextNode,
	findNodeFromWID,
	findTextNodeFromWIDandString
} = require('#remote-cursor-utils');

// Get the display name from the user object, if the user is not logged in use anonymous
var displayName = webstrate.user ? webstrate.user.displayName : "Anonymous";

// Keeps track of all current cursor elements.
var clientCursors = {};

// Keeps track of the last cursor signal received from a client
var lastSignals = {};

// Keeps track of the last selection.
var lastSelection;

// Run through clients already connected and create their cursors
for (var i = 0; i&lt;webstrate.clients.length; i++) {
	addClient(webstrate.clients[i]);
}

// When a client joins create a cursor element and send your selection
webstrate.on("clientJoin", function(clientId) {
	if (clientId == webstrate.clientId) return;
	addClient(clientId);
	signalSelection(lastSelection);
});


// When a client leaves we delete its cursor
webstrate.on("clientPart", function(clientId) {
	if (clientCursors[clientId] && clientCursors[clientId].parentElement) {
		clientCursors[clientId].parentElement.removeChild(clientCursors[clientId]);    
	}
	delete clientCursors[clientId];
	delete lastSignals[clientId];
});

// When the window resizes redraw the cursors based on the last cursor signal received from the other clients.
window.addEventListener("resize", function() {
	var clients = Object.keys(lastSignals);
	for (var i = 0; i&lt;clients.length; i++) {
		drawCursor(lastSignals[clients[i]], clients[i]);
	}
});

// Timer used to send an extra signal when interaction stops
var signalTimeout;
var lastSignal;

// Compose a message based on the selection and send it off
var signalSelection = function(selection) {
	if (!selection) return;
	var msg = {
		cmd: "remote-cursor"
	};

	// We have to send the WID of the anchor, extent and focus node. We also send the text of the nodes
	// Because we need it to find the proper text node on the other side. 
	// As soon as text nodes will have WIDs we will not need to do this.
	msg.anchorNode = selection.anchorNode.nodeType == 3 ? selection.anchorNode.parentNode.webstrate.id : selection.anchorNode.webstrate.id;
	msg.extentNode = selection.extentNode.nodeType == 3 ? selection.extentNode.parentNode.webstrate.id : selection.extentNode.webstrate.id;
	msg.focusNode = selection.focusNode.nodeType == 3 ? selection.focusNode.parentNode.webstrate.id : selection.focusNode.webstrate.id;
	msg.anchorOffset = selection.anchorOffset;
	msg.extentOffset = selection.extentOffset;
	msg.focusOffset = selection.focusOffset;
	msg.anchorText = selection.anchorNode.nodeType == 3 ? selection.anchorNode.textContent : null;
	msg.extentText = selection.extentNode.nodeType == 3 ? selection.extentNode.textContent : null;
	msg.focusText = selection.focusNode.nodeType == 3 ? selection.focusNode.textContent : null;
	msg.type = "selectionchanged";
	msg.anchorNodeType = selection.anchorNode.nodeType;
	msg.extentNodeType = selection.extentNode.nodeType;
	msg.focusNodeType = selection.focusNode.nodeType;
	msg.displayName = displayName;
	document.body.webstrate.signal(msg);
	// To make sure that the signal to move the cursor doesn't arrive before the edit done to the text,
	// We send an extra signal after waiting 50ms
	lastSignal = msg;

	if (signalTimeout) clearTimeout(signalTimeout);
	signalTimeout = setTimeout(function() {
		document.body.webstrate.signal(lastSignal);
	}, 50);
};

// When selection change, get it and send it
document.addEventListener("selectionchange", function(event) {
	lastSelection = getSelection();

	// only signal body paragraphs
	let anchorNode = lastSelection.anchorNode;
	if (
		anchorNode &&
		anchorNode.parentElement.closest('.paragraph.body-paragraph') &&
		anchorNode.parentElement.closest('[data-type="content"][contenteditable="true"]')
	) {
		signalSelection(lastSelection);	
	}
});


// Handles when we receive a signal
document.body.webstrate.on("signal", function(msg, clientId) {
	// If the client doesn't have a cursor return.
	if (msg.cmd !== "remote-cursor" || !clientCursors[clientId]) return;
	lastSignals[clientId] = msg;
	drawCursor(msg, clientId);
});

function drawCursor(msg, clientId) {
	// Now we have to find the anchor and focus from the WIDs in the signal
	// As textNodes currently have no WIDs we have to do some ugly stuff that I've parked in the levenshtein script
	var anchor, focus;
	if (msg.anchorNodeType === 3) {
		anchor = findTextNodeFromWIDandString(msg.anchorNode, msg.anchorText);
	} else {
		anchor = findNodeFromWID(msg.anchorNode);
	}
	if (msg.focusNodeType === 3) {
		focus = findTextNodeFromWIDandString(msg.focusNode, msg.focusText);
	} else {
		focus = findNodeFromWID(msg.focusNode, msg.focusText);
	}
	if (!anchor || !focus) return; // No nodes !

	// We check the order of the anchor and focus (to see if it is a backwards selection)
	try {
		var preceding = (anchor.compareDocumentPosition(focus) == 4) || (anchor.compareDocumentPosition(focus) === 0 && msg.focusOffset > msg.anchorOffset);
	} catch (err) {
		return;  
	}

	// If its a backwards selection we switch. This can throw an exception if anchor and focus are the same.
	var range = document.createRange();
	try {
		if (preceding) {
			range.setStart(anchor, msg.anchorOffset);
			range.setEnd(focus, msg.focusOffset);
		} else {
			range.setStart(focus, msg.focusOffset);
			range.setEnd(anchor, msg.anchorOffset);          
		}
	} catch (err) {
		return;  
	}
	// If the cursor is already somewhere in the document we detach it from its parent
	if (clientCursors[clientId].parentElement) clientCursors[clientId].parentElement.removeChild(clientCursors[clientId]);
	// Get the rects from the newly created range
	var allRects = range.getClientRects();
	// Prune out rects from elements with display block (fills the whole width of the screen)
	var rects = [];
	for (var i = 0; i&lt;allRects.length; i++) {
		if (allRects[i].width !== window.innerWidth) rects.push(allRects[i]);        	
	}

	// If there's no rects in the range we create one that can be used for the cursor.
	// We use the left side of the anchor node to do this.
	if (rects.length === 0) {
		if (!anchor.getBoundingClientRect) return; // The anchor is a text node, we shouldn't be here. Perhaps the content has display: none.
		var anchorBounds = anchor.getBoundingClientRect();
		anchorBounds = {left: anchorBounds.left, right: anchorBounds.left, top: anchorBounds.top, bottom: anchorBounds.bottom, height: anchorBounds.height, width: 0};
		rects.push(anchorBounds);
	}
	// Now we insert the cursor just before the anchornode
	anchor.parentElement.insertBefore(clientCursors[clientId], anchor);
	var cursorBounds = clientCursors[clientId].getBoundingClientRect();
	var rectsDiv = clientCursors[clientId].querySelector(".rects");
	// We clear the rects of the cursor
	rectsDiv.innerHTML = "";
	// Generate a div for each of the rects in the range
	for (var i = 0; i&lt;rects.length; i++) {
		var rect = document.createElement("div");
		rect.style.position = "absolute";
		rect.style.left = rects[i].left - cursorBounds.left + "px";
		rect.style.top = rects[i].top - cursorBounds.top + "px";
		rect.style.width = rects[i].width + "px";
		rect.style.height = rects[i].height + "px";
		rect.setAttribute("class", "rect");
		rect.style.backgroundColor = ClientManager.getClientColor(clientId);
		rect.style.borderColor = ClientManager.getClientColor(clientId);
		rectsDiv.appendChild(rect);
	}
	// At the end we place "the cursor" that is a vertical bar that also includes the display name
	var endRect = rects[rects.length-1];
	var cursorEnd = clientCursors[clientId].querySelector(".end");
	var displayName = clientCursors[clientId].querySelector(".displayName");
	displayName.innerText = msg.displayName;
	cursorEnd.style.position = "absolute";
	cursorEnd.style.left = endRect.right - cursorBounds.right + "px";
	cursorEnd.style.top = endRect.top - cursorBounds.top + "px";
	cursorEnd.style.height = endRect.height + "px";
	cursorEnd.setAttribute("class", "end");
	cursorEnd.style.backgroundColor = ClientManager.getClientColor(clientId);
	cursorEnd.style.borderColor = ClientManager.getClientColor(clientId);

}

function addClient(clientId) {

	// If the client is this one, return.
	if (clientId == webstrate.clientId) return; 

	// Get user's color
	var color = ClientManager.getClientColor(clientId);

	// Create the main cursor element
	var cursor = document.createElement("transient");

	// Create the end of the cursor (what's shown if nothing is selected
	var cursorEnd = document.createElement("div");

	// Create the element for the display name
	var displayName = document.createElement("div");
	displayName.setAttribute("class", "displayName");
	displayName.style.backgroundColor = color;
	cursorEnd.appendChild(displayName);
	cursorEnd.setAttribute("class", "end");
	cursor.setAttribute("class", "cursor");
	cursor.style.backgroundColor = color;
	cursor.setAttribute("data-clientid", clientId);
	cursor.setAttribute("contenteditable", "false");

	// Create the element containing the rects for selection
	var rects = document.createElement("div");
	rects.setAttribute("class", "rects");
	cursor.appendChild(rects);
	cursor.appendChild(cursorEnd);
	clientCursors[clientId] = cursor;

	// When we mouse over the cursor we want the display name to show (and then hide after a while
	// through CSS)
	cursor.addEventListener("mouseover", function() {
		// Easiest way to retrigger an animation is to clone and replace the node
		var clone = displayName.cloneNode(true);
		displayName.parentNode.replaceChild(clone, displayName);
		displayName = clone;
	});

	Codestrate.addEventListener("clientUpdateProperty", ({ client, propertyName }) => {
		if (propertyName === "color") {
			displayName.style.backgroundColor = client.color;
		}
	});
}</PRE></DIV><DIV class="paragraph style-paragraph collapsed" draggable="false" name="Remote Cursors" data-id="q78PZsdu" __wid="gCN7YAny"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="nrHQtTAx">html .client {
	width: 100px;
	height: 1em;
	margin: 1px;
	padding: 1px;
	display: inline-block;
}

html .cursor {
	position: absolute;
	user-select: none;
	pointer-events: none;
}

html .cursor .rect {
	/* lighten when white color font */
	mix-blend-mode: lighten;
}

html .cursor .end {
	opacity: 1.0;
	width: 2px;
}

html .cursor .end .displayName {
	position: absolute;
	padding: 2px;
	white-space: pre;
	top: -100%;
	font-size: 9pt;
	animation: hide 4s ease 1 normal;
	opacity: 0;
	font-weight: bold;
}

@-webkit-keyframes hide {
	0% { opacity: 1; }
	80% { opacity: 1; }
	100% { opacity: 0; }
}

html .cursor .rect {
	border-left: none;
}

html .cursor .rect ~ .rect {
	border: none;
}</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="qcWPfzfc" data-type="package" name="Presentations" __wid="Xu9K5RbG"><DIV class="paragraph body-paragraph locked collapsed" data-id="M4fRaLu8" name="Documentation" __wid="3ejKsqC2"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="CvuxW4X8"><H2 __wid="d6cX8qgZ">Description</H2><DIV __wid="n7jfcijE">This package makes it possible to create slides and presentations in Codestrates.</DIV><H2 __wid="8RF9BceW">Slides</H2><H4 __wid="P6d4PtJL">Adding Slides</H4><DIV __wid="55i8Tp4F">Slides can be added to the Codestrate by using the "Add Slide" button in the global toolbar.</DIV><H4 __wid="HMdvDWb6">Converting to Slides</H4><DIV __wid="prsLKCHN">Body paragraphs can be converted to a slide (and vice versa). This is done by selecting a body-paragraph and then using the "Toggle Slide" button in the snackbar.</DIV><H4 __wid="qafRyrjQ">Aspect Ratio of Slides</H4><DIV __wid="WNJxDGR5">Slides by default have an aspect ratio of 16:9. The aspect ratio can be changed by adding a <CODE __wid="5zTufhwq">aspect-x-y</CODE> class to a slide paragraph. The following aspect ratios are supported: <CODE __wid="aWsKfXwz">aspect-4-3</CODE>, <CODE __wid="jgvXuSb2">aspect-16-10</CODE> and <CODE __wid="ZmdKG8uS">aspect-1-1</CODE>.</DIV><H2 __wid="W65WqKRj">Presentations</H2><H4 __wid="Ti5Mmg7e">Start Presentation from Start</H4><DIV __wid="48mzJh7s">A presentation can be started from the first slide on by using the "Start Presentation" button in the global toolbar. A presentation can also be started from the start by pressing <KBD __wid="EP2LUchv">Ctrl</KBD>+<KBD __wid="QB5n5fyx">Enter</KBD> or <KBD __wid="GepQAiLT">F5</KBD> while no slide is selected.</DIV><H4 __wid="Q2MxyB7h">Start Presentation from a Specific Slide</H4><DIV __wid="eMhSk2kr">A presentation can also be started from a specific slide. This is done by selecting the slide and pressing the "Start Presentation" button in the snackbar. A presentation can also be started from a specific slide by pressing <KBD __wid="aVL7MT72">Ctrl</KBD>+<KBD __wid="wy57Lurp">Enter</KBD> or <KBD __wid="rpWAyS3V">F5</KBD> while the slide is selected.</DIV><H4 __wid="GwVu5TWm">Exit a Presentation</H4><DIV __wid="pzYLkFwu">To exit a presentation press <KBD __wid="hvgXYWPG">Esc</KBD> or <KBD __wid="K4S3iYXg">Ctrl</KBD>+<KBD __wid="7rUGR4HR">Enter</KBD> or <KBD __wid="Fx9FhCyw">F5</KBD> during a presentation.</DIV><H3 __wid="T3GcHEW4">Navigating Slides</H3><DIV __wid="V3L3yRbw">To go to the next or previous slides use the <KBD __wid="H4kN38Jx">&lt;-</KBD> and <KBD __wid="LgyZyuF4">-></KBD> arrow keys or <KBD __wid="6pDQpKwi">Page Up</KBD> and <KBD __wid="7k2giq9n">Page Down</KBD>.</DIV><H3 __wid="8Vszkknh">Slide Notes</H3><DIV __wid="5k3uA79i">To toggle slide notes during press <KBD __wid="qsn2KPDK">Ctrl</KBD>+<KBD __wid="LD3exdUm">K</KBD> during a presentation.</DIV><H2 __wid="QkYwrFjx">Heavy Content</H2><DIV __wid="P3qaxSNd">In the context of this package, heavy content means iframes or scripts or videos, which should be executed lazy, i.e. when the slide comes up or shortly before and be again removed afterwards. To facilitate these kind of loading this package provides slide scripts and <CODE __wid="eQ9BhMEh">&lt;slide-content></CODE> elements to do so.</DIV><H3 __wid="s469UbqY">Slide Scripts</H3><DIV __wid="iAi2izpb">A slide script is a script, which has the same ID as a slide paragraph followed by <CODE __wid="prSHxNQ8">-script</CODE> and provides three functions for three slide states. A newly created script looks as follows:</DIV><PRE __wid="SCLFTkn5"><CODE __wid="MBNVm9ts">// Called on slide preload
exports.preload = (paragraph, slide) => {
  // Your code...
};

// Called on slide enter
exports.enter = (paragraph, slide) => {
  // Your code...
};


// Called on slide exit
exports.exit = (paragraph, slide) => {
  // Your code...
};</CODE></PRE><DIV __wid="LeqnVkv2">As the comments suggest, the three functions will either be called when the slide comes up (<CODE __wid="RuccxnV8">.enter</CODE>), is left (<CODE __wid="ZzYpLSXY">.exit</CODE>) or when the slide before the one of the script is opened (<CODE __wid="iyXKiB5g">.preload</CODE>).</DIV><H3 __wid="FTFssHN8"><CODE __wid="NJ5843vR">&lt;slide-content></CODE> Element</H3><DIV __wid="kqGVPMRZ">When one just wants to lazy load an HTML element into a slide, one can use the <CODE __wid="ZYTZf3FK">&lt;slide-content></CODE> Element:</DIV><PRE __wid="nJwi9dST"><CODE __wid="ZK7a9KYh">&lt;slide-content>
  &lt;template event="preload">&lt;/template>
  &lt;template event="enter">&lt;/template>
  &lt;template event="exit">&lt;/template>
  &lt;render-to>&lt;/render-to>
&lt;/slide-content></CODE></PRE><DIV __wid="we7ycGGD">This element will render the contents of the <CODE __wid="PDu9vwDT">&lt;template></CODE> elements into the <CODE __wid="mf5yKdZ3">&lt;render-to></CODE> element on the same slide states as described in slide scripts.</DIV><H2 __wid="i9eAg7gY">Transient Presentation (experimental)</H2><DIV __wid="S7JtBBtC">When starting a presentation it is started persistent, i.e. on every client. When one wants to preview a presentation or leave a presentation just on the local client, one can add the <KBD __wid="LEfyiRHa">Alt</KBD> key to the shortcuts from above (e.g. <KBD __wid="qmDhma9N">Ctrl</KBD>+<KBD __wid="QSmUSCRS">Alt</KBD>+<KBD __wid="9mcAnx7w">Enter</KBD>) in order to do that. An orange border indicates, that the presentation is started (or left) just on the local client.</DIV><DIV __wid="XFqxf8if"><B __wid="AH8pYTk9">Warning</B>: This is an experimental function, so some things like presentation scripts or <CODE __wid="gmHbgzEX">&lt;slide-content></CODE> are not loading.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="zntLciQX" __wid="8GmMDtzz"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="WPqMztzJ">{
  "version": "1.2.10",
  "icon": "slideshow",
  "description": "Makes it possible to create slides and presentations.",
  "tags": [
    "tools",
    "body paragraphs"
  ],
  "assets": [
    "presentation_pointer.png"
  ],
  "changelog": {
    "1.0": "Initial version.",
    "1.0.1": "Fixed slide scaling when first slide is added and debounced slide scaling on window resize.",
    "1.0.2": "Added print slide style.",
    "1.0.3": "Fixed slide notes text color in other themes.",
    "1.0.4": "Added persistent styles to package.",
    "1.0.5": "Added add heavy slide content button to snackbar content editor.",
    "1.0.6": "Added transient element as wrapper around heavy slide content. Fixed comment in slide script template.",
    "1.0.7": "Fixed slide flex direction.",
    "1.0.8": "Always show slide number.",
    "1.0.9": "Fixed scaling bug when first slide is hidden.",
    "1.0.10": "Update slide numbers when creating slides.",
    "1.0.11": "Fixed fullscreen scaling by using 'window.innerWidth'.",
    "1.0.12": "Added documentation and new description.",
    "1.0.13": "Fixed printing CSS.",
    "1.0.14": "Fixed scaling in paragraphs, added 'basic' class for basic slide styles.",
    "1.0.15": "Pull classes from content into slide-content and convert slide back without notes.",
    "1.0.16": "Extended basic style.",
    "1.0.17": "New indicator for transient hidden presentation.",
    "1.0.18": "Fixed issue with table header (thead) rendering multiple times within table body when printing presentation slides.",
    "1.0.19": "Added text tools as optional dependency.",
    "1.0.20": "Fixed print style for new scroll style of #sections.",
    "1.0.21": "Added MutationObserver that checks for videos that have the muted attribute set and mutes the video accordingly. This fixes a change in Chrome where muted attribute is ignored.",
    "1.0.22": "Added gesture control to control slide show on a touch device",
    "1.0.23": "Fixed a bug where the toolbar and the snackbar were still visible in presentation mode on Mobile Safari.",
    "1.0.24": "Update scale on presentation exit to fixed wrong scaling bug.",
    "1.1": "Fixed transforming from paragraph to slide and vice versa.",
    "1.1.1": "Extracted basic slide template into custom package, and added it as optional dependency.",
    "1.1.2": "Re-implemented undo toggle slide action.",
    "1.2": "Added slide template select to the paragraph header when slide class is active.",
    "1.2.1": "Removed optional dependencies",
    "1.2.2": "Added aspect ratio select to paragraph header when slide class is active.",
    "1.2.3": "Removed console.log",
    "1.2.4": "Added a blank template that does not have much style except a white background and black color.",
    "1.2.5": "Binding contenteditable of [data-type=\"content\"] to .slide-content contenteditable.",
    "1.2.6": "Changed direction of swipe gestures to switch slides.",
    "1.2.7": "Used commands and keybindings API for shortcuts.",
    "1.2.8": "Do not change slides on arrow key left/right when focus is on a slide note.",
    "1.2.9": "Show default cursor when hovering over slide notes. The center of the laser-pointer cursor is now the tip of the arrow (default) cursor making it easier to hit elements on click.",
    "1.2.10": "Added 'paragraph' parameter to manually set the start slide of a presentation."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/qcWPfzfc-Presentations"
  }
}</PRE></DIV><DIV class="paragraph body-paragraph locked collapsed" data-id="Cqmg5byz" name="Slide Template" __wid="mi8SA7aS"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" __wid="jbP9HfiN"><!-- DO NOT CHANGE FORMATTING OF HTML  -->
<TEMPLATE id="slide-template" __wid="eTvMm9ZM"><DIV class="slide-container" contenteditable="false" __wid="z3kmQFTM">
  <DIV class="slide-content" contenteditable="true" __wid="KE9SMQ7L"></DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="NfrL7ehx">
  <DIV class="slide-notes" contenteditable="true" __wid="zsGkiPrn"></DIV>
</DIV></TEMPLATE></DIV></DIV><DIV class="paragraph code-paragraph locked collapsed" data-id="mh8ua8Lh" name="Slide Script Template" __wid="GBHidpAG"><PRE data-type="content" type="text/javascript" contenteditable="false" id="slide-script-template" __wid="qxCVYLBM">// Called on slide preload
exports.preload = (paragraph, slide) => {
  // Your code...
};

// Called on slide enter
exports.enter = (paragraph, slide) => {
  // Your code...
};

// Called on slide exit
exports.exit = (paragraph, slide) => {
  // Your code...
};</PRE></DIV><DIV class="paragraph style-paragraph locked collapsed" data-id="DMTZPYZk" name="Slide Style Template" __wid="k55CKP8N"><STYLE data-type="content" type="text/css" codemirror="true" id="slide-style-template" contenteditable="false" __wid="wusbWj8t">html #slide-id .slide-content {
  /* Your style... */
}</STYLE></DIV><DIV class="paragraph body-paragraph locked collapsed" data-id="D6kEDKbW" name="Heavy Slide Content Template" draggable="false" style __wid="7GngHuvP"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" __wid="8X4JuwwF"><!-- DO NOT CHANGE FORMATTING OF HTML  -->
<TEMPLATE id="heavy-slide-content-template" __wid="V96Ms4rv"><SLIDE-CONTENT __wid="Kjy4GbuM">
  <TEMPLATE event="preload" __wid="32UncXKk"></TEMPLATE>
  <TEMPLATE event="enter" __wid="9ew2rzrk"></TEMPLATE>
  <TEMPLATE event="exit" __wid="ZTUvpJwS"></TEMPLATE>
  <RENDER-TO __wid="LS3kzhJx"></RENDER-TO>
</SLIDE-CONTENT></TEMPLATE></DIV></DIV><DIV class="paragraph code-paragraph collapsed" data-id="PPReesUi" name="Presentation Code" style __wid="P2fw8yY2"><PRE data-type="content" type="text/javascript" id="presentation-code" __wid="mXAigbH8">const SlideScaling = require('#slide-scaling');

/******************************************************************************/

const presentationClass = "presentation";
const transientPresentationAttribute = "transient-presentation";

const preloadClass = "preload";
const transientPreloadAttribute = "transient-preload";

const wasContenteditableAttribute = "was-contenteditable";
const transientWasContenteditableAttribtue = "transient-was-contenteditable";

const slideNotesAttribute = "transient-slide-notes";

const slideSelector = '.section:not(.section-hidden):not(.collapsed) .paragraph:not(.collapsed) > .slide:not(.slide-hidden)';
const slideSelectorIncludingHidden = '.paragraph > .slide';

/******************************************************************************/

const getSlideParagraphs = () => {
  const slides = Array.from(document.querySelectorAll(slideSelector));
  return slides.map(slide => slide.closest(".paragraph"));
};

const setActiveSlide = (currentSlide, slideParagraphs, transient = false, step = 0) => {
  let index = slideParagraphs.indexOf(currentSlide);
  if (index === -1) {
    alert("Could not locate slide!");
    return;
  }

  // Only one slide at a time
  if (step > 0) {
    step = 1;
  } else if (step &lt; 0) {
    step = -1;
  }

  const newIndex = index + step;

  if (newIndex >= 0 && newIndex &lt; slideParagraphs.length) {
    if (transient) {
      slideParagraphs[index].removeAttribute(transientPresentationAttribute);
      slideParagraphs[newIndex].setAttribute(transientPresentationAttribute, "true");
      if (slideParagraphs[index + 1]) slideParagraphs[index + 1].removeAttribute(transientPreloadAttribute);
      if (slideParagraphs[newIndex + 1]) slideParagraphs[newIndex + 1].setAttribute(transientPreloadAttribute, "true");
    } else {
      const oldSlideContent = slideParagraphs[index].querySelector('.slide-content');
      if (oldSlideContent) oldSlideContent.setAttribute("contenteditable", "true");

      const newSlideContent = slideParagraphs[newIndex].querySelector('.slide-content');
      if (newSlideContent) newSlideContent.setAttribute("contenteditable", "false");

      slideParagraphs[index].classList.remove(presentationClass);
      slideParagraphs[newIndex].classList.add(presentationClass);
      if (slideParagraphs[index + 1]) slideParagraphs[index + 1].classList.remove(preloadClass);
      if (slideParagraphs[newIndex + 1]) slideParagraphs[newIndex + 1].classList.add(preloadClass);
    }
  }
};

exports.updateSlideNumbers = (slideParagraphs = getSlideParagraphs()) => {
  const slides = slideParagraphs.map(slideParagraph => slideParagraph.querySelector('[data-type="content"]'));

  let slideNumber = 0;

  slides.forEach(slide => {
    const slideContent = slide.querySelector('.slide-content');
    if (!slideContent) return;

    if (slide.classList.contains("skip-slide-number")) {
      ++slideNumber;
      slideContent.removeAttribute("slide-number");
      return;
    }

    if (slide.classList.contains("ignore-slide-number")) {
      slideContent.removeAttribute("slide-number");
      return;
    }

    if (!slide.classList.contains("prev-slide-number")) {
      ++slideNumber;
    }

    slideContent.setAttribute("slide-number", slideNumber);
  });
};

exports.startPresentation = (transient = false, fromStart = false, paragraph = false) => {
  if (exports.presentationVisible(transient)) return;

  const slideParagraphs = getSlideParagraphs();
  exports.updateSlideNumbers(slideParagraphs);

  // Find first slide
  let firstSlide;

  if (!fromStart && paragraph) {
    firstSlide = paragraph;
  } else if (!fromStart && Codestrate.focussedParagraph && Codestrate.focussedParagraph.querySelector('.slide')) {
    firstSlide = Codestrate.focussedParagraph;
  } else if (slideParagraphs && slideParagraphs.length > 0) {
    firstSlide = slideParagraphs[0];
  }

  if (!firstSlide) {
    alert("There are no slides in this codestrate!", "No Slides");
    return;
  }

  setActiveSlide(firstSlide, slideParagraphs, transient);

  if (transient) {
    //firstSlide.setAttribute(transientPresentationAttribute, "true");
    document.body.setAttribute(transientPresentationAttribute, "true");
    toast("Transient presentation started", 1500);
  } else {
    //firstSlide.classList.add(presentationClass);
    document.body.classList.add(presentationClass);
    toast("Presentation started", 1500);
  }
};

exports.exitPresentation = (transient = false) => {
  if (!exports.presentationVisible(transient)) return;

  const slideParagraphs = getSlideParagraphs();

  const currentSlide = exports.currentSlide(transient);

  let index = slideParagraphs.indexOf(currentSlide);

  if (transient) {
    if (currentSlide) currentSlide.removeAttribute(transientPresentationAttribute);
    if (slideParagraphs[index + 1]) slideParagraphs[index + 1].removeAttribute(transientPreloadAttribute);
    document.body.removeAttribute(transientPresentationAttribute);
    toast("Transient presentation exited", 1500);
  } else {
    if (currentSlide) {
      const slideContent = currentSlide.querySelector('.slide-content');
      if (slideContent) slideContent.setAttribute("contenteditable", "true");
      currentSlide.classList.remove(presentationClass);
    }
    if (slideParagraphs[index + 1]) slideParagraphs[index + 1].classList.remove(preloadClass);
    document.body.classList.remove(presentationClass);
    toast("Presentation exited", 1500);
  }
  SlideScaling.updateScale();
};

exports.presentationVisible = (transient = false) => {
  if (transient) {
    return document.body.hasAttribute(transientPresentationAttribute);
  } else {
    return document.body.classList.contains(presentationClass);
  }
};

exports.togglePresentation = (transient) => {
  if (exports.presentationVisible(transient)) {
    exports.exitPresentation(transient);
  } else {
    exports.startPresentation(transient);
  }
};

/******************************************************************************/

exports.currentSlide = (transient = false) => {
  if (transient) {
    return document.querySelector(`.paragraph[${transientPresentationAttribute}="true"]`);
  } else {
    return document.querySelector(`.paragraph.${presentationClass}`);
  }
};

const changeSlide = (step) => {
  const visible = exports.presentationVisible();
  const transient = exports.presentationVisible(true);
  const isFocusOnSlideNotes = !!document.activeElement.closest('.slide-notes');
  
  if ((!visible && !transient) || isFocusOnSlideNotes) return;

  const currentSlide = exports.currentSlide(transient);
  if (!currentSlide) {
    alert("No current slide!");
    return;
  }

  const slideParagraphs = getSlideParagraphs();
  if (!slideParagraphs || slideParagraphs.length === 0) {
    alert("No slides available!");
    return;
  }

  setActiveSlide(currentSlide, slideParagraphs, transient, step);
};

exports.previousSlide = () => {
  changeSlide(-1);
};

exports.nextSlide = () => {
  changeSlide(1);
};

/******************************************************************************/

exports.showNotes = () => {
  document.body.setAttribute(slideNotesAttribute, "true");
};

exports.hideNotes = () => {
  document.body.removeAttribute(slideNotesAttribute);
};

exports.notesVisible = () => {
  return document.body.hasAttribute(slideNotesAttribute);
};

exports.toggleNotes = () => {
  if (exports.notesVisible()) {
    exports.hideNotes();
  } else {
    exports.showNotes();
  }
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="dJSYnMBT" last-execution-state="success" name="
Slide Scaling" style draggable="false" run-on-load="true" __wid="65KwhTgt"><PRE data-type="content" type="text/javascript" id="slide-scaling" __wid="UVxrV9TE">const presentationStyleClass = "presentation-style";

/******************************************************************************/

const updateStyle = (scale, presentationScale, presentationScale43, presentationScale1610, presentationScale11, width) => {
  let style = document.head.querySelector(`.${presentationStyleClass} style`);

  if (!style) {
    const transient = document.createElement("transient");
    transient.setAttribute("class", presentationStyleClass);
    style = document.createElement("style");
    transient.appendChild(style);
    document.head.appendChild(transient);
  }

  style.innerHTML = `
.slide[slide-aspect-ratio="16:9"] .slide-container {
  width: ${width * scale}px !important;
  height: ${width * 0.5625 * scale}px !important;
}

.slide[slide-aspect-ratio="4:3"] .slide-container {
  width: ${width * scale}px !important;
  height: ${width * 0.75 * scale}px !important;
}

.slide[slide-aspect-ratio="16:10"] .slide-container {
  width: ${width * scale}px !important;
  height: ${width * 0.625 * scale}px !important;
}

.slide[slide-aspect-ratio="1:1"] .slide-container {
  width: ${width * scale}px !important;
  height: ${width * scale}px !important;
}

.slide .slide-content {
  transform: scale(${scale}) !important;
  transform-origin: 0 0 0 !important;
}

body.presentation:not([transient-presentation="true"]) .paragraph.presentation .slide[slide-aspect-ratio="16:9"] .slide-content,
body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .slide[slide-aspect-ratio="16:9"] .slide-content {
  transform: translate(-50%, -50%) scale(${presentationScale}) !important;
  transform-origin: center !important;
}

body.presentation:not([transient-presentation="true"]) .paragraph.presentation .slide[slide-aspect-ratio="4:3"] .slide-content,
body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .slide[slide-aspect-ratio="4:3"] .slide-content {
  transform: translate(-50%, -50%) scale(${presentationScale43}) !important;
  transform-origin: center !important;
}

body.presentation:not([transient-presentation="true"]) .paragraph.presentation .slide[slide-aspect-ratio="16:10"] .slide-content,
body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .slide[slide-aspect-ratio="16:10"] .slide-content {
  transform: translate(-50%, -50%) scale(${presentationScale1610}) !important;
  transform-origin: center !important;
}

body.presentation:not([transient-presentation="true"]) .paragraph.presentation .slide[slide-aspect-ratio="1:1"] .slide-content,
body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .slide[slide-aspect-ratio="1:1"] .slide-content {
  transform: translate(-50%, -50%) scale(${presentationScale11}) !important;
  transform-origin: center !important;
}
`;
};

exports.updateScale = () => {
  const slide = document.querySelector(".section:not(.section-hidden):not(.collapsed) .paragraph:not(.collapsed) .slide");
  const slideContent = slide ? slide.querySelector(".slide-content") : false;
  const paragraph = slide ? slide.closest(".paragraph") : false;

  if (!slideContent || !paragraph) return;

  const width = slideContent.offsetWidth;

  // Scale for paragraph view
  const scale = Math.min(
    paragraph.offsetWidth / width
  );

  // Scales for presentation view
  const presentationScale = Math.min(
    window.innerWidth / width,
    window.innerHeight / (width * 0.5625)
  );
  const presentationScale43 = Math.min(
    window.innerWidth / width,
    window.innerHeight / (width * 0.75)
  );
  const presentationScale1610 = Math.min(
    window.innerWidth / width,
    window.innerHeight / (width * 0.625)
  );
  const presentationScale11 = Math.min(
    window.innerWidth / width,
    window.innerHeight / width
  );

  updateStyle(scale, presentationScale, presentationScale43, presentationScale1610, presentationScale11, width);
};

/******************************************************************************/

let counter = 0;
let resizeTimer;
window.addEventListener("resize", (event) => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    exports.updateScale();
  }, 250);
});

document.body.liveAttribute("transient-menu-pinned").changed((value, oldValue) => {
  // Wait for animation
  document.body.addEventListener("transitionend", function pinnedTransition(event) {
    if (event.propertyName === "margin-left") {
      document.body.removeEventListener("transitionend", pinnedTransition);
      exports.updateScale();
    }
  });
});

document.body.liveQuerySelectorAll('.paragraph .slide').added((slide) => {
  if (document.body.querySelectorAll('.paragraph .slide').length === 1) {
    exports.updateScale();
  }
});

exports.updateScale();</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="qaCgfY8m" name="Presentation Key Map" style __wid="auBRGKhH"><PRE data-type="content" type="text/javascript" id="presentation-key-map" __wid="us94VZsR">const PresentationCode = require("#presentation-code");

/******************************************************************************/

exports.mappings = [{
  keys: ["mod+enter", "f5"],
  preventDefault: true,
  id: "presentations.togglePresentation",
  name: "Toggle Presentation",
  action(event) {
    PresentationCode.togglePresentation();
    return false;
  }
}, {
  keys: "esc",
  preventDefault: true,
  id: "presentations.exitPresentation",
  name: "Exit Presentation",
  action(event) {
    PresentationCode.exitPresentation();
    return false;
  }
}, {
  keys: ["mod+alt+enter", "alt+f5"],
  preventDefault: true,
  id: "presentations.toggleTransientPresentation",
  name: "Toggle Transient Presentation",
  action(event) {
    PresentationCode.togglePresentation(true);
    return false;
  }
}, {
  keys: "alt+esc",
  preventDefault: true,
  id: "presentations.exitTransientPresentation",
  name: "Exit Transient Presentation",
  action(event) {
    PresentationCode.exitPresentation(true);
    return false;
  }
}, {
  keys: ["left", "pageup"],
  preventDefault: false,
  id: "presentations.previousSlide",
  name: "Previous Slide",
  action(event) {
    PresentationCode.previousSlide();
  }
}, {
  keys: ["right", "pagedown"],
  preventDefault: false,
  id: "presentations.nextSlide",
  name: "Next Slide",
  action(event) {
    PresentationCode.nextSlide();
  }
}, {
  keys: ["mod+k"],
  id: "presentations.toggleNotes",
  name: "Toggle Presentation Notes",
  action(event) {
    PresentationCode.toggleNotes();
    return false;
  }
}];</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="pZbLtiu8" run-on-load="true" name="Gestures to control slideshow" draggable="false" style last-execution-state="success" __wid="TVpiKMaA"><PRE data-type="content" type="text/javascript" __wid="6rRCvALK">importLib([
  "hammer.min.js",
  "hammer-time.min.js"
]).then(() => {

  const PresentationCode = require("#presentation-code");

  var mc = new Hammer.Manager(window);

  mc.add(new Hammer.Swipe({
    direction: Hammer.DIRECTION_ALL,
  }));

  const handleSwipe = (event) => {

    switch (event.type) {
    case "swipeleft":
      PresentationCode.nextSlide();
      break;
    case "swiperight":
      PresentationCode.previousSlide();
      break;
    case "swipeup":
      break;
    case "swipedown":
      break;
    }
  };

  mc.on("swipeleft", handleSwipe);
  mc.on("swiperight", handleSwipe);
  mc.on("swipeup", handleSwipe);
  mc.on("swipedown", handleSwipe);
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="v7j7cbL4" name="Presentation Commands and KeyBindings" run-on-load="true" last-execution-state="success" __wid="TGNVm8at"><PRE data-type="content" type="text/javascript" __wid="pN75XDFU">const PresentationKeyMap = require("#presentation-key-map");

/******************************************************************************/

PresentationKeyMap.mappings.forEach((mapping) => {
  Codestrate.addCommand(mapping.id, mapping.name, () => mapping.action());
  Codestrate.addKeyBinding(mapping.id, mapping.keys, mapping.prevendDefault);
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="sC9VJnBL" name="Presentation Heavy Content" style run-on-load="true" last-execution-state="success" __wid="PKSy8A3f"><PRE data-type="content" type="text/javascript" __wid="vNCHcmf5">const PresentationKeyMap = require("#presentation-key-map");

/******************************************************************************/

importLib([
	"mousetrap.min.js",
	"mousetrap-global-bind.min.js"
]).then(() => {

	/**
	 * Inject navigation keys into iframe elements to allow advancing slides even
	 * though the focus might be on the iframe"s window.
	 */
	const injectNavigationKeyEvents = (element) => {
		let iframes = element.querySelectorAll("iframe");
		Array.prototype.forEach.call(iframes, (iframe) => {
			iframe.webstrate.on("transcluded", () => {
				PresentationKeyMap.mappings.forEach((mapping) => {

					// Prefix each key with shift, e.g., right will be shift+right
					let keys = mapping.keys;
					if (typeof keys === "string") {
						keys = `shift+${keys}`;
					} else {
						keys = keys.map((key) => `shift+${key}`);
					}

					Mousetrap(iframe.contentDocument).bindGlobal(keys, mapping.action);
				});
			});
		});
	};

	const onChange = (eventType, transcludes) => {
		Array.prototype.forEach.call(transcludes, (slideContent) => {

			// Remove previous template
			let renderTo = slideContent.querySelector("render-to");

			// Check if "render-to" element exists
			if (!renderTo) {
				console.warn(`slide-content requires a render-to element`, slideContent);
				return;
			}

			let template = slideContent.querySelector(`template[event="${eventType}"]`);
			if (template) {
				renderTo.innerHTML = "";

				let element = document.importNode(template.content, true);
				injectNavigationKeyEvents(element);
				
				// append element to transient because events will be triggered on every client, which can
				// cause an element to be added multiple times instead of just once
				let transient = document.createElement("transient");
				transient.appendChild(element);
				
				renderTo.appendChild(transient);
			} else if (eventType === "exit") {
				renderTo.innerHTML = "";
			}
		});
	};

/******************************************************************************/

	let connections;

	const connectSlidesAndSlideScripts = () => {

		const slides = document.querySelectorAll(".slide");

		// Add live attribute to run script when slide is presented
		connections = Array.prototype.map.call(slides, (slide) => {

			const transcludes = slide.querySelectorAll("slide-content");
			const id = slide.getAttribute("id");
			const scriptId = `${id}-script`;
			
			const skipTranscludes = !transcludes.length;
			const skipScripts = !document.querySelector(`#${scriptId}`);

			if (skipTranscludes && skipScripts) {
				return undefined;
			}

			let paragraph = slide.closest(".paragraph");
			let classAttribute = paragraph.liveAttribute("class");
			classAttribute.changed((value, oldValue) => {

				let script = false;
				if (!skipScripts) {
					script = require(`#${scriptId}`, null, false);
				}

				if (!paragraph.classList.contains("preload") &&
						!paragraph.classList.contains("presentation")) {

					// Exit event
					if (!skipTranscludes) onChange("exit", transcludes);
					if (!skipScripts && typeof script.exit === "function") script.exit(paragraph, slide);

				} else {

					// Give current slide some time to load before preload kicks-in
					setTimeout(() => {
						if (paragraph.classList.contains("preload") &&
								(!oldValue || oldValue.indexOf("preload") &lt; 0)) {

							// Preload event
							if (!skipTranscludes) onChange("preload", transcludes);
							if (!skipScripts && typeof script.preload === "function") script.preload(paragraph, slide);

						}
					}, 2000);

					// Postpone slide enter for next slide to next macro task to allow
					// previous slide to exit before.
					setTimeout(() => {
						if (paragraph.classList.contains("presentation") &&
								(!oldValue || oldValue.indexOf("presentation") &lt; 0)) {

							// Enter event
							if (!skipTranscludes) onChange("enter", transcludes);
							if (!skipScripts && typeof script.enter === "function") script.enter(paragraph, slide);

						}
					}, 0);
				}
			});

			return {
				disconnect() {
					classAttribute.stop();
				}
			};
		}).filter((slide) => !!slide);
	};

	const disconnectSlidesAndSlideScripts = () => {
		if (connections) {

			// Allow running "exit" mechanism before disconnecting
			setTimeout(() => {
				connections.forEach((connection) => connection.disconnect());
				connections.length = 0;
			}, 0);
		}
	};

/******************************************************************************/

	document.body.liveAttribute("class").changed((value, oldValue) => {
		if (document.body.classList.contains("presentation")) {
			connectSlidesAndSlideScripts();
		} else {
			disconnectSlidesAndSlideScripts();
		}
	});

	// Heavy content in transient presentation not supported for now
	/*document.body.liveAttribute("transient-presentation").changed((value, oldValue) => {
		if (value === "true") {
			connectSlidesAndSlideScripts(true);
		} else {
			disconnectSlidesAndSlideScripts(true);
		}
	});*/

/******************************************************************************/

	// TODO: Remove probably
	/*let slideSelector = document.body.liveQuerySelectorAll(".slide");
	slideSelector.added((slide) => {
		let paragraph = slide.closest(".paragraph");
		let classAttribute = slide.liveAttribute("class");
		slide.__slideClassAttribute = classAttribute;

		classAttribute.changed(() => {

			// ignore attribute change in presentation mode
			if (paragraph.classList.contains("presentation")) {
				return;
			}

			const transcludes = slide.querySelectorAll("slide-content");
			if (paragraph.classList.contains("enter")) {
				onChange("enter", transcludes);
			} else {
				onChange("exit", transcludes);
			}
		});
	});

	slideSelector.removed((slide) => {
		if (slide.__slideClassAttribute) {
			slide.__slideClassAttribute.stop();
			delete slide.__slideClassAttribute;
		}
	});*/
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="JftnGh9G" name="Presentation Toolbar and Snackbar Entries" run-on-load="true" last-execution-state="success" draggable="false" style __wid="J5iXy99g"><PRE data-type="content" type="text/javascript" __wid="CJNAU2cr">const GlobalToolbarUtils = require("#global-toolbar-utils");
const SnackbarUtils = require("#snackbar-utils");
const SnackbarTools = require("#snackbar-tools");
const ParagraphUtils = require("#paragraph-utils");
const PresentationCode = require("#presentation-code");

/******************************************************************************/

const packageClass = "presentation-package";
const slideClass = "slide";
const slideToolsClass = "slide-tools";

/******************************************************************************/

const getSlideFragment = () => {
  const slideTemplate = document.querySelector('#slide-template');
  return document.importNode(slideTemplate.content, true);
};

// bind contenteditable of content to slide-content to make the lock paragraph
// also work in slide mode
const slideContentLiveSelector = document.liveQuerySelectorAll('.slide-content');
slideContentLiveSelector.added((slideContent) => {
  const content = slideContent.closest('[data-type="content"]');
  if (content) {
    const liveAttribute = content.liveAttribute("contenteditable");
    liveAttribute.changed((value) => {
      slideContent.setAttribute("contenteditable", value);
    });
    slideContent.__contentContenteditable = liveAttribute;
  }
});
slideContentLiveSelector.removed((slideContent) => {
  if (slideContent.__contentContenteditable) {
    slideContent.__contentContenteditable.stop();
    delete slideContent.__contentContenteditable;
  }
});

/******************************************************************************/

Codestrate.addCommand("presentations.addSlide", "Add Slide", () => {
  const paragraph = ParagraphUtils.createBodyParagraph();
  const content = paragraph.querySelector('[data-type="content"]');
  content.classList.add("slide");

  // create slide from template and add it to content
  const slideFragment = getSlideFragment();
  content.appendChild(slideFragment);

  ParagraphUtils.insertParagraphAfterFocussed(paragraph);
  PresentationCode.updateSlideNumbers();
});

GlobalToolbarUtils.addDivider(1, packageClass);
GlobalToolbarUtils.addButton("Add Slide", "", "slide-button " + packageClass, 1, () => {
  Codestrate.executeCommand("presentations.addSlide");
});

GlobalToolbarUtils.addButton("Start Presentation", "", "presentation-button " + packageClass, 1, () => {
  Codestrate.executeCommand("presentations.togglePresentation");
  //PresentationCode.startPresentation(false, true);
});

/******************************************************************************/

SnackbarTools.addTools((target) => {
  return (Codestrate.focussedParagraph &&
    Codestrate.focussedParagraph.querySelector("[data-type='content']").classList.contains(slideClass));
}, slideToolsClass);

SnackbarUtils.addDivider(1, "body-tools " + packageClass);

const moveContentAndClasses = (from, to) => {

  // copy slide content back to regular paragraph
  Array.from(from.childNodes).forEach((child) => to.appendChild(child));

  // Move CSS class back to content
  // Array.from is required to create a copy of classList items!!!
  Array.from(from.classList).forEach((className) => {
    if (className.startsWith("slide-")) return;

    to.classList.add(className);
    from.classList.remove(className);
  });
};

const upgradeToSlide = (content) => {
  const slideFragment = getSlideFragment();
  const slideContent = slideFragment.querySelector('.slide-content');

  // append all childNodes from content to slide content
  moveContentAndClasses(content, slideContent);

  // append slide fragment to content
  content.appendChild(slideFragment);
  content.classList.add(slideClass);
};

const downgradeFromSlide = (content) => {
  const oldClassList = content.getAttribute("class");
  const slideContainer = content.querySelector(".slide-container");
  const slideContent = slideContainer.querySelector(".slide-content");
  const slideNotesContainer = content.querySelector(".slide-notes-container");
  const slideNotes = slideNotesContainer.querySelector(".slide-notes");

  // remove slide container
  if (slideContainer) {
    slideContainer.remove();
  }

  // remove slide notes container
  if (slideNotesContainer) {
    slideNotesContainer.remove();
  }

  if (slideContent) {
    // copy slide content back to regular paragraph
    moveContentAndClasses(slideContent, content);

    // Variant: Keep slideContent div
    // content.insertBefore(slideContent, slideContainer);
    // slideContent.removeAttribute("contenteditable");
  }

  if (slideNotes) {
    // Variant: Keep slideNotes div
    // content.insertBefore(slideNotes, slideContainer);
    // slideNotes.removeAttribute("contenteditable");
  }

  content.classList.remove(slideClass);
};

const toggleSlide = (paragraph) => {
  const content = paragraph.querySelector('[data-type="content"]');

  const oldContentChildNodes = Array.from(content.childNodes);
  const oldClassList = content.getAttribute("class");

  // upgrade and downgrade content to and from slide
  if (!content.classList.contains(slideClass)) {
    upgradeToSlide(content);
  } else {
    downgradeFromSlide(content);
  }

  PresentationCode.updateSlideNumbers();
};

SnackbarUtils.addButton("Toggle Slide", "", "body-tools slide-button " + packageClass, 1, () => {
  const paragraph = Codestrate.focussedParagraph;
  if (!paragraph) return;

  toggleSlide(paragraph);

  toast(`Toggled slide "${paragraph.getAttribute("name") || "No Name"}"`, 5000, () => {
    toggleSlide(paragraph);
  }, "Undo");
});

/******************************************************************************/

const getParagraphAndId = async() => {
  return new Promise(async(resolve, reject) => {
    const paragraph = Codestrate.focussedParagraph;
    if (!paragraph) return resolve(false);

    const content = paragraph.querySelector("[data-type='content']");
    let id = content.getAttribute("id");

    if (!id) {
      const result = await prompt("To add a slide script the slide needs an ID. Enter ID (or leave blank to generate one).", "", "Missing Slide ID");
      if (result === false) {
        return resolve(false);
      } else if (result === "") {
        id = "slide-" + Codestrate.util.randomString();
      } else {
        id = result;
      }
      content.setAttribute("id", id);
    }

    resolve({
      paragraph: paragraph,
      id: id
    });
  });
};

SnackbarUtils.addButton("Add Slide Script", "", slideToolsClass + " slide-script-button " + packageClass, 1, async() => {
  const data = await getParagraphAndId();
  if (!data) return;

  const paragraph = data.paragraph;
  const id = data.id;

  if (document.querySelector(`#${id}-script`)) {
    alert("Slide script already exists!", "Script Exists");
    return;
  }

  const scriptParagraph = ParagraphUtils.createCodeParagraph();
  if (paragraph.hasAttribute("name")) scriptParagraph.setAttribute("name", `${paragraph.getAttribute("name")} Script`);
  const scriptContent = scriptParagraph.querySelector("[data-type='content']");
  scriptContent.classList.add("slide-script");
  scriptContent.setAttribute("id", `${id}-script`);

  const scriptTemplate = document.querySelector("#slide-script-template");
  if (scriptTemplate) scriptContent.innerHTML = scriptTemplate.innerHTML;

  paragraph.closest(".section").insertBefore(scriptParagraph, paragraph.nextSibling);
});

SnackbarUtils.addButton("Add Slide Style", "", slideToolsClass + " slide-style-button " + packageClass, 1, async() => {
  const data = await getParagraphAndId();
  if (!data) return;

  const paragraph = data.paragraph;
  const id = data.id;

  if (document.querySelector(`#${id}-style`)) {
    alert("Slide style already exists!", "Style Exists");
    return;
  }

  const styleParagraph = ParagraphUtils.createStyleParagraph();
  if (paragraph.hasAttribute("name")) styleParagraph.setAttribute("name", `${paragraph.getAttribute("name")} Style`);
  const styleContent = styleParagraph.querySelector("[data-type='content']");
  styleContent.classList.add("slide-style");
  styleContent.setAttribute("id", `${id}-style`);

  const styleTemplate = document.querySelector("#slide-style-template");
  if (styleTemplate) styleContent.innerHTML = styleTemplate.innerHTML.replace("slide-id", id);

  paragraph.closest(".section").insertBefore(styleParagraph, paragraph.nextSibling);
});

/*SnackbarUtils.addButton("Start Presentation", "", slideToolsClass + " presentation-button " + packageClass, 1, () => {
  PresentationCode.startPresentation();
});*/

// add heavy content "template" at cursor position in HTML inspector
SnackbarUtils.addButton("Add Heavy Content", "", slideToolsClass + " add-heavy-content-button " + packageClass, 1, () => {
  let content = document.querySelector('[transient-content-paragraph="true"] [data-type="content"]');
  if (content.__editor) {
    let template = document.querySelector('#heavy-slide-content-template');
    let fragment = document.importNode(template.content, true);

    let editor = content.__editor.editor;
    let doc = editor.getDoc();
    let cursor = doc.getCursor();
    doc.replaceRange(fragment.firstElementChild.outerHTML, cursor);
  }
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="khjUmJzS" name="Presentation Style" style __wid="eaQ3YdxE"><STYLE data-type="content" type="text/css" codemirror="true" class="themable persistent" __wid="KiEJreMR">html body.presentation:not([transient-presentation="true"]),
html body[transient-presentation="true"]:not(.presentation) {
  overflow: hidden;
}

html body.presentation:not([transient-presentation="true"]) #sections,
html body[transient-presentation="true"]:not(.presentation) #sections {
  overflow: unset;
}

html body.presentation:not([transient-presentation="true"]) .paragraph.presentation,
html body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] {
  display: block;
  position: fixed;
  padding: 0;
  margin: 0;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 250;
  user-select: none;
  -webkit-user-select: none;
  /* Webkit requires -webkit prefix */
  cursor: url(presentation_pointer.png) 12 12, default;
  background: var(--material-color-black);
}

/*html body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] #global-toolbar,*/

html body.presentation[transient-presentation="true"]:after {
  content: "\f429";
  font-family: "Material Design Icons";
  text-align: center;
  font-size: 24px;
  line-height: 48px;
  bottom: 16px;
  left: 16px;
  position: fixed;
  height: 48px;
  width: 48px;
  z-index: 100;
  background: var(--material-color-red);
  color: var(--material-color-black);
  border-radius: 50%;
  box-shadow: var(--material-shadow-z2);
}

/******************************************************************************/

html body.presentation:not([transient-presentation="true"]) .paragraph.presentation .html-editor,
html body.presentation:not([transient-presentation="true"]) .paragraph.presentation .paragraph-header,
html body.presentation:not([transient-presentation="true"]) .paragraph.presentation .text-tools,
html body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .html-editor,
html body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .paragraph-header,
html body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .text-tools {
  display: none;
}

html body.presentation:not([transient-presentation="true"]) .paragraph.presentation .CodeMirror,
html body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .CodeMirror {
  overflow: auto;
  height: 100vh;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="rubFRTHQ" name="Blank Slide Style (Template Base)" __wid="4kmVsHS8"><STYLE data-type="content" type="text/css" codemirror="true" __wid="G8zfrpBY">html .paragraph .slide[data-type="content"],
html .paragraph .slide .slide-content {
  margin: 0;
  padding: 0;
  overflow: hidden;
}

html .paragraph .slide.slide-hidden {
  outline: 0.25rem solid var(--material-color-orange);
}

/******************************************************************************/

html .slide .slide-content {
  background-color: var(--material-color-white);
  color: var(--material-color-black);
}

html body.presentation:not([transient-presentation="true"]) .paragraph.presentation .slide .slide-content,
html body[transient-presentation="true"]:not(.presentation) .paragraph[transient-presentation="true"] .slide .slide-content {
  position: fixed;
  top: 50%;
  left: 50%;
}

/******************************************************************************/

html .slide .slide-content {
  transform: scale(0.5);
  transform-origin: 0 0 0;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="74dTWDaZ" name="Default Slide Template" __wid="sYF2ekVK"><STYLE data-type="content" type="text/css" codemirror="true" __wid="ubeawsE8">html .slide[slide-template="default"] .slide-content {
  font-family: "Roboto", "Avenir", sans-serif;
  font-weight: 400;
  font-size: 48px;
  display: flex;
  flex-direction: column;
}

html .slide[slide-template="default"] .slide-content ul,
html .slide[slide-template="default"] .slide-content ol {
  margin-left: 1rem;
}

html .slide[slide-template="default"]:not(.skip-slide-number) .slide-content[slide-number]:after {
  content: attr(slide-number);
  position: absolute;
  top: 16px;
  right: 16px;
  padding: 8px 16px;
  background-color: rgba(var(--material-color-white-rgb), 0.5);
  border-radius: 2px;
  font-size: 24px;
  z-index: 299;
  pointer-events: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="XFYfghGw" name="Slide Aspect Ratios" __wid="KH65VWuB"><STYLE data-type="content" type="text/css" codemirror="true" class="themable persistent" __wid="UqhEmyyY">html .slide[slide-aspect-ratio="16:9"] .slide-content {
  width: 1920px;
  height: 1080px;
}

html .slide[slide-aspect-ratio="4:3"] .slide-content {
  width: 1920px;
  height: 1440px;
}

html .slide[slide-aspect-ratio="16:10"] .slide-content {
  width: 1920px;
  height: 1200px;
}

html .slide[slide-aspect-ratio="1:1"] .slide-content {
  width: 1920px;
  height: 1920px;
}

/******************************************************************************/

/* Fallback scaling if only persistent parts are left */

html .slide[slide-aspect-ratio="16:9"] .slide-container {
  width: 960px;
  height: 540px;
}

html .slide[slide-aspect-ratio="4:3"] .slide-container {
  width: 960px;
  height: 720px;
}

html .slide[slide-aspect-ratio="16:10"] .slide-container {
  width: 960px;
  height: 600px;
}

html .slide[slide-aspect-ratio="1:1"] .slide-container {
  width: 960px;
  height: 960px;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="cxhUgB5x" name="Slide Notes Style" style __wid="3HenyWHp"><STYLE data-type="content" type="text/css" codemirror="true" class="persistent" __wid="ShZsWmTh">html .slide .slide-notes {
	background: var(--material-color-black);
	color: var(--material-color-grey-100);
	padding: 8px;
  cursor: default;
}

html .slide .slide-notes:empty:before {
	content: "Slide notes...";
	opacity: 0.5;
	cursor: text;
}

/******************************************************************************/

html .slide .slide-notes ul,
html .slide .slide-notes ol {
	margin: 0;
}

html .slide .slide-notes li {
	margin-bottom: 4px;
}

html .slide .slide-notes li:last-child {
	margin-bottom: 0;
}

/******************************************************************************/

html body.presentation:not([transient-presentation="true"]) .slide .slide-notes,
html body[transient-presentation="true"]:not(.presentation) .slide .slide-notes {
	display: none;
}

html body.presentation[transient-slide-notes="true"]:not([transient-presentation="true"]) .paragraph.presentation .slide .slide-notes:not(:empty),
html body[transient-presentation="true"][transient-slide-notes="true"]:not(.presentation) .paragraph[transient-presentation="true"] .slide .slide-notes:not(:empty) {
	display: block;
	position: fixed;
	top: 16px;
	right: 16px;
	font-size: 2.5vmin;
	line-height: 2.5vmin;
	padding: 1vmin;
	border-radius: 2px;
	box-shadow: var(--material-shadow-z6);
	background: rgba(var(--material-color-black-rgb), 0.75);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="4zrNYvYJ" name="Presentation Toolbar and Snackbar Entries Style" style __wid="YkcGZXGb"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="S4vM8RLD">html #snackbar:not([slide-tools="true"]) .slide-tools {
	display: none;
}

html #global-toolbar .slide-button i:after,
html #snackbar .slide-button i:after {
	content: var(--file-presentation-box);
	font-family: "Material Design Icons";
}

html #global-toolbar .slide-script-button i:after,
html #snackbar .slide-script-button i:after {
	content: "code";
}

html #global-toolbar .slide-style-button i:after,
html #snackbar .slide-style-button i:after {
	content: "brush";
}

html #snackbar[slide-tools="true"][content-tools="true"] .add-heavy-content-button {
	display: block;
}

html #snackbar:not([content-tools]) .add-heavy-content-button {
	display: none;
}

html #snackbar .add-heavy-content-button i:after {
	content: var(--flash);
	font-family: "Material Design Icons";
}

html #global-toolbar .presentation-button i:after,
html #snackbar .presentation-button i:after {
	content: var(--presentation-play);
	font-family: "Material Design Icons";
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="e7nFciSa" name="Print Slide Style" style __wid="P36drsJA"><STYLE data-type="content" type="text/css" codemirror="true" class="persistent" __wid="hZAdN59m">@media print {

	/* A4 Landscape*/
	@page {
		margin: 0;
	}

	html,
	body,
	#sections {
		padding: 0 !important;
		margin: 0 !important;
		background-color: transparent !important;
	}

	body > :not(#sections) {
		display: none;
	}

	#sections .section {
		margin: 0 !important;
		padding: 0 !important;

		position: absolute;
		top: 0;
		left: 0;

		min-width: 297mm;
		height: 209mm;
	}

	#sections .section .paragraph {
		page-break-before: avoid;
		page-break-inside: avoid;
		page-break-after: always;
	}

	#sections .section.collapsed,
	#sections .section.section-hidden,
	#sections .section > :not(.paragraph),
	#sections .section > .paragraph.collapsed,
	#sections .section > .paragraph > :not(.slide),
	#sections .section > .paragraph > .slide .slide-notes-container {
		display: none;
	}

	#sections .section > .paragraph > .slide,
	#sections .section > .paragraph > .slide .slide-container {
		width: 297mm !important;
		height: 209mm !important;
		margin: 0 !important;
		padding: 0 !important;
	}

	#sections .section > .paragraph > .slide .slide-content {
		position: relative !important;
		left: 50% !important;
		top: 50% !important;
		transform-origin: 50% 50% 0 !important;
		transform: translate3d(-50%, -50%, 0) scale(.586) !important;
	}

	#sections .section > .paragraph > .slide.slide-hidden {
		outline: none;
	}
	
	#sections .section > .paragraph > .slide table thead {
		display: table-row-group;
	}
}</STYLE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="UiFcUVAs" run-on-load="true" last-execution-state="success" name="Allow to mute videos with muted attribute" style __wid="mNM6MJYM"><PRE data-type="content" type="text/javascript" __wid="eGhyZSDF">const mutedVideoSelector = 'video[muted=""],video[muted="true"]';

const muteVideo = (video) => {
// 	window.console.log('mute video', video);
	video.muted = true;
};

// observe the document for added video elements with muted attribute set or
// muted attribute set to true
let observer = new MutationObserver((mutations) => {
	
	mutations.forEach((mutation) => {
		
		Array.prototype.forEach.call(mutation.addedNodes, (node) => {
			
			// only process element nodes
			if (node.nodeType !== Node.ELEMENT_NODE) return;
			
			if (node.matches(mutedVideoSelector)) {
				muteVideo(node);
			}
			
			const mutedVideos = node.querySelectorAll(mutedVideoSelector);
			Array.prototype.forEach.call(mutedVideos, muteVideo);
		});
	});
});

observer.observe(document.body, {
	childList: true,
	subtree: true
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="F9jz9VQS" name="Presentation Config" __wid="3S5EShjW"><PRE data-type="content" type="text/javascript" id="presentation-config" __wid="v5StfwF5">const ParagraphUtils = require('#paragraph-utils');

const slideTemplates = new Set();
slideTemplates.add("blank");
slideTemplates.add("default");

Object.defineProperty(exports, "slideTemplates", {
  get() {
    return Array.from(slideTemplates.values());
  }
});

exports.updateSlideTemplates = (paragraph) => {
  const header = ParagraphUtils.getHeaderElement(paragraph);
  const content = ParagraphUtils.getContentElement(paragraph);
  ParagraphUtils.addSelectElement(header, "slide-template", content, exports.slideTemplates);
};

const updateExistingSlideParagraphs = () => {
  const slides = document.querySelectorAll('.body-paragraph .slide');

  Array.prototype.forEach.call(slides, (slide) => {
    const paragraph = slide.closest('.paragraph');
    exports.updateSlideTemplates(paragraph);
  });
};

exports.addSlideTemplate = (name) => {
  slideTemplates.add(name);
  updateExistingSlideParagraphs();
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="9dUnaZsX" run-on-load="true" last-execution-state="success" name="Add selector for slide template" style __wid="8bLFE8An"><PRE data-type="content" type="text/javascript" __wid="LxiA9n9L">const ParagraphUtils = require('#paragraph-utils');
const PresentationConfig = require('#presentation-config');

const liveSelector = document.liveQuerySelectorAll('.body-paragraph');
liveSelector.added((paragraph) => {
  const header = ParagraphUtils.getHeaderElement(paragraph);
  const content = ParagraphUtils.getContentElement(paragraph);

  const liveAttribute = content.liveAttribute("class");
  liveAttribute.changed(() => {
    if (content.classList.contains("slide")) {
      
      // add default slide template
      if (!content.hasAttribute("slide-template")) {
        content.setAttribute("slide-template", "default");
      }
      
      PresentationConfig.updateSlideTemplates(paragraph);
    } else {
      const select = header.querySelector('select.slide-template-input');
      if (select) {
        select.remove();
      }
    }
  });
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="tzpxN7Zh" run-on-load="true" last-execution-state="success" name="Add selector for aspect ratio" draggable="false" style __wid="fPxv7bFS"><PRE data-type="content" type="text/javascript" __wid="vqxvDRvW">const ParagraphUtils = require('#paragraph-utils');

const aspectRatios = [
  "16:9",
  "4:3",
  "16:10",
  "1:1"
];

Codestrate.addEventListener("loaded", function onLoaded() {
  Codestrate.removeEventListener("loaded", onLoaded);

  const liveSelector = document.liveQuerySelectorAll('.body-paragraph');
  liveSelector.added((paragraph) => {
    const header = ParagraphUtils.getHeaderElement(paragraph);
    const content = ParagraphUtils.getContentElement(paragraph);

    const liveAttribute = content.liveAttribute("class");
    liveAttribute.changed(() => {
      if (content.classList.contains("slide")) {

        // add default aspect ratio
        if (!content.hasAttribute("slide-aspect-ratio")) {
          content.setAttribute("slide-aspect-ratio", "16:9");
        }

        ParagraphUtils.addSelectElement(header, "slide-aspect-ratio", content, aspectRatios);
      } else {
        const select = header.querySelector('select.slide-aspect-ratio-input');
        if (select) {
          select.remove();
        }
      }
    });
  });
});</PRE></DIV></DIV><DIV class="section section-hidden" data-id="3HvceM54" name="Basic Slide Template" data-type="package" __wid="CyA8CpZb"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="kn6Tbm29" __wid="jQ88k55X"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="ZewwDn2B"><H2 __wid="u9RruikQ">Description</H2><DIV __wid="VsgbHYnW">This package provides a basic slide template for the Presentations package.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="994z4E3V" __wid="UC62YMWE"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="v3byf7DF">{
  "version": "1.0.1",
  "icon": "style",
  "description": "This package provides a basic slide template for the Presentations package.",
  "tags": [
    "presentation",
    "template"
  ],
  "dependencies": [
    {
      "id": "qcWPfzfc",
      "name": "Presentations",
      "optional": false,
      "usage": "The basic slide template only works together with the Presentations package."
    }
  ],
  "changelog": {
    "1.0": "Initial version.",
    "1.0.1": "Fixed dependency."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/3HvceM54-Basic_Slide_Template"
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="biGZDKab" last-execution-state="success" run-on-load="true" name="Install basic slide template" draggable="false" style __wid="h7zQtvmr"><PRE data-type="content" type="text/javascript" __wid="k8wA3Ue7">const PresentationConfig = require('#presentation-config');
PresentationConfig.addSlideTemplate("basic");</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="Yv92JHFr" name="Basic Slide Style" style __wid="2BiurZcj"><STYLE data-type="content" type="text/css" codemirror="true" __wid="Zp3rycWG">html .paragraph .slide[slide-template="basic"][data-type="content"],
html .paragraph .slide[slide-template="basic"] .slide-content {
  margin: 0;
  padding: 0;
  overflow: hidden;
  font-family: "Roboto", "Avenir", sans-serif;
  font-weight: 400;
}

/******************************************************************************/

html .paragraph .slide[slide-template="basic"] .slide-content ul,
html .paragraph .slide[slide-template="basic"] .slide-content ol {
  margin-left: 1rem;
}

/******************************************************************************/

html .slide[slide-template="basic"] .slide-content {
  background: var(--material-color-white);
  color: var(--material-color-black);
  font-size: 48px;
  display: flex;
  flex-direction: column;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="zXb5uycG" name="Basic Components" style draggable="false" __wid="GPxhDRpA"><STYLE data-type="content" type="text/css" codemirror="true" class="themable persistent" __wid="Xjm4WYmm">/* Hack for a margin without increasing the size of the element */
html .slide[slide-template="basic"] .slide-content {
  box-sizing: border-box !important;
  border: 48px solid rgba(0, 0, 0, 0);
}

/******************************************************************************/

html .slide[slide-template="basic"] .slide-content .no-padding {
  padding: 0 !important;
}

html .slide[slide-template="basic"] .slide-content .no-margin {
  margin: 0 !important;
}

html .slide[slide-template="basic"] .slide-content .center,
html .slide[slide-template="basic"] .slide-content .middle,
html .slide[slide-template="basic"] .slide-content .left,
html .slide[slide-template="basic"] .slide-content .right,
html .slide[slide-template="basic"] .slide-content .top,
html .slide[slide-template="basic"] .slide-content .bottom {
  display: flex;
  flex-direction: column;
}

html .slide[slide-template="basic"] .slide-content .center {
  align-items: center;
}

html .slide[slide-template="basic"] .slide-content .left {
  align-items: flex-start;
}

html .slide[slide-template="basic"] .slide-content .right {
  align-items: flex-end;
}

html .slide[slide-template="basic"] .slide-content .middle {
  justify-content: center;
  height: 100%;
}

html .slide[slide-template="basic"] .slide-content .top {
  justify-content: flex-start;
  height: 100%;
}

html .slide[slide-template="basic"] .slide-content .bottom {
  justify-content: flex-end;
  height: 100%;
}

html .slide[slide-template="basic"] .slide-content .middle-self {
  justify-self: center;
}

/******************************************************************************/

html .slide[slide-template="basic"] .slide-content .split-h {
  display: flex;
  flex-direction: row;
  height: 100%;
}

html .slide[slide-template="basic"] .slide-content .split-v {
  display: flex;
  flex-direction: column;
  height: 100%;
}

html .slide[slide-template="basic"] .slide-content .split-h > *,
html .slide[slide-template="basic"] .slide-content .split-v > * {
  flex: 1 1 50%;
  margin: 0 !important;
}

html .slide[slide-template="basic"] .slide-content .split-h > * + * {
  margin-left: 32px !important;
}

html .slide[slide-template="basic"] .slide-content .split-v > * + * {
  margin-top: 32px !important;
}

/******************************************************************************/

html .slide[slide-template="basic"] .slide-content slide-content,
html .slide[slide-template="basic"] .slide-content render-to,
html .slide[slide-template="basic"] .slide-content render-to > transient,
html .slide[slide-template="basic"] .slide-content iframe {
  width: 100%;
  height: 100%;
}

/******************************************************************************/

html .slide[slide-template="basic"] .slide-content h1,
html .slide[slide-template="basic"] .slide-content h2,
html .slide[slide-template="basic"] .slide-content h3 {
  margin: 0;
}

/* Title */
html .slide[slide-template="basic"] .slide-content h1:first-of-type {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) translateY(-48px);
  width: 100%;
  text-align: center;
}

/* Slide Header */
html .slide[slide-template="basic"] .slide-content h2:first-of-type {
  margin-bottom: 96px;
}

/* Subtitle */
html .slide[slide-template="basic"] .slide-content h3:first-of-type {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) translateY(48px);
  width: 100%;
  text-align: center;
}

html .slide[slide-template="basic"] .slide-content a {
  color: orange !important;
}

html .slide[slide-template="basic"] .slide-content .keyword {
  position: absolute;
  left: 10%;
  top: 40%;
  font-size: 1.2em;
  font-weight: bold;
}

html .slide[slide-template="basic"] .slide-content .slogan {
  position: absolute;
  top: 40%;
  left: 10%;
  width: 80%;
  margin-top: 120px;
  margin-left: 20px;
  font-size: .8em;
}

html .slide[slide-template="basic"] .slide-content ul.items {
  list-style: none;
  font-size: .7em;
  width: 90% !important;
}

html .slide[slide-template="basic"] .slide-content ul.items li {
  padding-bottom: 55px;
}

html .slide[slide-template="basic"] .slide-content .highlight {
  font-weight: bold;
}

html .slide[slide-template="basic"] .slide-content .image-footer {
  display: block;
  text-align: center;
  font-size: .4em;
  width: 100%;
}

html .slide[slide-template="basic"] .slide-content .fill {
  width: 100%;
  height: 100%;
}

html .slide[slide-template="basic"] .slide-content .fill-horizontal {
  width: 100%;
  height: auto;
}

html .slide[slide-template="basic"] .slide-content .fill-vertical {
  width: auto;
  height: 100%;
}

html .slide[slide-template="basic"] .slide-content .center-with-title {
  position: absolute;
  top: 60%;
  left: 50%;
  transform: translate3d(-50%, -50%, 0);
  width: auto;
  height: 70%;
}

html .slide[slide-template="basic"] .slide-content .center {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
}

html .slide[slide-template="basic"] .slide-content .slide-title {
  position: absolute;
  top: 80px;
  left: 10px;
  padding: 10px;
  background-color: rgba(255, 255, 255, .75);
  border-radius: 2px;
  z-index: 2;
}

html .slide[slide-template="basic"] .slide-content .slide-title.right {
  display: inline-block;
  left: 82%;
}

html .slide[slide-template="basic"] .slide-content .slide-title-focus {
  font-size: .6em;
}

html .slide[slide-template="basic"] .slide-content .full-publication {
  position: absolute;
  font-size: .6em;
  top: 60%;
  left: 50%;
  width: 80%;
  transform: translate3d(-50%, -50%, 0);
}

html .slide[slide-template="basic"] .slide-content .left-box,
html .slide[slide-template="basic"] .slide-content .right-box {
  width: 45%;
  float: left;
  position: absolute;
  top: 50%;
}

html .slide[slide-template="basic"] .slide-content .left-box {
  left: 25%;
  transform: translate3d(-50%, -50%, 0);
}

html .slide[slide-template="basic"] .slide-content .right-box {
  left: 75%;
  transform: translate3d(-50%, -50%, 0);
}

html .slide[slide-template="basic"] .slide-content .topleft-box,
html .slide[slide-template="basic"] .slide-content .topright-box,
html .slide[slide-template="basic"] .slide-content .bottomleft-box,
html .slide[slide-template="basic"] .slide-content .bottomright-box {
  position: absolute;
  width: 45%;
}

html .slide[slide-template="basic"] .slide-content .topleft-box .copyright,
html .slide[slide-template="basic"] .slide-content .topright-box .copyright,
html .slide[slide-template="basic"] .slide-content .bottomleft-box .copyright,
html .slide[slide-template="basic"] .slide-content .bottomright-box .copyright {
  margin-bottom: 25px;
  max-width: 90%;
}

html .slide[slide-template="basic"] .slide-content .topleft-box {
  top: 20px;
  left: 60px;
}

html .slide[slide-template="basic"] .slide-content .topright-box {
  top: 20px;
  right: 60px;
}

html .slide[slide-template="basic"] .slide-content .bottomleft-box {
  bottom: 5px;
  left: 60px;
}

html .slide[slide-template="basic"] .slide-content .bottomright-box {
  bottom: 5px;
  right: 60px;
}

html .slide[slide-template="basic"] .slide-content .publication {
  display: flex;
  align-items: flex-end;
  position: absolute;
  bottom: 10px;
  left: 10px;
  padding: 10px;
  background-color: rgba(255, 255, 255, .75);
  border-radius: 2px;
  font-size: .4em;
  max-width: 50%;
  z-index: 2;
}

html .slide[slide-template="basic"] .slide-content .publication .cover {
  min-height: 100px;
  min-width: 100px;
  max-height: 150px;
  background-size: contain;
  margin-right: 10px;
}

html .slide[slide-template="basic"] .slide-content .copyright {
  position: absolute;
  bottom: 10px;
  right: 10px;
  padding: 10px;
  background-color: rgba(255, 255, 255, .75);
  border-radius: 2px;
  font-size: .4em;
  max-width: 50%;
  z-index: 2;
}</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="bMJyRxqs" name="Material Slide Template" data-type="package" __wid="STwheBGj"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="xd6wYUAy" __wid="XG5kdzHe"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="PZrWGbWF"><H2 __wid="tztWsaaF">Description</H2><DIV __wid="pMzZdfbN">This package provides a Material slide template for the Presentations package.</DIV><DIV class="warning" __wid="EbL7AN6E"><B __wid="j7xW54jp">Hint</B>: This slide tempalte uses CSS classes for style and thus can not be modified as easily with the Text Tools package as the basic slide template. See the examples below for the usage of them.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="xcvPVmx2" __wid="EhmEBX8n"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="yyCcDimu">{
  "version": "1.0.10",
  "icon": "style",
  "description": "This package provides a material slide template for the Presentations package.",
  "tags": [
    "presentation",
    "template"
  ],
  "dependencies": [
    {
      "id": "qcWPfzfc",
      "name": "Presentations",
      "optional": false,
      "usage": "The basic slide template only works together with the Presentations package."
    }
  ],
  "changelog": {
    "1.0.10": "Small fix for fill image.",
    "1.0.9": "Overview style.",
    "1.0.8": "Added stepper styles.",
    "1.0.7": "Fill image caption.",
    "1.0.6": "Filled fill image style.",
    "1.0.5": "Fill image style.",
    "1.0.4": "Added style for 1/3 2/3 split and 'three-points' list.",
    "1.0.3": "Small fix for .filled class.",
    "1.0.2": "Centered headers.",
    "1.0.1": "Adapted style to new default slide styles.",
    "1.0": "Initial version."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/bMJyRxqs-Material_Slide_Template"
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="gpPFQxxP" name="Install Material Slide Template" run-on-load="true" last-execution-state="success" __wid="eVGfndp5"><PRE data-type="content" type="text/javascript" __wid="kwgDTDhx">const PresentationConfig = require('#presentation-config');
PresentationConfig.addSlideTemplate("material");</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="KRP4pyKe" name="Material Slide Styles" style __wid="yHMjbctT"><STYLE data-type="content" type="text/css" codemirror="true" __wid="3n2smwVN">html body .paragraph .slide[slide-template="material"] .slide-content[slide-number]:after {
  content: attr(slide-number);
  position: absolute;
  font-size: 0.5em;
	top: auto;
	bottom: 72px;
	right: 96px;
	padding: 0;
	background: none;
	line-height: 24px;
	color: var(--material-color-grey-600);
	font-weight: 400;
	font-family: var(--font-monospace);
  z-index: 20;
}

html .slide[slide-template="material"] .slide-content {
	background: var(--material-color-grey-100);
  font-size: 48px;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .card {
	color: var(--material-color-grey-900);
	background: var(--material-color-white);
	margin: 48px;
	width: calc(100% - 192px) !important;
	height: calc(100% - 192px) !important;
	box-shadow: var(--material-shadow-z8);
	border-radius: 4px;
	display: flex;
	flex-direction: column;
	padding: 48px;
	z-index: 1;
}

html .slide[slide-template="material"] .slide-content .card > * {
	z-index: 10;
}

html .slide[slide-template="material"]:not(.skip-slide-number) .card {
	height: calc(100% - 264px) !important;
	padding-bottom: 120px;
}

html .slide[slide-template="material"]:not(.skip-slide-number) .slide-content .card:after {
	position: absolute;
	bottom: 48px;
	align-self: center;
	font-weight: 500;
	font-size: 0.5em;
	line-height: 24px;
	border-top: 1px solid var(--material-color-grey-400);
	width: calc(100% - 192px);
	background: var(--material-color-grey-50);
	padding: 24px 48px;
	text-align: left;
	border-radius: 0 0 4px 4px;
	color: var(--material-color-grey-600);
	font-weight: 400;
	font-family: var(--font-monospace);
  z-index: 15;
}

html .slide[slide-template="material"] .slide-content .card.filled {
	padding: 0;
	width: calc(100% - 96px) !important;
	height: calc(100% - 96px) !important;
}

html .slide[slide-template="material"]:not(.skip-slide-number) .card.filled {
	height: calc(100% - 168px) !important;
	padding-bottom: 72px;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .no-padding {
	padding: 0 !important;
}

html .slide[slide-template="material"] .slide-content .no-margin {
	margin: 0 !important;
}

html .slide[slide-template="material"] .slide-content .center,
html .slide[slide-template="material"] .slide-content .middle,
html .slide[slide-template="material"] .slide-content .left,
html .slide[slide-template="material"] .slide-content .right,
html .slide[slide-template="material"] .slide-content .top,
html .slide[slide-template="material"] .slide-content .bottom {
	display: flex;
	flex-direction: column;
}

html .slide[slide-template="material"] .slide-content .center {
	align-items: center;
}

html .slide[slide-template="material"] .slide-content .left {
	align-items: flex-start;
}

html .slide[slide-template="material"] .slide-content .right {
	align-items: flex-end;
}

html .slide[slide-template="material"] .slide-content .middle {
	justify-content: center;
	height: 100%;
}

html .slide[slide-template="material"] .slide-content .top {
	justify-content: flex-start;
	height: 100%;
}

html .slide[slide-template="material"] .slide-content .bottom {
	justify-content: flex-end;
	height: 100%;
}

html .slide[slide-template="material"] .slide-content .middle-self {
	justify-self: center;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .split-h {
	display: flex;
	flex-direction: row;
	height: 100%;
}

html .slide[slide-template="material"] .slide-content .split-v {
	display: flex;
	flex-direction: column;
	height: 100%;
}

html .slide[slide-template="material"] .slide-content .split-h > *,
html .slide[slide-template="material"] .slide-content .split-v > * {
	flex: 1 1 50%;
	margin: 0 !important;
}

html .slide[slide-template="material"] .slide-content .split-h > * + * {
	margin-left: 32px !important;
}

html .slide[slide-template="material"] .slide-content .split-v > * + * {
	margin-top: 32px !important;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .split-h-1-2 {
	display: flex;
	flex-direction: row;
	height: 100%;
}

html .slide[slide-template="material"] .slide-content .split-h-1-2 > *:first-child {
	flex: 1 1 33%;
	margin: 0 !important;
}

html .slide[slide-template="material"] .slide-content .split-h-1-2 > *:last-child {
	flex: 1 1 67%;
	margin: 0 !important;
	margin-left: 48px !important;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content slide-content,
html .slide[slide-template="material"] .slide-content render-to,
html .slide[slide-template="material"] .slide-content render-to > transient,
html .slide[slide-template="material"] .slide-content iframe {
	width: 100%;
	height: 100%;
}

/******************************************************************************/

html .slide[slide-template="material"] .fill-image,
html .slide[slide-template="material"] .fill-image-filled {
  margin: 0 !important;
  background-size: cover;
  background-repeat: no-repeat;
  display: flex;
  align-items: flex-end;
  justify-content: flex-end;
}

html .slide[slide-template="material"] .fill-image {
  width: 100%;
  height: 100%;
  border-radius: 4px;
  box-shadow: var(--material-shadow-z4);
}

html .slide[slide-template="material"] .fill-image-filled {
  width: calc(100% + 48px) !important;
  height: calc(100% + 96px) !important;
  border-top-right-radius: 4px;
  margin-right: -48px !important;
  margin-top: -48px !important;
  margin-bottom: -48px !important;
}

/******************************************************************************/

html .slide[slide-template="material"] .overview {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  width: 1362px;
  height: 816px;
}

html .slide[slide-template="material"] .overview > * {
  width: 416px;
  height: 234px;
  background: var(--material-color-white);
  border-radius: 4px;
  box-shadow: var(--material-shadow-z4);
  margin-bottom: 57px;
  margin-right: 57px;
  cursor: pointer;
}

html .slide[slide-template="material"] .overview > *:nth-child(3n) {
  margin-right: 0;
}

html .slide[slide-template="material"] .overview > * > * {
  width: 100%;
  height: 100%;
  background-size: cover;
  border-radius: 4px;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="hVXkpZCL" name="Material Text Styles" style __wid="VsT6MaH5"><STYLE data-type="content" type="text/css" codemirror="true" __wid="LHJ7Pz46">html .slide[slide-template="material"] .slide-content .presentation-title {
	font-weight: 700;
	text-transform: uppercase;
	font-size: 1.75em;
	font-family: var(--font-monospace);
	letter-spacing: 0.02em;
  text-align: center;
}

html .slide[slide-template="material"] .slide-content .presentation-subtitle {
	color: var(--material-color-grey-850);
	font-size: 1.1666em;
	margin-top: 24px;
	font-family: var(--font-monospace);
  text-align: center;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .section-title {
	font-weight: 700;
	text-transform: uppercase;
	font-size: 1.5em;
	font-family: var(--font-monospace);
	letter-spacing: 0.02em;
  text-align: center;
}

html .slide[slide-template="material"] .slide-content .section-subtitle {
	color: var(--material-color-grey-850);
	font-size: 1em;
	margin-top: 16px;
	font-family: var(--font-monospace);
  text-align: center;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .slide-title {
	font-weight: 500;
	font-size: 1.25em;
}

html .slide[slide-template="material"] .slide-content .slide-subtitle {
	font-size: 0.8333em;
	color: var(--material-color-grey-850);
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .slide-body {
	color: var(--material-color-grey-850);
	margin-top: 48px;
	flex: 1 1 100%;
}

html .slide[slide-template="material"] .slide-content .slide-body > *:first-child {
	margin-top: 0;
}

html .slide[slide-template="material"] .slide-content .slide-body .medium {
	font-weight: 500;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .slide-body div {
	margin-bottom: 16px;
}

html .slide[slide-template="material"] .slide-content .slide-body ul {
	list-style-type: disc;
	margin-top: 0;
}

html .slide[slide-template="material"] .slide-content .slide-body li {
	margin-bottom: 16px;
}

html .slide[slide-template="material"] .slide-content .slide-body .conclusion {
	font-weight: 700;
	margin-left: 48px;
}

html .slide[slide-template="material"] .slide-content .slide-body .conclusion:before {
	content: "⇒";
	margin-left: -56px;
	position: absolute;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content iframe {
	border: none;
}

html .slide[slide-template="material"] .slide-content .card.filled iframe {
	border-radius: 4px;
	-webkit-mask-image: -webkit-radial-gradient(white, black);
}

html .slide[slide-template="material"]:not(.skip-slide-number) .slide-content .card.filled iframe {
	border-radius: 4px 4px 0 0;
}

/******************************************************************************/

html .slide[slide-template="material"] .slide-content .card.filled .alice-bob {
	height: 100%;
	display: flex;
	flex-direction: row;
}

html .slide[slide-template="material"] .slide-content .card.filled iframe.alice {
	border-radius: 4px 0 0 4px;
}

html .slide[slide-template="material"] .slide-content .card.filled iframe.bob {
	border-radius: 0 4px 4px 0;
}

html .slide[slide-template="material"]:not(.skip-slide-number) .slide-content .card.filled iframe.alice {
	border-radius: 4px 0 0 0;
	border-right: 1px solid var(--material-color-grey-400);
}

html .slide[slide-template="material"]:not(.skip-slide-number) .slide-content .card.filled iframe.bob {
	border-radius: 0 4px 0 0;
	border-left: 1px solid var(--material-color-grey-400);
}

/******************************************************************************/

html .slide[slide-template="material"] figure {
	margin: 0;
}

html .slide[slide-template="material"] figure > * {
	width: 100%;
}

html .slide[slide-template="material"] figcaption {
	font-size: 0.625em;
	font-weight: 500;
	text-align: center;
}

html .slide[slide-template="material"] .fill-image-caption {
  background: var(--material-color-white);
  font-size: 0.625em;
  font-weight: 500;
  flex: 0 1 auto;
  margin: 16px;
  padding: 4px 8px;
  border-radius: 2px;
}

/******************************************************************************/

html .slide[slide-template="material"] .left-text {
  text-align: left;
}

html .slide[slide-template="material"] .center-text {
  text-align: center;
}

html .slide[slide-template="material"] .right-text {
  text-align: right;
}

/******************************************************************************/

html .slide[slide-template="material"] ul.three-points {
  list-style: none !important;
  margin-left: -40px;
  height: 100%;
}

html .slide[slide-template="material"] ul.three-points li {
  padding-top: 16px;
  height: 192px;
  margin: 0;
  border-top: 4px solid var(--material-color-grey-850);
  font-size: 1.1em;
}

/******************************************************************************/

html .slide[slide-template="material"] ul.stepper {
  display: block;
  list-style: none !important;
  counter-reset: stepper;
  margin: 0;
  padding-left: 24px;
}

html .slide[slide-template="material"] ul.stepper li {
  position: relative;
}

html .slide[slide-template="material"] ul.stepper li .step-title {
  margin: 0 -48px;
  padding: 24px 0 48px 128px;
  display: block;
  font-weight: 500;
}
html .slide[slide-template="material"] ul.stepper li:before {
  position: absolute;
  top: 24px;
  counter-increment: stepper;
  content: counter(stepper);
  height: 56px;
  width: 56px;
  border-radius: 50%;
  text-align: center;
  line-height: 56px;
  font-weight: 400;
  color: var(--material-color-white);
  background-color: var(--material-color-blue);
  font-size: 29px;
}

html .slide[slide-template="material"] ul.stepper li:after {
  content: "";
  position: absolute;
  top: 100px;
  left: 27px;
  width: 2px;
  background-color: var(--material-color-grey-500);
  height: calc(100% - 96px);
}

html .slide[slide-template="material"] ul.stepper li:last-child:after {
  display: none;
}

html .slide[slide-template="material"] ul.stepper li.done:before {
  font-family: "Material Icons";
  font-weight: normal;
  font-style: normal;
  letter-spacing: normal;
  word-wrap: normal;
  font-feature-settings: "liga";
  content: "check";
  font-size: 36px;
}

html .slide[slide-template="material"] ul.stepper li.new .step-title {
  color: var(--material-color-grey-500);
}

html .slide[slide-template="material"] ul.stepper li.new:before {
  background-color: var(--material-color-grey-500);
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="36GmbVE2" name="Material Slide Footer" draggable="false" style __wid="6czkv8Bx"><STYLE data-type="content" type="text/css" codemirror="true" __wid="RDeR2VC9">html .slide[slide-template="material"]:not(.skip-slide-number) .slide-content .card:after {
	content: "XX.XX.20XX                                 Footer Title — Footer Author";
}</STYLE></DIV><DIV class="paragraph body-paragraph collapsed" data-id="43Mwdgds" name="Presentation Template" __wid="28MS9sKi"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide skip-slide-number" slide-template="material" slide-aspect-ratio="16:9" __wid="YV9yQvx6"><DIV class="slide-container" contenteditable="false" __wid="ER6B8Wph">
	<DIV class="slide-content" contenteditable="true" __wid="H8qgteVk">
		<DIV class="card center middle" __wid="GhNUTr7C">
			<DIV class="presentation-title" __wid="pfheF34P">Presentation Title</DIV>
			<DIV class="presentation-subtitle" __wid="gXGRge99">Presentation Subtitle — 01.01.2018</DIV>
		</DIV>
	</DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="dh75Jfph">
	<DIV class="slide-notes" contenteditable="true" __wid="kSiDddjV"></DIV>
</DIV></DIV></DIV><DIV class="paragraph body-paragraph collapsed" data-id="AhYAvc4X" name="Segment Template" style __wid="rwSVVFFd"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide" slide-template="material" slide-aspect-ratio="16:9" __wid="mRTpbCgD"><DIV class="slide-container" contenteditable="false" __wid="mjFTHp4n">
	<DIV class="slide-content" contenteditable="true" slide-number="2" __wid="yVdpjuCb">
		<DIV class="card center middle" __wid="xBN8MvFY">
			<DIV class="section-title" __wid="fc3feQAB">Segment Title</DIV>
			<DIV class="section-subtitle" __wid="uT4cpend">“segment subtitle”</DIV>
		</DIV>
	</DIV>
</DIV><DIV class="slide-notes-container" contenteditable="false" __wid="erskPfp4">
	<DIV class="slide-notes" contenteditable="true" __wid="7FNagJ8j"></DIV>
</DIV></DIV></DIV><DIV class="paragraph body-paragraph collapsed" data-id="wAZfEycz" name="Stepper Segment Template" draggable="false" style __wid="vwg2uJda"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide" slide-template="material" slide-aspect-ratio="16:9" __wid="hbaxdeJV"><DIV class="slide-container" contenteditable="false" __wid="qwDKT8Mf">
  <DIV class="slide-content" contenteditable="true" slide-number="1" __wid="q4FcCKCM">
    <DIV class="card" __wid="zxYbUHQ3">
      <DIV class="split-h-1-2" __wid="RGnvcKZ3">
        <DIV class="middle" __wid="iPSZjKB5">
          <UL class="stepper" __wid="MKcbQEkF">
            <LI class="done" __wid="5bfJcV6S">
              <DIV class="step-title" __wid="MSYLd3Xz">Motivation</DIV>
            </LI>
            <LI class="done" __wid="QFbWxXtH">
              <DIV class="step-title" __wid="58j9ihKw">Technologies</DIV>
            </LI>
            <LI __wid="JVmTXwgC">
              <DIV class=" step-title" __wid="hzt8utFr">Implementation</DIV>
            </LI>
            <LI class="new" __wid="JZVgUiUT">
              <DIV class="step-title" __wid="Ggkj2g4N">Further Development</DIV>
            </LI>
            <LI class="new" __wid="gDEzMZuT">
              <DIV class="step-title" __wid="8AZGQxkA">Outlook</DIV>
            </LI>
          </UL>
        </DIV>
        <DIV class="middle" __wid="C796Dpqq">
          <DIV class="section-title" __wid="Q9wdXNtK">Segement Title</DIV>
          <DIV class="section-subtitle" __wid="89Pe8ass">“segment subtitle”</DIV>
        </DIV>
      </DIV>
    </DIV>
  </DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="wjcZM33p">
  <DIV class="slide-notes" contenteditable="true" __wid="wR5EnrRZ"></DIV>
</DIV></DIV></DIV><DIV class="paragraph body-paragraph collapsed" data-id="YSFbj9eH" name="Body Template" style __wid="vyPPAy3A"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide" slide-template="material" slide-aspect-ratio="16:9" __wid="jtpFinwW"><DIV class="slide-container" contenteditable="false" __wid="n5YSpJ6g">
	<DIV class="slide-content" contenteditable="true" slide-number="3" __wid="A9Cn5Q9A">
    <DIV class="card" __wid="qKCjuzLR">
      <DIV class="slide-title" __wid="h5PYrr67">Title</DIV>
      <DIV class="slide-body" __wid="CetXMcyM">Body</DIV>
    </DIV>
  </DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="a3FdTDYt">
  <DIV class="slide-notes" contenteditable="true" __wid="LKQuAhiE"></DIV>
</DIV></DIV></DIV><DIV class="paragraph body-paragraph collapsed" data-id="Z9CrtzpP" name="List Template" style __wid="b3sZ8wxt"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide" slide-template="material" slide-aspect-ratio="16:9" __wid="amUCD7tR"><DIV class="slide-container" contenteditable="false" __wid="hgsQNB3Y">
  <DIV class="slide-content" contenteditable="true" slide-number="4" __wid="yVTipHfG">
    <DIV class="card" __wid="YEnwfyFm">
      <DIV class="slide-title" __wid="4mzjFgCm">Title</DIV>
      <DIV class="slide-body" __wid="us7BZRNA">
        <DIV class="medium" __wid="4PPR9kUJ">Subtitle 1</DIV>
        <DIV __wid="XgSDbbrV">
          <UL __wid="HDKaJzLV">
            <LI __wid="GzJjqayZ">List element 1</LI>
            <LI __wid="dtXMkDuJ">List element 2</LI>
            <LI __wid="Dp4BnsK8">List element 3</LI>
          </UL>
        </DIV>
        <DIV class="medium" __wid="TuwarkEe">Subtitle 2</DIV>
        <DIV __wid="9rKum6fh">
          <UL __wid="dhSW4YUN">
            <LI __wid="wwHXdTZL">List element 1</LI>
            <LI __wid="YPgyqRnc">List element 2</LI>
            <LI __wid="QaSeTm9E">List element 3</LI>
          </UL>
        </DIV>
      </DIV>
    </DIV>
  </DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="JxsG8aCe">
  <DIV class="slide-notes" contenteditable="true" __wid="bsbdz7Fr"></DIV>
</DIV></DIV></DIV><DIV class="paragraph body-paragraph collapsed" data-id="tkcMVL3D" name="Split Template" style __wid="89G5M7vZ"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide" slide-template="material" slide-aspect-ratio="16:9" __wid="zQhV8J2f"><DIV class="slide-container" contenteditable="false" __wid="jqKGWMU7">
	<DIV class="slide-content" contenteditable="true" slide-number="5" __wid="bNPd8Kyj">
		<DIV class="card" __wid="cvZEbTza">
			<DIV class="slide-title" __wid="rFgJPfcZ">Motivation</DIV>
			<DIV class="slide-body split-h" __wid="zzdZvgTq">
				<DIV __wid="2rxssrHK">
          <DIV class="medium" __wid="aAw83ux8">Subtitle 1</DIV>
          <DIV __wid="MURicwYA">
            <UL __wid="BabfJMgN">
              <LI __wid="9hdPkEyL">List element 1</LI>
              <LI __wid="YAQcKBwX">List element 2</LI>
              <LI __wid="xWGNpTtn">List element 3</LI>
            </UL>
          </DIV>
          <DIV class="medium" __wid="iQYXhTRv">Subtitle 2</DIV>
          <DIV __wid="iTMbe9gP">
            <UL __wid="Dra45yZk">
              <LI __wid="jiF9cutc">List element 1</LI>
              <LI __wid="tGAed5zq">List element 2</LI>
              <LI __wid="XWCxUyk9">List element 3</LI>
            </UL>
          </DIV>
        </DIV>
				<DIV class="center" __wid="gCPcEkYu">
					<FIGURE __wid="YnDTEFrc">
						<IMG src="favicon-android-chrome-512x512.png" __wid="jFCehFcj"/>
						<FIGCAPTION __wid="L4Zx6sEG">Fig. 1: Caption</FIGCAPTION>
					</FIGURE>
				</DIV>
			</DIV>
		</DIV>
	</DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="i9yK3sYf">
	<DIV class="slide-notes" contenteditable="true" __wid="9y9dNbWw"></DIV>
</DIV></DIV></DIV><DIV class="paragraph body-paragraph collapsed" name="Fill Split Template" data-id="sWfKdKCe" __wid="UYWfNTc3"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide" slide-template="material" slide-aspect-ratio="16:9" __wid="NhEWLMTe"><DIV class="slide-container" contenteditable="false" __wid="y62S4CQb">
  <DIV class="slide-content" contenteditable="true" slide-number="1" __wid="hmVqPgA2">
    <DIV class="card" __wid="pZ2jer7G">
      <DIV class="split-h-1-2" __wid="WSwP5u8h">
        <DIV __wid="ZSNEH4kt">
          <DIV class="slide-title" __wid="a7QRaP3Z">Application-Centric Model<BR __wid="MhKYGUsU"/></DIV>
          <DIV class="slide-body" __wid="fBdhcej7">
            <DIV __wid="HgSYUvQk">
              <UL class="three-points" __wid="kaKPcQKH">
                <LI __wid="6rLis8pF">List element 1<BR __wid="NJgCn6Zu"/>Second line</LI>
                <LI __wid="dcCamnfM">List element 2<BR __wid="FEJpLzUn"/>Second line</LI>
                <LI __wid="DFKfpxFc">Fill image is 1125.6 x 816 Pixels (~4:3)</LI>
              </UL>
            </DIV>
          </DIV>
        </DIV>
        <DIV class="center middle" __wid="XDdtqWW8">
          <DIV class="fill-image" style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="JPTFe7QQ">
            <DIV class="fill-image-caption" __wid="XSHuzAQx">My Caption</DIV>
          </DIV>
        </DIV>
      </DIV>
    </DIV>
  </DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="cJwRjnBU">
  <DIV class="slide-notes" contenteditable="true" __wid="Z7w6ZTrK"></DIV>
</DIV></DIV></DIV><DIV class="paragraph body-paragraph collapsed" name="Fill-Filled Split Template" data-id="Lik76rhi" style draggable="false" __wid="NgfR56Ks"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide" slide-template="material" slide-aspect-ratio="16:9" __wid="sEjFHEha"><DIV class="slide-container" contenteditable="false" __wid="d6C6wXS7">
  <DIV class="slide-content" contenteditable="true" slide-number="1" __wid="775rMxYT">
    <DIV class="card" __wid="pwjMEMzm">
      <DIV class="split-h-1-2" __wid="aqcZNiAz">
        <DIV __wid="HLACrQEg">
          <DIV class="slide-title" __wid="HhiugFDv">Example<BR __wid="xjTZppGv"/><BR __wid="mZL4JvFE"/></DIV>
          <DIV class="slide-body" __wid="EVvD7mka">
            <DIV __wid="2GCGiwVF">
              <UL class="three-points" __wid="4ssVR84z">
                <LI __wid="bbGRutST">List element 1<BR __wid="pv7fjPB5"/>Second line</LI>
                <LI __wid="uSjJQcDw">List element 2<BR __wid="E7kthGWJ"/>Second line</LI>
                <LI __wid="gkvYCHC8">Fill image is 1173.6 x 912 Pixels (~4:3)</LI>
              </UL>
            </DIV>
          </DIV>
        </DIV>
        <DIV class="center middle" __wid="kdUqUnZC">
          <DIV class="fill-image-filled" style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="qVAh2wBr">
            <DIV class="fill-image-caption" __wid="MJcPSDQd">My Caption</DIV>
          </DIV>
        </DIV>
      </DIV>
    </DIV>
  </DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="UHi7zWWd">
  <DIV class="slide-notes" contenteditable="true" __wid="wP7zWrwL"></DIV>
</DIV></DIV></DIV><DIV class="paragraph body-paragraph collapsed" data-id="a47gTGff" name="Overview Template" __wid="NvDL5wmQ"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" class="slide" slide-template="material" slide-aspect-ratio="16:9" __wid="Fn3Uawgj"><DIV class="slide-container" contenteditable="false" __wid="dDuvFRYi">
  <DIV class="slide-content" contenteditable="true" slide-number="1" __wid="cnF5View">
    <DIV class="card center middle" __wid="pHCK25Cw">
      <DIV class="overview" __wid="wkFtPTka">
        <DIV __wid="qxf2fGeU">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="84AUq5Fb"></DIV>
        </DIV>
        <DIV __wid="fmj3Rgks">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="iU7TAi7G"></DIV>
        </DIV>
        <DIV __wid="Pzd6cWmC">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="ZtMhFMML"></DIV>
        </DIV>
        <DIV __wid="uuTaj5gU">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="H9DTvqGe"></DIV>
        </DIV>
        <DIV __wid="vbKC7KcR">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="mZ4LCJ8E"></DIV>
        </DIV>
        <DIV __wid="8xTZw2kH">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="VNJspYsC"></DIV>
        </DIV>
        <DIV __wid="ExDmgm7s">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="B3kjfrAu"></DIV>
        </DIV>
        <DIV __wid="Wu5CWyNY">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="9NvtVHzA"></DIV>
        </DIV>
        <DIV __wid="cFwA65CG">
          <DIV style="background-image: url(&quot;https://picsum.photos/1920/1080&quot;);" __wid="7ULggQGZ"></DIV>
        </DIV>
      </DIV>
    </DIV>
  </DIV>
</DIV>
<DIV class="slide-notes-container" contenteditable="false" __wid="fnALfVvd">
  <DIV class="slide-notes" contenteditable="true" __wid="RnG5jx3W"></DIV>
</DIV></DIV></DIV></DIV><DIV class="section section-hidden" data-id="qRcedryV" data-type="package" name="Output" __wid="b5jgKKqy"><DIV class="paragraph body-paragraph locked collapsed" data-id="fuLwB9hN" name="Documentation" __wid="TvPRsG8w"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="Zzs3dPsw"><H2 __wid="8tEip6pS">Description</H2>Adds an <CODE __wid="UQ9u5rG9">output()</CODE> function to easily print output into a body paragraph.</DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="2Jdaxtda" style __wid="8ESYNgbD"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="EHmy5fSf">{
	"version": "0.2.4",
	"icon": "receipt",
	"description": "Adds an output() function to easily print output into a body paragraph.",
	"tags":[
		"function",
		"code paragraphs"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"0.2.4": "Fixed request of JavaScript virtual machine from \"JavaScript\" to \"text/javascript\".",
		"0.2.3": "Updated style to stop content from jumping.",
		"0.2.2": "Output paragraph styling also for body-paragraphs.",
		"0.2.1": "'this' in output now correctly refers to the calling paragraph.",
		"0.2": "Use paragraph utils and cleanup, added styling for data-output.",
		"0.1": "Initial version."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/qRcedryV-Output"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="U8eupwkv" draggable="false" style name="Output Code" run-on-load="true" last-execution-state="success" __wid="6QWBErDA"><PRE data-type="content" type="text/javascript" __wid="A9nWyxGQ">const ParagraphUtils = require("#paragraph-utils");

/******************************************************************************/

const createParagraph = function(type) {
	const newParagraph = document.createElement("div");
	newParagraph.classList.add("paragraph");
	newParagraph.classList.add(`${type}-paragraph`);
	return newParagraph;
};

function createDataParagraph(content) {
	const outputParagraph = ParagraphUtils.createDataParagraph(JSON.stringify(content, null, 2));
	outputParagraph.setAttribute("name", "Output " + this.getAttribute("name"));
	outputParagraph.classList.add("output");

	const outputContent = outputParagraph.querySelector("[data-type='content']");
	outputContent.classList.add("output");
	outputContent.contentEditable = false;

	this.parentElement.insertBefore(outputParagraph, this.nextElementSibling);
}

function createBodyParagraph(content) {
	const outputParagraph = ParagraphUtils.createBodyParagraph();
	outputParagraph.setAttribute("name", "Output " + this.getAttribute("name"));
	outputParagraph.classList.add("output");

	const outputContent = outputParagraph.querySelector("[data-type='content']");
	outputContent.classList.add("output");
	outputContent.contentEditable = false;
	outputContent.appendChild(content);

	this.parentElement.insertBefore(outputParagraph, this.nextElementSibling);
}

/******************************************************************************/

function output(content) {
	if (this.nextElementSibling && this.nextElementSibling.querySelector(".output[data-type='content']")) {
		this.nextElementSibling.remove();
	}

	if (content instanceof Element) {
		createBodyParagraph.call(this, content);
	} else if (typeof content === "string" || typeof content === "number") {
		let el = document.createElement("div");
		el.innerHTML = content;
		createBodyParagraph.call(this, el);
	} else { //We'll assume it's a Javascript object
		createDataParagraph.call(this, content);
	}
}

document.liveQuerySelectorAll("[data-type='content']").added((content) => {
	content.liveAttribute("class").changed((value, oldValue) => {
		if (content.classList.contains("output")) {
			content.closest(".paragraph").classList.add("output");
		} else {
			content.closest(".paragraph").classList.remove("output");
		}
	});
});

/******************************************************************************/

const vm = Codestrate.VirtualMachines.get("text/javascript");

vm.addToGlobalContext({
	output
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="ftrWXYaM" name="Output Style" __wid="a3JGDcRG"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="SxEtpmbr">html .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) {
	background: var(--color-primary-shade-1);
	border-radius: 24px;
	border: 4px solid;
	border-top: 6px solid;
	border-bottom: 6px solid;
	border-color: var(--color-primary-shade-3);
	box-shadow: var(--material-shadow-z6),
		inset 0 0 16px rgba(0, 0, 0, 0.5);
	margin-bottom: 24px;
}

html .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror,
html .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) [data-type="content"] {
	padding: 24px;
}

html .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror {
	background: none !important;
}

html .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-activeline-background,
html .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-rulers,
html .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-gutters,
html .paragraph.output:not(.fullscreen):not([transient-fullscreen="true"]) .CodeMirror-gutter-wrapper {
	display: none;
}

html .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]) .paragraph-header {
	z-index: 1;
	position: absolute;
	top: -36px;
	box-shadow: var(--material-shadow-z4);
}

html .paragraph.output:not(.collapsed):not(.fullscreen):not([transient-fullscreen="true"]):not([transient-focussed]):not(:hover) .paragraph-header {
	display: none;
}</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="TRQ4yFDP" name="Plot" data-type="package" __wid="yWrENSgQ"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="qFWPWSbP" __wid="MDwBnvAn"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="TFKvdrSY"><H2 __wid="PeDKgMy8">Plot using plotly</H2><DIV __wid="SQDBEXiq">Adds a <CODE __wid="xjY3KdL3">plot</CODE> function to the global scope that can be used to plot data using the <A href="https://plot.ly/javascript/" __wid="vB3zVHAP">plotly.js</A>.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="NVtdsrUk" draggable="false" style __wid="RFwfQN7N"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="cHf48ZU8">{
	"version": "0.4.1",
	"icon": "insert_chart",
	"description": "Adds a global plot function using plotly.js",
	"tags": [
		"function",
		"code paragraphs"
	],
	"assets": [
		"plotly.min.js"
	],
	"dependencies": [
		{
			"id": "qRcedryV",
			"name": "Output"
		}
	],
	"changelog":
	{
		"0.4.1": "'this' in plot now correctly refers to the calling paragraph.",
		"0.4": "Added multi-user support",
		"0.3": "Added support for data in data paragraphs",
		"0.2": "Fixed dependency to output",
		"0.1": "Initial version."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/TRQ4yFDP-Plot"
	}
}</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="aswkRsND" name="Plot style" style __wid="xuyZQNjp"><STYLE data-type="content" type="text/css" codemirror="true" __wid="sHb5cyLK">.plotly-plot {
	padding-top: 10px;
	text-align: center;
	margin: 0 auto;
}

.plotly-plot pre.data, .plotly-plot pre.options, .plotly-plot pre.layout {
	display: none;
}</STYLE></DIV><DIV class="paragraph body-paragraph collapsed" data-id="ZUpXZFEn" name="Assets" __wid="35s6uXZD"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" __wid="hUGwuq3m"><A href="plotly.min.js" target="_blank" __wid="eTRkZGV5">plotly.min.js</A></DIV></DIV><DIV class="paragraph code-paragraph collapsed" data-id="nGDWsZXn" run-on-load="true" last-execution-state="success" name="plot code" __wid="ggDg9q9P"><PRE data-type="content" type="text/javascript" __wid="BWQ2TRUD">importLib(["plotly.min.js"]).then(() => {

	function plot(data, layout, options) {
		// Create a div to contain the plot
		const plotDiv = document.createElement("div");
		plotDiv.classList.add("plotly-plot");
		// If data is a string, lets require it as a data paragraph
		if (typeof data === "string") {
			data = require(data);
		}
		// We'll store the data in a hidden pre element
		const dataPre = document.createElement("pre");
		dataPre.classList.add("data");
		dataPre.innerText = JSON.stringify(data);
		plotDiv.appendChild(dataPre);
		// Same with layout
		if (layout) {
			const layoutPre = document.createElement("pre");
			layoutPre.classList.add("layout");
			layoutPre.innerText = JSON.stringify(layout);
			plotDiv.appendChild(layoutPre);
		}
		// And options
		if (options) {
			const optionsPre = document.createElement("pre");
			optionsPre.classList.add("options");
			optionsPre.innerText = JSON.stringify(options);
			plotDiv.appendChild(optionsPre);
		}
		
		// Now we'll output the div
		let newOutput = output.bind(this);
		newOutput(plotDiv);
	}
	
	// We listen for .plotly-plot being added
	document.liveQuerySelectorAll(".plotly-plot").added((plotDiv) => {
		// When a plot is added extract the data from the pres
		if (plotDiv.querySelector("transient")) return;
		let data;
		const dataPre = plotDiv.querySelector(".data");
		if (dataPre) data = JSON.parse(dataPre.innerText);
		let layout;
		const layoutPre = plotDiv.querySelector(".layout");
		if (layoutPre) layout = JSON.parse(layoutPre.innerText);
		let options;
		const optionsPre = plotDiv.querySelector(".options");
		if (optionsPre) options = JSON.parse(optionsPre.innerText);
		if (!options) {
			options = {};
		}
		// Disable tips that polute the DOM
		options.showTips = false;
		// Create a transient element for the view
		const plotlyView = document.createElement("transient");
		plotDiv.appendChild(plotlyView);
		// Plot it.
		Plotly.newPlot(plotlyView, data, layout, options);
	});

	const vm = Codestrate.VirtualMachines.get("text/javascript");

	vm.addToGlobalContext({
		plot
	});	
});</PRE></DIV><DIV class="paragraph body-paragraph" data-id="8tRYpCkh" name="Examples" __wid="cw8LSc4V"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" __wid="cvVMxik5"><H2 __wid="GVhQBD5z">
	Examples:
</H2></DIV></DIV><DIV class="paragraph code-paragraph" data-id="JG7HKGia" name="Line and scattor plot" last-execution-state="success" __wid="6tS7r7vq"><PRE data-type="content" type="text/javascript" __wid="AYmV8JeU">var trace1 = {
  x: [1, 2, 3, 4],
  y: [10, 15, 13, 17],
  mode: 'markers',
  type: 'scatter'
};

var trace2 = {
  x: [2, 3, 4, 5],
  y: [16, 5, 11, 9],
  mode: 'lines',
  type: 'scatter'
};

var trace3 = {
  x: [1, 2, 3, 4],
  y: [12, 9, 15, 12],
  mode: 'lines+markers',
  type: 'scatter'
};

var data = [trace1, trace2, trace3];

plot(data);</PRE></DIV><DIV class="paragraph code-paragraph" data-id="v2MZDDUW" name="Pie chart with data in data paragraph and layout" last-execution-state="success" style __wid="L8ZYhVA3"><PRE data-type="content" type="text/javascript" __wid="wyZ38kKT">var layout = {
  height: 400,
  width: 500
};

plot("#pie-chart-example-data", layout);</PRE></DIV><DIV class="paragraph data-paragraph" data-id="45eVgT5j" name="Pie Chart example data" __wid="bF6wCFXf"><PRE data-type="content" type="application/json" id="pie-chart-example-data" __wid="DaspbZu5">[{
  "values": [19, 26, 55],
  "labels": ["Residential", "Non-Residential", "Utility"],
  "type": "pie"
}]</PRE></DIV><DIV class="paragraph code-paragraph" data-id="ZQ9fbxzS" draggable="false" style name="Scroll and zoom" last-execution-state="success" __wid="PisybZiz"><PRE data-type="content" type="text/javascript" __wid="Lxiv8LjU">// mousewheel or two-finger scroll zooms the plot

var trace1 = {
    x:['2020-10-04', '2021-11-04', '2023-12-04'],
    y: [90, 40, 60],
    type: 'scatter'
};

var data = [trace1];

var layout = {
    title: 'Scroll and Zoom',
    showlegend: false
};

// Plot with options
plot(data, layout, {scrollZoom: true});</PRE></DIV></DIV><DIV class="section section-hidden" data-id="KX9BMP3y" name="Vega Lite Plotting" data-type="package" __wid="5tSgmkHv"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="aWpnaLGb" style __wid="pcb9fsDV"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="bKhk2fMP"><H2 __wid="xhQUiD6S">Vega Lite Plotting</H2><DIV __wid="5LjhLu5e">Adds a <CODE __wid="ZmrpiBtS">vplot</CODE> and <CODE __wid="z5H76mY7">vplotlive</CODE> function to the global scope that can be used to plot using <A href="https://vega.github.io/vega-lite/" target="_blank" __wid="xus5gi4q">Vega Lite</A>.</DIV><DIV __wid="Syd3xwHE"><CODE __wid="aEAVWjMR">vplot</CODE> renders a static plot, while <CODE __wid="qfpWEgJ8">vplotlive</CODE> takes a reference to a data paragraph, and updates when the spec in the data paragraph is changed.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="SeeshLAV" draggable="false" style __wid="x2u2WMbH"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="Yy5wSVWB">{
	"version": "0.4.3",
	"icon": "bubble_chart",
	"description": "Vega and Vega Lite plotting package. Adds global vplot function.",
	"tags": [
		"function",
		"code paragraphs"
	],
	"assets": [
		"vega.js",
		"vega-lite.js",
		"vega-embed.js",
		"seattle-weather.csv"
	],
	"dependencies": [
		{
			"id": "qRcedryV",
			"name": "Output"
		}
	],
	"changelog":
	{
		"0.4.3": "Fixed styling of documentation.",
		"0.4.2": "Fixed bug that prevented the vega lite package from initialize correctly.",
		"0.4.1": "'this' in vplot and vplotlive now correctly refers to the calling paragraph.",
		"0.4": "Added vplotlive and support for outputting to an element with a given id",
		"0.3": "Added support for output target with CSS selector",
		"0.2": "Multi-user support",
		"0.1": "Initial version."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/KX9BMP3y-Vega_Lite_Plotting"
	}
}</PRE></DIV><DIV class="paragraph body-paragraph locked collapsed" data-id="qDDJtgei" name="Assets" style __wid="AdWPGFPg"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="writing" __wid="xgqyZ4qp"><A href="vega.js" target="_blank" __wid="DvaeG4vP">vega.js</A><DIV __wid="mQz6LPbV"><A href="vega-lite.js" target="_blank" __wid="Y4WGVcWu">vega-lite.js</A><BR __wid="McZk3PnZ"/><A href="vega-embed.js" target="_blank" style="font-family: var(--font-secondary); font-size: 1rem; background-color: var(--color-primary-shade-2);" __wid="hQaC3ntp">vega-embed.js</A><BR __wid="rs6VuAfX"/><A href="seattle-weather.csv" target="_blank" style="font-family: var(--font-secondary); font-size: 1rem; background-color: var(--color-primary-shade-2);" __wid="j52ued5T">seattle-weather.csv</A></DIV></DIV></DIV><DIV class="paragraph code-paragraph collapsed" data-id="wpqsPzzf" name="Vega code" last-execution-state="success" run-on-load="true" __wid="PWMHE646"><PRE data-type="content" type="text/javascript" __wid="6KMdqhTr">importLib(["vega.js", "vega-lite.js", "vega-embed.js"]).then(() => {
	
	// vplot renders a static vega plot where the spec is stored with the plot
	function vplot(spec, selector) {
		// Create the div that will contain the plot
		const vegaDiv = document.createElement("div");
		// If a selector is given, use that element as an output
		if (selector) {
			document.querySelector(selector).appendChild(vegaDiv);
		} else {
			// Else just use output
			let outputBound = output.bind(this);
			outputBound(vegaDiv);
		}
		vegaDiv.classList.add("vega");
		// If the spec is a string require it
		if (typeof spec === "string") {
			spec = require(spec);
		}
		const specPre = document.createElement("pre");
		// Store the spec in a pre element
		specPre.classList.add("spec");
		specPre.innerText = JSON.stringify(spec);
		vegaDiv.appendChild(specPre);
	}

	// Listen for new vega plots and render them based on the stored spec
	document.liveQuerySelectorAll(".vega").added((vegaDiv) => {
		if (vegaDiv.querySelector("transient")) return;
		const spec = JSON.parse(vegaDiv.querySelector(".spec").innerText);
		const vegaView = document.createElement("transient");
		vegaDiv.appendChild(vegaView);
		vegaEmbed(vegaView, spec);
	});

	// vplotlive renders a live vega plot that updates when the source spec in a data paragraph updates
	function vplotlive(spec, selector) {
		// We only allow ID selectors as input for specs
		if (typeof spec !== "string" || spec[0] !== "#") {
			alert("The first parameter to vplotlive must be an id of a data paragraph");
			return;
		}
		const vegaDiv = document.createElement("div");
		// If a selector is given, use that element as an output
		if (selector) {
			document.querySelector(selector).appendChild(vegaDiv);
		} else {
			// Else just use output
			let outputBound = output.bind(this);
			outputBound(vegaDiv);	
		}
		vegaDiv.classList.add("vegalive");
		const specId = spec;
		spec = require(spec);
		const specPre = document.createElement("pre");
		// Store the id of the spec in a pre element
		specPre.classList.add("spec");
		specPre.innerText = specId;
		vegaDiv.appendChild(specPre);
	}

	// Listen for new vega live plots and render them based on the stored spec
	document.liveQuerySelectorAll(".vegalive").added((vegaDiv) => {
		if (vegaDiv.querySelector("transient")) return;
		const specId = vegaDiv.querySelector(".spec").innerText;
		const spec = require(specId);
		const vegaView = document.createElement("transient");
		vegaDiv.appendChild(vegaView);
		vegaEmbed(vegaView, spec);
		const specNode = document.querySelector(specId).firstChild;
		// Listen for updates to the spec and re-render the vega plot
		specNode.webstrate.on("insertText*", function(position, value) {
  		vegaEmbed(vegaView, require(specId));
		});

		specNode.webstrate.on("deleteText*", function(position, value) {
  		vegaEmbed(vegaView, require(specId));
		});
	}); 

	const vm = Codestrate.VirtualMachines.get("text/javascript");

	vm.addToGlobalContext({
		vplot,
		vplotlive
	});	
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="GRmzwAuY" draggable="false" style name="Vega style" __wid="AwpAC2mQ"><STYLE data-type="content" type="text/css" codemirror="true" __wid="jsAnznZt">.vega canvas, .vegalive canvas {
	background-color: white;
}

.vega a, .vegalive a {
	margin-right: 4px;
}

.vega pre.spec, .vegalive pre.spec {
	display: none;
}</STYLE></DIV><DIV class="paragraph body-paragraph" data-id="xxXQD4JB" style name="Examples" __wid="JAE66bxq"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" __wid="VwBUfpC5"><H2 __wid="zPazrYjV">
	Examples:
</H2></DIV></DIV><DIV class="paragraph data-paragraph" data-id="RgERWEx4" name="Average monthly precipitation in Seattle Vega Lite Spec" style __wid="26MaUMEW"><PRE data-type="content" type="application/json" id="seattle-precipitation" __wid="UyWZZBFM">{
  "$schema": "https://vega.github.io/schema/vega-lite/v2.json",
  "data": {
    "url": "seattle-weather.csv",
    "format": {
      "type": "csv"
    }
  },
  "mark": "bar",
  "encoding": {
    "x": {
      "timeUnit": "months",
      "field": "date",
      "type": "ordinal"
    },
    "y": {
      "aggregate": "mean",
      "field": "precipitation",
      "type": "quantitative"
    }
  }
}</PRE></DIV><DIV class="paragraph code-paragraph" data-id="aw35mqbM" draggable="false" style name="Average monthly precipitation in Seattle Code" last-execution-state="success" __wid="U9Sgq4tJ"><PRE data-type="content" type="text/javascript" __wid="4uQT365Y">vplot("#seattle-precipitation");</PRE></DIV><DIV class="paragraph code-paragraph" data-id="q7i5VkDu" name="Example with target output element" last-execution-state="success" style __wid="TMGBpNUF"><PRE data-type="content" type="text/javascript" __wid="LDYuCEFr">vplot("#seattle-precipitation", "#vega-lite-target");</PRE></DIV><DIV class="paragraph body-paragraph locked" data-id="mUrwwTbR" draggable="false" style name="Target for plotting" __wid="DXW2cC8A"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" id="vega-lite-target" __wid="zeEVHRMw"></DIV></DIV><DIV class="paragraph code-paragraph" data-id="7uWdXfp5" draggable="false" style last-execution-state="success" name="Live plot" __wid="jstnMq68"><PRE data-type="content" type="text/javascript" __wid="XktcpCQH">// Change the spec, and the plot will change
vplotlive("#seattle-precipitation");</PRE></DIV></DIV><DIV class="section section-hidden" data-id="2RJ3bLKU" name="Function Plotting" data-type="package" __wid="BEk8N6w8"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="K7urNtpY" __wid="8u5SNPHp"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="Nu3DiSWn"><H2 __wid="PXvrQZZD">Function Plotting</H2><DIV __wid="mBeBfG83">Adds a global <CODE __wid="uUT8jzuy">fplot</CODE> function for creating plots with <A href="https://mauriciopoppe.github.io/function-plot/" target="_blank" __wid="WQ5CWvXi">Function Plot</A>.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="mqm9tyHs" draggable="false" style __wid="gHLEVyFR"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="ZTjGmAeu">{
	"version": "0.1.1",
	"icon": "show_chart",
	"description": "Adds a global fplot function for creating plots with Function Plot.",
	"tags": [
		"function",
		"code paragraphs"
	],
	"assets": [
		"d3.v3.min.js",
		"function-plot-min.js"
	],
	"dependencies": [
		{
			"id": "qRcedryV",
			"name": "Output"
		}
	],
	"changelog":
	{
		"0.1.1": "'this' in fplot now correctly refers to the calling paragraph.",
		"0.1": "Initial version."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/2RJ3bLKU-Function_Plotting"
	}
}</PRE></DIV><DIV class="paragraph body-paragraph collapsed" data-id="ABn4E7Gs" name="Assets" style __wid="WVaheMUR"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="true" __wid="9sWPEgJZ"><A href="function-plot-min.js" target="_blank" __wid="BgcxUkX3">function-plot-min.js</A><DIV __wid="9YD3fRTc"><A href="d3.v3.min.js" target="_blank" __wid="fXbe7bBv">d3.v3.min.js</A><BR __wid="TWhk8a6G"/></DIV></DIV></DIV><DIV class="paragraph code-paragraph collapsed" data-id="sAdMBZ4v" name="Function plotting code" run-on-load="true" last-execution-state="success" __wid="ZuHiUYhD"><PRE data-type="content" type="text/javascript" __wid="6ER6pz2C">importLib(["d3.v3.min.js", "function-plot-min.js"]).then(() => {
	function fplot(f) {
		const fplotDiv = document.createElement("div");
		let outputBound = output.bind(this);
		outputBound(fplotDiv);
		fplotDiv.classList.add("fplot");
		if (typeof f === "string") {
			f = require(f);
		}
		const functionPre = document.createElement("pre");
		functionPre.classList.add("function");
		functionPre.innerText = JSON.stringify(f);
		fplotDiv.appendChild(functionPre);
	}
	
	document.liveQuerySelectorAll(".fplot").added((fplotDiv) => {
		if (fplotDiv.querySelector("transient")) return;
		const f = JSON.parse(fplotDiv.querySelector(".function").innerText);
		const fplotView = document.createElement("transient");
		fplotDiv.appendChild(fplotView);
		if (!f.target) {
			f.target = fplotView;
		}
// 		console.log(f);
		functionPlot(f);
	});

	const vm = Codestrate.VirtualMachines.get("text/javascript");

	vm.addToGlobalContext({
		fplot
	});	
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="bAuFXPkk" name="Function plot style" __wid="m7CbsqHF"><STYLE data-type="content" type="text/css" codemirror="true" __wid="LkkVfVZc">.fplot {
	padding-top: 4px;
}

.fplot pre.function {
	display: none;
}

.fplot .function-plot {
	background-color: white;
}</STYLE></DIV><DIV class="paragraph body-paragraph locked" data-id="ghReCz4F" name="Examples" __wid="GZhmEuEE"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" __wid="J4Greirs"><H2 __wid="hhxxyAMb">
	Examples:
</H2></DIV></DIV><DIV class="paragraph code-paragraph" data-id="S7jYCJpt" name="Quadratic curve" last-execution-state="success" __wid="mkknNtYD"><PRE data-type="content" type="text/javascript" __wid="EMgNM8if">fplot({
  data: [{
    fn: 'x^2'
  }]
});</PRE></DIV><DIV class="paragraph code-paragraph" data-id="Aqs5FH77" last-execution-state="success" name="Curve with options" __wid="S4UU5eSm"><PRE data-type="content" type="text/javascript" __wid="ey9errLb">fplot({
  title: 'y = x * x',
  width: 580,
  height: 400,
  disableZoom: true,
  xAxis: {
    label: 'x - axis',
    domain: [-6, 6]
  },
  yAxis: {
    label: 'y - axis'
  },
  data: [{
    fn: 'x^2'
  }]
});</PRE></DIV><DIV class="paragraph code-paragraph" data-id="h6Ve48Gs" last-execution-state="success" name="Plotting from data paragraph" __wid="gQxkTRJk"><PRE data-type="content" type="text/javascript" __wid="dKVzxz4A">fplot("#butterfly-plot");</PRE></DIV><DIV class="paragraph data-paragraph" data-id="FTa2SG8L" name="Butterfly plot data" __wid="cqfLrWwA"><PRE data-type="content" type="application/json" id="butterfly-plot" __wid="7j5q6nzd">{
  "yAxis": {"domain": [-4.428571429, 4.428571429]},
  "xAxis": {"domain": [-7, 7]},
  "data": [{
    "x": "sin(t) * (exp(cos(t)) - 2 cos(4t) - sin(t/12)^5)",
    "y": "cos(t) * (exp(cos(t)) - 2 cos(4t) - sin(t/12)^5)",
    "range": [-31.4, 31.4],
    "fnType": "parametric",
    "graphType": "polyline"
  }]
}</PRE></DIV></DIV><DIV class="section section-hidden" name="PDF Viewer" data-type="package" data-id="ErYrJpnZ" __wid="TSmbpXwx"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="J94dr6d5" __wid="HWsS7nXj"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="Kjj4LFJZ"><H2 __wid="KjJb82ED">Description<BR __wid="3S5n5atb"/></H2><DIV __wid="eCwpmbYk">PDF viewer paragraph.</DIV><H2 __wid="SYGKwefJ">Changes</H2><DIV __wid="gYVtUJGJ">Consider changing the <CODE __wid="GQRJkyx9">this.getPageScreenViewPort</CODE> in the PDF Rendering to render pdf pages using the paragraph's width instead of <CODE __wid="j3bFLA85">window.innerWidth</CODE>. See code paragraph below.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="kHFXgsu5" __wid="uwrihhbg"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="3xTQGTXm">{
	"version": "1.2.2",
	"icon": "picture_as_pdf",
	"description": "PDF viewer paragraph.",
	"tags": [
		"tools",
		"body paragraphs"
	],
	"assets": [
		"pdf.js",
		"pdf.worker.js"
	],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initital version",
		"1.0.1": "Added missing JavaScript dependency to pdf.worker.js.",
		"1.1": "A pdf body paragraph can be added through the toolbar, which will render a dropped pdf inside of it.",
		"1.1.1": "Fixed pdf rendering when multiple paragraphs with pdfs are in a document and one document is scrolled. This issue was caused because all pdf paragraphs shared the same pdf renderer.",		
		"1.1.2": "Text highlight button is added only once.",
		"1.2": "Added debounce on scroll and resize events to make scrolling and resizing not jerk.",
		"1.2.1": "Displaying/rendering pdf also in transient-fullscreen=\"false\" mode.",
		"1.2.2": "Fixed rendering and re-rendering of pdf when changing between fullscreen and non-fullscreen modes."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/ErYrJpnZ-PDF_Viewer"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="jBAg36gU" name="PDF Toolbar Integration" run-on-load="true" last-execution-state="success" __wid="iRguED25"><PRE data-type="content" type="text/javascript" contenteditable="true" __wid="9zsNv3PG">const GlobalToolbarUtils = require("#global-toolbar-utils");
const ParagraphUtils = require("#paragraph-utils");

GlobalToolbarUtils.addDivider(1, "pdf-package");
GlobalToolbarUtils.addButton("Add PDF Paragraph", "picture_as_pdf", "pdf-toolbar-icon", 1, () => {
	const paragraph = ParagraphUtils.createBodyParagraph();
	const content = paragraph.querySelector('[data-type="content"]');
	content.classList.add("pdf");
	content.innerHTML = `&lt;div class="document">
  &lt;div class="pages">&lt;/div>
&lt;/div>
&lt;div class="documentLoading">
  &lt;div class="dropzone">Drop PDF here (max 100mb)&lt;/div>
&lt;/div>`;
	ParagraphUtils.insertParagraphAfterFocussed(paragraph);
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Pen annotation" data-id="mK5RDhPn" __wid="nnzQJJtF"><PRE data-type="content" type="text/javascript" id="annotationlayer" contenteditable="null" __wid="ci6cFBrS">// This function is used to convert an svg element into a annotation layer
// The annotation layer is compatible only with the iPad Pro (so far).
// Example usage: var annotationLayer = new AnnotationLayer(svgelement, 2);

exports.AnnotationLayer = function(svg, strokeWidth) {
	this.svg = svg;
	this.path = null;
	this.points = [];

	svg.parentElement.addEventListener("touchstart", function(e) {
		if (e.touches.length != 1) return;
		let touch = e.touches[0];
		if (touch.force === 0) return;
		let ns = "http://www.w3.org/2000/svg";
		this.path = document.createElementNS(ns, "path");
		let svgPos = getCoords(svg);
		let svgBox = svg.viewBox.baseVal;
		let x = ((touch.pageX - svgPos.left) / svg.clientWidth) * svgBox.width;
		let y = ((touch.pageY - svgPos.top) / svg.clientHeight) * svgBox.height;
		let point = {x: x, y: y, force: touch.force};
		this.points = [point];
		this.path.setAttribute("d", generatePath(this.points));
		this.path.setAttribute("fill", "#284283");
		svg.appendChild(this.path);
		e.preventDefault();
	});

	svg.parentElement.addEventListener("touchmove", function(e) {
		if (this.path === null) return;
		if (e.touches.length != 1) return;
		let touch = e.touches[0];
		if (touch.force === 0) return;
		let svgPos = getCoords(svg);
		let svgBox = svg.viewBox.baseVal;
		let x = ((touch.pageX - svgPos.left) / svg.clientWidth) * svgBox.width;
		let y = ((touch.pageY - svgPos.top) / svg.clientHeight) * svgBox.height;
		let point = {x: x, y: y, force: touch.force};
		this.points.push(point);
		let pathString = this.path.getAttribute("d");
		this.path.setAttribute("d", generatePath(this.points));
	});

	svg.parentElement.addEventListener("touchend", function(e) { 
		this.path = null;  
	});

	function getCoords(elem) {
		let box = elem.getBoundingClientRect();

		let body = document.body;
		let docEl = document.documentElement;

		let scrollTop = window.pageYOffset || docEl.scrollTop || body.scrollTop;
		let scrollLeft = window.pageXOffset || docEl.scrollLeft || body.scrollLeft;

		let clientTop = docEl.clientTop || body.clientTop || 0;
		let clientLeft = docEl.clientLeft || body.clientLeft || 0;

		let top  = box.top +  scrollTop - clientTop;
		let left = box.left + scrollLeft - clientLeft;

		return { top: Math.round(top), left: Math.round(left) };
	}

	function generatePath(points) {
		let newPoints = [];
		newPoints.push(points[0]);

		for (let j = 1; j&lt;points.length-1; j++) {
			let p1	= points[j-1];
			let p = points[j];
			let p2 = points[j+1];
			let c = {x: p2.x-p1.x, y: p2.y-p1.y};
			let n = {x: -c.y, y: c.x};
			let len = Math.sqrt(n.x*n.x + n.y*n.y);
			if (len === 0) continue;
			let u = {x: n.x/len, y: n.y/len};
			let newPoint = {x: p.x+u.x*p.force*strokeWidth, y: p.y+u.y*p.force*strokeWidth};
			newPoints.push(newPoint);
		}
		newPoints.push(points[points.length-1]);

		for (let j = points.length-2; j>0; j--) {
			let p1 = points[j+1];
			let p = points[j];
			let p2 = points[j-1];
			let c = {x: p2.x-p1.x, y: p2.y-p1.y};
			let n = {x: -c.y, y: c.x};
			let len = Math.sqrt(n.x*n.x + n.y*n.y);
			if (len === 0) continue;
			let u = {x: n.x/len, y: n.y/len};

			newPoints.push({x: p.x+u.x*p.force*strokeWidth, y: p.y+u.y*p.force*strokeWidth});
		}

		let p1 = newPoints[0];
		let p2 = newPoints[1];
		let pathString = "M"+p1.x + " " + p1.y;
		for (let j = 1; j&lt;newPoints.length; j++) {
			let midPoint = midPointBtw(p1, p2);
			if (isNaN(p1.x) || isNaN(p1.y) || isNaN(midPoint.x) || isNaN(midPoint.y)) {
				console.log("NaN");
			}
			pathString = pathString += " Q " + p1.x + " " + p1.y + " " + midPoint.x + " " + midPoint.y;
			p1 = newPoints[j];
			p2 = newPoints[j+1];
		}

		return pathString;
	}

	function midPointBtw(pa, pb) {
		return {
			x: pa.x + (pb.x - pa.x) / 2,
			y: pa.y + (pb.y - pa.y) / 2
		};
	}
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Text highlight" draggable="false" last-execution-state="success" data-id="VcJus83a" __wid="SfT4rX8T"><PRE data-type="content" type="text/javascript" id="texthighlight" contenteditable="null" __wid="XnAz9zgM">exports.addTextHighlightButton = (content) => {
	let highlightButton = document.createElement("transient");
	highlightButton.classList.add("highlightButton");
	highlightButton.classList.add("hidden");

	content.appendChild(highlightButton);

	let lastSelection  = null;
	let hideTimer = null;

	function hideHighlightButton() {
		if (hideTimer !== null) {
			clearTimeout(hideTimer);
		}
		hideTimer = setTimeout(() => {
			highlightButton.classList.add("hidden");
		}, 500);
	}

	function showHighlightButton() {
		if (hideTimer !== null) {
			clearTimeout(hideTimer);	
		}
		highlightButton.classList.remove("hidden");	
	}

	document.addEventListener("selectionchange", (e) => {
		var selection = window.getSelection();
		if (selection.anchorNode === null) {
			hideHighlightButton();
			return;
		}
		var anchorElement = selection.anchorNode.nodeType === 3 ? selection.anchorNode.parentNode : selection.anchorNode;
		var focusElement = selection.focusNode.nodeType === 3 ? selection.focusNode.parentNode : selection.focusNode;

		var anchorPage = anchorElement.closest(".page");
		var focusPage = focusElement.closest(".page");

		if (!anchorPage) {
			hideHighlightButton();
			return;
		}

		// We currently can't handle cross-page selections
		if (anchorPage !== focusPage) {
			hideHighlightButton();
			return;
		}

		if (selection.anchorNode === selection.extentNode && selection.anchorOffset === selection.focusOffset) {
			hideHighlightButton();
		} else {
			var range = selection.getRangeAt(0);
			var boundingRects = range.getClientRects();
			lastSelection = {page: anchorElement.closest(".page"), rects: boundingRects, scrollTop: document.body.scrollTop};
			showHighlightButton();
		}
	});

	highlightButton.addEventListener("click", function(e) {
		if (lastSelection === null) return;
		var svg = lastSelection.page.querySelector("svg");
		var viewBox = svg.viewBox.baseVal;
		var scale = viewBox.width / svg.getBoundingClientRect().width;
		var rects = lastSelection.rects;
		var pageTop = lastSelection.page.getBoundingClientRect().top;
		var scrollTop = lastSelection.scrollTop;
		var offsetTop = scrollTop - pageTop;
		console.log(pageTop, scrollTop, offsetTop);
		for (var i = 0; i&lt;rects.length; i++) {
			var rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");	
			rect.setAttribute("x", rects[i].left * scale);
			rect.setAttribute("y", (rects[i].top + offsetTop) * scale);
			rect.setAttribute("width", rects[i].width * scale);
			rect.setAttribute("height", rects[i].height * scale);

			svg.appendChild(rect);
		}
	}, true);
};</PRE></DIV><DIV class="paragraph style-paragraph collapsed" draggable="false" name="Highlight style" data-id="vB8NU6YC" __wid="vAZzgebh"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="null" __wid="aAJuwyRT">.highlightButton {
	position: fixed;
	right: 20px;
	bottom: 20px;
	background-color: yellow;
	width: 40px;
	height: 40px;
	border-radius: 40px;
	border: 3px solid gray;
}

.highlightButton.hidden {
	display: none;
}</STYLE></DIV><DIV class="paragraph code-paragraph collapsed" name="PDF rendering" data-id="xQE7xw85" __wid="BGyKd6te"><PRE data-type="content" type="text/javascript" id="pdfrendering" contenteditable="null" __wid="VCSTJFGy">//var TextOverlay = require("#textoverlay");

// This module is a simple wrapper around PDF.JS to load a PDF and show a page on a canvas
exports.PDFRenderer = function () {
  let pages = 0;
  let pdf = null;

  // Loads a PDF from a data URI and returns the PDF.JS object
  this.loadPdf = function (source, callback) {
    if (window.PDFJS === undefined) {
      console.error("PDFJS is not loaded!");
      return;
    }
    PDFJS.getDocument(source).then(function (thePdf) {
      pages = thePdf.pdfInfo.numPages;
      pdf = thePdf;
      callback(pdf, pages);
    });
  };

  // Gives the viewport of a given page number in a callback
  this.getPageSceenViewPort = function (containerWidth, pageNo, callback) {
    pdf.getPage(pageNo).then(function (page) {
      let result = {};
      let scale = containerWidth / page.getViewport(1).width;
      let height = Math.floor(page.getViewport(scale).height);
      callback(pageNo, {
        width: containerWidth,
        height: height
      });
    });
  };

  // Shows a given page number in a given container
  this.showPage = function (pageNo, container, textLayerDiv, callback) {
    pdf.getPage(pageNo).then(function (page) {
      let canvas = document.createElement("canvas");
      canvas.classList.add("pdfcanvas");
      if (container.firstElementChild) {
        container.insertBefore(canvas, container.firstElementChild);
      } else {
        container.appendChild(canvas);
      }

      // 			debugger;
      let canvasWidth = parseInt(window.getComputedStyle(container).width);
      // 			let canvasWidth = window.innerWidth;
      let scale = (canvasWidth / page.getViewport(1).width) * 2;

      let viewport = page.getViewport(scale);

      let ctx = canvas.getContext('2d');
      ctx.canvas.width = canvasWidth;
      ctx.canvas.height = viewport.height / 2;

      let oldWidth = canvas.width;
      let oldHeight = canvas.height;

      canvas.width = oldWidth * 2;
      canvas.height = oldHeight * 2;

      canvas.style.width = oldWidth + 'px';
      canvas.style.height = oldHeight + 'px';

      // Generate text layer (for text selection)
      let textLayer = container.querySelector(".textLayer");
      if (!textLayer) {
        textLayer = document.createElement("transient");
        textLayer.classList.add("textLayer");
        container.appendChild(textLayer);
      }
      textLayer.style.width = oldWidth + 'px';
      textLayer.style.height = oldHeight + 'px';
      page.getTextContent().then(function (textContent) {
        PDFJS.renderTextLayer({
          textContent: textContent,
          container: textLayer,
          viewport: page.getViewport(canvasWidth / page.getViewport(1).width),
          textDivs: []
        });
      });

      // Render the page
      let renderContext = {
        canvasContext: ctx,
        viewport: viewport
      };
      page.cleanupAfterRender = true;
      page.render(renderContext);
      callback(pageNo, page.getViewport(1));

    });
  };

  this.getPageCount = function () {
    return pages;
  };

  this.getPdf = function () {
    return pdf;
  };
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="File loader" data-id="EkxYeUVV" __wid="CAHi5m4X"><PRE data-type="content" type="text/javascript" id="fileloader" contenteditable="null" __wid="wxhEAMrf">// This module can process a drop of a PDF, store it as an asset and returns a link to the file

exports.processFileDrop = function (event, callback) {
	if (event.dataTransfer.files.length > 1) {
		callback("Just one file!");
		return;
	} else if (event.dataTransfer.files.length === 0) {
		callback("That's not a file?");  
		return;
	} else if (event.dataTransfer.files[0].type !== "application/pdf") {
		callback("That's not a pdf!");
		return;
	}
	
	let file = event.dataTransfer.files[0];
	if (file.size > 104857600) {
		callback("Max 100MB!");
		return;
	}

	let formData = new FormData();
	formData.append("file", file, file.name);

	let req = new XMLHttpRequest();
	req.open("POST", window.location.pathname);
	req.send(formData);
	req.onload = function(e) {
		let pdfLink = document.createElement("a");
		pdfLink.setAttribute("href", file.name);
		pdfLink.innerText = file.name;
		callback(null, pdfLink);
	};
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="PDF main" last-execution-state="success" data-id="ZRaeLdG5" run-on-load="true" __wid="ie8NbeCE"><PRE data-type="content" type="text/javascript" contenteditable="null" __wid="dSdNNdSU">importLib([
  "pdf.js"
]).then(() => {

  // Returns a function, that, as long as it continues to be invoked, will not
  // be triggered. The function will be called after it stops being called for
  // N milliseconds. If `immediate` is passed, trigger the function on the
  // leading edge, instead of the trailing.
  const debounce = (func, wait, immediate) => {
    var timeout;
    return function () {
      const context = this;
      const args = arguments;
      const later = function () {
        timeout = null;
        if (!immediate) func.apply(context, args);
      };
      const callNow = immediate && !timeout;
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
      if (callNow) func.apply(context, args);
    };
  };

  let FileLoader = require("#fileloader");
  let PDFRenderer = require("#pdfrendering").PDFRenderer;
  let AnnotationLayer = require("#annotationlayer").AnnotationLayer;
  let TextHighlight = require("#texthighlight");

  class PdfParagraphWrapper {

    get pages() {
      return this.content.querySelectorAll('.page');
    }

    get url() {
      const pdfUrl = this.content.querySelector("a.pdfdata");
      if (pdfUrl) {
        return pdfUrl.getAttribute("href");
      }
      return null;
    }

    get containerWidth() {
      return parseInt(window.getComputedStyle(this.paragraph).width);
    }

    constructor(paragraph, content) {
      this.paragraph = paragraph;
      this.content = content;

      // create actual pdf renderer
      this.pdfRenderer = new PDFRenderer();

      TextHighlight.addTextHighlightButton(content);

      this.initialize();
    }

    initialize() {
      // Let's first check if we already have some PDF data
      if (this.url) {
        // If we do lets render the PDF
        this.loadAndRenderPdf(this.url);
      } else {
        // Else we setup the handlers for the PDF drop zone
        this.setupDropZone();
      }
    }

    // This method sets up the event handler for dropping a PDF into the empty viewer
    setupDropZone() {
      let dropzone = this.content.querySelector('.dropzone');
      dropzone.addEventListener("drop", (event) => {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();

        FileLoader.processFileDrop(event, (error, pdfLink) => {
          if (error) {
            dropzone.innerHTML = error;
          } else {
            // When we get the data we load the PDF and hide the loader
            pdfLink.classList.add("pdfdata");
            this.content.appendChild(pdfLink);
            let url = pdfLink.getAttribute("href");
            this.loadAndRenderPdf(url);

            let documentLoading = this.content.querySelector(".documentLoading");
            documentLoading.remove();
          }

        });
      }, true);

      dropzone.addEventListener("dragover", (event) => {
        event.preventDefault();
      }, false);
    }

    loadAndRenderPdf(url) {
      this.pdfRenderer.loadPdf(url, (pdf, pages) => {
        this.pdfLoadCallback(pdf, pages);
      });
    }

    // This is the callback function for the PDF renderer when the data has loaded
    pdfLoadCallback(pdf, pages) {



      // Used to resize all of the canvas containers to match the width of the screen
      const resizeCanvasContainers = () => {
        let pages = this.pages;

        const onPageScreenViewPort = (pageNo, viewport) => {
          let container = pages[pageNo - 1].querySelector(".canvascontainer");
          container.style.width = `${viewport.width}px`;
          container.style.height = `${viewport.height}px`;
        };

        for (let i = 0; i &lt; pages.length; i++) {
          this.pdfRenderer.getPageSceenViewPort(this.containerWidth, i + 1, onPageScreenViewPort);
        }
      };

      // Simple optimization that hides pages that are not visible in the client's viewbox
      const isScrolledIntoView = (el) => {
        let elemTop = el.getBoundingClientRect().top;
        let elemBottom = el.getBoundingClientRect().bottom;
        let elemHeight = el.getBoundingClientRect().height;
        let isVisible = (elemTop + elemHeight) >= 0 && (elemBottom - elemHeight) &lt;= window.innerHeight;
        return isVisible;
      };

      // Renders the page with the given page number. If it hasn't been shown before it updates the width and height of the svg annotation layer
      const showPage = (pageNo) => {
        let page = this.content.querySelector(`[page="${pageNo}"]`);
        let pageCanvasContainer = page.querySelector(".canvascontainer");
        let pageText = page.querySelector(".text");

        this.pdfRenderer.showPage(pageNo, pageCanvasContainer, pageText, (pageNo, viewPort) => {

          let page = this.content.querySelector(`[page="${pageNo}"]`);
          if (!page.querySelector("svg").hasAttribute("viewBox")) {
            page.querySelector("svg").setAttribute("viewBox", `0 0 ${viewPort.width} ${viewPort.height}`);
          }
        });
      };

      // Runs through the pages to test which of them are on screen.
      // If a page is offscreen its canvas is removed.
      // If a page appears its canvas is created and the page is rendered.
      const renderVisiblePages = () => {
        var pages = this.pages;
        for (let i = 0; i &lt; pages.length; i++) {
          let pageCanvasContainer = pages[i].querySelector(".canvascontainer");
          if (isScrolledIntoView(pageCanvasContainer)) {
            if (pages[i].querySelector("canvas")) {
              continue;
            }
            showPage(i + 1);
          } else {
            let canvas = pages[i].querySelector("canvas");
            if (canvas) canvas.remove();
          }
        }
      };

      // Setup handling of window resizing, set old window size to -1 to trigger an initial rendering
      // of at least the first pdf page.
      let oldWindowWidth = -1;

      const resize = () => {
        if (oldWindowWidth === this.containerWidth) return;
        resizeCanvasContainers();
        let pages = this.pages;
        for (let i = 0; i &lt; pages.length; i++) {
          let canvas = pages[i].querySelector("canvas");
          if (canvas) canvas.remove();
        }
				
				// render visible pages on next tick
				setTimeout(renderVisiblePages, 0);
        oldWindowWidth = this.containerWidth;
      };

      // general debounced resize
      const debouncedResize = debounce(resize, 250);

      let currentPages = this.pages;
      let firstLoad = false;

      // If its the first time we setup elements for each page
      if (!currentPages || currentPages.length != pages) {
        this.createPageElements(pages);
      }
      this.createAnnotationLayers(pages);

      // Every time the user scrolls we test visibility of pages
      this.content.addEventListener("scroll", debounce(renderVisiblePages, 250));

      // adjust pdf render size on window resize
      window.addEventListener("resize", debouncedResize);

      // react on changes between fullscreen and non-fullscreen mode and adjust pdf render size
      this.paragraph.liveAttribute("class").changed(debouncedResize);
      document.documentElement.liveAttribute("transient-fullscreen").changed(debouncedResize);
    }

    // Creates an element for each page and adds an SVG annotation layer
    createPageElements(pages) {
      let pagesElement = this.content.querySelector('.pages');
      pagesElement.innerHTML = "";
      for (let i = 1; i &lt;= pages; i++) {
        let page = document.createElement("div");
        page.setAttribute("page", i);
        page.setAttribute("class", "page");
        let svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("class", "annotationlayer");
        svg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
        page.appendChild(svg);
        pagesElement.appendChild(page);
      }
    }

    createAnnotationLayers(pages) {
      let annotationLayers = [];
      let textHighlightHandlers = [];
      // We now run through the pages and create a transient canvas container for the individual pages
      // We furthermore setup the SVG annotation layer
      for (let i = 1; i &lt;= pages; i++) {
        let page = this.content.querySelector(`[page="${i}"]`);
        let canvasContainer = document.createElement("transient");
        canvasContainer.setAttribute("class", "canvascontainer");
        page.insertBefore(canvasContainer, page.firstChild);
        annotationLayers[i] = new AnnotationLayer(page.querySelector(".annotationlayer"), 2);
      }
    }
  }

  let liveSelector = document.liveQuerySelectorAll('.paragraph .pdf[data-type="content"]');
  liveSelector.added((content) => {

    // get paragraph to associate it with renderer
    const paragraph = content.closest('.paragraph');

    // only install pdf paragraph wrapper once
    if (!paragraph.pdfParagraphWrapper) {
      paragraph.pdfParagraphWrapper = new PdfParagraphWrapper(paragraph, content);
    }
  });
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" name="PDF Style" data-id="TVM2R7tM" __wid="Jxqhuy6q"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="null" __wid="8cPC6R9D">.pdf[data-type="content"] {
  position: relative;
  background-color: gray;
  min-height: 300px;
}

html[transient-fullscreen="false"] .paragraph.fullscreen > .pdf,
html:not([transient-fullscreen="true"]) .paragraph:not(.fullscreen) > .pdf {
  max-height: 800px;
	overflow: hidden;
	overflow-y: auto;
}

.pages {
  width: 100%;
  height: 100%;
}

.page,
.canvascontainer,
.pdfcanvas {
  width: 100%;
  position: relative;
  display: none;
}

.fullscreen .page,
.fullscreen .canvascontainer,
.fullscreen .pdfcanvas {
  width: 100%;
  position: relative;
  display: inline-block;
}

.fullscreen a.pdfdata {
  display: none !important;
}

.fullscreen .remote-cursor {
  display: none;
}

.pdf[data-type="content"] a.pdfdata {
  text-align: center;
  display: block;
  padding-top: 4em;
  font-size: 24pt;
}

.annotationlayer {
  position: absolute;
  left: 0px;
  top: 0px;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.annotationlayer rect {
  fill: yellow;
}

svg.annotationlayer {
  mix-blend-mode: multiply;
}

.pdf[data-type="content"] .dropzone {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  font-family: monospace;
  font-size: 18px;
  width: 28.5em;
  height: 5em;
  text-align: center;
  border: 2px dashed black;
  border-radius: 4px;
  background-color: transparent;
  padding-top: 3.5em;
}</STYLE></DIV><DIV class="paragraph code-paragraph collapsed" name="Text overlay" data-id="TByVL7dn" __wid="FEXabmpz"><PRE data-type="content" type="text/javascript" id="textoverlay" contenteditable="null" __wid="6FenMmpz">/**
 * Code extracted from pdf.js' viewer.js file. This contains code that is relevant to building the text overlays. I
 * have removed dependencies on viewer.js and viewer.html.
 *
 *   -- Vivin Suresh Paliath (http://vivin.net)
 */

var TextLayerBuilder = function textLayerBuilder(textLayerDiv, pageIdx) {
	var textLayerFrag = document.createDocumentFragment();

	this.textLayerDiv = textLayerDiv;
	this.layoutDone = false;
	this.divContentDone = false;
	this.pageIdx = pageIdx;
	this.matches = [];

	this.beginLayout = function textLayerBuilderBeginLayout() {
		this.textDivs = [];
		this.renderingDone = false;
	};

	this.endLayout = function textLayerBuilderEndLayout() {
		this.layoutDone = true;
		this.insertDivContent();
	};

	this.renderLayer = function textLayerBuilderRenderLayer() {
		var textDivs = this.textDivs;
		var bidiTexts = this.textContent.bidiTexts;
		var textLayerDiv = this.textLayerDiv;
		var canvas = document.createElement('canvas');
		var ctx = canvas.getContext('2d');

		// No point in rendering so many divs as it'd make the browser unusable
		// even after the divs are rendered
		var MAX_TEXT_DIVS_TO_RENDER = 100000;
		if (textDivs.length > MAX_TEXT_DIVS_TO_RENDER)
			return;

		for (var i = 0, ii = textDivs.length; i &lt; ii; i++) {
			var textDiv = textDivs[i];
			if ('isWhitespace' in textDiv.dataset) {
				continue;
			}
			textLayerFrag.appendChild(textDiv);

			ctx.font = textDiv.style.fontSize + ' ' + textDiv.style.fontFamily;
			var width = ctx.measureText(textDiv.textContent).width;

			if (width > 0) {
				var textScale = textDiv.dataset.canvasWidth / width;

				var transform = 'scale(' + textScale + ', 1)';
				if (bidiTexts[i].dir === 'ttb') {
					transform = 'rotate(90deg) ' + transform;
				}
				CustomStyle.setProp('transform', textDiv, transform);
				CustomStyle.setProp('transformOrigin', textDiv, '0% 0%');

				textLayerDiv.appendChild(textDiv);
			}
		}

		this.renderingDone = true;

		textLayerDiv.appendChild(textLayerFrag);
	};

	this.setupRenderLayoutTimer = function textLayerSetupRenderLayoutTimer() {
		// Schedule renderLayout() if user has been scrolling, otherwise
		// run it right away
		var RENDER_DELAY = 200; // in ms
		var self = this;
		//0 was originally PDFView.lastScroll
		if (Date.now() - 0 > RENDER_DELAY) {
			// Render right away
			this.renderLayer();
		} else {
			// Schedule
			if (this.renderTimer)
				clearTimeout(this.renderTimer);
			this.renderTimer = setTimeout(function () {
				self.setupRenderLayoutTimer();
			}, RENDER_DELAY);
		}
	};

	this.appendText = function textLayerBuilderAppendText(geom) {
		var textDiv = document.createElement('div');

		// vScale and hScale already contain the scaling to pixel units
		var fontHeight = geom.fontSize * Math.abs(geom.vScale);
		textDiv.dataset.canvasWidth = geom.canvasWidth * geom.hScale;
		textDiv.dataset.fontName = geom.fontName;

		textDiv.style.fontSize = fontHeight + 'px';
		textDiv.style.fontFamily = geom.fontFamily;
		textDiv.style.left = geom.x + 'px';
		textDiv.style.top = (geom.y - fontHeight) + 'px';

		// The content of the div is set in the `setTextContent` function.

		this.textDivs.push(textDiv);
	};

	this.insertDivContent = function textLayerUpdateTextContent() {
		// Only set the content of the divs once layout has finished, the content
		// for the divs is available and content is not yet set on the divs.
		if (!this.layoutDone || this.divContentDone || !this.textContent)
			return;

		this.divContentDone = true;

		var textDivs = this.textDivs;
		var bidiTexts = this.textContent.bidiTexts;

		for (var i = 0; i &lt; bidiTexts.length; i++) {
			var bidiText = bidiTexts[i];
			var textDiv = textDivs[i];
			if (!/\S/.test(bidiText.str)) {
				textDiv.dataset.isWhitespace = true;
				continue;
			}

			textDiv.textContent = bidiText.str;
			// bidiText.dir may be 'ttb' for vertical texts.
			textDiv.dir = bidiText.dir === 'rtl' ? 'rtl' : 'ltr';
		}

		this.setupRenderLayoutTimer();
	};

	this.setTextContent = function textLayerBuilderSetTextContent(textContent) {
		this.textContent = textContent;
		this.insertDivContent();
	};
};

/**
 * Returns scale factor for the canvas. It makes sense for the HiDPI displays.
 * @return {Object} The object with horizontal (sx) and vertical (sy)
 scales. The scaled property is set to false if scaling is
 not required, true otherwise.
 */
function getOutputScale() {
	var pixelRatio = 'devicePixelRatio' in window ? window.devicePixelRatio : 1;
	return {
		sx: pixelRatio,
		sy: pixelRatio,
		scaled: pixelRatio != 1
	};
}

exports.TextLayerBuilder = TextLayerBuilder;
exports.getOutputScale = getOutputScale;</PRE></DIV><DIV class="paragraph style-paragraph collapsed" name="Text layer" data-id="X6ETh7Kd" __wid="Q5bHKkKU"><STYLE data-type="content" type="text/css" codemirror="true" contenteditable="null" __wid="GANkXYH4">.textLayer {
	position: absolute;
	left: 0;
	top: 0;
	right: 0;
	bottom: 0;
	overflow: hidden;
	opacity: 0.2;
	line-height: 1.0;
}

.textLayer > div {
	color: transparent;
	position: absolute;
	white-space: pre;
	cursor: text;
	-webkit-transform-origin: 0% 0%;
	-moz-transform-origin: 0% 0%;
	-o-transform-origin: 0% 0%;
	-ms-transform-origin: 0% 0%;
	transform-origin: 0% 0%;
}

.textLayer .highlight {
	margin: -1px;
	padding: 1px;

	background-color: rgb(180, 0, 170);
	border-radius: 4px;
}

.textLayer .highlight.begin {
	border-radius: 4px 0px 0px 4px;
}

.textLayer .highlight.end {
	border-radius: 0px 4px 4px 0px;
}

.textLayer .highlight.middle {
	border-radius: 0px;
}

.textLayer .highlight.selected {
	background-color: rgb(0, 100, 0);
}

.textLayer ::selection { background: rgb(0,0,255); }
.textLayer ::-moz-selection { background: rgb(0,0,255); }

.textLayer .endOfContent {
	display: block;
	position: absolute;
	left: 0px;
	top: 100%;
	right: 0px;
	bottom: 0px;
	z-index: -1;
	cursor: default;
	-webkit-user-select: none;
	-ms-user-select: none;
	-moz-user-select: none;
}

.textLayer .endOfContent.active {
	top: 0px;
}</STYLE></DIV></DIV><DIV class="section section-hidden" name="Transformer" data-type="package" data-group="basic" data-id="rEpvSgsq" __wid="VxLfjGLm"><DIV class="paragraph body-paragraph locked collapsed" draggable="false" name="Documentation" data-id="fi4DiaeV" __wid="qtVYWCrE"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="5Wc6K4dU"><H2 __wid="nTgwQjFj">Description</H2><DIV __wid="R83rdB2V">Provides transformation functions and classes (currently used in the "Drawing" package).</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="KDxhWYmz" __wid="fwCn7zmn"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="ikcZbhMj">{
	"version": "1.0",
	"icon": "open_with",
	"description": "Provides transformation functions and classes.",
	"tags": [
		"utility"
	],
	"assets": [],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initital Release"
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/rEpvSgsq-Transformer"
	}
}</PRE></DIV>

<DIV class="paragraph code-paragraph collapsed" draggable="false" name="Number.prototype.toFixedNumber" last-execution-state="success" data-id="8PxQr3XN" __wid="NLumXrci"><PRE data-type="content" type="text/javascript" class="transformer" __wid="wzam59LX">if (!Number.prototype.toFixedNumber) {
  Number.prototype.toFixedNumber = function (x, base) {
    var pow = Math.pow(base || 10, x);
    return +(Math.round(this * pow) / pow);
  };
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Point" data-id="Kesc5XiM" __wid="Hqyu2v3D"><PRE data-type="content" type="text/javascript" class="transformer" __wid="SgqT8ycc">/**
 * A simple point class.
 * 
 * @class Point
 */
class Point {

  /**
   * Creates an instance of Point.
   * 
   * @param {any} x The x value.
   * @param {any} y The y value.
   * 
   * @memberOf Point
   */
  constructor(x, y) {
    this.x = x;
    this.y = y;
  }

  /**
   * Returns the string representation of the point.
   * 
   * @returns The string representation of the point.
   * 
   * @memberOf Point
   */
  toString() {
    return `${Point.name} [x=${this.x},y=${this.y}]`;
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Matrix" data-id="Kny7FsRx" __wid="RjdgW4nE"><PRE data-type="content" type="text/javascript" class="transformer" __wid="WVcfSHLj">/**
 * The matrix class provides convenient functions for affine transformations, e.g., translate, rotate,
 * and scale. It also offers functions like matrix multiplication or creating an inverse matrix.
 * 
 * @class Matrix
 */
class Matrix {

  /**
   * Creates an instance of Matrix. The matrix needs to be a two-dimensional array. The first index will
   * be rows and the second index will be columns. The array needs to be in a n x m format. For example,
   * an array [[1, 2, 3], [4, 5, 6], [7, 8 ,9]] will result in the following matrix:
   * 
   * 1   2   3
   * 4   5   6
   * 7   8   9
   * 
   * @param {any} M A two-dimensional array.
   * 
   * @memberOf Matrix
   */
  constructor(M) {

    if (typeof M === 'undefined' || !Array.isArray(M)) {
      throw new Error(`first parameter needs to be a two-dimensional array`);
    }
    this.matrix = M;
  }

  /**
   * Sets the matrix. The matrix needs to be a two-dimensional array. The first index will be rows and
   * the second index will be columns. The array needs to be in a n x m format.
   * 
   * @memberOf Matrix
   */
  set matrix(matrix) {
    this._matrix = matrix;
    this._rows = matrix.length;
    this._columns = matrix[0].length;
  }

  /**
   * Returns the matrix as a two-dimensional array.
   * 
   * @memberOf Matrix
   */
  get matrix() {
    return this._matrix;
  }

  /**
   * Returns number of rows of matrix.
   * 
   * @readonly
   * 
   * @memberOf Matrix
   */
  get rows() {
    return this._rows;
  }

  /**
   * Returns number of columns of matrix.
   * 
   * @readonly
   * 
   * @memberOf Matrix
   */
  get columns() {
    return this._columns;
  }

  get a() {
    return this.matrix[0][0];
  }

  get b() {
    return this.matrix[1][0];
  }

  get c() {
    return this.matrix[0][1];
  }

  get d() {
    return this.matrix[1][1];
  }

  get tx() {
    return this.matrix[0][2];
  }

  get ty() {
    return this.matrix[1][2];
  }

  get angle() {
    const rad = Math.atan2(this.b, this.a);
    return (rad * 180) / Math.PI;
  }

  get scaleX() {
    return this.a;
  }

  get scaleY() {
    return this.d;
  }

  /**
   * Translates the matrix by tx and ty.
   * 
   * @param {Number} tx The translation value in x.
   * @param {Number} ty The translation value in y.
   * 
   * @memberOf Matrix
   */
  translate(tx, ty, truncate = true) {
    const M = this.multiply(new Matrix([
      [1, 0, tx],
      [0, 1, ty],
      [0, 0, 1],
    ]), truncate).matrix;

    this.matrix = M;
  }

  /**
   * Rotates the matrix by angle. The rotation value has to be in degrees.
   * 
   * @param {Number} angle The rotation value in degrees.
   * 
   * @memberOf Matrix
   */
  rotate(angle, truncate = true) {
    const rad = angle * (Math.PI / 180);
    const costheta = Math.cos(rad);
    const sintheta = Math.sin(rad);

    const M = this.multiply(new Matrix([
      [costheta, -sintheta, 0],
      [sintheta, costheta, 0],
      [0, 0, 1],
    ]), truncate).matrix;

    this.matrix = M;
  }

  /**
   * Scales the matrix by sx and sy.
   * 
   * @param {Number} sx The scale value in x.
   * @param {Number} sy The scale value in y.
   * 
   * @memberOf Matrix
   */
  scale(sx, sy, truncate = true) {
    const M = this.multiply(new Matrix([
      [sx, 0, 0],
      [0, sy, 0],
      [0, 0, 1],
    ]), truncate).matrix;

    this.matrix = M;
  }

  /**
   * Skwes the matrix in degX and degY.
   * 
   * @param {Number} degX The skew value in x in degrees.
   * @param {Number} degY The skew value in y in degrees.
   * 
   * @memberOf Matrix
   */
  skew(degX, degY, truncate = true) {
    const radX = degX * (Math.PI / 180);
    const radY = degY * (Math.PI / 180);
    const x = Math.tan(radX);
    const y = Math.tan(radY);

    const M = this.multiply(new Matrix([
      [1, x, 0],
      [y, 1, 0],
      [0, 0, 1],
    ]), truncate).matrix;

    this.matrix = M;
  }

  /**
   * Multiplies a given matrix with this matrix and returns the result as new matrix instance. In order
   * to perform the matrix multiplication, rows of matrix M1 need to match columns of matrix M2 as well
   * as columns of matrix M1 need to match rows of matrix M2.
   * 
   * @param {any} M The matrix used to multiply with this matrix.
   * @returns The multipied matrix.
   * 
   * @memberOf Matrix
   */
  multiply(M, truncate = true) {

    if (this.rows !== M.columns || this.columns !== M.rows) {
      throw new Error(`cannot multiply because matrix dimensions do not match (n*m !== m*n)`);
    }

    const m = [];
    const m1 = this.matrix;
    const m2 = M.matrix;
    for (let i = 0; i &lt; m1.length; i++) {
      m[i] = [];
      for (let j = 0; j &lt; m2[0].length; j++) {
        let sum = 0;
        for (let k = 0; k &lt; m1[0].length; k++) {
          sum += m1[i][k] * m2[k][j];
        }
        // m[i][j] = sum;
        m[i][j] = truncate ? parseFloat(sum.toFixed(3)) : sum;
      }
    }

    return new Matrix(m);
  }

  /**
   * Multiplies this matrix by the given matrix and replaces this matrix by the resulting matrix.
   * 
   * @param {any} The matrix used to multiply with this matrix.
   * 
   * @memberOf Matrix
   */
  multiplyBy(M) {
    // const m = this.multiply(M).matrix;
    const m = M.multiply(this).matrix;
    this.matrix = m;
  }

  /**
   * Creates a copy of the matrix.
   * 
   * @returns The copy of this matrix.
   * 
   * @memberOf Matrix
   */
  copy() {
    const m = this.matrix;
    const copyM = JSON.parse(JSON.stringify(m));
    return new Matrix(copyM);
  }

  /**
   * Returns the inverse matrix of this matrix.
   * 
   * http://blog.acipo.com/matrix-inversion-in-javascript/
   * 
   * @readonly
   * 
   * @memberOf Matrix
   */
  get inverse() {
    // I use Guassian Elimination to calculate the inverse:
    // (1) 'augment' the matrix (left) by the identity (on the right)
    // (2) Turn the matrix on the left into the identity by elemetry row ops
    // (3) The matrix on the right is the inverse (was the identity matrix)
    // There are 3 elemtary row ops: (I combine b and c in my code)
    // (a) Swap 2 rows
    // (b) Multiply a row by a scalar
    // (c) Add 2 rows

    const M = this.matrix;

    //if the matrix isn't square: exit (error)
    if (M.length !== M[0].length) {
      throw new Error(`matrix is not squared`);
    }

    //create the identity matrix (I), and a copy (C) of the original
    var i = 0,
      ii = 0,
      j = 0,
      dim = M.length,
      e = 0,
      t = 0;
    var I = [],
      C = [];
    for (i = 0; i &lt; dim; i += 1) {
      // Create the row
      I[I.length] = [];
      C[C.length] = [];
      for (j = 0; j &lt; dim; j += 1) {

        //if we're on the diagonal, put a 1 (for identity)
        if (i == j) {
          I[i][j] = 1;
        } else {
          I[i][j] = 0;
        }

        // Also, make the copy of the original
        C[i][j] = M[i][j];
      }
    }

    // Perform elementary row operations
    for (i = 0; i &lt; dim; i += 1) {
      // get the element e on the diagonal
      e = C[i][i];

      // if we have a 0 on the diagonal (we'll need to swap with a lower row)
      if (e == 0) {
        //look through every row below the i'th row
        for (ii = i + 1; ii &lt; dim; ii += 1) {
          //if the ii'th row has a non-0 in the i'th col
          if (C[ii][i] != 0) {
            //it would make the diagonal have a non-0 so swap it
            for (j = 0; j &lt; dim; j++) {
              e = C[i][j]; //temp store i'th row
              C[i][j] = C[ii][j]; //replace i'th row by ii'th
              C[ii][j] = e; //repace ii'th by temp
              e = I[i][j]; //temp store i'th row
              I[i][j] = I[ii][j]; //replace i'th row by ii'th
              I[ii][j] = e; //repace ii'th by temp
            }
            //don't bother checking other rows since we've swapped
            break;
          }
        }
        //get the new diagonal
        e = C[i][i];
        //if it's still 0, not invertable (error)
        if (e == 0) {
          throw new Error(`matrix is not invertable`);
        }
      }

      // Scale this row down by e (so we have a 1 on the diagonal)
      for (j = 0; j &lt; dim; j++) {
        C[i][j] = C[i][j] / e; //apply to original matrix
        I[i][j] = I[i][j] / e; //apply to identity
      }

      // Subtract this row (scaled appropriately for each row) from ALL of
      // the other rows so that there will be 0's in this column in the
      // rows above and below this one
      for (ii = 0; ii &lt; dim; ii++) {
        // Only apply to other rows (we want a 1 on the diagonal)
        if (ii == i) {
          continue;
        }

        // We want to change this element to 0
        e = C[ii][i];

        // Subtract (the row above(or below) scaled by e) from (the
        // current row) but start at the i'th column and assume all the
        // stuff left of diagonal is 0 (which it should be if we made this
        // algorithm correctly)
        for (j = 0; j &lt; dim; j++) {
          C[ii][j] -= e * C[i][j]; //apply to original matrix
          I[ii][j] -= e * I[i][j]; //apply to identity
        }
      }
    }

    //we've done all operations, C should be the identity
    //matrix I should be the inverse:
    return new Matrix(I);
  }

  toJSON() {
    return JSON.stringify(this.matrix);
  }

  static fromJSON(json) {
    const matrix = JSON.parse(json);
    return new Matrix(matrix);
  }

  /**
   * Converts the matrix to a CSS matrix transform. It respects whether the matrix should be a
   * CSS matrix() or CSS matrix3d().
   * 
   * @returns The CSS transform.
   * 
   * @memberOf Matrix
   */
  toCss(fixed = true) {

    const M = this.matrix;

    const getFixedValue = (row, column) => {
      if (fixed) {
        return parseFloat(M[row][column].toFixed(3));
      }
      return M[row][column];
    };

    if (this.rows === 3 && this.columns === 3) {
      if (this.equals(Matrix.identity(3))) {
        return "none";
      }

      const a = getFixedValue(0, 0);
      const b = getFixedValue(1, 0);
      const c = getFixedValue(0, 1);
      const d = getFixedValue(1, 1);
      const tx = getFixedValue(0, 2);
      const ty = getFixedValue(1, 2);

      return `matrix(${a}, ${b}, ${c}, ${d}, ${tx}, ${ty})`;
    }

    if (this.equals(Matrix.identity(4))) {
      return "none";
    }

    const a1 = getFixedValue(0, 0);
    const b1 = getFixedValue(1, 0);
    const c1 = getFixedValue(2, 0);
    const d1 = getFixedValue(3, 0);
    const a2 = getFixedValue(0, 1);
    const b2 = getFixedValue(1, 1);
    const c2 = getFixedValue(2, 1);
    const d2 = getFixedValue(3, 1);
    const a3 = getFixedValue(0, 2);
    const b3 = getFixedValue(1, 2);
    const c3 = getFixedValue(2, 2);
    const d3 = getFixedValue(3, 2);
    const a4 = getFixedValue(0, 3);
    const b4 = getFixedValue(1, 3);
    const c4 = getFixedValue(2, 3);
    const d4 = getFixedValue(3, 3);

    return `matrix3d(${a1}, ${b1}, ${c1}, ${d1}, ${a2}, ${b2}, ${c2}, ${d2}, ${a3}, ${b3}, ${c3}, ${d3}, ${a4}, ${b4}, ${c4}, ${d4})`;
  }

  /**
   * Returns true if matrix M equals to this matrix.
   * 
   * @param {any} M A matrix to compare to.
   * @returns True if this matrix and matrix M are equal.
   * 
   * @memberOf Matrix
   */
  equals(M) {
    return Matrix.equals(this, M);
  }

  /**
   * Returns true if both matrix have the same matrix values, false otherwise.
   * 
   * @static
   * @param {any} M1 Matrix 1.
   * @param {any} M2 Matrix 2.
   * @returns True if matrix M1 and M2 are equal.
   * 
   * @memberOf Matrix
   */
  static equals(M1, M2) {
    return JSON.stringify(M1.matrix) === JSON.stringify(M2.matrix);
  }

  /**
   * Creates an n x n identity matrix.
   * 
   * @static
   * @param {any} n The number of rows and columns to create this n x n identity matrix.
   * @returns The identity matrix.
   * 
   * @memberOf Matrix
   */
  static identity(n) {

    let m = [];
    for (let row = 0; row &lt; n; row++) {
      let mRow = m[row] = [];

      for (let col = 0; col &lt; n; col++) {
        mRow[col] = col === row ? 1 : 0;
      }
    }

    return new Matrix(m);
  }

  /**
   * Creates a matrix from a DOM element (e.g., a HTMLElement or a SVGElement).
   * 
   * @static
   * @param {any} element A DOM element from which the matrix is created from.
   * @returns The matrix.
   * 
   * @memberOf Matrix
   */
  static from(element) {

    let rawTransform = "none";

    if (element instanceof SVGElement) {
      rawTransform = element.getAttribute("transform");

      // SAFARI does not return a proper transform with window.getComputedStyle for SVGElement.
      // TODO This is a nasty workaround.
      if (!rawTransform || rawTransform === "") {
        rawTransform = element.style.transform;
      }
    } else if (element.nodeType === 1) {
      rawTransform = window.getComputedStyle(element).transform;
    }

    if (rawTransform === "" || rawTransform === "none") {
      return Matrix.identity(3);
    } else {
      const regEx = /([-+]?[\d\.]+)/g;

      // console.log('rawTransform %o', rawTransform);

      if (rawTransform.indexOf("matrix3d") > -1) {
        // throw new Error(`matrix3d transformation not yet supported`);

        // https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/matrix3d
        const a1 = parseFloat(regEx.exec(rawTransform)[0]);
        const b1 = parseFloat(regEx.exec(rawTransform)[0]);
        const c1 = parseFloat(regEx.exec(rawTransform)[0]);
        const d1 = parseFloat(regEx.exec(rawTransform)[0]);
        const a2 = parseFloat(regEx.exec(rawTransform)[0]);
        const b2 = parseFloat(regEx.exec(rawTransform)[0]);
        const c2 = parseFloat(regEx.exec(rawTransform)[0]);
        const d2 = parseFloat(regEx.exec(rawTransform)[0]);
        const a3 = parseFloat(regEx.exec(rawTransform)[0]);
        const b3 = parseFloat(regEx.exec(rawTransform)[0]);
        const c3 = parseFloat(regEx.exec(rawTransform)[0]);
        const d3 = parseFloat(regEx.exec(rawTransform)[0]);
        const a4 = parseFloat(regEx.exec(rawTransform)[0]);
        const b4 = parseFloat(regEx.exec(rawTransform)[0]);
        const c4 = parseFloat(regEx.exec(rawTransform)[0]);
        const d4 = parseFloat(regEx.exec(rawTransform)[0]);

        return new Matrix([
          [a1, a2, a3, a4],
          [b1, b2, b3, b4],
          [c1, c2, c3, c4],
          [d1, d2, d3, d4]
        ]);
      } else {

        // https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/matrix
        const a = parseFloat(regEx.exec(rawTransform)[0]);
        const b = parseFloat(regEx.exec(rawTransform)[0]);
        const c = parseFloat(regEx.exec(rawTransform)[0]);
        const d = parseFloat(regEx.exec(rawTransform)[0]);
        const tx = parseFloat(regEx.exec(rawTransform)[0]);
        const ty = parseFloat(regEx.exec(rawTransform)[0]);

        return new Matrix([
          [a, c, tx],
          [b, d, ty],
          [0, 0, 1]
        ]);
      }
    }
  }

  /**
   * Returns the matrix in a human readable format. 
   * 
   * @returns The matrix in string format.
   * 
   * @memberOf Matrix
   */
  toString() {
    return `Matrix [rows=${this.rows},columns=${this.columns},matrix=${JSON.stringify(this.matrix)}]`;
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Transform" data-id="quFaQdBQ" __wid="j4Mz8zjQ"><PRE data-type="content" type="text/javascript" class="transformer" __wid="F4DHKeBq">/**
 * The base class for a transforms.
 * 
 * @class Transform
 */
class Transform {

  /**
   * Creates an instance of Transform. It will create an instance with a default identity matrix.
   * 
   * @memberOf Transform
   */
  constructor() {
    this.matrix = Matrix.identity(3);
    this._centerPoint = new Point(0, 0);
  }

  get centerPoint() {
    return this._centerPoint;
  }

  /**
   * Applies this transform to the matrix given as parameter.
   * 
   * @param {any} matrix The matrix to which this transform will be applied.
   * 
   * @memberOf Transform
   */
  apply(matrix) {
    const centerPointMatrix = Matrix.identity(3);
    centerPointMatrix.translate(this._centerPoint.x, this._centerPoint.y);

    matrix.multiplyBy(centerPointMatrix.inverse);
    matrix.multiplyBy(this.matrix);
    matrix.multiplyBy(centerPointMatrix);
  }

  /**
   * Unapplies this transformation from the matrix given as paramter.
   * 
   * @param {any} matrix The matrix from which this transform will be unapplied.
   * 
   * @memberOf Transform
   */
  unapply(matrix) {
    const centerPointMatrix = Matrix.identity(3);
    centerPointMatrix.translate(this._centerPoint.x, this._centerPoint.y);

    matrix.multiplyBy(centerPointMatrix.inverse);
    // console.log('matrix1 %o', this.matrix.toString());
    matrix.multiplyBy(this.matrix.inverse);
    // console.log('matrix2 %o', this.matrix.toString());
    matrix.multiplyBy(centerPointMatrix);
  }

  get inverse() {
    throw new Error(`inverse not implemented for ${this.constructor.name}`);
  }

  reset() {
    this._centerPoint.x = 0;
    this._centerPoint.y = 0;
  }

  static from(matrix) {
    throw new Error(`inverse not implemented for transform`);
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="TranslateTransform" data-id="vvdD8jr8" __wid="hzaNq3Sf"><PRE data-type="content" type="text/javascript" class="transformer" __wid="wQn9zmGQ">/**
 * The translate transform.
 * 
 * @class TranslateTransform
 * @extends {Transform}
 */
class TranslateTransform extends Transform {

  /**
   * Creates an instance of TranslateTransform. It will translate a matrix by tx and ty.
   * 
   * @param {any} tx The translate value in x.
   * @param {any} ty The translate value in y.
   * 
   * @memberOf TranslateTransform
   */
  constructor(x = 0, y = 0) {
    super();
    this.set(x, y);
  }

  set(x, y) {
    this.x = x;
    this.y = y;

    this.matrix = new Matrix([
      [1, 0, x],
      [0, 1, y],
      [0, 0, 1]
    ]);
  }

  get inverse() {
    return TranslateTransform.from(this.matrix.inverse);
  }

  update(matrix) {

    if (!(matrix instanceof Matrix)) {
      throw new Error(`matrix needs to be of type ${Matrix.name}`);
    }

    const M = matrix;

    // http://math.stackexchange.com/questions/13150/extracting-rotation-scale-values-from-2d-transformation-matrix
    const tx = M.tx;
    const ty = M.ty;

    this.set(tx, ty);
  }

  /**
   * Reset translate transform.
   * 
   * @memberOf TranslateTransform
   */
  reset() {
    this.set(0, 0);
    super.reset();
  }

  static from(matrix) {
    const transform = new TranslateTransform();
    transform.update(matrix);
    return transform;
  }

  toString() {
    return `${this.constructor.name} [x=${this.x},y=${this.y}]`;
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="RotateTransform" data-id="McadRmZp" __wid="MxAv9k43"><PRE data-type="content" type="text/javascript" class="transformer" __wid="kuMzg7uP">/**
 * The rotate transform.
 * 
 * @class RotateTransform
 * @extends {Transform}
 */
class RotateTransform extends Transform {

  /**
   * Creates an instance of RotateTransform. It will rotate a matrix by an angle [in degrees].
   * 
   * @param {any} deg The rotate value in degrees.
   * 
   * @memberOf RotateTransform
   */
  constructor(angle = 0) {
    super();
    this.set(angle);
  }

  set(angle) {
    this.angle = angle;

    const rad = angle * (Math.PI / 180);
    const costheta = Math.cos(rad);
    const sintheta = Math.sin(rad);

    this.matrix = new Matrix([
      [costheta, -sintheta, 0],
      [sintheta, costheta, 0],
      [0, 0, 1]
    ]);
  }

  get inverse() {
    return RotateTransform.from(this.matrix.inverse);
  }

  update(matrix) {

    if (!(matrix instanceof Matrix)) {
      throw new Error(`matrix needs to be of type ${Matrix.name}`);
    }

    const M = matrix;

    // http://math.stackexchange.com/questions/13150/extracting-rotation-scale-values-from-2d-transformation-matrix
    // const psi1 = Math.atan2(-M.b, M.a);
    // const psi2 = Math.atan2(M.c, M.d);

    // if (psi1 !== psi2) {
    //     throw new Error(`matrix error ${psi1} !== ${psi2}`);
    // }

    // const angle = (psi2 * 180) / Math.PI;

    const rad = Math.atan2(M.b, M.a);
    const angle = (rad * 180) / Math.PI;

    this.set(angle);
  }

  /**
   * Reset rotate transform.
   * 
   * @memberOf RotateTransform
   */
  reset() {
    this.set(0);
    super.reset();
  }

  static from(matrix) {
    const transform = new RotateTransform();
    transform.update(matrix);
    return transform;
  }

  toString() {
    return `${this.constructor.name} [angle=${this.angle}]`;
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="ScaleTransform" data-id="GfrFKqKY" __wid="FkvZ77Wd"><PRE data-type="content" type="text/javascript" class="transformer" __wid="au9Zs9Tq">/**
 * The scale transform.
 * 
 * @class ScaleTransform
 * @extends {Transform}
 */
class ScaleTransform extends Transform {

  /**
   * Creates an instance of ScaleTransform. It will scale a matrix by x and y.
   * 
   * @param {any} x The scale factor in x.
   * @param {any} y The scale factor in y.
   * 
   * @memberOf ScaleTransform
   */
  constructor(x = 1.0, y = 1.0) {
    super();
    this.set(x, y);
  }

  set(x, y) {
    this.x = x;
    this.y = y;

    this.matrix = new Matrix([
      [x, 0, 0],
      [0, y, 0],
      [0, 0, 1],
    ]);
  }

  get inverse() {
    return ScaleTransform.from(this.matrix.inverse);
  }

  update(matrix) {

    if (!(matrix instanceof Matrix)) {
      throw new Error(`matrix needs to be of type ${Matrix.name}`);
    }

    const M = matrix;

    // http://math.stackexchange.com/questions/13150/extracting-rotation-scale-values-from-2d-transformation-matrix
    // const sx = Math.sign(M.a) * Math.sqrt(Math.pow(M.a, 2) + Math.pow(M.b, 2));
    // const sy = Math.sign(M.d) * Math.sqrt(Math.pow(M.c, 2) + Math.pow(M.d, 2));

    const sx = Math.sqrt(Math.pow(M.a, 2) + Math.pow(M.b, 2));
    const sy = Math.sqrt(Math.pow(M.c, 2) + Math.pow(M.d, 2));

    this.set(sx, sy);
  }

  /**
   * Reset scale transform.
   * 
   * @memberOf ScaleTransform
   */
  reset() {
    this.set(1, 1);
    super.reset();
  }

  static from(matrix) {
    const transform = new ScaleTransform();
    transform.update(matrix);
    return transform;
  }

  toString() {
    return `${this.constructor.name} [x=${this.x},y=${this.y}]`;
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="TransformOrigin" data-id="BuDXCNxm" __wid="JJ7K5Qgs"><PRE data-type="content" type="text/javascript" class="transformer" __wid="TJGpH9vJ">class TransformOrigin extends Transform {

  constructor(element, ratioX = 0, ratioY = 0) {
    super();

    if (!element) {
      throw new Error(`element is null or undefined`);
    }

    this.element = element;
    this.set(ratioX, ratioY);
  }

  set(ratioX, ratioY) {
    this.ratioX = ratioX;
    this.ratioY = ratioY;
  }


  get inverse() {
    return TransformOrigin.from(this.element, this.matrix.inverse);
  }

  /**
   * Applies this transform to the matrix given as parameter.
   * 
   * @param {any} matrix The matrix to which this transform will be applied.
   * 
   * @memberOf TransformOrigin
   */
  apply(matrix) {

    // TODO Remove if a notifier to property clientWidth/clientHeight change has been
    // attached to element. Until then always reforce calculation of transform origin.
    const x = this.element.clientWidth * this.ratioX;
    const y = this.element.clientHeight * this.ratioY;

    this.matrix = new Matrix([
      [1, 0, x],
      [0, 1, y],
      [0, 0, 1]
    ]);

    super.apply(matrix);
  }

  /**
   * Unapplies this transformation from the matrix given as paramter.
   * 
   * @param {any} matrix The matrix from which this transform will be unapplied.
   * 
   * @memberOf TransformOrigin
   */
  unapply(matrix) {

    // TODO Remove if a notifier to property clientWidth/clientHeight change has been
    // attached to element. Until then always reforce calculation of transform origin.
    const x = this.element.clientWidth * this.ratioX;
    const y = this.element.clientHeight * this.ratioY;

    this.matrix = new Matrix([
      [1, 0, x],
      [0, 1, y],
      [0, 0, 1]
    ]);

    super.unapply(matrix);
  }

  update(matrix) {

    if (!(matrix instanceof Matrix)) {
      throw new Error(`matrix needs to be of type ${Matrix.name}`);
    }

    const M = matrix;

    this.set(M.tx, M.ty);
  }

  /**
   * Reset transform origin.
   * 
   * @memberOf TransformOrigin
   */
  reset() {
    this.set(0, 0);
    super.reset();
  }

  static from(element, matrix) {
    const transform = new TransformOrigin(element);
    transform.update(matrix);
    return transform;
  }

  toString() {
    return `${this.constructor.name} [ratioX=${this.ratioX}, ratioY=${this.ratioY}]`;
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="TransformGroup" data-id="YTfEM79M" __wid="Bi2wXQQq"><PRE data-type="content" type="text/javascript" class="transformer" __wid="aj95Q56T">/**
 * The transform group can hold multiple transform of type TranslateTransform, RotateTransform,
 * ScaleTransform, or even another TransformGroup. When the apply function is called, it will apply all
 * added transform in the exact order in which they have been added to the transform group. The unapply
 * function will unapply all transform in the reverse order in which they have been added to the
 * transform group.
 * 
 * @class TransformGroup
 * @extends {Transform}
 */
class TransformGroup extends Transform {

  /**
   * Creates an instance of TransformGroup.
   * 
   * @memberOf TransformGroup
   */
  constructor() {
    super();

    this.transforms = [];
  }

  /**
   * Add a transform (e.g., TranslateTransform, RotateTransform, or ScaleTransform) to the transform
   * group. All transforms will be applied in the order they were added to the transform group. If a
   * transform group is unapplied, it will unapply all transforms in reverse order.
   * 
   * @param {Transform} transform A transform of type Transform (e.g., TranslateTransform, RotateTransform,
   * or ScaleTransform). Eventually, a TransformGroup can also be added.
   * 
   * @throws {Error} Throws an error if transform is not of type Transform.
   * 
   * @memberOf TransformGroup
   */
  add(transform, inverse = false) {

    // Check if transform is of proper type.
    if (!(transform instanceof Transform)) {
      throw new Error(`transform needs to be of type ${Transform.name}`);
    }

    // Add transform to transforms.
    this.transforms.push({
      inverse,
      transform
    });
  }

  /**
   * Remove a transform from this transform group. The transform has to be part of the transform group,
   * otherwise an error will be thrown.
   * 
   * @param {Transform} transform
   * 
   * @throws {Error} Throws an error if transform is not of type Transform and if transform is not part
   * of transform group.
   * 
   * @memberOf TransformGroup
   */
  remove(transform) {

    // Check if transform is of proper type.
    if (!(transform instanceof Transform)) {
      throw new Error(`transform needs to be of type ${Transform.name}`);
    }

    // Check if transform is part of transform group.
    if (!this.transforms.contains(transform)) {
      throw new Error(`transform is not part of this transform group`);
    }

    // Remove transform from transform group.
    const idx = this.transforms.indexOf(transform);
    this.transforms.splice(idx, 1);
  }

  /**
   * Applies all transforms in the order in which they have been added to this transform group. The
   * TransformGroup#apply function is specified in Transform ({@see Transform#apply}).
   * 
   * @param {any} matrix The matrix to which transforms are applied.
   * 
   * @memberOf TransformGroup
   */
  apply(matrix, type = null) {

    // Apply each transform to the matrix.
    this.transforms.forEach(({
      transform,
      inverse
    }) => {
      if (type && !(transform instanceof type) && !(transform instanceof TransformGroup)) {
        return;
      }
      // console.log('apply inverse=%o transform=%o', inverse, transform.toString());
      inverse ? transform.unapply(matrix, type) : transform.apply(matrix, type);
    });
  }

  /**
   * Unapplies all transforms in reverse order in which they have been added to this transform group. The
   * TransformGroup#unapply function is specified in Transform ({@see Transform#unapply}).
   * 
   * @param {any} matrix The matrix from which the transforms are unapplied.
   * 
   * @memberOf TransformGroup
   */
  unapply(matrix, type = null) {

    // Unapply each transform from the matrix in reverse order.
    this.transforms.slice().reverse().forEach(({
      transform,
      inverse
    }) => {
      if (type && !(transform instanceof type) && !(transform instanceof TransformGroup)) {
        return;
      }
      // console.log('unapply inverse=%o transform=%o', inverse, transform.toString());
      inverse ? transform.apply(matrix, type) : transform.unapply(matrix, type);
    });
  }

  /**
   * Reset transform group.
   * 
   * @memberOf TransformGroup
   */
  reset() {
    this.transforms.forEach(({
      transform
    }) => {
      transform.reset();
    });
  }

  /**
   * Transform group to string.
   * 
   * @returns Transform group in string representation.
   * 
   * @memberOf TransformGroup
   */
  toString() {
    return `${this.constructor.name} [transforms=[${this.transforms.map(({transform, inverse}) => {
			return inverse ? transform.inverse.toString() : transform.toString();
		}).join(", ")}]]`;
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" draggable="false" name="Transformer" data-id="GNzZwswn" __wid="kAwzMVGi"><PRE data-type="content" type="text/javascript" class="transformer" __wid="krTn7sHc">// Module object holding private variables.
const module = {};

(function () {

  const observerOptions = {
    attributes: true,
    subtree: true,
    attributeFilter: ['style']
  };

  const observer = new MutationObserver((mutations) => {

    mutations.forEach(mutation => {
      switch (mutation.type) {
      case "attributes":
        const target = mutation.target;
        if (target.transformer) {
					// check if transform property in style attribute changed
					let transformer = target.transformer;
					
					// only update if no update is in progress (update only happens on requestAnimationFrame)
					// and if current element matrix is different from transformer's current element matrix
					if (
						!transformer.updateInProgress &&
// 						target.style.transform !== transformer.elementMatrix.toCss()
						!Matrix.from(target).equals(transformer.elementMatrix)
					) {
						target.transformer.refreshTransforms();
					}
        }
        break;
      }
    });
  });

  let isConnected = false;

  module.connectObserver = function () {
    if (!isConnected) {
      observer.observe(document.body, observerOptions);
      isConnected = true;
    }
  };

  module.disconnectObserver = function () {
    if (isConnected) {
      observer.disconnect();
      isConnected = false;
    }
  };

  // Listening for DOM changes on style element.
  module.connectObserver();
})();

/**
 * The transform stack builds the base object responsible for transforming a DOM element. It takes an
 * element as constructor parameter and binds itself to this element. The transform stack allows push
 * and pop of transforms. A transform is immediately applied on the element and poping will immediately
 * unapply the transform from the element.
 * 
 * @class Transformer
 */
class Transformer {

  /**
   * Creates an instance of Transformer. It takes a DOM element as contstructor parameter to which
   * this transform stack will bind itself. The transform stack will receive the elements current 
   * transform as matrix, which will be used to apply transforms.
   * 
   * @param {any} element A DOM element to which transforms will be applied. 
   * 
   * @memberOf Transformer
   */
  constructor(element, callback, debug = false) {

    // Element needs to be in DOM to get its clientWidth and clientHeight.
    if (!element.parentElement) {
      throw new Error(`Element has no parent element. Is the element in the DOM?`);
    }

    // Check if callback is set and if it is a function.
    if (callback && typeof callback !== "function") {
      throw new Error(`callback needs to be a function`);
    }

    this.element = element;
    this.element.transformer = this;
    this.callback = callback;
    this.updateInProgress = false;

    let matrix = this.getTransformMatrix();

    // this._transformOrigin = new TransformOrigin(element);
    this._scaleTransform = ScaleTransform.from(matrix);
    this._rotateTransform = RotateTransform.from(matrix);
    this._translateTransform = TranslateTransform.from(matrix);

    const transformGroup = new TransformGroup();
    transformGroup.add(this._rotateTransform);
    transformGroup.add(this._scaleTransform);
    transformGroup.add(this._translateTransform);

    this._transforms = transformGroup;

    // Listen for Webstrates updates.
    // this.listenForUpdates();

    if (debug) {

      let visualTransformOrigin = this.element.querySelector(':scope > .transform-origin-point');

      if (!visualTransformOrigin) {
        // Create visual transform origin
        visualTransformOrigin = document.createElement("transient");
        visualTransformOrigin.setAttribute("class", "transform-origin-point");
        element.appendChild(visualTransformOrigin);
      }

      // const _transformOriginSet = this.transformOrigin.set;
      // this.transformOrigin.set = function(x, y) {
      //     visualTransformOrigin.style.zIndex = "99999";
      //     visualTransformOrigin.style.position = `absolute`;
      //     visualTransformOrigin.style.left = `${x * 100}%`;
      //     visualTransformOrigin.style.top = `${y * 100}%`;
      //     visualTransformOrigin.style.transform = `translate(-50%, -50%)`;
      //     _transformOriginSet.apply(this, arguments);
      // }
    }
  }

  /**
   * Get transform matrix from element transform.
   * 
   * @returns Element transform matrix.
   * 
   * @memberOf Transformer
   */
  getTransformMatrix() {
    return Matrix.from(this.element);
  }

  /**
   * Refresh transfroms from element transform.
   * 
   * @memberOf Transformer
   */
  refreshTransforms() {
    const matrix = this.getTransformMatrix();
    this._translateTransform.update(matrix);
    this._rotateTransform.update(matrix);
    this._scaleTransform.update(matrix);
  }

  /**
   * Reapplies all transforms again. This function should be used when any of the transforms in the transform
   * chain changed.
   * 
   * @memberOf TransformStack
   */
  reapplyTransforms(updateElementsTransform = true) {
    let matrix = Matrix.identity(3);

    if (this.element.renderTransform) {
      this.element.renderTransform.apply(matrix);
    }
    this._transforms.apply(matrix);

    this.elementMatrix = matrix;

    if (updateElementsTransform) {
      // Update element transform.
      return this.updateElement();
    } else {
      return new Promise((resolve, reject) => {
        resolve();
      });
    }
  }

  /**
   * Merge render transform to main transform and reset
   * render transform on success.
   * 
   * @memberOf Transformer
   */
  complete() {
    if (this.element.renderTransform) {
      this.refreshTransforms();
      this.element.renderTransform.reset();
    }
  }

  /**
   * Updates the element's transform matrix.
   * 
   * @returns A promise resolved when element updated successfully.
   * 
   * @memberOf TransformStack
   */
  updateElement() {

    return new Promise((resolve, reject) => {

      if (this.updateInProgress) {
        // reject(`update already in progress`);
        // resolve(this.elementMatrix);
        return;
      }

      window.requestAnimationFrame(() => {

        const updateElementTransform = () => {
          let elementTransform = this.elementMatrix.toCss();
          this.setCssTransform(elementTransform);
        };

        if (this.callback) {
          if (this.callback.call(this, this.elementMatrix)) {
            updateElementTransform();
          }
        } else {
          updateElementTransform();
        }

        this.updateInProgress = false;

        resolve(this.elementMatrix);
      });

      this.updateInProgress = true;
    });
  }

  /**
   * Sets the element's transform also compensating for various vendor prefixes.
   * 
   * @param {any} cssTansform The CSS transform.
   * 
   * @memberOf TransformStack
   */
  setCssTransform(cssTransform) {

    // Stop listening for DOM changes on style element.
    module.disconnectObserver();
		
		// Make sure the element is positioned absolute and its origin is at point (0, 0, 0).
		this.element.style.position = "absolute";
		this.element.style.transformOrigin = "0 0 0";

    if (this.element instanceof SVGElement) {
      cssTransform === "none" ? this.element.removeAttribute("transform") : this.element.setAttribute("transform", cssTransform);
    } else if (this.element.nodeType === 1) {
      this.element.style.webkitTransform = cssTransform;
      this.element.style.mozTransform = cssTransform;
      this.element.style.msTransform = cssTransform;
      this.element.style.oTransform = cssTransform;
      this.element.style.transform = cssTransform;
    }

    // Listening for DOM changes on style element.
    module.connectObserver();
  }

  /**
   * tbd.
   * 
   * @returns
   * 
   * @memberOf Transformer
   */
  getTransformHierarchy() {
    const allTransformers = [];

    // Also collect transforms of parents.
    let parent = this.element;
    do {
      if (parent.transformer) {
        allTransformers.push({
          transformer: parent.transformer,
          renderTransform: parent.renderTransform
        });
      }
    }
    while ((parent = parent.parentElement) !== null);

    // Reverse transform order to start with root transform.
    allTransformers.reverse();

    return allTransformers;
  }

  /**
   * tbd.
   * 
   * @returns
   *
   * @memberOf Transformer
   */
  getAncesterElementWithoutTransformer() {
    let parent = this.element;
    do {
      if (!parent.transformer) {
        return parent;
      }
    }
    while ((parent = parent.parentElement) !== null);

    return window.document.body;
  }

  /**
   * tbd.
   * 
   * @param {any} m
   * 
   * @memberOf Transformer
   */
  applyToLocalTransform(m, type = null) {
    this._transforms.apply(m, type);

    if (this.element.renderTransform) {
      this.element.renderTransform.apply(m, type);
    }
  }

  /**
   * tbd.
   * 
   * @param {any} m
   * 
   * @memberOf Transformer
   */
  applyToGlobalTransform(m, type = null) {
    const allTransformers = this.getTransformHierarchy();

    allTransformers.forEach(({
      transformer,
      renderTransform
    }) => {

      // Undo main transforms.
      if (transformer) {
        transformer._transforms.unapply(m, type);
      }

      // Undo render transforms.
      if (renderTransform) {
        renderTransform.unapply(m, type);
      }
    });
  }

  /**
   * tbd.
   * 
   * @param {any} m
   * 
   * @memberOf Transformer
   */
  unapplyFromGlobalTransform(m, type = null) {
    const allTransformers = this.getTransformHierarchy();

    allTransformers.forEach(({
      transformer,
      renderTransform
    }) => {

      // Apply render transforms.
      if (renderTransform) {
        renderTransform.apply(m, type);
      }

      // Apply main transforms.
      if (transformer) {
        transformer._transforms.apply(m, type);
      }
    });
  }

  /**
   * Converts a point from global coordinates to local coordinates.
   * 
   * @param {Point} point The point with global x- and y-coordinates.
   * @returns The point with local x- and y-coordinates.
   * 
   * @memberOf TransformStack
   */
  fromGlobalToLocal(point) {

    if (!(point instanceof Point)) {
      throw new Error(`point needs to be of instance ${Point.name}`);
    }

    // adjust x and y according to ancestor element offset
    let ancestor = this.getAncesterElementWithoutTransformer();
    let {
      left,
      top
    } = ancestor.getBoundingClientRect();
    let x = left ? point.x - left : point.x;
    let y = top ? point.y - top : point.y;

    let m = Matrix.identity(3);
    m.translate(x, y);

    this.applyToGlobalTransform(m);

    return new Point(m.tx, m.ty);
  }

  /**
   * Converts a point from local coordinates to global coordinates.
   * 
   * @param {any} point The point with local x- and y-coordinates.
   * @returns The point with global x- and y-coordinates.
   * 
   * @memberOf TransformStack
   */
  fromLocalToGlobal(point) {
		
    if (!(point instanceof Point)) {
      throw new Error(`point needs to be of instance ${Point.name}`);
    }

    let m = Matrix.identity(3);
    m.translate(point.x, point.y);

    this.unapplyFromGlobalTransform(m);
		
		// adjust x and y according to ancestor element offset
    let ancestor = this.getAncesterElementWithoutTransformer();
    let {
      left,
      top
    } = ancestor.getBoundingClientRect();
    let x = left ? m.tx + left : m.tx;
    let y = top ? m.ty + top : m.ty;

    return new Point(x, y);
  }

  /**
   * Converts a delta point from global coordinates to local coordinates.
   * 
   * @param {any} point The delta point with global x- and y-coordinates.
   * @returns The delta point with local x- and y-coordinates.
   * 
   * @memberOf TransformStack
   * 
   * @see TransformStack#fromGlobalToLocal
   */
  fromGlobalToLocalDelta(deltaPoint) {

    if (!(deltaPoint instanceof Point)) {
      throw new Error(`delta point needs to be of instance ${Point.name}`);
    }

    const allTransforms = this.getTransformHierarchy();

    let m = Matrix.identity(3);
    m.translate(deltaPoint.x, deltaPoint.y);

    allTransforms.forEach(({
      transformer,
      renderTransform
    }) => {

      // Undo main transforms.
      if (transformer) {
        transformer._transforms.unapply(m, ScaleTransform);
        transformer._transforms.unapply(m, RotateTransform);
      }
    });

    return new Point(m.tx, m.ty);
  }

  /**
   * tbd.
   * 
   * @readonly
   * 
   * @memberOf Transformer
   */
  get localRotation() {
    let m = Matrix.identity(3);
    this.applyToLocalTransform(m, RotateTransform);
    return m.angle;
  }

  /**
   * tbd.
   * 
   * @readonly
   * 
   * @memberOf Transformer
   */
  get globalRotation() {
    let m = Matrix.identity(3);
    this.applyToGlobalTransform(m, RotateTransform);
    return m.angle;
  }

  /**
   * tbd.
   * 
   * @readonly
   * 
   * @memberOf Transformer
   */
  get localScale() {
    let m = Matrix.identity(3);
    this.applyToLocalTransform(m, ScaleTransform);
    return new Point(m.scaleX, m.scaleY);
  }

  /**
   * tbd.
   * 
   * @readonly
   * 
   * @memberOf Transformer
   */
  get globalScale() {
    let m = Matrix.identity(3);
    this.applyToGlobalTransform(m, ScaleTransform);
    return new Point(m.scaleX, m.scaleY);
  }

  /**
   * tbd.
   * 
   * @readonly
   * 
   * @memberOf Transformer
   */
  get globalScaleTest() {
    let m = Matrix.identity(3);
    m.scale(1, 1);

    const allTransformers = [];

    // Also collect transforms of parents.
    let parent = this.element;
    do {
      if (parent.transformer) {
        allTransformers.push({
          transformer: parent.transformer,
          renderTransform: parent.renderTransform
        });
      }
    }
    while ((parent = parent.parentElement) !== null);

    // Apply all transforms in reverse order.
    allTransformers.reverse().forEach(({
      transformer,
      renderTransform
    }) => {

      // Undo main transforms.
      if (transformer) {
        transformer._transforms.apply(m, ScaleTransform);
      }

      // Undo render transforms.
      if (renderTransform) {
        renderTransform.apply(m, ScaleTransform);
      }
    });

    const scaleX = m.a;
    const scaleY = m.d;

    return new Point(scaleX, scaleY);
  }

  /**
   * tbd.
   * 
   * @memberOf Transformer
   */
  destroy() {
    delete this._scaleTransform;
    delete this._rotateTransform;
    delete this._translateTransform;
    delete this._transforms;
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Transformer Export" data-id="NbE5yABd" __wid="ug6cgbWk"><PRE data-type="content" type="text/javascript" class="transformer" __wid="ZGDTr4iU">// Export the transform classes to window.Transformer.
exports.Transformer = {
	Point,
	Matrix,
	TranslateTransform,
	RotateTransform,
	ScaleTransform,
	TransformGroup,
	bindElement: (element, callback, debug) => {

		// check for Promise support
		if (!Promise) {
			throw new Error(`The Transformer library requires Promise support`);
		}

		return new Promise((resolve, reject) => {

			if (element.transformer) {
				return resolve(element.transformer);
			}

			const oldVisbilityValue = element.style.visibility;
			// element.style.visibility = "hidden";

			const makeStack = () => {
				const transformer = new Transformer(element, callback, debug);

				(async() => {
					await transformer.reapplyTransforms();
					resolve(transformer);
				})();
			};

			let runs = 60 * 5; // ca. 5 seconds
			function waitFor() {
				--runs;

				if (runs > 0 && (element.offsetWidth === 0 || element.offsetHeight === 0)) {
					return window.requestAnimationFrame(waitFor);
				}

				if (runs &lt;= 0) {
					console.warn(`could not identify element size width=${element.offsetWidth}, height=${element.offsetHeight}`);
				}
				makeStack();
			}
			waitFor();
		});
	}
};</PRE></DIV></DIV><DIV class="section section-hidden" name="Canvas" data-type="package" data-group="basic" data-id="Kw6McUkB" __wid="zNbrBHpn"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="34EydchL" __wid="yBjpD63C"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="EZTDJybK"><H2 __wid="uP425yXX">Description</H2><DIV __wid="CApdfqty">Add drawing capabililties to body paragraphs and slides. Latter requires the presentation package.</DIV><DIV __wid="yDnvf7pR">The Canvas Mutation Observer code paragraph is run-on-load and observes the codestrate for body paragraphs that have the class canvas. A body paragraph will be upgraded in a canvas when the canvas class is set; and downgraded when the canvas class is removed.<BR __wid="5Qb7dHY2"/></DIV><DIV __wid="y7NkFFa4">The Pen Tips code paragraph implements a felt pen algorithm that generates felt-pen-like stroke paths.<BR __wid="GR2bqAx4"/></DIV><DIV __wid="h4MqS5YZ">The Canvas code paragraph modifies a body paragraph of class canvas to allow whiteboard-like drawing. Therefore, it adds a SVG element to the body paragraph, if it does not exist. It further adds event listeners to the body paragraph to listen for pen and eraser events. Currently these events are hard-coded, but may be dynamically assignable by the user. On pen down event, it generates a path and on pen move it generates a stroke based on the pen points. On eraser move events, it checks for intersections of the eraser movement and path elements in the SVG element. If the eraser movement and a path element intersect, the path element will be removed.<BR __wid="L4NuWNBw"/></DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="MqSH2XDP" __wid="tNjJJ2eG"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="QKYgtBL3">{
  "version": "1.3.11",
  "icon": "filter_frames",
  "description": "Add drawing capabililties to body paragraphs and slides. Latter requires the presentation package.",
  "tags": [
    "tools",
    "body paragraphs"
  ],
  "assets": [
    "quadtree.js"
  ],
  "dependencies": [
    {
      "id": "rEpvSgsq",
      "name": "Transformer"
    }
  ],
  "changelog": {
    "1.0": "Initital Release",
    "1.1": "Snackbar and Toolbar integration.",
    "1.2": "Update offset on transient-fullscreen.",
    "1.2.1": "Canvas works with presentation package. Add `canvas` class to `slide-content` element.",
    "1.2.2": "Added workaround to make Drawing package work with Presentation package.",
    "1.2.3": "Cleanup remaining tool-palettes before creating new ones.",
    "1.2.4": "Deactivated snackbar button and added 'hide-palette' style.",
    "1.2.5": "Used Commands API.",
    "1.3": "Renamed package to Canvas",
    "1.3.1": "Added context menu to canvas",
    "1.3.2": "Added option to set user specific colors. These colors are stored in anywhere cookies.",
    "1.3.3": "Fixed canvas re-calculating offset when scrolling.",
    "1.3.4": "Dispose event listeners of canvas",
    "1.3.5": "More adjustment of styles when no .canvas class is present",
    "1.3.6": "Dispose context menu",
    "1.3.7": "Adapted to changes in context menu",
    "1.3.8": "Adapted to changes in context menu",
    "1.3.9": "Fixed style for .canvas class not present, but svg.drawing-canvas still render correctly.",
    "1.3.10": "Fixed persistent styles.",
    "1.3.11": "Added quadtree asset entry."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/Kw6McUkB-Canvas"
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="PdL3KBDn" name="Disable attribute value diffing" run-on-load="true" last-execution-state="success" __wid="FMmjMnah"><PRE data-type="content" type="text/javascript" __wid="AUCQwEaz">// turn of attribute value diffing in order for transformer.js to work correctly
// THIS IS IMPORTANT, DO NOT REMOVE
webstrate.config.attributeValueDiffing = false;</PRE></DIV>

<DIV class="paragraph code-paragraph collapsed" data-id="FvMhPSqc" name="Canvas Context Menu" __wid="u2vkmiuC"><PRE data-type="content" type="text/javascript" id="canvas-context-menu" __wid="Phccb7a7">let menuItems = [];

exports.setItems = (items) => {
  menuItems = items;
};

exports.addItem = (item) => {
  menuItems.push(item);
};

exports.getItems = () => {
  return menuItems;
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Canvas Mutation Observer" last-execution-state="success" run-on-load="true" data-id="Bt6rHkFc" __wid="XNXJiczp">
        <PRE data-type="content" type="text/javascript" __wid="NJ8NXEzY">importLib([
  "quadtree.js"
]).then(() => {
  const { Canvas } = require('#canvas');
  const { ToolPalette, ColorTool } = require('#canvas-instruments');
  const CanvasConfig = require('#canvas-config');
  const ContextMenuManager = require('#context-menu-manager');
  const CanvasContextMenu = require('#canvas-context-menu');

  const createInstruments = (target) => {
    if (!target.__canvas) {

      // Remove remaining tool-palettes
      const palettes = Array.from(target.querySelectorAll(":scope > transient.tool-palette"));
      if (palettes && palettes.length > 0) {
        palettes.forEach(palette => palette.remove());
      }

      const canvas = new Canvas(target);
      const toolPalette = new ToolPalette(target);
      const colorTool = new ColorTool("color", {
        colors: CanvasConfig.ColorTool.colors
      });
      colorTool.on("change", (event) => {
        if (event.type === "color") {
          canvas.penColor = event.value;
        }
      });
      toolPalette.addTool(colorTool);

      // add context menu to canvas
      const paragraph = target.closest('.paragraph');
      const contextMenuManager = ContextMenuManager.register(paragraph,
                                                             target,
                                                             CanvasContextMenu.getItems, { target });

      target.__canvas = {
        destroy() {
          contextMenuManager.destroy();
          toolPalette.destroy();
          canvas.destroy();

          delete target.__canvas;
        }
      };
    }
  };

  const destroyInstruments = (target) => {
    if (target.__canvas) {
      target.__canvas.destroy();
    }
  };

  document.liveQuerySelectorAll('.paragraph.body-paragraph .canvas')
    .added(createInstruments)
    .removed(destroyInstruments);

  let canvasSelector = document.liveQuerySelectorAll('.paragraph.body-paragraph [data-type="content"],.paragraph.body-paragraph .slide-content');
  canvasSelector.added(target => {
    target.liveAttribute("class").changed(() => {

      if (target.matches('.canvas')) {
        createInstruments(target);
      } else {
        destroyInstruments(target);
      }
    });
  });
});</PRE>
      </DIV><DIV class="paragraph code-paragraph collapsed" data-id="tY9jcMdv" name="Canvas Config" __wid="xSyhr49t"><PRE data-type="content" type="text/javascript" id="canvas-config" __wid="giKTcNMc">let localColors = ["black", "red", "green", "blue"];

exports.ColorTool = {
  get colors() {
    if (webstrate.user && webstrate.user.cookies) {
      return webstrate.user.cookies.anywhere.get("codestrate.canvas.colorTool.colors") || localColors;
    }
    return localColors;
  },

  set colors(value) {
    if (webstrate.user && webstrate.user.cookies) {
      webstrate.user.cookies.anywhere.set("codestrate.canvas.colorTool.colors", value);
    } else {
      console.warn('setting colors temporarily because user is not logged in');
      localColors = value;
    }
  }
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Pen Tips" data-id="DaKNkN4T" __wid="nHLgAQxZ">
        <PRE data-type="content" type="text/javascript" id="pen-tips" __wid="PitgNtmy">/**
 * Calculates the mid-point between the two points A and B and then returns
 * the mid-point.
 *
 * @param {any} pointA The point A.
 * @param {any} pointB The point B.
 * @returns The mid-point between point A and point B.
 */
const midPointBetween = (pointA, pointB) => {
	return {
		x: pointA.x + (pointB.x - pointA.x) / 2,
		y: pointA.y + (pointB.y - pointA.y) / 2
	};
};

exports.FeltPen = {

	/**
   * Generates a path with regard to thickness of each point in path. This
   * implementation was done by @clemens.
   *
   * @param {any} points Path points with x- and y-position and a thickness per
   * point.
   * @returns The path as string.
   */
	generateD: (points, pressureFactor) => {

		const newPoints = [];
		newPoints.push(points[0]);

		for (let j = 1; j &lt; points.length - 1; j++) {
			let p1 = points[j - 1];
			let p = points[j];
			let p2 = points[j + 1];
			let c = {
				x: p2.x - p1.x,
				y: p2.y - p1.y
			};
			let n = {
				x: -c.y,
				y: c.x
			};
			let len = Math.sqrt(n.x * n.x + n.y * n.y);
			if (len === 0) continue;
			let u = {
				x: n.x / len,
				y: n.y / len
			};

			let thickness = p.pressure * pressureFactor;

			newPoints.push({
				x: p.x + u.x * thickness,
				y: p.y + u.y * thickness
			});
		}
		newPoints.push(points[points.length - 1]);

		for (let j = points.length - 2; j > 0; j--) {
			let p1 = points[j + 1];
			let p = points[j];
			let p2 = points[j - 1];
			let c = {
				x: p2.x - p1.x,
				y: p2.y - p1.y
			};
			let n = {
				x: -c.y,
				y: c.x
			};
			let len = Math.sqrt(n.x * n.x + n.y * n.y);
			if (len === 0) continue;
			let u = {
				x: n.x / len,
				y: n.y / len
			};

			let thickness = p.pressure * pressureFactor;

			newPoints.push({
				x: p.x + u.x * thickness,
				y: p.y + u.y * thickness
			});
		}
		let p1 = newPoints[0];
		let p2 = newPoints[1];
		let pathString = "M" + p1.x + " " + p1.y;
		for (let j = 1; j &lt; newPoints.length; j++) {
			let midPoint = midPointBetween(p1, p2);
			if (isNaN(p1.x) || isNaN(p1.y) || isNaN(midPoint.x) || isNaN(midPoint.y)) {
				console.log("NaN");
			}
			pathString = pathString += " Q " + p1.x + " " + p1.y + " " + midPoint.x + " " + midPoint.y;
			p1 = newPoints[j];
			p2 = newPoints[j + 1];
		}

		return pathString;
	}
};</PRE>
      </DIV><DIV class="paragraph code-paragraph collapsed" name="Canvas" data-id="NqCrNXKW" __wid="hNkWZGCX">
        <PRE data-type="content" type="text/javascript" id="canvas" __wid="ZyHJmVQ9">const EventUtils = require('#event-utils');
const {
  Transformer
} = require('.transformer');
const {
  Pen
} = require('#pen');
const EraserUtils = require('#eraser-utils');
const svgNS = "http://www.w3.org/2000/svg";

const DEFAULT_OPTIONS = {
  isElementsIndexEnabled: true,
  isAllowedPenEvent: [
    // Pen event
    (event) => {
      if (event.pointerType === "pen") {
        event.preventDefault();
        return true;
      }
      return false;
    },
    // ctrl+mouse event
    (event) => {
      if (event.shiftKey && event.pointerType === "mouse") {
        event.preventDefault();
        return true;
      }
      return false;
    }
  ],
  isAllowedEraserEvent: [
    // touch event
    (event) => {
      if (event.pointerType === "touch") {
        event.preventDefault();
        return true;
      }
      return false;
    },
    // alt+mouse event
    (event) => {
      if (event.altKey && event.pointerType === "mouse") {
        event.preventDefault();
        return true;
      }
      return false;
    }
  ],
  correctPoint: (point) => {
    return point;
  }
};

exports.Canvas = class Canvas {

  constructor(target, options = {}) {
    this.target = target;
    this._disposables = [];

    // Merge options with default options
    this.options = Object.assign({}, DEFAULT_OPTIONS, options);

    this.penColor = "black";
    this.tools = {};

    this.target.liveQuerySelectorAll('svg').added((svg) => {

      // Only initialize elements index for svg of this canvas
      if (svg.parentElement === this.target) {
        // Initialize elements index if enabled, but not initialized
        if (this.options.isElementsIndexEnabled && !this._elementsIndex) {
          this._initElementsIndex(svg);
        }
      }
    }).removed((svg) => {
      // Only clear element index for svg of this canvas
      if (svg.parentElement === this.target && this._elementsIndex) {
        try {
          this._elementsIndex.clear();
          this._elementsIndex = null;
        } catch (error) {
          console.warn(`error when svg element removed ${error}`);
        }
      }
    });

    const calculateOffset = () => {
      this.offset = this.target.getBoundingClientRect();
    };
    calculateOffset();

    // debounce the flood of scroll events, and only fire after 150ms event
    // stopped firing
    let disposable = window.addDisposableEventListener("scroll", EventUtils.debounce(calculateOffset, 150), true);
    this._disposables.push(disposable);

    // Also update offset on class change, e.g., fullscreen change
    let paragraph = target.closest('.paragraph');
    paragraph.liveAttribute("class").changed(() => {
      this.offset = this.target.getBoundingClientRect();
    });

    paragraph.liveAttribute("transient-fullscreen").changed(() => {
      this.offset = this.target.getBoundingClientRect();
    });

    // In case the canvas transitions
    disposable = this.target.addDisposableEventListener("transitionend", (e) => {
      this.offset = this.target.getBoundingClientRect();
    });
    this._disposables.push(disposable);

    if (!!window.PointerEvent) {

      let disposable = this.target.addDisposableEventListener("pointerdown", (e) => this._onPointerDown(e));
      this._disposables.push(disposable);
      
      disposable = this.target.addDisposableEventListener("pointermove", (e) => this._onPointerMove(e));
      this._disposables.push(disposable);
      
      disposable = this.target.addDisposableEventListener("pointerup", (e) => this._onPointerUp(e));
      this._disposables.push(disposable);

      // Enabling to draw on canvas by entering it
      disposable = this.target.addDisposableEventListener("pointerover", (e) => {
        // On any button down
        if (e.buttons > 0) {
          this._onPointerDown(e);
        }
      });
      this._disposables.push(disposable);

      // Stop drawing on canvas when leaving it
      disposable = this.target.addDisposableEventListener("pointerout", (e) => {
        // On any button down
        if (e.buttons > 0) {
          this._onPointerUp(e);
        }
      });
      this._disposables.push(disposable);
    } else {
      let disposable = this.target.addDisposableEventListener("touchstart", (e) => {
        this._dispatchTouchEvent(e, this._onPointerDown);
      });
      this._disposables.push(disposable);
      
      disposable = this.target.addDisposableEventListener("touchmove", (e) => {
        this._dispatchTouchEvent(e, this._onPointerMove);
      });
      this._disposables.push(disposable);
      
      disposable = this.target.addDisposableEventListener("touchend", (e) => {
        this._dispatchTouchEvent(e, this._onPointerUp);
      });
      this._disposables.push(disposable);
    }
  }

  /**
   * Upgrade touch events with pointer event properties
   */
  _dispatchTouchEvent(event, dispatch) {
    Array.prototype.forEach.call(event.changedTouches, touch => {
      touch.pointerId = touch.identifier + 2;
      touch.pressure = (touch.force && touch.force > 0.1 ? touch.force : 0) * 2;
      touch.preventDefault = function () {
        event.preventDefault();
      };
      touch.stopPropagation = function () {
        event.stopPropagation();
      };
      touch.stopImmediatePropagation = function () {
        event.stopImmediatePropagation();
      };
      if (touch.touchType === "direct") {
        touch.pointerType = "touch";
      } else if (touch.touchType === "stylus") {
        touch.pointerType = "pen";
      }

      // window.console.log("pointerType", touch.pointerType);

      dispatch.call(this, touch);
    });
  }

  _isValidPenEvent(event) {
    // Only process events that are on the target
    if (event.target !== this.target) return false;

    let allowed = this.options.isAllowedPenEvent;
    let len = allowed.length;
    for (let i = 0; i &lt; len; i++) {
      if (allowed[i].call(this, event)) {
        event.preventDefault();
        return true;
      }
    }

    return false;
  }

  _isValidEraserEvent(event) {
    // only process events that are on the target
    if (event.target !== this.target) return false;

    let allowed = this.options.isAllowedEraserEvent;
    let len = allowed.length;
    for (let i = 0; i &lt; len; i++) {
      if (allowed[i].call(this, event)) {
        event.preventDefault();
        return true;
      }
    }

    return false;
  }

  _getSVG() {
    // Check if target already has an svg element
    let svg = Array.from(this.target.children).find(e => {
      return e.tagName.toLowerCase() === "svg";
    });

    // Create an svg element if it does not have one
    if (!svg) {
      svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("xmlns", svgNS);
      svg.setAttribute("xlink", "http://www.w3.org/1999/xlink");
      svg.setAttribute("xmlns:xlink", "");
      svg.setAttribute("class", "drawing-canvas");

      this.target.insertBefore(svg, this.target.firstElementChild);
    }

    return svg;
  }

  _initElementsIndex(svg) {
    let svgBounds = svg.getBoundingClientRect();

    this._elementsIndex = new Quadtree({
      x: 0,
      y: 0,
      width: svgBounds.width,
      height: svgBounds.height
    }, 4);

    svg.liveQuerySelectorAll('path').added(path => {
      path.__observer = path.liveAttribute("complete").changed((value, oldValue) => {
        if (value === "true") {
          // window.console.log("path complete");
          this._addElementsToIndex(svg, [path]);
        }
      });
    }).removed(path => {
      if (path.__indexObject) {
        this._elementsIndex.removeObject(path.__indexObject);
        this._elementsIndex.cleanup();
        path.__observer.stop();
      }
    });

    // Add existing paths to index
    // let elementsToIndex = svg.querySelector('[index="true"]');
    // this._addElementsToIndex(svg, elementsToIndex);
  }

  _calculateBounds(svgBounds, element) {
    let globalBounds = element.getBoundingClientRect();
    return {
      x: globalBounds.left - svgBounds.left,
      y: globalBounds.top - svgBounds.top,
      width: globalBounds.width,
      height: globalBounds.height
    };
  }

  _addElementsToIndex(svg, elements) {
    let svgBounds = svg.getBoundingClientRect();

    Array.prototype.forEach.call(elements, element => {
      let bounds = this._calculateBounds(svgBounds, element);
      bounds.element = element;
      element.__indexObject = bounds;
      this._elementsIndex.insert(bounds);
    });
  }

  _createPen(event) {

    let pen = new Pen((path) => this.onPathAdded(path), {
      color: this.penColor,
      pressureFactor: 1.5
    });

    this.tools[event.pointerId] = pen;

    return pen;
  }

  _getPen(event) {
    return this.tools[event.pointerId];
  }

  _getPoint(event) {

    let point;

    // Check if target element is using Transformer
    if (this.target.transformer) {
      let transformerPoint = new Transformer.Point(event.clientX, event.clientY);
      point = this.target.transformer.fromGlobalToLocal(transformerPoint);
    } else {
      let matrix = Transformer.Matrix.from(this.target);
      point = {
        x: (event.clientX - this.offset.left) / matrix.scaleX,
        y: (event.clientY - this.offset.top) / matrix.scaleY
      };
    }

    return this.options.correctPoint(point);
  }

  _onPointerDown(event) {
    if (this._isValidPenEvent(event)) {
      this.onPenDown(event);
    } else if (this._isValidEraserEvent(event)) {
      this.onEraserDown(event);
    }
  }

  _onPointerMove(event) {
    if (this._isValidPenEvent(event)) {
      this.onPenMove(event);
    } else if (this._isValidEraserEvent(event)) {
      this.onEraserMove(event);
    }
  }

  _onPointerUp(event) {
    if (this._isValidPenEvent(event)) {
      this.onPenUp(event);
    } else if (this._isValidEraserEvent(event)) {
      this.onEraserUp(event);
    }
  }

  onPenDown(event) {
    let pen = this._createPen(event);
    let point = this._getPoint(event);
    point.pressure = event.pressure || 1.0;
    pen.addPoint(point);
  }

  onPenMove(event) {
    let pen = this._getPen(event);
    if (pen) {
      let point = this._getPoint(event);
      point.pressure = event.pressure || 1.0;
      pen.addPoint(point);
    }
  }

  onPenUp(event) {
    let pen = this._getPen(event);

    if (pen && pen instanceof Pen) {
      let point = this._getPoint(event);
      point.pressure = event.pressure || 1.0;
      pen.addPoint(point);
      pen.destroy();
    }

    delete this.tools[event.pointerId];
  }

  onEraserDown(event) {
    this.tools[event.pointerId] = {
      type: "eraser",
      point: this._getPoint(event)
    };
  }

  onEraserMove(event) {
    let eraser = this.tools[event.pointerId];
    if (eraser) {
      // Get svg element
      let svg = this._getSVG();
      let point = this._getPoint(event);
      let eraserPoint = eraser.point;
      eraser.point = point;

      let thickness = 5;

      setTimeout(() => {

        // 				let bounds = {
        // 					x: point.x - thickness,
        // 					y: point.y - thickness,
        // 					width: thickness * 2,
        // 					height: thickness * 2
        // 				};

        let x1 = Math.min(eraserPoint.x, point.x);
        let y1 = Math.min(eraserPoint.y, point.y);
        let x2 = Math.max(eraserPoint.x, point.x);
        let y2 = Math.max(eraserPoint.y, point.y);
        let width = x2 - x1 || 1;
        let height = y2 - y1 || 1;

        let bounds = {
          x: x1,
          y: y1,
          width: width,
          height: height,
          point1: {
            x: x1,
            y: y1
          },
          point2: {
            x: x1 + width,
            y: y1 + height
          }
        };

        // window.console.log(bounds);

        let candidates = this._elementsIndex.retrieve(bounds).map((item) => {
          return item.element;
        });

        // window.console.log(`children: ${svg.childNodes.length}, candidates: ${candidates.length}, subset: ${Math.round((candidates.length / svg.childNodes.length) * 100)}`);

        // window.console.log(candidates);

        let promise = EraserUtils.eraseIntersectingPaths(bounds, candidates);
        promise.then((intersectingPaths) => {
          Array.prototype.forEach.call(intersectingPaths, ip => {
            this._elementsIndex.removeObject(ip.__indexObject);
            this._elementsIndex.cleanup();
            ip.remove();
          });
        });
      }, 0);
    }
  }

  onEraserUp(event) {
    delete this.tools[event.pointerId];
  }

  onPathAdded(path) {
    // Get svg element
    let svg = this._getSVG();
    svg.appendChild(path);
  }

  destroy() {
    this._disposables.forEach((d) => d.dispose());
  }
};</PRE>
      </DIV><DIV class="paragraph code-paragraph collapsed" name="Pen" data-id="yxxxBQKW" __wid="CCbKu3hE">
        <PRE data-type="content" type="text/javascript" id="pen" __wid="9yQJM5tt">const svgNS = "http://www.w3.org/2000/svg";
const pathCutLength = 100;
const connectingPointsOnCut = 5;

const DEFAULT_OPTIONS = {
	penTip: require('#pen-tips').FeltPen,
	color: "black",
	pressureFactor: 1.0
};

exports.Pen = class Pen {

	constructor(onPathCreated, options = {}) {
		this.onPathCreated = onPathCreated;

		// Merge options with default options
		this.options = Object.assign(DEFAULT_OPTIONS, options);

		this._paths = [];
		this._points = [];
	}

	get paths() {
		return this._paths;
	}

	addPoint(point) {

		// Also reset path when > pathCutLength to circumvent performance issue when
		// drawing long paths
		let len = this._points.length;
		if (!len || len > pathCutLength) {

			// Remove previous points except for # of connecting points to connect new path
			// with previous path
			if (len > pathCutLength) {
				this._points.splice(0, pathCutLength - connectingPointsOnCut);
				this._pathComplete();
			}

			this._path = document.createElementNS(svgNS, "path");
			this._path.setAttribute("fill", this.options.color);
			this._paths.push(this._path);

			this.onPathCreated(this._path);
		}

		this._points.push(point);

		let d = this.options.penTip.generateD(this._points, this.options.pressureFactor);
		this._path.setAttribute("d", d);
	}

	_pathComplete() {
		if (this._path) {

			// Only complete path if bounds larger than 0, otherwise remove
			let bounds = this._path.getBoundingClientRect();

			if (bounds.width > 0 || bounds.height > 0) {
				this._path.setAttribute("complete", "true");
			} else {
				this._path.remove();
			}
		}
	}

	destroy() {
		this._pathComplete();
		this._points.length = 0;
		this._paths.length = 0;
	}
};</PRE>
      </DIV><DIV class="paragraph code-paragraph collapsed" name="Canvas Instruments" data-id="ujr23FGQ" __wid="56Y7DAeT">
        <PRE data-type="content" type="text/javascript" id="canvas-instruments" __wid="y6jgqpfE">class EventHandler {

	constructor() {
		this._listeners = [];
	}

	on(name, handler) {
		this._listeners.push({
			name: name,
			handler: handler
		});
	}

	off(name, listener) {
		throw new Error(`Not yet implemented`);
	}

	triggerEvent(name, event) {
		this._listeners.forEach((listener) => {
			if (listener.name === name) {
				listener.handler.call(this, event);
			}
		});
	}
}

class Tool extends EventHandler {

	constructor(name) {
		super();

		if (typeof name !== "string") {
			throw new Error(`parameter name needs to be of type string`);
		}

		this.name = name;
		this.element = this.createElement();
		this.element.classList.add("tool");
	}

	createElement() {
		throw new Error(`createElement not implemented, but it should return a container element`);
	}

	set visible(value) {
		if (value) {
			this.element.classList.remove("hide");
		}
		else {
			this.element.classList.add("hide");
		}
	}

	get visible() {
		return !this.element.classList.contains("hide");
	}

	destroy() {
		// empty
	}
}

exports.Tool = Tool;

class ColorTool extends Tool {

	constructor(name, options) {
		super(name);

		this.options = Object.assign({}, {
			colors: ["black", "red", "green", "blue"],
			className: "colors",
			eventName: "change",
			eventType: "color"
		}, options);

		// add class name to element
		this.element.classList.add(this.options.className);

		this.options.colors.forEach((c, idx) => {
			const color = document.createElement("li");
			color.classList.add("color");
			color.style.backgroundColor = c;
			this.element.appendChild(color);

			if (!idx) {
				this._selectColor(color);
			}
		});

		this.element.addEventListener("pointerdown", (e) => {
			this._consumeEvent(e);
			this._onPointerDown(e);
		});
		this.element.addEventListener("pointermove", this._consumeEvent);
		this.element.addEventListener("pointerup", this._consumeEvent);

		this.element.addEventListener("touchstart", (e) => {
			this._consumeEvent(e);
			this._onPointerDown(e);
		});
		this.element.addEventListener("touchmove", this._consumeEvent);
		this.element.addEventListener("touchend", this._consumeEvent);
	}

	createElement() {
		return document.createElement("ul");
	}

	_getColor(event) {
		return event.target.closest('.color');
	}

	select(colorValue) {
		let colors = Array.from(this.element.querySelectorAll('.color'));
		let color = colors.find((c) => c.style.backgroundColor === colorValue);
		if (color) {
			this._selectColor(color);
			return true;
		}
		return false;
	}

	_selectColor(color) {
		Array.prototype.forEach.call(this.element.querySelectorAll('.color'), (c) => {
			c.classList.remove("active");
		});
		color.classList.add("active");

		// Dispatch change event
		this.triggerEvent(this.options.eventName, {
			type: this.options.eventType,
			value: color.style.backgroundColor
		});
	}

	_onPointerDown(event) {
		let color = this._getColor(event);
		if (color) {
			this._selectColor(color);
		}
	}

	_consumeEvent(event) {
		event.preventDefault();
		event.stopPropagation();
		event.stopImmediatePropagation();
	}
}

exports.ColorTool = ColorTool;

class ToolPalette {

	constructor(target) {
		this.target = target;

		this.element = document.createElement("transient");
		this.element.classList.add("tool-palette");

		this._tools = {};

		target.insertBefore(this.element, target.firstElementChild);
	}

	addTool(tool) {
		if (!(tool instanceof Tool)) {
			throw new Error(`tool needs to be instanceof Tool`);
		}

		if (this._tools[tool.name]) {
			throw new Error(`tool with the same name already exists`);
		}

		// Add tool
		this._tools[tool.name] = tool;

		// Add tool's element to tool palette
		this.element.appendChild(tool.element);
	}

	get tools() {
		// Do not allow to modify tools from outside tool palette
		return Object.freeze(this._tools);
	}

	getTool(name) {
		if (!name) {
			throw new Error(`name parameter is required`);
		}

		// Return named tool
		return this._tools[name];
	}

	destroy() {
		// Destroy each tool
		for (let n in this._tools) {
			let tool = this._tools[n];

			// Remove element from parent
			this.element.remove();

			// Destroy tool
			tool.destroy();

			// Delete tool from tools object
			delete this._tools[n];
		}
	}
}

exports.ToolPalette = ToolPalette;</PRE>
      </DIV><DIV class="paragraph style-paragraph collapsed" data-id="Sz7QwnUR" name="Drawing Canvas Style" draggable="false" __wid="MgPsJrdG"><STYLE data-type="content" type="text/css" codemirror="true" class="persistent" __wid="ZHq46CCJ">svg.drawing-canvas,
svg.drawing-canvas {
	position: absolute;
	z-index: 1;

	top: 0;
	left: 0;
	bottom: 0;
	right: 0;
	border: 0;
	padding: 0;
	margin: 0;
	box-sizing: border-box;
	width: 100%;
	height: 100%;
	pointer-events: none;

/* 	background-color: hotpink; */
}

/* still show a bit of the canvas when no .canvas class is present */
.paragraph :not(.canvas) > svg.drawing-canvas {
  position: relative;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" name="Canvas Tools Style" data-id="FygJSFcB" __wid="HhFggXZn">
			<STYLE data-type="content" type="text/css" codemirror="true" class="persistent" __wid="2JT6tvtt">#test-canvas,
.canvas {
	position: relative;
	min-height: 300px;
	background-color: white;

	overflow: hidden;
	touch-action: none;
	/* cursor: none; */
	cursor: pointer;
	overflow: hidden !important;
}

#test-canvas > .tool-palette,
.canvas > .tool-palette {
	position: absolute;
	bottom: 0;
	left: 50%;
	z-index: 2;

	transform: translate3d(-50%, -10px, 0);

	/* transform: translate3d(-50%, 100%, 0);
	transition: transform 250ms ease-in-out;
	background-color: orange; */
}

.hide-palette #test-canvas > .tool-palette,
.hide-palette .canvas > .tool-palette {
	display: none;
}

@media only screen 
	and (min-device-width : 768px) 
	and (max-device-width : 1024px)  {
		#test-canvas > .tool-palette,
		.canvas > .tool-palette {
			top: 0;

			/* Height 0 fixes 100% height issue on iOS */
			height: 0;

			transform: translate3d(-50%, 10px, 0);
		}
}

/* #test-canvas:hover > .tool-palette,
.canvas:hover > .tool-palette {
transform: translate3d(-50%, -10px, 0);
} */

#test-canvas > .tool-palette .colors,
.canvas > .tool-palette .colors {
	list-style: none;
	margin: 0;
	padding: 0;
}

#test-canvas > .tool-palette .colors .color,
.canvas > .tool-palette .colors .color {
	position: relative;
	float: left;
	width: 30px;
	height: 30px;
	border-radius: 50%;
	margin: 5px;

	box-sizing: border-box;
}

#test-canvas > .tool-palette .colors .color.active:after,
.canvas > .tool-palette .colors .color.active:after {
	content: "";
	position: absolute;
	left: -5px;
	top: -5px;
	width: 40px;
	height: 40px;

	border: 3px solid rgba(0, 0, 0, .75);
	border-radius: 50%;
	box-sizing: border-box;
}</STYLE>
		</DIV><DIV class="paragraph code-paragraph collapsed" last-execution-state="success" name="Drawing Main Code" draggable="false" data-id="txWtHcbH" __wid="NFt6haJz"><PRE data-type="content" type="text/javascript" __wid="BPgjrvwN">const enableDrawing = drawable => {
	// console.log(drawable);

	let penColor = "white";
	let ctx;

	const begin = point => {
		const DrawingUtil = require('#drawing-util');
		ctx = DrawingUtil.begin(drawable, penColor);
		ctx.addPoint(point);
	};

	const move = point => {
		ctx.addPoint(point);
	};

	const end = point => {
		// empty
	};

	const MouseHandler = require('#drawing-mouse-handler');
	MouseHandler.enable(drawable, {
		begin,
		move,
		end
	});

	const ApplePenHandler = require('#drawing-apple-pen-handler');
	ApplePenHandler.enable(drawable, {
		begin,
		move,
		end
	});
};

document.liveQuerySelectorAll('.drawable').added(enableDrawing);</PRE></DIV><DIV class="paragraph code-paragraph collapsed" name="Drawing Event Utils" draggable="false" data-id="YzesPAT2" __wid="TxaiYbWL"><PRE data-type="content" type="text/javascript" id="event-util" __wid="WCKydUgw">exports.getCoordinate = (target, event) => {

	const rect = target.getBoundingClientRect();

	return {
		x: Math.floor(event.clientX - rect.left),
		y: Math.floor(event.clientY - rect.top)
	};
};</PRE></DIV><DIV class="paragraph style-paragraph collapsed" draggable="false" name="No Cursor in Fullscreen" data-id="GLCTkjwd" __wid="vhQLUN6Q"><STYLE data-type="content" type="text/css" codemirror="true" __wid="a4fVUXQM">/*
@media (pointer: fine) and (hover: hover) {
	.canvas {
		background-color: limegreen;
		cursor: auto;
	}
}

@media (pointer: fine) and (hover: none) {
	.canvas {
		background-color: hotpink !important;
		cursor: none !important;
	}
}
*/

/* .body-paragraph.fullscreen .canvas {
	cursor: none !important;
} */</STYLE></DIV><DIV class="paragraph code-paragraph collapsed" name="Intersection Utils" data-id="bpPfV4Uj" __wid="4zy2dCRt">
        <PRE data-type="content" type="text/javascript" id="intersection-utils" __wid="iZMsWvWe">const calculateQuadraticLineIntersect = (p1, p2, p3, a1, a2) => {
	var lerp = function(a, b, x) { return (a + x * (b - a)); };

	var intersections = [];

	// Inverse line normal
	var normal = {
		x: a1.y - a2.y,
		y: a2.x - a1.x,
	};

	// Q-coefficients
	var c2 = {
		x: p1.x + p2.x * -2 + p3.x,
		y: p1.y + p2.y * -2 + p3.y
	};

	var c1 = {
		x: p1.x * -2 + p2.x * 2,
		y: p1.y * -2 + p2.y * 2,
	};

	var c0 = {
		x: p1.x,
		y: p1.y
	};

	// Transform to line 
	var coefficient = a1.x * a2.y - a2.x * a1.y;
	var a = normal.x * c2.x + normal.y * c2.y;
	var b = (normal.x * c1.x + normal.y * c1.y) / a;
	var c = (normal.x * c0.x + normal.y * c0.y + coefficient) / a;

	// Solve the roots
	var roots = [];
	d = b * b - 4 * c;
	if (d > 0) {
		var e = Math.sqrt(d);
		roots.push((-b + Math.sqrt(d)) / 2);
		roots.push((-b - Math.sqrt(d)) / 2);
	} else if (d === 0) {
		roots.push(-b / 2);
	}

	// Calc the solution points
	for (var i = 0; i &lt; roots.length; i++) {
		var minX = Math.min(a1.x, a2.x);
		var minY = Math.min(a1.y, a2.y);
		var maxX = Math.max(a1.x, a2.x);
		var maxY = Math.max(a1.y, a2.y);
		var t = roots[i];
		if (t >= 0 && t &lt;= 1) {
			// Possible point -- pending bounds check
			var point = {
				x: lerp(lerp(p1.x, p2.x, t), lerp(p2.x, p3.x, t), t),
				y: lerp(lerp(p1.y, p2.y, t), lerp(p2.y, p3.y, t), t)
			};
			var x = point.x;
			var y = point.y;
			// Bounds checks
			if (a1.x == a2.x && y >= minY && y &lt;= maxY) {
				// Vertical line
				intersections.push(point);
			} else if (a1.y == a2.y && x >= minX && x &lt;= maxX) {
				// Horizontal line
				intersections.push(point);
			} else if (x >= minX && y >= minY && x &lt;= maxX && y &lt;= maxY) {
				// Line passed bounds check
				intersections.push(point);
			}
		}
	}
	return intersections;
};

const parseQuadraticSegments = (svgPath) => {
	var pathData = svgPath.getAttributeNS(null, "d");

	var segments = [];

	var startPointMatch = pathData.match(/M(\s*)(\S+) (\S+)/);

	var startPoint = {
		x: parseInt(startPointMatch[1]),
		y: parseInt(startPointMatch[2])
	};

	var quadraticPattern = /Q (\S+) (\S+) (\S+) (\S+)/;
	var quadraticPatternGlobal = /Q (\S+) (\S+) (\S+) (\S+)/g;

	var quadraticMatches = pathData.match(quadraticPatternGlobal);

	quadraticMatches.forEach(function (v) {
		var result = v.match(quadraticPattern);

		var controlPoint = {
			x: parseInt(result[1]),
			y: parseInt(result[2])
		};

		var endPoint = {
			x: parseInt(result[3]),
			y: parseInt(result[4])
		};

		segments.push({
			start: startPoint,
			control: controlPoint,
			end: endPoint
		});

		startPoint = endPoint;
	});

	return segments;
};

exports.intersect = (svgPath, a1, a2) => {
	var pathElements = parseQuadraticSegments(svgPath);

	var intersected = false;

	pathElements.forEach(function(segment) {
		var intersections = calculateQuadraticLineIntersect(segment.start, segment.control, segment.end, a1, a2);

		if(intersections.length > 0) {
			intersected = true;
		}
	});

	return intersected;
};</PRE>
      </DIV><DIV class="paragraph code-paragraph collapsed" draggable="false" name="Eraser Utils" data-id="zsS4m8J3" __wid="hjekzgYN"><PRE data-type="content" type="text/javascript" id="eraser-utils" __wid="RrPXJVq6">const Intersection = require('#intersection-utils');

exports.eraseIntersectingPaths = (bounds, paths) => {

	return new Promise((resolve, reject) => {
		let result = Array.prototype.filter.call(paths, child => {
			try {
				if(Intersection.intersect(child, bounds.point1, bounds.point2)) {
					return child;
				}
			} catch(error) {
				console.log(error);
			}
			return null;
		});

		resolve(result);
	});
};</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="aff8H5di" name="Snackbar/Toolbar Integration" last-execution-state="success" run-on-load="true" __wid="BtxYidJL"><PRE data-type="content" type="text/javascript" __wid="NuYURV82">const GlobalToolbarUtils = require("#global-toolbar-utils");
const ParagraphUtils = require("#paragraph-utils");
const SnackbarUtils = require("#snackbar-utils");
const SnackbarTools = require("#snackbar-tools");

///////////////////////////////////////////////////////////////////////////////////////////////////

const packageClass = "drawing-package";
const drawingClass = "canvas";

///////////////////////////////////////////////////////////////////////////////////////////////////

Codestrate.addCommand("drawing.addDrawing", "Add Drawing", () => {
	const paragraph = ParagraphUtils.createBodyParagraph();
	const content = paragraph.querySelector("[data-type='content']");
  // lock paragraph
  content.setAttribute("contenteditable", "false");
	content.classList.add(drawingClass);

	ParagraphUtils.insertParagraphAfterFocussed(paragraph);
});

GlobalToolbarUtils.addDivider(1, packageClass);
GlobalToolbarUtils.addButton("Add Drawing", "", "drawing " + packageClass, 1, () => {
	Codestrate.executeCommand("drawing.addDrawing");
});

///////////////////////////////////////////////////////////////////////////////////////////////////

SnackbarTools.addTools((target) => {
	return (Codestrate.focussedParagraph &&
					Codestrate.focussedParagraph.querySelector('[data-type="content"][contenteditable="true"]') &&
					Codestrate.focussedParagraph.querySelector('[data-type="content"][contenteditable="true"]').classList.contains(drawingClass));
}, "canvas-tools");

SnackbarUtils.addDivider(1, "body-tools " + packageClass);

SnackbarUtils.addButton("Toggle Drawing", "", "body-tools drawing " + packageClass, 1, () => {
	// Codestrate.focussedParagraph.querySelector("[data-type='content']").classList.toggle(drawingClass);

	const paragraph = Codestrate.focussedParagraph;
	const content = paragraph.querySelector('[data-type="content"]');

	// content is also a slide
	if (content.matches('.slide')) {
		const slideContent = content.querySelector('.slide-content');
		slideContent.classList.toggle(drawingClass);
	}
	else {
		content.classList.toggle(drawingClass);
	}
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="sBa3Chfb" name="Drawing Toolbar/Snackbar Style" __wid="7jVvW8Xm"><STYLE data-type="content" type="text/css" codemirror="true" class="themable" __wid="jc8r72L2">html #snackbar[canvas-tools="true"] .body-content-tools {
	display: none;
}

html #snackbar[canvas-tools="true"]:not([content-tools]) .drawing {
	display: flex;
}

html #global-toolbar .drawing i:after,
html #snackbar .drawing i:after {
	content: "filter_frames";
}

/*html #snackbar[canvas-tools="true"] .drawing {
	background: radial-gradient(rgba(var(--color-accent-text-rgb), 0.8) 0%, rgba(var(--color-accent-text-rgb), 1) 52%, rgba(0, 0, 0, 0) 55%);
}

html #snackbar[canvas-tools="true"] .drawing {
	color: var(--color-accent);
}*/</STYLE></DIV></DIV><DIV class="section section-hidden" data-id="VxDJJKw9" name="Canvas Objects" data-type="package" __wid="ND3JvPRs"><DIV class="paragraph body-paragraph locked collapsed" name="Documentation" data-id="AqHBTqx8" __wid="AdrevYKy"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="eUaG7z8W"><H2 __wid="ehM7swbN">Description</H2><DIV __wid="9uujmKWg">Allows adding objects to the canvas, which are then transforable (translate, rotate, scale).</DIV></DIV></DIV><DIV class="paragraph data-paragraph collapsed locked" name="Properties" data-id="d9ccqLUD" __wid="mQJW29Tt"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="XuKae6AF">{
  "version": "0.1.9",
  "icon": "transform",
  "description": "Allows adding objects to the canvas, which are then transforable (translate, rotate, scale).",
  "tags": [
    "canvas",
    "objects"
  ],
  "assets": [
    "hammer.min.js",
    "transformer.min.js",
    "transformer.min.js.map",
    "marked.min.js"
  ],
  "dependencies": [
    {
      "id": "Kw6McUkB",
      "name": "Canvas",
      "optional": false,
      "usage": "Canvas Objects only works with Canvas package."
    }
  ],
  "changelog": {
    "0.1": "Initial version.",
    "0.1.1": "Adapted to changes in context menu",
    "0.1.2": "Updated transformer.min.js and added transformer.min.js.map.",
    "0.1.3": "Only create Transformer if not yet exist for canvas object.",
    "0.1.4": "Lock transform when grid class is enabled.",
    "0.1.5": "Replaced contenteditable text with markdown notes.",
    "0.1.6": "Added \"delete item\" menu item.",
    "0.1.7": "Simplified markdown note structure and added undo delete action.",
    "0.1.8": "Overflow over components when canvas is unlocked to prevent interaction while moving canvas objects on the canvas.",
    "0.1.9": "Using custom upload that checks if asset filename already exists and provides a rename dialog if so."
  },
  "github": {
    "url": "https://github.com/Webstrates/Codestrate-Packages",
    "folder": "packages/VxDJJKw9-Canvas_Objects"
  }
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="DzTgVcuM" name="Canvas Object Utils" __wid="5MFTBwiM"><PRE data-type="content" type="text/javascript" id="canvas-object-utils" __wid="AJdLZrS5">exports.createCanvasObject = (x, y) => {
	const canvasObject = document.createElement("div");
	canvasObject.classList.add("canvas-object");
	canvasObject.style.transform = `translate3d(${x}px, ${y}px, 0)`;
	return canvasObject;
};</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="L835z9dK" name="Canvas Object Style" __wid="nEutJaNg"><STYLE data-type="content" type="text/css" codemirror="true" __wid="GRD2UB9h">.canvas .canvas-object {
  color: black;
	position: absolute;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="FmwCE38M" name="Canvas Unlocked Object Style" __wid="9TxiFHYk"><STYLE data-type="content" type="text/css" codemirror="true" __wid="VdJ6d8AJ">/* .canvas:not(.locked) .canvas-object > * {
  pointer-events: none;
} */

.canvas:not(.locked) .canvas-object:after {
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 250;
  background-color: transparent;
  /* must have a color on ie10, if not :after does not exist... */
/*   opacity: 0; */
  outline: 1px dashed lightgray;
}</STYLE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="wTiDLbZZ" name="Canvas Object Transformer" last-execution-state="success" run-on-load="true" __wid="dBzKWcn5"><PRE data-type="content" type="text/javascript" __wid="tugyt4FK">importLib([
  "hammer.min.js",
  "transformer.min.js"
]).then(() => {

  const initializeCanvasObject = (canvasObject) => {
    if (canvasObject.transformer) {
      return;
    }
    
    const canvas = canvasObject.closest('.canvas');
    
    if (!canvas) {
      throw new Error(`canvas object transformer only works with Canvas package`);
    }

    (async() => {

      let transformer = await Transformer.hammerize(canvasObject, {
        enabled: () => {
          return !canvas.classList.contains("locked") && !canvas.classList.contains("grid");
        }
      });
    })();
  };

  const liveSelector = document.liveQuerySelectorAll('.canvas-object');
  liveSelector.added(initializeCanvasObject);
});</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="G9PV7yUN" style draggable="false" name="Markdown Note Utils" run-on-load="true" last-execution-state="success" __wid="PwSZXxGz"><PRE data-type="content" type="text/javascript" id="markdown-note-utils" __wid="dQLLbqmA">/**
 * The MarkdownNote plugin adds a functionality to the Pad and allows
 * adding notes to the canvas. A doubletap on the canvas will create a
 * new note at the tap location. Another doubletap on the note will switch
 * the note to a markdown editor view. The note can be edited in this view.
 * The markdown will be transformed into html markup when the focus of the note
 * is lost.
 */
importLib([
  "hammer.min.js",
  "https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"
]).then(() => {

  /**
   * Switch the editmode of a note.
   *
   * @param {any} element The actual markdown note element.
   * @param {any} editable True if editable, false otherwise.
   *
   * @memberOf MarkdownNote
   */
  const switchEditMode = (element, editable) => {
    element.setAttribute("editmode", `${editable}`);
    if (editable) {
      const input = element.querySelector('.markdown-input');
      setTimeout(() => {
        input.focus();
      }, 1);
    }
  };

  const getTextContent = (node) => {
    if (node.nodeType === 1 && node.tagName.toUpperCase() === "BR") return "\n";
    if (node.nodeType == 3) {
      return node.textContent;
    }
    var textContent = "";
    for (var i = 0; i &lt; node.childNodes.length; i++) {
      textContent = textContent + getTextContent(node.childNodes[i]);
    }
    if (node.nodeType === 1 && node.tagName.toUpperCase() === "DIV") {
      textContent = textContent + "\n";
    }
    return textContent;
  };

  // Create a HammerManager (hammer.js) to listen to doubletap events on
  // the document body. The doubletap events will later be used to add new
  // markdown notes whenever the user doubletaps on the canvas.
  const hammerManager = new Hammer.Manager(document.body);
  hammerManager.add(new Hammer.Tap());
  hammerManager.add(new Hammer.Tap({
    event: 'doubletap',
    taps: 2
  }));
  hammerManager.get('doubletap').recognizeWith('tap');

  // Add callback function whenever a doubletap event happens on the document
  // body.
  hammerManager.on("tap doubletap", (event) => {

    if (event.type === "tap") {
      // console.log('here %o', event);

      // blur active element
      const activeElement = document.activeElement;
      if (!event.target.closest('.markdown-note') &&
        activeElement.closest('.markdown-note')) {
        event.preventDefault();
        event.srcEvent.preventDefault();
        event.srcEvent.stopPropagation();
        event.srcEvent.stopImmediatePropagation();
        // console.log('blur element');
        activeElement.blur();
      }
      return;
    }

    event.preventDefault();
    event.srcEvent.preventDefault();
    event.srcEvent.stopPropagation();
    event.srcEvent.stopImmediatePropagation();

    // When the event target is a markdown note or any of its children, then
    // switch to markdown note edit mode.
    const markdownNote = event.target.closest('.markdown-note');
    // console.log('doubletap %o', markdownNote);
    if (markdownNote) {
      switchEditMode(markdownNote, true);
      return;
    }
  });

  /**
   * Make the markdown note interactive. Add a transient element, which will contain
   * the transformed markdown into html. It is important to notice that only the markdown
   * is synchronized by webstrate. The transformed html is added to a transient element
   * and only available locally.
   *
   * @param {any} element The html element with the .markdown-note class.
   *
   * @memberOf MarkdownNote
   */
  const makeMarkdownNoteInteractive = (element) => {
    
    // only add marked html container once
    if (element.querySelector('.marked-html')) {
      return;
    }

    // Get element containing the actual markdown.
    const input = element.querySelector('.markdown-input');

    // Make the markdown input element editable (if not already).
    input.setAttribute("contenteditable", "true");

    // Switch markdown note from edit mode to non-edit mode on blur.
    input.addEventListener("blur", (event) => {
      switchEditMode(element, false);
    });

    input.addEventListener("mousedown", (event) => {
      event.stopImmediatePropagation();
    });

    // Add a transient element holding the marked html content. Also transform the initial
    // markdown to html and set it as new innerHTML. Then append the element containing
    // the marked html to the transient element.
    const htmlContainer = document.createElement("transient");
    htmlContainer.classList.add("marked-html");
    htmlContainer.innerHTML = marked(getTextContent(input));
    element.appendChild(htmlContainer);

    // In order to listen to changes in the markup, reapply them, and replace
    // the content of the element holding the html, we use the attributeChanged event on the
    // actual markdown note element. The editmode attribute will be triggered every time a user
    // switches the note's editmode, which will be synchronized by Webstrates.
    let liveAttribute = element.liveAttribute("editmode");
    liveAttribute.changed((value) => {
      htmlContainer.innerHTML = marked(getTextContent(input));
    });
  };

  //   /**
  //    * Create a new markdown note. The function also appends the new note to the canvas element and
  //    * sets all required css class on the element.
  //    *
  //    * @returns The new markdown note element.
  //    *
  //    * @memberOf MarkdownNote
  //    */
  //   exports.createMarkdownNote = () => {

  //     const note = document.createElement("div");
  //     // give each markdown note an ID to reference it in a markdown inline style
  //     note.setAttribute("id", `note${Codestrate.util.randomString()}`);
  //     note.classList.add("markdown-note");
  //     note.setAttribute("editmode", "false");

  //     const markdownInput = document.createElement("div");
  //     markdownInput.setAttribute("class", "markdown-input");
  //     markdownInput.innerHTML = '# Hello Note';
  //     note.appendChild(markdownInput);

  //     return note;
  //   };

  // Make all markdown note elements already existing on the
  // canvas interactive. This for example is the case on a browser
  // reload.
  //
  // Enable manipulation on new nodes that are added to the DOM.
  // This callback will be called whenever a new markdown note was
  // added (locally or remote) to the canvas. Make each note that was
  // added to the canvas interactive.
  const liveSelector = document.liveQuerySelectorAll('.markdown-note');
  liveSelector.added((note) => {
    makeMarkdownNoteInteractive(note);
  });
});</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="raL4g4nL" name="Markdown Note Style" draggable="false" style __wid="judbGYYL"><STYLE data-type="content" type="text/css" codemirror="true" __wid="QJxtFk35">.canvas .markdown-note {
  background: whitesmoke;
  padding: 5px;
  box-shadow: 0 0 10px lightgray;
}

.canvas .markdown-note:hover:before,
.canvas .markdown-note .markdown-input:focus:before {
  content: "#" attr(id);
  position: absolute;
  top: 0;
  left: 0;
  padding-bottom: 5px;
  font-weight: bold;
  font-size: .8em;
  transform: translate3d(0, -100%, 0);
}

.canvas .markdown-note[editmode="true"] .markdown-input {
  display: inline-block;
  width: 100%;
  height: 100%;
}

.canvas .markdown-note[editmode="false"] .markdown-input {
  display: none;
}

.canvas .markdown-note[editmode="true"] .marked-html {
  display: none;
}

.canvas .markdown-note[editmode="false"] .marked-html {
  display: inline-block;
  cursor: default;
}

.canvas .markdown-note>*[contenteditable] {
  display: inline-block;
  overflow: hidden;
  overflow-y: auto;
  width: 100%;
  height: 100%;
}</STYLE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="zcGBhHnn" name="Canvas Object Context Menu Items" last-execution-state="success" style run-on-load="true" __wid="DvAfkLfH"><PRE data-type="content" type="text/javascript" __wid="DEuMTGmd">importLib([
  "marked.min.js"
]).then(() => {

  const AssetUtils = require('#asset-utils');
  const CanvasContextMenu = require('#canvas-context-menu');
  const CanvasObjectUtils = require('#canvas-object-utils');

  const items = [{
    type: "item",
    label: "Add text",
    icon: "text_fields",
    hidden: (event) => {
      return !event.srcEvent.target.closest('.markdown-note');
    },
    action: (event) => {
      const canvasObject = CanvasObjectUtils.createCanvasObject(event.x, event.y);

      const note = document.createElement("div");
      // give each markdown note an ID to reference it in a markdown inline style
      note.setAttribute("id", `note-${Codestrate.util.randomString()}`);
      note.classList.add("markdown-note");
      note.setAttribute("editmode", "false");

      const markdownInput = document.createElement("div");
      markdownInput.setAttribute("class", "markdown-input");
      markdownInput.innerHTML = '# Hello Note';
      note.appendChild(markdownInput);

      canvasObject.appendChild(note);
      event.target.appendChild(canvasObject);
    }
  }, {
    type: "item",
    label: "Edit text",
    icon: "mode_edit",
    hidden: (event) => {
      return !!event.srcEvent.target.closest('.markdown-note');
    },
    action: (event) => {
      // When the event target is a markdown note or any of its children, then
      // switch to markdown note edit mode.
      const markdownNote = event.srcEvent.target.closest('.markdown-note');
      // console.log('doubletap %o', markdownNote);
      if (markdownNote) {
        markdownNote.setAttribute("editmode", "true");
        const input = markdownNote.querySelector('.markdown-input');
        setTimeout(() => {
          input.focus();
        }, 0);
      }
    }
  }, {
    type: "item",
    label: "Upload asset",
    icon: "attach_file", // "insert_photo",
    action: (event) => {

      const input = document.createElement('input');
      input.setAttribute('multiple', true);
      input.setAttribute('type', 'file');

      input.addEventListener('change', () => {
        AssetUtils.uploadFiles(input.files, (asset) => {
          const canvasObject = CanvasObjectUtils.createCanvasObject(event.x, event.y);
          const element = AssetUtils.getElementFromAsset(asset);
          canvasObject.appendChild(element);
          event.target.appendChild(canvasObject);
        }, null, (error) => {
          alert(error);
        });
      });

      input.click();
    }
  }, {
    type: "item",
    label: "Delete object",
    icon: "delete",
    hidden: (event) => {
      return !!event.srcEvent.target.closest('.canvas-object');
    },
    action: (event) => {
      const canvasObject = event.srcEvent.target.closest('.canvas-object');
      if (canvasObject) {
        const parentElement = canvasObject.parentElement;
        const nextSibling = canvasObject.nextSibling;
        canvasObject.remove();
        toast('Object deleted', 5000, () => {
          parentElement.insertBefore(canvasObject, nextSibling);
        }, "Undo");
      }
    }
  }, {
    // menu item to lock canvas
    type: "item",
    label: (event) => {
      // is components canvas locked
      const isCanvasLocked = event.target.classList.contains("locked");
      return isCanvasLocked ? "Unlock canvas" : "Lock canvas";
    },
    icon: (event) => {
      // is components canvas locked
      const isCanvasLocked = event.target.classList.contains("locked");
      return isCanvasLocked ? "lock_outline" : "lock_open";
    },
    action: (event) => {
      // toggle locked class to lock or unlock canvas
      event.target.classList.toggle("locked");
    }
  }];

  items.forEach(CanvasContextMenu.addItem);

});</PRE></DIV></DIV><DIV class="section section-hidden" data-id="PZdwMdfP" data-type="package" name="Markdown" __wid="MJppHXqx"><DIV class="paragraph body-paragraph locked collapsed" data-id="CWux8e95" name="Documentation" __wid="iB5gBTM6"><DIV data-type="content" type="text/html" codemirror="true" contenteditable="false" class="section-documentation" __wid="4EwiUyP8"><H2 __wid="Kih3c7gp">Description</H2><DIV __wid="iFUXTWic">Body paragraphs can be toggled to display as markdown.</DIV></DIV></DIV><DIV class="paragraph data-paragraph locked collapsed" name="Properties" data-id="XkmdKAst" __wid="YbaUpWqN"><PRE data-type="content" type="application/json" class="section-properties" contenteditable="false" __wid="vxgCXaH8">{
	"version": "1.0",
	"icon": "format_quote",
	"description": "Body paragraphs can be toggled to display as markdown.",
	"tags": [
		"tools",
		"body paragraphs"
	],
	"assets": [
		"showdown.min.js"
	],
	"dependencies": [],
	"changelog":
	{
		"1.0": "Initial version."
	},
	"github": {
		"url": "https://github.com/Webstrates/Codestrate-Packages",
		"folder": "packages/PZdwMdfP-Markdown"
	}
}</PRE></DIV><DIV class="paragraph code-paragraph collapsed" data-id="JsrkyX5g" name="Markdown Code" run-on-load="true" last-execution-state="success" __wid="iMAdP3Ks"><PRE data-type="content" type="text/javascript" __wid="MYLZt82s">const SnackbarUtils = require("#snackbar-utils");
const SnackbarTools = require("#snackbar-tools");

/******************************************************************************/

const toolsName = "markdown-tools";
const showdownOptions = {
	tables: true,
	tasklists: true,
	requireSpaceBeforeHeadingText: true,
	emoji: true,
	simpleLineBreaks: true
};

/******************************************************************************/

SnackbarTools.addTools((target) => {
	const paragraph = Codestrate.focussedParagraph;
	const content = paragraph ? paragraph.querySelector("[data-type='content']") : false;
	return (content &&
					content.getAttribute("type") === "text/html" &&
					content.getAttribute("contenteditable") === "true" &&
					content.classList.contains("markdown"));
}, toolsName);

/******************************************************************************/

SnackbarUtils.addDivider(1, "body-tools");

SnackbarUtils.addButton("Toggle Markdown", "", "body-tools markdown-button", 1, () => {
	const paragraph = Codestrate.focussedParagraph;
	const content = paragraph ? paragraph.querySelector("[data-type='content']") : false;
	if (content) content.classList.toggle("markdown");
});

/******************************************************************************/

importLib([
	"showdown.min.js"
]).then(() => {
	const markdownConverter = new showdown.Converter(showdownOptions);

	const updateMarkdown = (content, output) => {
		output.innerHTML = markdownConverter.makeHtml(content.innerText);
	};

	// Wait for Codemirror initialization
	setTimeout(() => document.liveQuerySelectorAll(".body-paragraph [data-type='content']").added((content) => {
		content.liveAttribute("class").changed((value, oldValue) => {
			const paragraph = content.closest(".paragraph");

			if (content.classList.contains("markdown")) {
				let output = paragraph.querySelector(".markdown-output");

				if (!output) {
					const outputContainer = document.createElement("transient");
					outputContainer.classList.add("markdown-output-container");

					output = document.createElement("div");
					output.classList.add("markdown-output");

					outputContainer.appendChild(output);
					paragraph.appendChild(outputContainer);
				}

				// Prevent "no textblock" CodeMirror error on empty content
				if (content.innerText === "") content.innerText = "...";

				setTimeout(() => {
					if (!content.__markdownEditor) {
						const { CodeEditor } = require("#code-editor");
						const editor = new CodeEditor(content, content.parentElement, {
							mode: "text/x-markdown"
						});

						content.__markdownEditor = editor;
					}
				}, 0);

				content.__markdownObserver = new MutationObserver(() => updateMarkdown(content, output));
				content.__markdownObserver.observe(content, { characterData: true, attributes: false, childList: true, subtree: true });
				updateMarkdown(content, output);
			} else {
				const output = paragraph.querySelector(".markdown-output-container");
				if (output) output.remove();
				const editor = paragraph.querySelector(".default-editor");
				if (editor) editor.remove();
				if (content.__markdownEditor) delete content.__markdownEditor;
				if (content.__markdownObserver) {
					content.__markdownObserver.disconnect();
					delete content.__markdownObserver;
				}
			}
		});
	}), 1000);
});

/******************************************************************************/

let currentParagraph = false;

const editorToSnackbar = (editor) => {
	const name = Codestrate.focussedParagraph.getAttribute("name") ? Codestrate.focussedParagraph.getAttribute("name") : "Unnamed Paragraph";
	SnackbarUtils.setContent(editor, name + " Markdown");
	currentParagraph = Codestrate.focussedParagraph;
	currentParagraph.querySelector("[data-type='content']").__markdownEditor.editor.refresh();
	currentParagraph.setAttribute("transient-content-paragraph", "true");
};

const editorToParagraph = (editor) => {
	currentParagraph.appendChild(editor);
	currentParagraph.removeAttribute("transient-content-paragraph");
	currentParagraph = false;
	SnackbarUtils.closeContent();
};

const htmlEditorButton = document.querySelector("#snackbar .html-editor-button");
const markdownEditorButton = SnackbarUtils.createButton("Show Markdown Editor", "", toolsName + " markdown-editor-button", () => {
	const content = SnackbarUtils.getContent();
	if (content && content.classList.contains("default-editor")) {
		editorToParagraph(content);
	} else {
		const editor = Codestrate.focussedParagraph.querySelector(".default-editor");
		editorToSnackbar(editor);
	}
});

window.addEventListener("SnackbarRemoveContent", (event) => {
	if (currentParagraph && event.detail && event.detail.classList.contains("default-editor")) {
		editorToParagraph(event.detail);
	}
});

htmlEditorButton.parentNode.insertBefore(markdownEditorButton, htmlEditorButton);</PRE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="vGUkEBTq" name="Markdown Style" __wid="LXhYBYzW"><STYLE data-type="content" type="text/css" codemirror="true" __wid="WztR8gYc">html #snackbar:not([markdown-tools="true"]) .markdown-tools,
html #snackbar[markdown-tools="true"] .html-editor-button {
	display: none;
}

html .markdown[data-type="content"] {
	display: none;
}

html .markdown-button i:after {
	content: var(--markdown);
	font-family: "Material Design Icons";
}

html .markdown-editor-button i:after {
	content: var(--xml);
	font-family: "Material Design Icons";
}

html .markdown-output-container + .default-editor {
	display: none;
}

html #snackbar .snackbar-content .default-editor .CodeMirror,
html #snackbar .snackbar-content .default-editor .CodeMirror-gutters  {
	background: none;
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="xUHvS5jh" name="Github Markdown Style" __wid="3aUcKwcj"><STYLE data-type="content" type="text/css" codemirror="true" __wid="z5tt3ju9">html .markdown-output {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
	font-size: 16px;
	line-height: 1.5;
	word-wrap: break-word;
	background: #fff;
	color: #24292e;
	padding: 48px;
}

html .markdown-output::before {
	display: table;
	content: ""
}

html .markdown-output::after {
	display: table;
	clear: both;
	content: ""
}

html .markdown-output>*:first-child {
	margin-top: 0 !important
}

html .markdown-output>*:last-child {
	margin-bottom: 0 !important
}

html .markdown-output a:not([href]) {
	color: inherit;
	text-decoration: none
}

html .markdown-output .absent {
	color: #cb2431
}

html .markdown-output .anchor {
	float: left;
	padding-right: 4px;
	margin-left: -20px;
	line-height: 1
}

html .markdown-output .anchor:focus {
	outline: none
}

html .markdown-output p,html .markdown-output blockquote,html .markdown-output ul,html .markdown-output ol,html .markdown-output dl,html .markdown-output table,html .markdown-output pre {
	margin-top: 0;
	margin-bottom: 16px
}

html .markdown-output hr {
	height: 0.25em;
	padding: 0;
	margin: 24px 0;
	background-color: #e1e4e8;
	border: 0
}

html .markdown-output blockquote {
	padding: 0 1em;
	color: #6a737d;
	border-left: 0.25em solid #dfe2e5
}

html .markdown-output blockquote>:first-child {
	margin-top: 0
}

html .markdown-output blockquote>:last-child {
	margin-bottom: 0
}

html .markdown-output kbd {
	display: inline-block;
	padding: 3px 5px;
	font-size: 11px;
	line-height: 10px;
	color: #444d56;
	vertical-align: middle;
	background-color: #fafbfc;
	border: solid 1px #c6cbd1;
	border-bottom-color: #959da5;
	border-radius: 3px;
	box-shadow: inset 0 -1px 0 #959da5
}

html .markdown-output h1,html .markdown-output h2,html .markdown-output h3,html .markdown-output h4,html .markdown-output h5,html .markdown-output h6 {
	margin-top: 24px;
	margin-bottom: 16px;
	font-weight: 600;
	line-height: 1.25
}

html .markdown-output h1 .octicon-link,html .markdown-output h2 .octicon-link,html .markdown-output h3 .octicon-link,html .markdown-output h4 .octicon-link,html .markdown-output h5 .octicon-link,html .markdown-output h6 .octicon-link {
	color: #1b1f23;
	vertical-align: middle;
	visibility: hidden
}

html .markdown-output h1:hover .anchor,html .markdown-output h2:hover .anchor,html .markdown-output h3:hover .anchor,html .markdown-output h4:hover .anchor,html .markdown-output h5:hover .anchor,html .markdown-output h6:hover .anchor {
	text-decoration: none
}

html .markdown-output h1:hover .anchor .octicon-link,html .markdown-output h2:hover .anchor .octicon-link,html .markdown-output h3:hover .anchor .octicon-link,html .markdown-output h4:hover .anchor .octicon-link,html .markdown-output h5:hover .anchor .octicon-link,html .markdown-output h6:hover .anchor .octicon-link {
	visibility: visible
}

html .markdown-output h1 tt,html .markdown-output h1 code,html .markdown-output h2 tt,html .markdown-output h2 code,html .markdown-output h3 tt,html .markdown-output h3 code,html .markdown-output h4 tt,html .markdown-output h4 code,html .markdown-output h5 tt,html .markdown-output h5 code,html .markdown-output h6 tt,html .markdown-output h6 code {
	font-size: inherit
}

html .markdown-output h1 {
	padding-bottom: 0.3em;
	font-size: 2em;
	border-bottom: 1px solid #eaecef;
}

html .markdown-output h2 {
	padding-bottom: 0.3em;
	font-size: 1.5em;
	border-bottom: 1px solid #eaecef
}

html .markdown-output h3 {
	font-size: 1.25em
}

html .markdown-output h4 {
	font-size: 1em
}

html .markdown-output h5 {
	font-size: 0.875em
}

html .markdown-output h6 {
	font-size: 0.85em;
	color: #6a737d
}

html .markdown-output ul,html .markdown-output ol {
	padding-left: 2em
}

html .markdown-output ul.no-list,html .markdown-output ol.no-list {
	padding: 0;
	list-style-type: none
}

html .markdown-output ul ul,html .markdown-output ul ol,html .markdown-output ol ol,html .markdown-output ol ul {
	margin-top: 0;
	margin-bottom: 0
}

html .markdown-output li {
	word-wrap: break-all
}

html .markdown-output li>p {
	margin-top: 16px
}

html .markdown-output li+li {
	margin-top: 0.25em
}

html .markdown-output dl {
	padding: 0
}

html .markdown-output dl dt {
	padding: 0;
	margin-top: 16px;
	font-size: 1em;
	font-style: italic;
	font-weight: 600
}

html .markdown-output dl dd {
	padding: 0 16px;
	margin-bottom: 16px
}

html .markdown-output table {
	display: block;
	width: 100%;
	overflow: auto
}

html .markdown-output table th {
	font-weight: 600
}

html .markdown-output table th,html .markdown-output table td {
	padding: 6px 13px;
	border: 1px solid #dfe2e5
}

html .markdown-output table tr {
	background-color: #fff;
	border-top: 1px solid #c6cbd1
}

html .markdown-output table tr:nth-child(2n) {
	background-color: #f6f8fa
}

html .markdown-output table img {
	background-color: transparent
}

html .markdown-output img {
	max-width: 100%;
	box-sizing: content-box;
	background-color: #fff
}

html .markdown-output img[align=right] {
	padding-left: 20px
}

html .markdown-output img[align=left] {
	padding-right: 20px
}

html .markdown-output .emoji {
	max-width: none;
	vertical-align: text-top;
	background-color: transparent
}

html .markdown-output span.frame {
	display: block;
	overflow: hidden
}

html .markdown-output span.frame>span {
	display: block;
	float: left;
	width: auto;
	padding: 7px;
	margin: 13px 0 0;
	overflow: hidden;
	border: 1px solid #dfe2e5
}

html .markdown-output span.frame span img {
	display: block;
	float: left
}

html .markdown-output span.frame span span {
	display: block;
	padding: 5px 0 0;
	clear: both;
	color: #24292e
}

html .markdown-output span.align-center {
	display: block;
	overflow: hidden;
	clear: both
}

html .markdown-output span.align-center>span {
	display: block;
	margin: 13px auto 0;
	overflow: hidden;
	text-align: center
}

html .markdown-output span.align-center span img {
	margin: 0 auto;
	text-align: center
}

html .markdown-output span.align-right {
	display: block;
	overflow: hidden;
	clear: both
}

html .markdown-output span.align-right>span {
	display: block;
	margin: 13px 0 0;
	overflow: hidden;
	text-align: right
}

html .markdown-output span.align-right span img {
	margin: 0;
	text-align: right
}

html .markdown-output span.float-left {
	display: block;
	float: left;
	margin-right: 13px;
	overflow: hidden
}

html .markdown-output span.float-left span {
	margin: 13px 0 0
}

html .markdown-output span.float-right {
	display: block;
	float: right;
	margin-left: 13px;
	overflow: hidden
}

html .markdown-output span.float-right>span {
	display: block;
	margin: 13px auto 0;
	overflow: hidden;
	text-align: right
}

html .markdown-output code,html .markdown-output tt {
	padding: 0.2em 0.4em;
	margin: 0;
	font-size: 85%;
	background-color: rgba(27,31,35,0.05);
	border-radius: 3px
}

html .markdown-output code br,html .markdown-output tt br {
	display: none
}

html .markdown-output del code {
	text-decoration: inherit
}

html .markdown-output pre {
	word-wrap: normal
}

html .markdown-output pre>code {
	padding: 0;
	margin: 0;
	font-size: 100%;
	word-break: normal;
	white-space: pre;
	background: transparent;
	border: 0
}

html .markdown-output .highlight {
	margin-bottom: 16px
}

html .markdown-output .highlight pre {
	margin-bottom: 0;
	word-break: normal
}

html .markdown-output .highlight pre,html .markdown-output pre {
	padding: 16px;
	overflow: auto;
	font-size: 85%;
	line-height: 1.45;
	background-color: #f6f8fa;
	border-radius: 3px
}

html .markdown-output pre code,html .markdown-output pre tt {
	display: inline;
	max-width: auto;
	padding: 0;
	margin: 0;
	overflow: visible;
	line-height: inherit;
	word-wrap: normal;
	background-color: transparent;
	border: 0
}

html .markdown-output .csv-data td,html .markdown-output .csv-data th {
	padding: 5px;
	overflow: hidden;
	font-size: 12px;
	line-height: 1;
	text-align: left;
	white-space: nowrap
}

html .markdown-output .csv-data .blob-num {
	padding: 10px 8px 9px;
	text-align: right;
	background: #fff;
	border: 0
}

html .markdown-output .csv-data tr {
	border-top: 0
}

html .markdown-output .csv-data th {
	font-weight: 600;
	background: #f6f8fa;
	border-top: 0
}</STYLE></DIV><DIV class="paragraph style-paragraph collapsed" data-id="NSryqF9n" name="Github Markdown Dark Style" __wid="RUxHXMkk"><STYLE data-type="content" type="text/css" codemirror="true" __wid="9WThsDJt">html .markdown-output {
	font-family: var(--font-primary);
	padding: 5px;
	background: var(--color-primary-shade-2);
	color: var(--color-primary-text);
}

html .markdown-output .absent {
	color: #cb2431;
}

html .markdown-output hr {
	background-color: var(--color-tertiary-text);
}

html .markdown-output blockquote {
	color: var(--color-secondary-text);
	border-left: 0.25em solid var(--color-secondary-text);
}

html .markdown-output kbd {
	color: #444d56;
	background-color: #fafbfc;
	border: solid 1px #c6cbd1;
	border-bottom-color: #959da5;
	box-shadow: inset 0 -1px 0 #959da5;
}

html .markdown-output h1 .octicon-link,html .markdown-output h2 .octicon-link,html .markdown-output h3 .octicon-link,html .markdown-output h4 .octicon-link,html .markdown-output h5 .octicon-link,html .markdown-output h6 .octicon-link {
	color: #1b1f23;
}

html .markdown-output h1 {
	border-bottom: 1px solid var(--color-secondary-text);
}

html .markdown-output h2 {
	border-bottom: 1px solid var(--color-secondary-text);
}

html .markdown-output h6 {
	color: var(--color-secondary-text);
}

html .markdown-output table th,html .markdown-output table td {
	border: 1px solid var(--color-secondary-text);
}

html .markdown-output table tr {
	background-color: var(--color-primary-shade-2);
	border-top: 1px solid #c6cbd1;
}

html .markdown-output table tr:nth-child(2n) {
	background-color: var(--color-primary-shade-3);
}

html .markdown-output img {
	background-color: var(--color-primary-shade-2)
}

html .markdown-output span.frame>span {
	border: 1px solid var(--color-secondary-text);
}

html .markdown-output span.frame span span {
	color: var(--color-secondary-text)
}

html .markdown-output code,html .markdown-output tt {
	background-color: var(--color-primary-shade-3);
	font-family: var(--font-monospace);
}

html .markdown-output .highlight pre,html .markdown-output pre {
	background-color: var(--color-primary-shade-3);
	font-family: var(--font-monospace);
}

html .markdown-output .csv-data .blob-num {
	background: var(--color-primary-shade-2);
}

html .markdown-output .csv-data th {
	background: #f6f8fa;
}</STYLE></DIV></DIV></div>





































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































	




























	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	






	
	
	
	
	
	






	
	
	
	
	
	</body></html>